<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Tech on Xan&#39;s Blog</title>
    <link>https://xancoding.cn/tags/tech/</link>
    <description>Recent content in Tech on Xan&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Thu, 15 Dec 2022 08:38:27 +0800</lastBuildDate><atom:link href="https://xancoding.cn/tags/tech/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>线性代数</title>
      <link>https://xancoding.cn/posts/linear-algebra/</link>
      <pubDate>Thu, 15 Dec 2022 08:38:27 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/linear-algebra/</guid>
      <description>&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/45707832&#34;&gt;MIT线性代数 | 笔记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1ix411f7Yp?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;MIT线性代数 | Vedio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1ys411472E/?spm_id_from=333.999.0.0&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;线性代数的本质 - 系列合集 | Vedio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/470439808&#34;&gt;考生必记：线性代数知识汇总 | 笔记&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
      <content:encoded><![CDATA[<ol>
<li><a href="https://zhuanlan.zhihu.com/p/45707832">MIT线性代数 | 笔记</a></li>
<li><a href="https://www.bilibili.com/video/BV1ix411f7Yp?spm_id_from=333.337.search-card.all.click&amp;vd_source=ae16ff6478eb15c1b87880540263910b">MIT线性代数 | Vedio</a></li>
<li><a href="https://www.bilibili.com/video/BV1ys411472E/?spm_id_from=333.999.0.0&amp;vd_source=ae16ff6478eb15c1b87880540263910b">线性代数的本质 - 系列合集 | Vedio</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/470439808">考生必记：线性代数知识汇总 | 笔记</a></li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>计算机系统基础</title>
      <link>https://xancoding.cn/posts/computer-system-fundamentals/</link>
      <pubDate>Tue, 15 Nov 2022 21:37:17 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/computer-system-fundamentals/</guid>
      <description>&lt;h1 id=&#34;计算机系统基础一程序的表示转换与链接&#34;&gt;计算机系统基础(一)——程序的表示、转换与链接&lt;/h1&gt;
&lt;h2 id=&#34;原码移码补码&#34;&gt;原码&amp;amp;移码&amp;amp;补码&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;原码
&lt;ul&gt;
&lt;li&gt;&lt;u&gt;最高位放符号位，1 表示负&lt;/u&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;定点小数，用来表示浮点数的尾数&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;移码
&lt;ul&gt;
&lt;li&gt;&lt;u&gt;真值加上一个偏置值 bias&lt;/u&gt;，$bias$ 常为 2&lt;sup&gt;n - 1&lt;/sup&gt; $or$ 2&lt;sup&gt;n - 1&lt;/sup&gt; - 1 (如 $IEEE 754$)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;定点整数，用来表示浮点数的阶&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;移码的本意是为了方便两个数作比较&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;补码
&lt;ul&gt;
&lt;li&gt;假设补码有 $n$ 位，则：&lt;strong&gt;x&lt;sub&gt;补&lt;/sub&gt; = 2&lt;sup&gt;n&lt;/sup&gt; + x&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;u&gt;数值为正数时，其值大小就是原码；为负时，其值的大小就是各位取反再加 1&lt;/u&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;补码表示带符号整数&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;补码的出现是为了解决计算机的减法运算问题&lt;/li&gt;
&lt;li&gt;求补码的真值——简便求法
&lt;ul&gt;
&lt;li&gt;符号为 0 ，则为正数，数值部分相同&lt;/li&gt;
&lt;li&gt;符号为 1，则为负数，数值各位取反，末位加 1&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;u&gt;各位取反，末位加 1 简便做法：从后往前看，找到第一个 1 ，将它前面的所有位取反&lt;/u&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;浮点数ieee754标准&#34;&gt;浮点数——$IEEE754$标准&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;u&gt;数符 + 阶码 + 尾数&lt;/u&gt;
&lt;ul&gt;
&lt;li&gt;Float $1 + 8 + 23$
&lt;ul&gt;
&lt;li&gt;$SP$：$(-1)$&lt;sup&gt;s&lt;/sup&gt;  $&lt;em&gt;$ $(1 + Significand)$ $&lt;/em&gt;$ $2$&lt;sup&gt;(Exponent  - 127)&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Double $1 + 11 + 52$
&lt;ul&gt;
&lt;li&gt;$DP$：$(-1)$&lt;sup&gt;s&lt;/sup&gt;  $&lt;em&gt;$ $(1 + Significand)$ $&lt;/em&gt;$ $2$&lt;sup&gt;(Exponent  - 1023)&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;数符 $Sign bit$
&lt;ul&gt;
&lt;li&gt;1 表示负数&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;阶码 $Exponent$
&lt;ul&gt;
&lt;li&gt;规格化阶码范围为 $0000 0001(-126) —— 1111 1110(127)$ $(single)$&lt;/li&gt;
&lt;li&gt;$bias$ 为 $127(single)$ $1023(double)$&lt;/li&gt;
&lt;li&gt;规格化阶范围为 $1——254$$(single)$&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;全 $0$ 和全 $1$ 用来表示特殊值&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;为避免混淆，用&lt;u&gt;阶码表示阶的编码&lt;/u&gt;，用&lt;u&gt;阶或指数表示阶码的值&lt;/u&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;尾数 $Significand$
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;规格化尾数最高位总是 $1$，所以隐含表示，省 $1$ 位，小数点前总是 $1$&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;特殊数的表示$(single)$
&lt;ul&gt;
&lt;li&gt;$0$
&lt;ul&gt;
&lt;li&gt;$阶码：all$ $zeros$&lt;/li&gt;
&lt;li&gt;$尾数：all$ $zeros$&lt;/li&gt;
&lt;li&gt;$+0：0$ $00000000$ $00000000000000000000000$&lt;/li&gt;
&lt;li&gt;$-0：1$ $00000000$ $00000000000000000000000$&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;$∞$
&lt;ul&gt;
&lt;li&gt;$阶码：all$ $ones$&lt;/li&gt;
&lt;li&gt;$尾数：all$ $zeros$&lt;/li&gt;
&lt;li&gt;$+∞：0$ $11111111$ $00000000000000000000000$&lt;/li&gt;
&lt;li&gt;$-∞：1$ $11111111$ $00000000000000000000000$&lt;/li&gt;
&lt;li&gt;浮点数除以 $0$ 的结果是 $∞$，而不是溢出异常(整数除以 $0$ 为异常)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;$NaN$  ($Not$ $a$ $Number$)
&lt;ul&gt;
&lt;li&gt;$阶码：all$ $ones$&lt;/li&gt;
&lt;li&gt;$尾数：nonzeros$&lt;/li&gt;
&lt;li&gt;&lt;u&gt;可帮助调试程序&lt;/u&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;非规格化数 $Denorms$&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;$阶码：all$ $zeros$&lt;/li&gt;
&lt;li&gt;$尾数：nonzeros$&lt;/li&gt;
&lt;li&gt;用于表示 $0$ 与规格化数间的$Gap$&lt;/li&gt;
&lt;li&gt;$SP$：$(-1)$&lt;sup&gt;s&lt;/sup&gt;  $&lt;em&gt;$ $(0.xxxx&amp;hellip;xxx)$ $&lt;/em&gt;$ $2$&lt;sup&gt;-126&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;为了让非规格化单精度浮点数能够平缓过渡到规格化单精度浮点数，所以取 $2$&lt;sup&gt;-126&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;u&gt;当输入数据为不可表示数时，机器将其转换为最邻近的可表示数&lt;/u&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;汉字内码ascii码&#34;&gt;汉字内码&amp;amp;ASCII码&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;u&gt;ASCII码为 7 位编码&lt;/u&gt;&lt;/li&gt;
&lt;li&gt;Ex：汉字 &amp;ldquo;$大$&amp;rdquo; 在码表中位于第 $20$ 行、第 $83$ 列。因此&lt;u&gt;区位码&lt;/u&gt;为 $0010100$ $1010011$，在区、位码上各加 $32$ 得到两个字节编码（&lt;u&gt;GB2312国标码&lt;/u&gt;），即 $00110100$ $01110011B$ $=$ $3473H$。前面的 $34 H$ 和 字符 $4$ 的 $ACSII$ 的最高位相同，后面的 $73H$ 和字符 $s$ 的 $ACSII$ 码相同。但是，将每个字节的最高位各设为 $1$ 后，就得到其&lt;u&gt;内码&lt;/u&gt;： $B4F3H$ ($0110100$ $11110011B$)，因而不会和 $ASCII$ 码混淆&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;逻辑电路&#34;&gt;逻辑电路&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;异或：$n$ 个数做异或运算，若有奇数个 $1$ ，则输出 $1$&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;推荐阅读&#34;&gt;推荐阅读&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1gx411n7aG/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;计算机系统基础(一)——程序的表示、转换与链接&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1Xx411E7qn/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;计算机系统基础(二)——异常、中断和输入/输出&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1jE411874k/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;计算机系统基础(三)——程序的执行和存储访问&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;以 &lt;code&gt;IA-32 + Linux + C + gcc&lt;/code&gt; 为平台&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1iW411d7hd?p=1&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;【精校中英字幕】2015 CMU 15-213 CSAPP 深入理解计算机系统&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://book.douban.com/subject/26912767/&#34;&gt;《深入理解计算机系统（原书第3版）》CSAPP&lt;/a&gt;&lt;/strong&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/26912767/&#34; urlstring=&#34;https://book.douban.com/subject/26912767/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<h1 id="计算机系统基础一程序的表示转换与链接">计算机系统基础(一)——程序的表示、转换与链接</h1>
<h2 id="原码移码补码">原码&amp;移码&amp;补码</h2>
<ol>
<li>原码
<ul>
<li><u>最高位放符号位，1 表示负</u></li>
<li><code>定点小数，用来表示浮点数的尾数</code></li>
</ul>
</li>
<li>移码
<ul>
<li><u>真值加上一个偏置值 bias</u>，$bias$ 常为 2<sup>n - 1</sup> $or$ 2<sup>n - 1</sup> - 1 (如 $IEEE 754$)</li>
<li><code>定点整数，用来表示浮点数的阶</code></li>
<li>移码的本意是为了方便两个数作比较</li>
</ul>
</li>
<li>补码
<ul>
<li>假设补码有 $n$ 位，则：<strong>x<sub>补</sub> = 2<sup>n</sup> + x</strong></li>
<li><u>数值为正数时，其值大小就是原码；为负时，其值的大小就是各位取反再加 1</u></li>
<li><code>补码表示带符号整数</code></li>
<li>补码的出现是为了解决计算机的减法运算问题</li>
<li>求补码的真值——简便求法
<ul>
<li>符号为 0 ，则为正数，数值部分相同</li>
<li>符号为 1，则为负数，数值各位取反，末位加 1</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li><u>各位取反，末位加 1 简便做法：从后往前看，找到第一个 1 ，将它前面的所有位取反</u></li>
</ul>
<h2 id="浮点数ieee754标准">浮点数——$IEEE754$标准</h2>
<ul>
<li><u>数符 + 阶码 + 尾数</u>
<ul>
<li>Float $1 + 8 + 23$
<ul>
<li>$SP$：$(-1)$<sup>s</sup>  $<em>$ $(1 + Significand)$ $</em>$ $2$<sup>(Exponent  - 127)</sup></li>
</ul>
</li>
<li>Double $1 + 11 + 52$
<ul>
<li>$DP$：$(-1)$<sup>s</sup>  $<em>$ $(1 + Significand)$ $</em>$ $2$<sup>(Exponent  - 1023)</sup></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>数符 $Sign bit$
<ul>
<li>1 表示负数</li>
</ul>
</li>
<li>阶码 $Exponent$
<ul>
<li>规格化阶码范围为 $0000 0001(-126) —— 1111 1110(127)$ $(single)$</li>
<li>$bias$ 为 $127(single)$ $1023(double)$</li>
<li>规格化阶范围为 $1——254$$(single)$</li>
<li><strong>全 $0$ 和全 $1$ 用来表示特殊值</strong></li>
<li>为避免混淆，用<u>阶码表示阶的编码</u>，用<u>阶或指数表示阶码的值</u></li>
</ul>
</li>
<li>尾数 $Significand$
<ul>
<li><strong>规格化尾数最高位总是 $1$，所以隐含表示，省 $1$ 位，小数点前总是 $1$</strong></li>
</ul>
</li>
</ol>
<ul>
<li>特殊数的表示$(single)$
<ul>
<li>$0$
<ul>
<li>$阶码：all$ $zeros$</li>
<li>$尾数：all$ $zeros$</li>
<li>$+0：0$ $00000000$ $00000000000000000000000$</li>
<li>$-0：1$ $00000000$ $00000000000000000000000$</li>
</ul>
</li>
<li>$∞$
<ul>
<li>$阶码：all$ $ones$</li>
<li>$尾数：all$ $zeros$</li>
<li>$+∞：0$ $11111111$ $00000000000000000000000$</li>
<li>$-∞：1$ $11111111$ $00000000000000000000000$</li>
<li>浮点数除以 $0$ 的结果是 $∞$，而不是溢出异常(整数除以 $0$ 为异常)</li>
</ul>
</li>
<li>$NaN$  ($Not$ $a$ $Number$)
<ul>
<li>$阶码：all$ $ones$</li>
<li>$尾数：nonzeros$</li>
<li><u>可帮助调试程序</u></li>
</ul>
</li>
<li><strong>非规格化数 $Denorms$</strong>
<ul>
<li>$阶码：all$ $zeros$</li>
<li>$尾数：nonzeros$</li>
<li>用于表示 $0$ 与规格化数间的$Gap$</li>
<li>$SP$：$(-1)$<sup>s</sup>  $<em>$ $(0.xxxx&hellip;xxx)$ $</em>$ $2$<sup>-126</sup></li>
<li>为了让非规格化单精度浮点数能够平缓过渡到规格化单精度浮点数，所以取 $2$<sup>-126</sup></li>
<li><u>当输入数据为不可表示数时，机器将其转换为最邻近的可表示数</u></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="汉字内码ascii码">汉字内码&amp;ASCII码</h2>
<ul>
<li><u>ASCII码为 7 位编码</u></li>
<li>Ex：汉字 &ldquo;$大$&rdquo; 在码表中位于第 $20$ 行、第 $83$ 列。因此<u>区位码</u>为 $0010100$ $1010011$，在区、位码上各加 $32$ 得到两个字节编码（<u>GB2312国标码</u>），即 $00110100$ $01110011B$ $=$ $3473H$。前面的 $34 H$ 和 字符 $4$ 的 $ACSII$ 的最高位相同，后面的 $73H$ 和字符 $s$ 的 $ACSII$ 码相同。但是，将每个字节的最高位各设为 $1$ 后，就得到其<u>内码</u>： $B4F3H$ ($0110100$ $11110011B$)，因而不会和 $ASCII$ 码混淆</li>
</ul>
<h2 id="逻辑电路">逻辑电路</h2>
<ul>
<li>异或：$n$ 个数做异或运算，若有奇数个 $1$ ，则输出 $1$</li>
</ul>
<h1 id="推荐阅读">推荐阅读</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1gx411n7aG/?spm_id_from=333.337.search-card.all.click&amp;vd_source=ae16ff6478eb15c1b87880540263910b">计算机系统基础(一)——程序的表示、转换与链接</a></li>
<li><a href="https://www.bilibili.com/video/BV1Xx411E7qn/?spm_id_from=333.337.search-card.all.click&amp;vd_source=ae16ff6478eb15c1b87880540263910b">计算机系统基础(二)——异常、中断和输入/输出</a></li>
<li><a href="https://www.bilibili.com/video/BV1jE411874k/?spm_id_from=333.337.search-card.all.click&amp;vd_source=ae16ff6478eb15c1b87880540263910b">计算机系统基础(三)——程序的执行和存储访问</a>
<ul>
<li>以 <code>IA-32 + Linux + C + gcc</code> 为平台</li>
</ul>
</li>
<li><a href="https://www.bilibili.com/video/BV1iW411d7hd?p=1&amp;vd_source=ae16ff6478eb15c1b87880540263910b">【精校中英字幕】2015 CMU 15-213 CSAPP 深入理解计算机系统</a></li>
</ul>
<hr>
<ul>
<li><strong><a href="https://book.douban.com/subject/26912767/">《深入理解计算机系统（原书第3版）》CSAPP</a></strong>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26912767/" urlstring="https://book.douban.com/subject/26912767/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>计算机程序的构造和解释</title>
      <link>https://xancoding.cn/posts/sicp/</link>
      <pubDate>Tue, 15 Nov 2022 14:34:16 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/sicp/</guid>
      <description>&lt;h1 id=&#34;为什么-sicp-非常重要&#34;&gt;为什么 SICP 非常重要&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;它将注意力重点放在了抽象的核心思想之上 —— 从特定问题直至构建软件工具，帮助你探求一般性的规律&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;学习 SICP 之于编程就像学习 学习 本身&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;学习 SICP 的目的是为了学会 控制大型系统复杂度 的技术&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;推荐阅读&#34;&gt;推荐阅读&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1v64y1Q78o/?p=5&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;【计算机程序的构造和解释】精译【UC Berkeley 公开课-CS61A (Spring 2021)】-中英双语字幕&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.fujiji.com/why-structure-and-interpretation-of-computer-programs-matters/#:~:text=%E4%BB%8E%E5%BE%88%E5%A4%9A%E6%96%B9%E9%9D%A2%E6%9D%A5%E7%9C%8B,%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%9A%84%E5%85%B7%E4%BD%93%E7%BB%86%E8%8A%82%E3%80%82&#34;&gt;为什么 SICP 非常重要&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://juejin.cn/post/6844903861056978957&#34;&gt;魔法书《SICP》的简明介绍 - 为什么要学习SICP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.yinwang.org/blog-cn/2017/07/06/master-pl&#34;&gt;如何掌握所有的程序语言&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/ikventure/p/14984919.html#%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0&#34;&gt;[2021 Spring] CS61A 学习笔记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://pythontutor.com/composingprograms.html#mode=edit&#34;&gt;Python tutor&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://inst.eecs.berkeley.edu/~cs61a/sp21/&#34;&gt;CS 61A: Structure and Interpretation of Computer Programs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/1148282/&#34;&gt;计算机程序的构造和解释(原书第2版)&lt;/a&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/1148282/&#34; urlstring=&#34;https://book.douban.com/subject/1148282/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<h1 id="为什么-sicp-非常重要">为什么 SICP 非常重要</h1>
<blockquote>
<p><strong>它将注意力重点放在了抽象的核心思想之上 —— 从特定问题直至构建软件工具，帮助你探求一般性的规律</strong></p>
<p><strong>学习 SICP 之于编程就像学习 学习 本身</strong></p>
<p><strong>学习 SICP 的目的是为了学会 控制大型系统复杂度 的技术</strong></p>
</blockquote>
<h1 id="推荐阅读">推荐阅读</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1v64y1Q78o/?p=5&amp;vd_source=ae16ff6478eb15c1b87880540263910b">【计算机程序的构造和解释】精译【UC Berkeley 公开课-CS61A (Spring 2021)】-中英双语字幕</a></li>
</ul>
<hr>
<ul>
<li><a href="http://blog.fujiji.com/why-structure-and-interpretation-of-computer-programs-matters/#:~:text=%E4%BB%8E%E5%BE%88%E5%A4%9A%E6%96%B9%E9%9D%A2%E6%9D%A5%E7%9C%8B,%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%9A%84%E5%85%B7%E4%BD%93%E7%BB%86%E8%8A%82%E3%80%82">为什么 SICP 非常重要</a></li>
<li><a href="https://juejin.cn/post/6844903861056978957">魔法书《SICP》的简明介绍 - 为什么要学习SICP</a></li>
<li><a href="https://www.yinwang.org/blog-cn/2017/07/06/master-pl">如何掌握所有的程序语言</a></li>
</ul>
<hr>
<ul>
<li><a href="https://www.cnblogs.com/ikventure/p/14984919.html#%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0">[2021 Spring] CS61A 学习笔记</a></li>
<li><a href="https://pythontutor.com/composingprograms.html#mode=edit">Python tutor</a></li>
<li><a href="https://inst.eecs.berkeley.edu/~cs61a/sp21/">CS 61A: Structure and Interpretation of Computer Programs</a></li>
</ul>
<hr>
<ul>
<li><a href="https://book.douban.com/subject/1148282/">计算机程序的构造和解释(原书第2版)</a>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/1148282/" urlstring="https://book.douban.com/subject/1148282/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>汇编语言</title>
      <link>https://xancoding.cn/posts/assembly-language/</link>
      <pubDate>Tue, 15 Nov 2022 13:16:12 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/assembly-language/</guid>
      <description>&lt;h1 id=&#34;汇编语言是什么&#34;&gt;汇编语言是什么？&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;汇编语言是任何一种用于电子计算机、微处理器、微控制器，或其他可编程器件的低级语言&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;检测点答案部分&#34;&gt;检测点答案（部分）&lt;/h1&gt;
&lt;h2 id=&#34;检测点21&#34;&gt;检测点2.1&lt;/h2&gt;
&lt;p&gt;（2）最多使用 4 条指令，编程计算 2 的 4 次方&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mov ax, 2H
add ax, ax
add ax, ax
add ax, ax
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;检测点31&#34;&gt;检测点3.1&lt;/h2&gt;
&lt;p&gt;（2）&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mov ax,6622H
jmp 0ff0:0100
mov ax,2000H
mov ds,ax
mov ax,[0008]
mov ax,[0002]
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;指令&lt;/th&gt;
&lt;th&gt;CS&lt;/th&gt;
&lt;th&gt;IP&lt;/th&gt;
&lt;th&gt;DS&lt;/th&gt;
&lt;th&gt;AX&lt;/th&gt;
&lt;th&gt;BX&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;mov ax, 6622H&lt;/td&gt;
&lt;td&gt;2000H&lt;/td&gt;
&lt;td&gt;0003H&lt;/td&gt;
&lt;td&gt;1000H&lt;/td&gt;
&lt;td&gt;6622H&lt;/td&gt;
&lt;td&gt;0000H&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;jmp 0ff0:0100&lt;/td&gt;
&lt;td&gt;0ff0H&lt;/td&gt;
&lt;td&gt;0100H&lt;/td&gt;
&lt;td&gt;1000H&lt;/td&gt;
&lt;td&gt;6622H&lt;/td&gt;
&lt;td&gt;0000H&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mov ax, 2000H&lt;/td&gt;
&lt;td&gt;0ff0H&lt;/td&gt;
&lt;td&gt;0103H&lt;/td&gt;
&lt;td&gt;1000H&lt;/td&gt;
&lt;td&gt;2000H&lt;/td&gt;
&lt;td&gt;0000H&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mov ds, ax&lt;/td&gt;
&lt;td&gt;0ff0H&lt;/td&gt;
&lt;td&gt;0105H&lt;/td&gt;
&lt;td&gt;2000H&lt;/td&gt;
&lt;td&gt;2000H&lt;/td&gt;
&lt;td&gt;0000H&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mov ax, [0008]&lt;/td&gt;
&lt;td&gt;0ff0H&lt;/td&gt;
&lt;td&gt;0108H&lt;/td&gt;
&lt;td&gt;2000H&lt;/td&gt;
&lt;td&gt;C389H&lt;/td&gt;
&lt;td&gt;0000H&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mov ax, [0002]&lt;/td&gt;
&lt;td&gt;0ff0H&lt;/td&gt;
&lt;td&gt;010BH&lt;/td&gt;
&lt;td&gt;2000H&lt;/td&gt;
&lt;td&gt;EA66H&lt;/td&gt;
&lt;td&gt;0000H&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;检测点32&#34;&gt;检测点3.2&lt;/h2&gt;
&lt;p&gt;（1）&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mov ax,2000H 
mov ss,ax
mov sp,0010H
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;（2）&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mov ax,1000H 
mov ss,ax
mov sp,0000H 
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;课后实验&#34;&gt;课后实验&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 实验一&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 实验二&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 实验三
（3）PSP 的内容

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2023/01/06/63b7de3f90329.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2023/01/06/63b7de3f90329.png&#34; alt=&#34;Snipaste_2023-01-06_16-39-17.png&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;&lt;input checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 实验四
（2）&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;assume cs:code

code segment

	mov ax, 0020H
	mov ds, ax        ;(ds) = 0020H 

	mov bx, 0         ;ds:bx 指向 0020:0，即 0:200

	mov cx, 40H       ;循环 64 次

s:  mov ds:[bx], bx   ;((ds) * 16 + bx)) = bx
	inc bx
	loop s

	mov ax, 4c00h
	int 21h

code ends

end
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;（3）&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;assume cs:code
code segment

	mov ax, code
	mov ds, ax
	mov ax, 0020h
	mov es, ax
	mov bx, 0
	mov cx, 17
  s:
	mov al, [bx]
    mov es:[bx], al
    inc bx
    loop s
    mov ax, 4c00h
    int 21h

code ends
end
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;input disabled=&#34;&#34; type=&#34;checkbox&#34;&gt; 实验五
（1）&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;assume cs:code, ds:data, ss:stack

data segment 
		dw 0123h, 0456h, 0789h, 0abch, 0defh, 0fedh, 0cbah, 0987h
data ends

stack segment 
		dw 0, 0, 0, 0, 0, 0, 0, 0
stack ends

code segment 

start: 
		mov ax, stack 
		mov ss, ax
		mov sp, 16
		
		mov ax, data
		mov ds, ax

		push ds:[0]
		push ds:[2]
		pop ds:[2]
		pop ds:[0]

		mov ax, 4c00h 
		int 21h

code ends

end start
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;（2）&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;assume cs:code, ds:data, ss:stack

data segment 
		dw 0123H, 0456H
data ends

stack segment 
		dw 0, 0
stack ends

code segment 

start: 
		mov ax, stack 
		mov ss, ax
		mov sp, 16
		
		mov ax, data
		mov ds, ax

		push ds:[0]
		push ds:[2]
		pop ds:[2]
		pop ds:[0]

		mov ax, 4c00h 
		int 21h

code ends

end start
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;（3）&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;assume cs:code, ds:data, ss:stack

code segment 

start: 
		mov ax, stack 
		mov ss, ax
		mov sp, 16
		
		mov ax, data
		mov ds, ax

		push ds:[0]
		push ds:[2]
		pop ds:[2]
		pop ds:[0]

		mov ax, 4c00h 
		int 21h

code ends

data segment 
		dw 0123H, 0456H
data ends

stack segment 
		dw 0, 0
stack ends

end start
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;（4）都能执行，但只有程序(3)可以正确执行，因为程序 加载后会从程序第一个单元开始执行，但只有（3）中的code段在程序 的开始位置，所以所以只有(3)中的程序 是可以正确执行的
（5）&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;assume cs:code

a segment 
		db 1, 2, 3, 4, 5, 6, 7, 8    ; db定义字节单元数据、dw字义字单元数据、dd定义双字单元数据
a ends

b segment 
		db 1, 2, 3, 4, 5, 6, 7, 8
b ends

c segment 
		db 0, 0, 0, 0, 0, 0, 0, 0
c ends

code segment 

start: 
		mov ax, a
		mov ds, ax               ; ds定位到a段

		mov ax, b
		mov es, ax               ; es定位到b段

		mov bx, 0                ; 偏移地址
		mov cx, 8                ; 循环次数8次
	s:  
		mov dl, ds:[bx]
		add dl, es:[bx]
		mov ds:[bx+32], dl       ; 将dl的数值传送到c段的偏移位置
                                 ; 由于push与pop指令只对字操作，而这里要操作的是字节，所以不能用push和pop传送数据
		inc bx
		loop s

		mov ax, 4c00h 
		int 21h

code ends

end start
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;推荐阅读&#34;&gt;推荐阅读&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1Gf4y1w75t/?vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;Win10下配置汇编语言 （王爽）实验环境&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/sanmianti/AssemblyLanguageTest/blob/master/%E3%80%8A%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E3%80%8B%E7%AC%AC%E4%B8%89%E7%89%88%E6%A3%80%E6%B5%8B%E7%82%B9%E7%AD%94%E6%A1%88.md&#34;&gt;《汇编语言》第三版检测点答案&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://tinylab.org/assembly/&#34;&gt;《汇编语言 王爽著》课后实验参考答案&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/35038473/&#34;&gt;《汇编语言（第4版）》&lt;/a&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/35038473/&#34; urlstring=&#34;https://book.douban.com/subject/35038473/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<h1 id="汇编语言是什么">汇编语言是什么？</h1>
<blockquote>
<p><strong>汇编语言是任何一种用于电子计算机、微处理器、微控制器，或其他可编程器件的低级语言</strong></p>
</blockquote>
<h1 id="检测点答案部分">检测点答案（部分）</h1>
<h2 id="检测点21">检测点2.1</h2>
<p>（2）最多使用 4 条指令，编程计算 2 的 4 次方</p>
<pre tabindex="0"><code>mov ax, 2H
add ax, ax
add ax, ax
add ax, ax
</code></pre><h2 id="检测点31">检测点3.1</h2>
<p>（2）</p>
<ol>
<li></li>
</ol>
<pre tabindex="0"><code>mov ax,6622H
jmp 0ff0:0100
mov ax,2000H
mov ds,ax
mov ax,[0008]
mov ax,[0002]
</code></pre><ol start="2">
<li></li>
</ol>
<table>
<thead>
<tr>
<th>指令</th>
<th>CS</th>
<th>IP</th>
<th>DS</th>
<th>AX</th>
<th>BX</th>
</tr>
</thead>
<tbody>
<tr>
<td>mov ax, 6622H</td>
<td>2000H</td>
<td>0003H</td>
<td>1000H</td>
<td>6622H</td>
<td>0000H</td>
</tr>
<tr>
<td>jmp 0ff0:0100</td>
<td>0ff0H</td>
<td>0100H</td>
<td>1000H</td>
<td>6622H</td>
<td>0000H</td>
</tr>
<tr>
<td>mov ax, 2000H</td>
<td>0ff0H</td>
<td>0103H</td>
<td>1000H</td>
<td>2000H</td>
<td>0000H</td>
</tr>
<tr>
<td>mov ds, ax</td>
<td>0ff0H</td>
<td>0105H</td>
<td>2000H</td>
<td>2000H</td>
<td>0000H</td>
</tr>
<tr>
<td>mov ax, [0008]</td>
<td>0ff0H</td>
<td>0108H</td>
<td>2000H</td>
<td>C389H</td>
<td>0000H</td>
</tr>
<tr>
<td>mov ax, [0002]</td>
<td>0ff0H</td>
<td>010BH</td>
<td>2000H</td>
<td>EA66H</td>
<td>0000H</td>
</tr>
</tbody>
</table>
<h2 id="检测点32">检测点3.2</h2>
<p>（1）</p>
<pre tabindex="0"><code>mov ax,2000H 
mov ss,ax
mov sp,0010H
</code></pre><p>（2）</p>
<pre tabindex="0"><code>mov ax,1000H 
mov ss,ax
mov sp,0000H 
</code></pre><h1 id="课后实验">课后实验</h1>
<ul>
<li><input checked="" disabled="" type="checkbox"> 实验一</li>
<li><input checked="" disabled="" type="checkbox"> 实验二</li>
<li><input checked="" disabled="" type="checkbox"> 实验三
（3）PSP 的内容

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2023/01/06/63b7de3f90329.png">
<img src="https://bu.dusays.com/2023/01/06/63b7de3f90329.png" alt="Snipaste_2023-01-06_16-39-17.png"  />
</a>
</div>

</li>
<li><input checked="" disabled="" type="checkbox"> 实验四
（2）</li>
</ul>
<pre tabindex="0"><code>assume cs:code

code segment

	mov ax, 0020H
	mov ds, ax        ;(ds) = 0020H 

	mov bx, 0         ;ds:bx 指向 0020:0，即 0:200

	mov cx, 40H       ;循环 64 次

s:  mov ds:[bx], bx   ;((ds) * 16 + bx)) = bx
	inc bx
	loop s

	mov ax, 4c00h
	int 21h

code ends

end
</code></pre><p>（3）</p>
<pre tabindex="0"><code>assume cs:code
code segment

	mov ax, code
	mov ds, ax
	mov ax, 0020h
	mov es, ax
	mov bx, 0
	mov cx, 17
  s:
	mov al, [bx]
    mov es:[bx], al
    inc bx
    loop s
    mov ax, 4c00h
    int 21h

code ends
end
</code></pre><ul>
<li><input disabled="" type="checkbox"> 实验五
（1）</li>
</ul>
<pre tabindex="0"><code>assume cs:code, ds:data, ss:stack

data segment 
		dw 0123h, 0456h, 0789h, 0abch, 0defh, 0fedh, 0cbah, 0987h
data ends

stack segment 
		dw 0, 0, 0, 0, 0, 0, 0, 0
stack ends

code segment 

start: 
		mov ax, stack 
		mov ss, ax
		mov sp, 16
		
		mov ax, data
		mov ds, ax

		push ds:[0]
		push ds:[2]
		pop ds:[2]
		pop ds:[0]

		mov ax, 4c00h 
		int 21h

code ends

end start
</code></pre><p>（2）</p>
<pre tabindex="0"><code>assume cs:code, ds:data, ss:stack

data segment 
		dw 0123H, 0456H
data ends

stack segment 
		dw 0, 0
stack ends

code segment 

start: 
		mov ax, stack 
		mov ss, ax
		mov sp, 16
		
		mov ax, data
		mov ds, ax

		push ds:[0]
		push ds:[2]
		pop ds:[2]
		pop ds:[0]

		mov ax, 4c00h 
		int 21h

code ends

end start
</code></pre><p>（3）</p>
<pre tabindex="0"><code>assume cs:code, ds:data, ss:stack

code segment 

start: 
		mov ax, stack 
		mov ss, ax
		mov sp, 16
		
		mov ax, data
		mov ds, ax

		push ds:[0]
		push ds:[2]
		pop ds:[2]
		pop ds:[0]

		mov ax, 4c00h 
		int 21h

code ends

data segment 
		dw 0123H, 0456H
data ends

stack segment 
		dw 0, 0
stack ends

end start
</code></pre><p>（4）都能执行，但只有程序(3)可以正确执行，因为程序 加载后会从程序第一个单元开始执行，但只有（3）中的code段在程序 的开始位置，所以所以只有(3)中的程序 是可以正确执行的
（5）</p>
<pre tabindex="0"><code>assume cs:code

a segment 
		db 1, 2, 3, 4, 5, 6, 7, 8    ; db定义字节单元数据、dw字义字单元数据、dd定义双字单元数据
a ends

b segment 
		db 1, 2, 3, 4, 5, 6, 7, 8
b ends

c segment 
		db 0, 0, 0, 0, 0, 0, 0, 0
c ends

code segment 

start: 
		mov ax, a
		mov ds, ax               ; ds定位到a段

		mov ax, b
		mov es, ax               ; es定位到b段

		mov bx, 0                ; 偏移地址
		mov cx, 8                ; 循环次数8次
	s:  
		mov dl, ds:[bx]
		add dl, es:[bx]
		mov ds:[bx+32], dl       ; 将dl的数值传送到c段的偏移位置
                                 ; 由于push与pop指令只对字操作，而这里要操作的是字节，所以不能用push和pop传送数据
		inc bx
		loop s

		mov ax, 4c00h 
		int 21h

code ends

end start
</code></pre><h1 id="推荐阅读">推荐阅读</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1Gf4y1w75t/?vd_source=ae16ff6478eb15c1b87880540263910b">Win10下配置汇编语言 （王爽）实验环境</a></li>
<li><a href="https://github.com/sanmianti/AssemblyLanguageTest/blob/master/%E3%80%8A%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E3%80%8B%E7%AC%AC%E4%B8%89%E7%89%88%E6%A3%80%E6%B5%8B%E7%82%B9%E7%AD%94%E6%A1%88.md">《汇编语言》第三版检测点答案</a></li>
<li><a href="https://tinylab.org/assembly/">《汇编语言 王爽著》课后实验参考答案</a></li>
</ul>
<hr>
<ul>
<li><a href="https://book.douban.com/subject/35038473/">《汇编语言（第4版）》</a>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/35038473/" urlstring="https://book.douban.com/subject/35038473/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>C&#43;&#43; 学习路线</title>
      <link>https://xancoding.cn/posts/learning-cpp/</link>
      <pubDate>Tue, 15 Nov 2022 12:54:07 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/learning-cpp/</guid>
      <description>&lt;h1 id=&#34;入门&#34;&gt;入门&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;当您在 IDE 中创建新项目时，大多数 IDE 会为您设置两种不同的构建配置：发布配置和调试配置，开发程序时使用调试构建配置。当您准备好将可执行文件发布给其他人时，或者想要测试性能时，请使用发布构建配置
&lt;ol&gt;
&lt;li&gt;Debug：&lt;strong&gt;调试版本，&lt;/strong&gt; 包含调试信息，所以 &lt;strong&gt;容量比Release大很多，&lt;/strong&gt; 并且不进行任何优化（优化会使调试复杂化，因为源代码和生成的指令间关系会更复杂），便于程序员调试&lt;/li&gt;
&lt;li&gt;Release：&lt;strong&gt;发布版本，&lt;/strong&gt; 不对源代码进行调试，编译时对应用程序的速度进行优化，&lt;strong&gt;使得程序在代码大小和运行速度上都是最优的&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;对于 CLion 用户，您可以添加 Release：按 Alt+Ctrl+S 调出 Settings &amp;gt; Build，Execution，Deployment &amp;gt; CMake &amp;gt; 单击 Profiles 部分中的 + 按钮，将自动添加 Release 选项
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;禁用编译器扩展&lt;/strong&gt;以确保您的程序（和编码实践）保持符合 C++ 标准并且可以在任何系统上运行&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;CLion 使用 CMake 构建项目。
将行 set(CMAKE_CXX_EXTENSIONS OFF) 添加到 CMakeList.txt 以禁用扩展
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;将你的警告级别调到最大&lt;/strong&gt;，尤其是在你学习的时候。它将帮助您识别可能的问题&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;在 Clion（从 2021.3 版本开始）中，要将警告级别调到最高，您可以按 Alt+Ctrl+S 调出 Settings ，然后选择 Editor &amp;gt; Inspections &amp;gt; C/C++，然后手动选中所有框，或者在窗口的右侧，在矩形的 severity 框中选择错误，然后在另一个框中选择 In All Scopes
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;strong&gt;选择语言标准&lt;/strong&gt;：在专业环境中，通常选择比最新标准低一个或两个版本的语言标准（例如，现在 C++20 已经出来了，这意味着 C++14 或 C++17）。这样做通常是为了确保编译器制造商有机会解决缺陷，以便更好地理解新功能的最佳实践。在相关的情况下，这也有助于确保更好的跨平台兼容性，因为某些平台上的编译器可能不会立即为更新的语言标准提供全面支持。启用 C++17 语言标准（或更高版本）后，您应该能够在没有任何警告或错误的情况下编译以下代码&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#include &amp;lt;array&amp;gt;
#include &amp;lt;iostream&amp;gt;
#include &amp;lt;string_view&amp;gt;
#include &amp;lt;tuple&amp;gt;
#include &amp;lt;type_traits&amp;gt;

namespace a:🅱️:c
{
    inline constexpr std::string_view str{ &amp;#34;hello&amp;#34; };
}

template &amp;lt;class... T&amp;gt;
std::tuple&amp;lt;std::size_t, std::common_type_t&amp;lt;T...&amp;gt;&amp;gt; sum(T... args)
{
    return { sizeof...(T), (args + ...) };
}

int main()
{
    auto [iNumbers, iSum]{ sum(1, 2, 3) };
    std::cout &amp;lt;&amp;lt; a:🅱️:c::str &amp;lt;&amp;lt; &amp;#39; &amp;#39; &amp;lt;&amp;lt; iNumbers &amp;lt;&amp;lt; &amp;#39; &amp;#39; &amp;lt;&amp;lt; iSum &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;;

    std::array arr{ 1, 2, 3 };

    std::cout &amp;lt;&amp;lt; std::size(arr) &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;;

    return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;c-基础知识&#34;&gt;C++ 基础知识&lt;/h1&gt;
&lt;h2 id=&#34;注释&#34;&gt;注释&lt;/h2&gt;
&lt;h2 id=&#34;写在前面&#34;&gt;写在前面&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;通常，注释应该用于三件事
&lt;ol&gt;
&lt;li&gt;在库、程序或函数级别，使用注释来&lt;strong&gt;描述作用&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;在库、程序或函数内部，使用注释来描述&lt;strong&gt;如何操作&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;在语句级别，使用注释来&lt;strong&gt;描述原因&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;注释是一种很好的方式来提醒自己（或告诉别人）你做出一个决定而不是另一个决定的原因&lt;/li&gt;
&lt;li&gt;注释您的代码，像在对不知道代码功能的人说话一样写您的注释。不要假设你会记得你为什么做出特定的选择&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;单行注释&#34;&gt;单行注释&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;在行的右侧添加注释会使代码和注释都难以阅读，尤其是在行很长的情况下。如果行相当短，评论可以简单地对齐（通常是一个制表位），像这样：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;std::cout &amp;lt;&amp;lt; &amp;#34;Hello world!\n&amp;#34;;                 // std::cout lives in the iostream library
std::cout &amp;lt;&amp;lt; &amp;#34;It is very nice to meet you!\n&amp;#34;; // this is much easier to read
std::cout &amp;lt;&amp;lt; &amp;#34;Yeah!\n&amp;#34;;                        // don&amp;#39;t you think so?
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;但是，如果行很长，将注释放在右边会使行变得很长。在这种情况下，单行注释通常放在它正在注释的行之上：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// std::cout lives in the iostream library
std::cout &amp;lt;&amp;lt; &amp;#34;Hello world!\n&amp;#34;;

// this is much easier to read
std::cout &amp;lt;&amp;lt; &amp;#34;It is very nice to meet you!\n&amp;#34;;

// don&amp;#39;t you think so?
std::cout &amp;lt;&amp;lt; &amp;#34;Yeah!\n&amp;#34;;
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Commenting out code&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//    std::cout &amp;lt;&amp;lt; 1;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;多行注释&#34;&gt;多行注释&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Explaining code&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/* This is a multi-line comment.
 * the matching asterisks to the left
 * can make this easier to read
 */
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Commenting out code&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/*
    std::cout &amp;lt;&amp;lt; 1;
    std::cout &amp;lt;&amp;lt; 2;
    std::cout &amp;lt;&amp;lt; 3;
*/
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;初始化&#34;&gt;初始化&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Default initialization：默认初始化&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int a; // no initializer
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Copy initialization：在现代 C++ 中用的不多&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int width = 5; // copy initialization of value 5 into variable width
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Direct initialization：当在括号内提供初始化程序时，这称为直接初始化。最初引入直接初始化是为了更有效地初始化复杂对象。但是，与复制初始化一样，直接初始化在现代 C++ 中使用不多&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int width( 5 ); // direct initialization of value 5 into variable width
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Brace initialization：在 C++ 中初始化对象的现代方法是使用一种利用大括号的初始化形式&amp;ndash;&lt;strong&gt;大括号初始化&lt;/strong&gt;（也称为统一初始化或列表初始化）。引入大括号初始化是为了提供在大多数情况下都有效的&lt;strong&gt;更一致的初始化语法&lt;/strong&gt;（这就是为什么它有时被称为“统一初始化”）。此外，大括号初始化提供了&lt;strong&gt;一种使用值列表初始化对象的方法&lt;/strong&gt;（这就是为什么它有时被称为“列表初始化”）。大括号初始化有三种形式：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int width { 5 }; // direct brace initialization of value 5 into variable width (preferred)
int height = { 6 }; // copy brace initialization of value 6 into variable height
int depth {}; // value initialization 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;大括号初始化&lt;/strong&gt;有一个额外的好处：它不允许“缩小转换”。这意味着如果您尝试使用变量无法安全保存的值来初始化变量，&lt;strong&gt;编译器将产生错误，迫使您在继续之前解决这个问题&lt;/strong&gt;。例如：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int width { 4.5 }; // error: a number with a fractional value can&amp;#39;t fit into an int
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;stdendl-vs-n&#34;&gt;std::endl vs ‘\n’&lt;/h2&gt;
&lt;p&gt;使用 std::endl 可能有点低效，因为它实际上做了两个工作：它将光标移动到控制台的下一行，并确保任何缓存的输出立即显示在屏幕上（这称为刷新输出）。当使用 std::cout 将文本写入控制台时，std::cout 通常会刷新输出（如果不刷新，通常也无关紧要），因此让 std::endl 执行刷新很少重要&lt;/p&gt;
&lt;p&gt;因此，通常首选使用“\n”字符。 ‘\n’ 字符将光标移动到控制台的下一行，但不请求刷新，因此在刷新不会发生的情况下它会执行得更好。 ‘\n’ 字符也更易于阅读，因为它更短并且可以嵌入到现有文本中&lt;/p&gt;
&lt;p&gt;这是一个以两种不同方式使用“\n”的示例：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#include &amp;lt;iostream&amp;gt; // for std::cout

int main()
{
    int x{ 5 };
    std::cout &amp;lt;&amp;lt; &amp;#34;x is equal to: &amp;#34; &amp;lt;&amp;lt; x &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;; // Using &amp;#39;\n&amp;#39; standalone
    std::cout &amp;lt;&amp;lt; &amp;#34;And that&amp;#39;s all, folks!\n&amp;#34;; // Using &amp;#39;\n&amp;#39; embedded into a double-quoted piece of text (note: no single quotes when used this way)
    return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这打印：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;x is equal to: 5
And that&amp;#39;s all, folks!
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;将文本输出到控制台时，优先使用“\n”而不是 std::endl&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;代码的可读性&#34;&gt;代码的可读性&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;您的行的长度不应超过 80 个字符&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int main()
{
    std::cout &amp;lt;&amp;lt; &amp;#34;This is a really, really, really, really, really, really, really, &amp;#34;
        &amp;#34;really long line\n&amp;#34;; // one extra indentation for continuation line

    std::cout &amp;lt;&amp;lt; &amp;#34;This is another really, really, really, really, really, really, really, &amp;#34;
                 &amp;#34;really long line\n&amp;#34;; // text aligned with the previous line for continuation line

    std::cout &amp;lt;&amp;lt; &amp;#34;This one is short\n&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果用操作符（例如 &amp;laquo; 或 +）拆分长行，则应将操作符放在下一行的开头，而不是当前行的结尾&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;std::cout &amp;lt;&amp;lt; 3 + 4
    + 5 + 6
    * 7 * 8;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;许多编辑器都有一个内置功能（或插件/扩展），可以在给定的列（例如 80 个字符）处显示一行（称为“列指南”），因此您可以轻松查看行何时变得太长&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Clion column guide&lt;/strong&gt; : File &amp;gt; Settings &amp;gt; Editor &amp;gt; Code Style &amp;gt; General &amp;gt; 在 &amp;ldquo;Visual guides&amp;rdquo; 矩形框中键入 80 并应用更改
2. 使用空格通过对齐值或注释或在代码块之间添加间距来使您的代码更易于阅读&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cost          = 57;
pricePerItem  = 24;
value         = 5;
numberOfItems = 17;

std::cout &amp;lt;&amp;lt; &amp;#34;Hello world!\n&amp;#34;;                  // cout lives in the iostream library
std::cout &amp;lt;&amp;lt; &amp;#34;It is very nice to meet you!\n&amp;#34;;  // these comments are easier to read
std::cout &amp;lt;&amp;lt; &amp;#34;Yeah!\n&amp;#34;;                         // especially when all lined up

// cout lives in the iostream library
std::cout &amp;lt;&amp;lt; &amp;#34;Hello world!\n&amp;#34;;

// these comments are easier to read
std::cout &amp;lt;&amp;lt; &amp;#34;It is very nice to meet you!\n&amp;#34;;

// when separated by whitespace
std::cout &amp;lt;&amp;lt; &amp;#34;Yeah!\n&amp;#34;;
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;c-基础函数和文件&#34;&gt;C++ 基础：函数和文件&lt;/h1&gt;
&lt;h2 id=&#34;函数返回值&#34;&gt;函数返回值&lt;/h2&gt;
&lt;p&gt;C++标准只定义了3种状态码的含义：0、EXIT_SUCCESS、EXIT_FAILURE。 0 和 EXIT_SUCCESS 都表示程序执行成功。 EXIT_FAILURE 表示程序没有成功执行&lt;/p&gt;
&lt;p&gt;EXIT_SUCCESS 和 EXIT_FAILURE 是 &lt;code&gt;&amp;lt;cstdlib&amp;gt;&lt;/code&gt; 标头中定义的预处理器宏：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#include &amp;lt;cstdlib&amp;gt; // for EXIT_SUCCESS and EXIT_FAILURE

int main()
{
    return EXIT_SUCCESS;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果你想最大限度地提高可移植性，你应该只使用 0 或 EXIT_SUCCESS 来指示成功终止，或者使用 EXIT_FAILURE 来指示不成功终止&lt;/p&gt;
&lt;h2 id=&#34;前向声明和定义&#34;&gt;前向声明和定义&lt;/h2&gt;
&lt;p&gt;对于以下每个程序，说明它们是编译失败、链接失败、两者都失败，还是编译和链接成功。如果您不确定，请尝试编译它们！&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; add(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;3 + 4 + 5 = &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; add(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; add(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; x + y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Doesn’t compile. The compiler will complain that the add() called in main() does not have the same number of parameters as the one that was forward declared.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; add(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;3 + 4 + 5 = &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; add(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; add(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; z)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; x + y + z;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Doesn’t compile. The compiler will complain that it can’t find a matching add() function that takes 3 arguments, because the add() function that was forward declared only takes 2 arguments.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; add(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;3 + 4 = &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; add(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; add(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; z)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; x + y + z;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Doesn’t link. The compiler will match the forward declaration of add to the function call to add() in main(). However, no add() function that takes two parameters was ever implemented (we only implemented one that took 3 parameters), so the linker will complain.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; add(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; z);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;3 + 4 + 5 = &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; add(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; add(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; z)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; x + y + z;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Compiles and links. The function call to add() matches the forward declaration, the implemented function also matches.&lt;/p&gt;
&lt;h2 id=&#34;具有多个cpp文件的程序&#34;&gt;具有多个cpp文件的程序&lt;/h2&gt;
&lt;h3 id=&#34;cpp-文件&#34;&gt;.cpp 文件&lt;/h3&gt;
&lt;p&gt;编译器会单独编译每个文件。它不知道其他代码文件的内容，也不记得它从以前编译的代码文件中看到的任何内容。这种有限的可见性和短内存是有意的，因此文件可能具有名称相同的函数或变量而不会相互冲突。&lt;/p&gt;
&lt;p&gt;C++ 语言支持&amp;quot;分别编译&amp;quot;（separatecompilation）。也就是说，一个程序所有的内容，可以分成不同的部分分别放在不同的 .cpp 文件里。.cpp 文件里的东西都是相对独立的，在编译（compile）时不需要与其他文件互通，只需要在编译成目标文件后再与其他的目标文件做一次链接（link）就行了。比如，在文件 a.cpp 中定义了一个全局函数 &amp;ldquo;void a(){}&amp;quot;，而在文件 b.cpp 中需要调用这个函数。即使这样，文件 a.cpp 和文件 b.cpp 并不需要相互知道对方的存在，而是可以分别地对它们进行编译，编译成目标文件之后再链接，整个程序就可以运行了&lt;/p&gt;
&lt;p&gt;这是怎么实现的呢？从写程序的角度来讲，很简单。在文件 b.cpp 中，在调用 &amp;ldquo;void a()&amp;rdquo; 函数之前，先&lt;strong&gt;声明一下&lt;/strong&gt;这个函数 &amp;ldquo;voida();&amp;quot;，就可以了。这是因为编译器在编译 b.cpp 的时候会生成一个符号表（symbol table），像 &amp;ldquo;void a()&amp;rdquo; 这样的看不到定义的符号，就会被存放在这个表中。再进行链接的时候，编译器就会在别的目标文件中去寻找这个符号的定义。一旦找到了，程序也就可以顺利地生成了&lt;/p&gt;
&lt;h3 id=&#34;h-文件&#34;&gt;.h 文件&lt;/h3&gt;
&lt;p&gt;考虑一下，如果有一个很常用的函数 &amp;ldquo;void f() {}&amp;quot;，在整个程序中的许多 .cpp 文件中都会被调用，那么，我们就只需要在一个文件中定义这个函数，而在其他的文件中声明这个函数就可以了。一个函数还好对付，声明起来也就一句话。但是，如果函数多了，比如是一大堆的数学函数，有好几百个，那怎么办？&lt;/p&gt;
&lt;p&gt;头文件允许我们将声明放在一个位置，然后在我们需要的地方导入它们。这可以在多文件程序中节省大量的输入&lt;/p&gt;
&lt;p&gt;头文件通常只包含函数和变量声明，而不包含函数和变量定义（否则可能会导致违反单一定义规则）。&lt;strong&gt;符号常量&lt;/strong&gt;是一个例外&lt;/p&gt;
&lt;p&gt;使用双引号 &lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt; 包括您编写的或预期在当前目录中找到的头文件&lt;/p&gt;
&lt;p&gt;使用尖括号 &lt;code&gt;&amp;lt;&amp;gt;&lt;/code&gt; 来包含编译器、操作系统或您在系统其他位置安装的第三方库附带的标头&lt;/p&gt;
&lt;h4 id=&#34;为什么-iostream-没有-h-扩展名&#34;&gt;为什么 iostream 没有 .h 扩展名？&lt;/h4&gt;
&lt;p&gt;首次创建 C++ 时，标准库中的所有文件都以 .h 后缀结尾。生活是一致的，而且很好。 cout 和 cin 的原始版本在 iostream.h 中声明。当 ANSI 委员会对该语言进行标准化时，他们决定将标准库中使用的所有名称移动到 std 命名空间中，以帮助避免与用户定义的标识符发生命名冲突。然而，这带来了一个问题：如果他们将所有名称移动到 std 名称空间中，那么旧程序（包括 iostream.h）将不再工作！&lt;/p&gt;
&lt;p&gt;为解决此问题，引入了一组缺少 .h 扩展名的新头文件。这些新的头文件定义了 std 命名空间内的所有名称。这样，包含 &lt;code&gt;#include &amp;lt;iostream.h&amp;gt;&lt;/code&gt; 的旧程序不需要重写，新程序可以 &lt;code&gt;#include &amp;lt;iostream&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;include来自其他目录的头文件&#34;&gt;Include来自其他目录的头文件&lt;/h4&gt;
&lt;p&gt;一种（不好的）方法是在#include 行中包含一个指向您要包含的头文件的相对路径。例如：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;#34;headers/myHeader.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;#34;../moreHeaders/myOtherHeader.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;虽然这会编译（假设文件存在于那些相对目录中），但这种方法的缺点是它需要您在代码中反映您的目录结构。如果您更新了目录结构，您的代码将不再有效&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;更好的方法&lt;/strong&gt;是告诉你的编译器或 IDE 你在其他位置有一堆头文件，这样当它在当前目录中找不到它们时就会去那里寻找。这通常可以通过在 IDE 项目设置中设置包含路径或搜索目录来完成&lt;/p&gt;
&lt;p&gt;这种方法的好处是，如果您更改了目录结构，您只需更改一个编译器或 IDE 设置，而不是每个代码文件&lt;/p&gt;
&lt;h4 id=&#34;headers-may-include-other-headers&#34;&gt;Headers may include other headers&lt;/h4&gt;
&lt;p&gt;当您的代码文件 &lt;code&gt;#includes&lt;/code&gt; 第一个头文件时，您还将获得第一个头文件包含的任何其他头文件（以及那些包含的任何头文件，等等）。这些额外的头文件有时称为传递包含，因为它们是隐式包含而不是显式包含&lt;/p&gt;
&lt;p&gt;每个文件都应该 &lt;code&gt;显式#include&lt;/code&gt; 它需要编译的所有头文件。不要依赖从其他标头传递过来的标头&lt;/p&gt;
&lt;h4 id=&#34;include-头文件顺序&#34;&gt;include 头文件顺序&lt;/h4&gt;
&lt;p&gt;如果你的头文件写得正确并且&lt;code&gt;#include&lt;/code&gt;了他们需要的一切，那么包含的顺序应该无关紧要&lt;/p&gt;
&lt;p&gt;现在考虑以下场景：假设 header A 需要 header  B 的声明，但忘记包含它。在我们的代码文件中，如果我们在 header  A 之前包含 header  B，我们的代码仍然可以编译！这是因为编译器会先编译 B 中的所有声明，然后再编译 A 中依赖于这些声明的代码&lt;/p&gt;
&lt;p&gt;但是，如果我们首先包含 header  A，那么编译器会报错，因为 A 的代码将在编译器看到 B 的声明之前编译。这实际上是更可取的，因为错误已经浮出水面，然后我们可以修复它.&lt;/p&gt;
&lt;p&gt;为了最大限度地提高编译器标记缺少包含的机会，请按以下方式命令您的&lt;code&gt;#includes&lt;/code&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The paired header file&lt;/li&gt;
&lt;li&gt;Other headers from your project&lt;/li&gt;
&lt;li&gt;3rd party library headers&lt;/li&gt;
&lt;li&gt;Standard library headers&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The headers for each grouping should be sorted alphabetically（按字母顺序排序）.&lt;/p&gt;
&lt;p&gt;这样，如果您的某个用户定义的 Header 缺少第 3 方库或标准库 Header 的&lt;code&gt;#include&lt;/code&gt;，则更有可能导致编译错误，因此您可以修复它&lt;/p&gt;
&lt;h4 id=&#34;header-file-best-practices&#34;&gt;Header file best practices&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;始终 include header guards&lt;/li&gt;
&lt;li&gt;不要在头文件中定义变量和函数（全局常量是一个例外）&lt;/li&gt;
&lt;li&gt;为头文件指定与其关联的源文件相同的名称（例如，grades.h 与 grades.cpp 配对）&lt;/li&gt;
&lt;li&gt;每个头文件应该有一个特定的工作，并且尽可能独立。例如，您可以将与功能 A 相关的所有声明放在 A.h 中，将与功能 B 相关的所有声明放在 B.h 中。这样如果你以后只关心 A，你可以只 include A.h 而不会得到任何与 B 相关的东西&lt;/li&gt;
&lt;li&gt;请注意您需要为代码文件中使用的功能显式包含哪些 header&lt;/li&gt;
&lt;li&gt;您编写的每个 header 都应该自行编译（它应该&lt;code&gt;#include&lt;/code&gt; 它需要的每个依赖项）&lt;/li&gt;
&lt;li&gt;仅 &lt;code&gt;#include&lt;/code&gt; 您需要的内容（不要仅仅因为可以就包含所有内容）&lt;/li&gt;
&lt;li&gt;不要&lt;code&gt;#include&lt;/code&gt; .cpp 文件&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;header-guards&#34;&gt;Header guards&lt;/h4&gt;
&lt;p&gt;使用头文件，很容易导致头文件中的定义被多次包含的情况。当一个头文件 &lt;code&gt;#includes&lt;/code&gt; 另一个头文件（这很常见）时，就会发生重复定义&lt;/p&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;p&gt;square.h:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// We shouldn&amp;#39;t be including function definitions in header files
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// But for the sake of this example, we will
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; getSquareSides()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;geometry.h:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;#34;square.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;main.cpp:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;#34;square.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;#34;geometry.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在预处理完所有 &lt;code&gt;#includes&lt;/code&gt;  之后，main.cpp 最终看起来像这样：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; getSquareSides()  &lt;span style=&#34;color:#007f7f&#34;&gt;// from square.h
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; getSquareSides() &lt;span style=&#34;color:#007f7f&#34;&gt;// from geometry.h (via square.h)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我们可以通过一种称为 &lt;code&gt;Header guards&lt;/code&gt; 的机制来避免上述问题。&lt;code&gt;Header guards&lt;/code&gt;  是采用以下形式的条件编译指令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#ifndef SOME_UNIQUE_NAME_HERE
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#define SOME_UNIQUE_NAME_HERE
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// your declarations (and certain types of definitions) here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;当此标头为&lt;code&gt;#included&lt;/code&gt; 时，预处理器会检查之前是否定义了 &lt;code&gt;SOME_UNIQUE_NAME_HERE&lt;/code&gt;。如果这是我们第一次包含此标头，则不会定义 &lt;code&gt;SOME_UNIQUE_NAME_HERE&lt;/code&gt;。因此，它 &lt;code&gt;#defines SOME_UNIQUE_NAME_HERE&lt;/code&gt; 并包含文件的内容。如果标头再次包含到同一个文件中，&lt;code&gt;SOME_UNIQUE_NAME_HERE&lt;/code&gt; 将在第一次包含标头的内容时已经定义，并且标头的内容将被忽略&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;你所有的头文件都应该有头文件保护&lt;/strong&gt;。 &lt;code&gt;SOME_UNIQUE_NAME_HERE&lt;/code&gt; 可以是您想要的任何名称，但按照惯例设置为头文件的完整文件名，全部大写，使用下划线作为空格或标点符号&lt;/p&gt;
&lt;p&gt;在大型程序中，可能有两个单独的头文件（包含在不同的目录中）最终具有相同的文件名（例如 &lt;code&gt;directoryA\config.h&lt;/code&gt; 和 &lt;code&gt;directoryB\config.h&lt;/code&gt;）。如果仅文件名用于包含保护（例如 &lt;code&gt;CONFIG_H&lt;/code&gt;），这两个文件最终可能会使用相同的保护名称。如果发生这种情况，任何包含（直接或间接）这两个 config.h 文件的文件将不会收到要包含的包含文件的内容。这可能会导致编译错误&lt;/p&gt;
&lt;p&gt;由于这种保护名称冲突的可能性，许多开发人员建议在标头保护中使用更复杂/唯一的名称。一些好的建议是 &lt;code&gt;&amp;lt;PROJECT&amp;gt;_&amp;lt;PATH&amp;gt;_&amp;lt;FILE&amp;gt;_H&lt;/code&gt; 、&lt;code&gt;&amp;lt;FILE&amp;gt;_&amp;lt;LARGE RANDOM NUMBER&amp;gt;_H&lt;/code&gt; 或 &lt;code&gt;&amp;lt;FILE&amp;gt;_&amp;lt;CREATION DATE&amp;gt;_H &lt;/code&gt;的命名约定&lt;/p&gt;
&lt;h5 id=&#34;summary&#34;&gt;Summary&lt;/h5&gt;
&lt;p&gt;标头保护旨在确保给定标头文件的内容不会被多次复制到任何&lt;strong&gt;单个文件&lt;/strong&gt;中，以防止重复定义&lt;/p&gt;
&lt;p&gt;请注意，重复声明是可以的，因为一个声明可以多次声明而不会发生意外——但即使您的头文件由所有声明（无定义）组成，包含头文件保护仍然是 Best Practice&lt;/p&gt;
&lt;p&gt;Note that header guards do &lt;em&gt;not&lt;/em&gt; prevent the contents of a header file from being copied (once) into separate project files. This is a good thing, because we often need to reference the contents of a given header from different project files&lt;/p&gt;
&lt;h4 id=&#34;pragma-once&#34;&gt;pragma once&lt;/h4&gt;
&lt;p&gt;现代编译器使用 &lt;code&gt;#pragma&lt;/code&gt; 指令支持一种更简单的替代形式的标头保护：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#pragma once
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// your code here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;#pragma once&lt;/code&gt; 与标头保护具有相同的目的，并且具有更短且不易出错的额外好处。对于大多数项目，&lt;code&gt;#pragma once&lt;/code&gt; 工作正常，许多开发人员更喜欢使用它们而不是标头保护。然而，&lt;code&gt;#pragma once&lt;/code&gt; 并不是 C++ 语言的正式部分（而且可能永远不会是，因为它无法以在所有情况下都可靠工作的方式实现）&lt;/p&gt;
&lt;p&gt;为了最大的可移植性，优先使用 &lt;code&gt;header guards&lt;/code&gt; 而不是 &lt;code&gt;#pragma once&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;命名冲突和命名空间介绍&#34;&gt;命名冲突和命名空间介绍&lt;/h2&gt;
&lt;h3 id=&#34;命名冲突&#34;&gt;命名冲突&lt;/h3&gt;
&lt;p&gt;大多数命名冲突发生在两种情况下：&lt;/p&gt;
&lt;p&gt;两个（或更多）同名函数（或全局变量）被引入到属于同一程序的不同文件中。这将导致&lt;strong&gt;链接器错误&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;两个（或更多）同名函数（或全局变量）被引入到同一个文件中。这将导致&lt;strong&gt;编译器错误&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;命名空间&#34;&gt;命名空间&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;命名空间&lt;/strong&gt;是一个区域，允许您在其中声明名称以消除歧义。命名空间为在其中声明的名称提供一个作用域区域（称为命名空间作用域）——这仅仅意味着在命名空间内声明的任何名称都不会被误认为是其他作用域中的相同名称&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;命名空间&lt;/strong&gt;通常用于对大型项目中的相关标识符进行分组，以帮助确保它们不会无意中与其他标识符发生冲突。例如，如果您将所有数学函数放在一个名为 math 的命名空间中，那么您的数学函数将不会与 math 命名空间之外的同名函数发生冲突&lt;/p&gt;
&lt;p&gt;在 C++ 中，任何未在类、函数或命名空间内定义的名称都被视为隐式定义的命名空间的一部分，称为&lt;strong&gt;全局命名空间&lt;/strong&gt;（有时也称为全局范围）&lt;/p&gt;
&lt;p&gt;只有声明和定义语句可以出现在全局命名空间中。这意味着我们可以在全局命名空间中定义变量，尽管通常应该避免这种情况。这也意味着其他类型的语句（例如表达式语句）不能放在全局命名空间中（全局变量的初始化器是一个例外）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt; // handled by preprocessor&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// All of the following statements are part of the global namespace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;void&lt;/span&gt; foo();    &lt;span style=&#34;color:#007f7f&#34;&gt;// okay: function forward declaration in the global namespace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x;         &lt;span style=&#34;color:#007f7f&#34;&gt;// compiles but strongly discouraged: uninitialized variable definition in the global namespace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y { &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt; };   &lt;span style=&#34;color:#007f7f&#34;&gt;// compiles but discouraged: variable definition with initializer in the global namespace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;x = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;;         &lt;span style=&#34;color:#007f7f&#34;&gt;// compile error: executable statements are not allowed in the global namespace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()     &lt;span style=&#34;color:#007f7f&#34;&gt;// okay: function definition in the global namespace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;void&lt;/span&gt; goo();    &lt;span style=&#34;color:#007f7f&#34;&gt;// okay: another function forward declaration in the global namespace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在最初设计 C++ 时，C++ 标准库中的所有标识符（包括 std::cin 和 std::cout）都可以在没有 std:: 前缀的情况下使用（它们是全局命名空间的一部分）。但是，这意味着标准库中的任何标识符都可能与您为自己的标识符选择的任何名称（也在全局命名空间中定义）发生冲突。当您#include 标准库中的新文件时，正在运行的代码可能会突然出现命名冲突。或者更糟的是，在一个版本的 C++ 下编译的程序可能无法在未来的 C++ 版本下编译，因为引入标准库的新标识符可能与已经编写的代码发生命名冲突。因此，C++ 将标准库中的所有功能移动到名为“std”（标准的缩写）的命名空间中&lt;/p&gt;
&lt;p&gt;std::cout 的名字并不是真正的 std::cout。它实际上只是 cout，而 std 是标识符 cout 所属的命名空间的名称。因为 cout 是在 std 命名空间中定义的，所以名称 cout 不会与我们在全局命名空间中创建的任何名为 cout 的对象或函数发生冲突&lt;/p&gt;
&lt;h2 id=&#34;预处理器简介&#34;&gt;预处理器简介&lt;/h2&gt;
&lt;p&gt;在编译之前，代码文件会经历一个称为翻译的阶段。翻译阶段会发生很多事情，让您的代码准备好进行编译（如果您好奇，可以在此处找到翻译阶段列表）。应用了翻译的代码文件称为翻译单元&lt;/p&gt;
&lt;p&gt;最值得注意的翻译阶段涉及预处理器。预处理器最好被认为是一个单独的程序，它可以处理每个代码文件中的文本&lt;/p&gt;
&lt;p&gt;当预处理器运行时，它会扫描代码文件（从上到下），寻找预处理器指令。预处理程序指令（通常简称为 &lt;strong&gt;指令（Directives）&lt;/strong&gt;）是以# 符号开头并以换行符（不是分号）结尾的指令。这些指令告诉预处理器执行某些文本操作任务。请注意，预处理器不理解 C++ 语法——相反，指令有自己的语法（在某些情况下类似于 C++ 语法，而在其他情况下，则不太相似）&lt;/p&gt;
&lt;p&gt;请注意，预处理器不会以任何方式修改原始代码文件——相反，预处理器所做的所有文本更改都会在每次编译代码文件时临时发生在内存中或使用临时文件&lt;/p&gt;
&lt;h3 id=&#34;includes&#34;&gt;Includes&lt;/h3&gt;
&lt;p&gt;当您 &lt;code&gt;#include&lt;/code&gt; 一个文件时，预处理器会用 include 文件的内容替换 &lt;code&gt;#include&lt;/code&gt; 指令。然后对 include 的内容进行预处理（连同文件的其余部分），然后进行编译&lt;/p&gt;
&lt;h3 id=&#34;macro-defines&#34;&gt;Macro defines&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;#define&lt;/code&gt; 指令可用于创建 &lt;strong&gt;宏&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;有两种基本类型的宏：&lt;strong&gt;类对象宏&lt;/strong&gt;和&lt;strong&gt;类函数宏&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;类函数宏&lt;/strong&gt;的行为类似于函数，并且具有相似的目的。它们的使用通常被认为是危险的，它们几乎可以做的任何事情都可以通过一个正常的函数来完成&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;类对象宏&lt;/strong&gt;可以通过以下两种方式之一定义：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#define identifier
#define identifier substitution_text
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;替换文本&lt;/strong&gt;的类对象宏被用作（在 C 中）将名称分配给文字的一种方式。这不再是必需的，因为 C++ 中提供了更好的方法（Const 变量和符号常量）。带有替换文本的类对象宏现在通常只能在遗留代码中看到&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;没有替换文本&lt;/strong&gt;的类对象宏：标识符的任何进一步出现都将被删除并被替换为任何东西！&lt;/p&gt;
&lt;p&gt;与带有替换文本的类对象宏不同，这种形式的宏通常被认为可以使用。&lt;/p&gt;
&lt;h3 id=&#34;conditional-compilation&#34;&gt;Conditional compilation&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;条件编译预处理器指令&lt;/strong&gt;允许您指定在什么条件下编译或不编译。有很多不同的条件编译指令，但我们在这里只介绍目前使用最多的三个：&lt;code&gt;#ifdef&lt;/code&gt;、&lt;code&gt;#ifndef&lt;/code&gt; 和 &lt;code&gt;#endif&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;#ifdef&lt;/code&gt; 预处理器指令允许预处理器检查标识符是否先前已被&lt;code&gt;#defined&lt;/code&gt;。如果是，编译 &lt;code&gt;#ifdef&lt;/code&gt; 和匹配的 &lt;code&gt;#endif&lt;/code&gt; 之间的代码。如果不是，代码将被忽略&lt;/p&gt;
&lt;p&gt;考虑以下程序：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#define PRINT_JOE
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#ifdef PRINT_JOE
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Joe&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// will be compiled since PRINT_JOE is defined
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#ifdef PRINT_BOB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Bob&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// will be ignored since PRINT_BOB is not defined
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;因为 &lt;code&gt;PRINT_JOE&lt;/code&gt; 已被 &lt;code&gt;#defined&lt;/code&gt;，&lt;code&gt;std::cout &amp;lt;&amp;lt; &amp;quot;Joe\n&amp;quot;&lt;/code&gt; 行将被编译。因为 &lt;code&gt;PRINT_BOB&lt;/code&gt; 尚未被 &lt;code&gt;#defined&lt;/code&gt;，&lt;code&gt;std::cout &amp;lt;&amp;lt; &amp;quot;Bob\n&amp;quot; &lt;/code&gt;行将被忽略&lt;/p&gt;
&lt;p&gt;&lt;code&gt;#ifndef&lt;/code&gt; 与 &lt;code&gt;#ifdef&lt;/code&gt; 相反，因为它允许您检查标识符是否尚未 &lt;code&gt;#defined&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#ifndef PRINT_BOB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Bob&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;该程序打印 &lt;code&gt;“Bob”&lt;/code&gt;，因为 &lt;code&gt;PRINT_BOB&lt;/code&gt; 从未被  &lt;code&gt;#defined&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;条件编译的一个更常见的用途是使用 &lt;code&gt;#if 0&lt;/code&gt; 将代码块排除在编译之外（就像它在注释块中一样）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Joe&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#if 0&lt;/span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt; // Don&amp;#39;t compile anything starting here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;    std::cout &amp;lt;&amp;lt; &amp;#34;Bob\n&amp;#34;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;    std::cout &amp;lt;&amp;lt; &amp;#34;Steve\n&amp;#34;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif // until this point
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这也提供了一种方便的方法来**“注释掉”包含多行注释的代码**（由于多行注释是不可嵌套的，因此不能使用另一个多行注释来注释掉）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Joe&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#if 0&lt;/span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt; // Don&amp;#39;t compile anything starting here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;    std::cout &amp;lt;&amp;lt; &amp;#34;Bob\n&amp;#34;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;    /* Some
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;     * multi-line
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;     * comment here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;     */
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;    std::cout &amp;lt;&amp;lt; &amp;#34;Steve\n&amp;#34;;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif // until this point
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;类对象宏不影响其他预处理器指令，宏只会导致普通代码的文本替换。其他预处理器命令将被忽略&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#define FOO 9 &lt;/span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// Here&amp;#39;s a macro substitution
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#ifdef FOO &lt;/span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// This FOO does not get replaced because it’s part of another preprocessor directive
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; FOO; &lt;span style=&#34;color:#007f7f&#34;&gt;// This FOO gets replaced with 9 because it&amp;#39;s part of the normal code
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;指令在编译前解析，逐个文件地从上到下解析&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#include &amp;lt;iostream&amp;gt;

void foo()
{
#define MY_NAME &amp;#34;Alex&amp;#34;
}

int main()
{
	std::cout &amp;lt;&amp;lt; &amp;#34;My name is: &amp;#34; &amp;lt;&amp;lt; MY_NAME;

	return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;即使看起来 &lt;code&gt;#define MY_NAME “Alex”&lt;/code&gt; 是在函数 &lt;code&gt;foo&lt;/code&gt; 中定义的，预处理器也不会注意到，因为它不理解像函数这样的 C++ 概念。因此，该程序的行为与 &lt;code&gt;#define MY_NAME “Alex”&lt;/code&gt; 在函数 &lt;code&gt;foo&lt;/code&gt; 之前或之后立即定义的程序相同。为了一般的可读性，您通常希望在函数之外 &lt;code&gt;#define&lt;/code&gt; 标识符&lt;/p&gt;
&lt;p&gt;预处理器完成后，该文件中所有定义的标识符都将被丢弃。这意味着指令&lt;strong&gt;仅从定义点到定义它们的文件末尾有效&lt;/strong&gt;。&lt;strong&gt;一个代码文件中定义的指令不会影响同一项目中的其他代码文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;考虑以下示例：&lt;/p&gt;
&lt;p&gt;function.cpp:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;void&lt;/span&gt; doSomething()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#ifdef PRINT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Printing!&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#ifndef PRINT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Not printing!&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;main.cpp:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;void&lt;/span&gt; doSomething(); &lt;span style=&#34;color:#007f7f&#34;&gt;// forward declaration for function doSomething()
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#define PRINT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    doSomething();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面的程序会打印：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Not printing!
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;尽管 &lt;code&gt;PRINT&lt;/code&gt; 是在 &lt;code&gt;main.cpp&lt;/code&gt; 中定义的，但这对 &lt;code&gt;function.cpp&lt;/code&gt; 中的任何代码都没有任何影响（&lt;code&gt;PRINT&lt;/code&gt; 只是从定义点到 &lt;code&gt;main.cpp&lt;/code&gt; 末尾的 &lt;code&gt;#defined&lt;/code&gt;）&lt;/p&gt;
&lt;h2 id=&#34;如何完成你的第一个程序&#34;&gt;如何完成你的第一个程序&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Design（设计）
&lt;ol&gt;
&lt;li&gt;定义目标。将此表示为面向用户的结果通常很有用，例如：
&lt;ul&gt;
&lt;li&gt;允许用户组织姓名和相关电话号码的列表&lt;/li&gt;
&lt;li&gt;模拟球从塔上掉落到地面需要多长时间&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;定义需求。既指您的解决方案需要遵守的约束（例如预算、时间线、空间、内存等），也指程序为满足用户需求而必须展示的能力。请注意，您的要求同样应该关注“什么”，而不是“如何”。例如：
&lt;ul&gt;
&lt;li&gt;应保存电话号码，以便日后调用&lt;/li&gt;
&lt;li&gt;用户应该能够输入塔的高度&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;定义您的工具、目标和备份计划
&lt;ol&gt;
&lt;li&gt;定义您的程序将运行的目标架构 和/或 操作系统&lt;/li&gt;
&lt;li&gt;确定您将使用的工具集&lt;/li&gt;
&lt;li&gt;确定您是单独编写程序还是作为团队的一部分编写程序’&lt;/li&gt;
&lt;li&gt;定义您的测试/反馈/发布策略&lt;/li&gt;
&lt;li&gt;确定您将如何备份您的代码&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;将困难问题分解为简单问题。如果发现其中一个项目（功能）太难实现，只需将该项目拆分为多个子项目/子功能。最终，您应该达到程序中的每个功能都可以轻松实现的地步&lt;/li&gt;
&lt;li&gt;弄清楚事件的顺序&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Implementation（实现）
&lt;ol&gt;
&lt;li&gt;概述您的主要功能。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// Get first number from user
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;//    getUserInput();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// Get mathematical operation from user
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;//    getMathematicalOperation();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// Get second number from user
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;//    getUserInput();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// Calculate result
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;//    calculateResult();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// Print result
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;//    printResult();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;实现各个功能。对于每个函数，您将做三件事：
&lt;ol&gt;
&lt;li&gt;定义函数原型（输入和输出）&lt;/li&gt;
&lt;li&gt;编写函数&lt;/li&gt;
&lt;li&gt;测试功能&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;最终测试。一旦你的程序“完成”，最后一步就是测试整个程序并确保它按预期工作。如果它不起作用，请修复它&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Words of advice when writing programs（忠告）
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Keep your programs simple to start&lt;/strong&gt;.让你的第一个目标尽可能简单，一些你绝对可以实现的目标&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Add features over time&lt;/strong&gt;.一旦您的简单程序运行良好并且运行良好，您就可以向其添加功能&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Focus on one area at a time&lt;/strong&gt;.不要试图一次编写所有代码，也不要将注意力分散到多个任务上。一次专注于一项任务&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Test each piece of code as you go&lt;/strong&gt;.编写一段代码，然后立即编译并测试它。如果它不起作用，您将确切地知道问题出在哪里，并且很容易修复。确定代码有效后，移至下一段并重复。完成代码的编写可能需要更长的时间，但是当您完成后，整个事情应该可以正常工作，并且您不必花费两倍的时间来弄清楚为什么它不起作用&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Don’t invest in perfecting early code&lt;/strong&gt;.让你的功能最低限度地工作，然后继续。不要以完美为目标——重要的程序从来都不是完美的，而且总有更多的事情可以做来改进它们。达到“足够好”并继续前进&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;调试-c-程序&#34;&gt;调试 C++ 程序&lt;/h1&gt;
&lt;h2 id=&#34;调试过程&#34;&gt;调试过程&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;找到问题的根本原因（通常是不起作用的代码行）&lt;/li&gt;
&lt;li&gt;确保您了解问题发生的原因&lt;/li&gt;
&lt;li&gt;确定您将如何解决问题&lt;/li&gt;
&lt;li&gt;修复问题&lt;/li&gt;
&lt;li&gt;重新测试以确保问题已解决并且没有出现新问题&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;调试策略&#34;&gt;调试策略&lt;/h2&gt;
&lt;p&gt;观察程序运行时的行为，并尝试从中诊断问题&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;弄清楚如何&lt;strong&gt;重现问题&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;运行程序并收集信息以&lt;strong&gt;缩小问题所在的范围&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;重复前面的步骤，&lt;strong&gt;直到找到问题&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;调试策略-1注释掉你的代码&#34;&gt;调试策略 1：注释掉你的代码&lt;/h3&gt;
&lt;p&gt;如果您的程序表现出错误行为，减少必须搜索的代码量的一种方法是注释掉一些代码并查看问题是否仍然存在。如果问题仍然存在，则注释掉的代码不负责任&lt;/p&gt;
&lt;h3 id=&#34;调试策略-2验证代码流&#34;&gt;调试策略 2：验证代码流&lt;/h3&gt;
&lt;p&gt;另一个在更复杂的程序中常见的问题是程序调用一个函数的次数太多或太少（包括根本不调用）&lt;/p&gt;
&lt;p&gt;在这种情况下，将语句放在函数的顶部以打印函数的名称会很有帮助。这样，当程序运行时，您可以看到调用了哪些函数&lt;/p&gt;
&lt;p&gt;当&lt;strong&gt;出于调试目的打印信息时&lt;/strong&gt;，使用 &lt;code&gt;std::cerr&lt;/code&gt; 而不是 &lt;code&gt;std::cout&lt;/code&gt;。这样做的一个原因是 std::cout 可能被缓冲，这意味着在您要求 std::cout 输出信息和它实际输出信息之间可能会有一个暂停。如果您使用 std::cout 进行输出，然后您的程序随后立即崩溃，则 std::cout 可能已经或可能还没有实际输出。这可能会误导您了解问题出在哪里。另一方面，std::cerr 是无缓冲&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;的，这意味着您发送给它的任何内容都会立即输出。这有助于确保所有调试输出尽快出现（以一些性能为代价，我们在调试时通常不关心）&lt;/p&gt;
&lt;p&gt;使用 std::cerr 还有助于明确输出的信息是针对错误情况而不是正常情况&lt;/p&gt;
&lt;p&gt;添加临时调试语句时，不缩进它们会很有帮助。这使它们更容易在以后找到并移除&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; getValue()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std::cerr &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;getValue() called&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std::cerr &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;main() called&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; getValue;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;调试策略-3打印值&#34;&gt;调试策略 3：打印值&lt;/h3&gt;
&lt;p&gt;对于某些类型的错误，程序可能会计算或传递错误的值。&lt;/p&gt;
&lt;p&gt;我们还可以输出变量（包括参数）或表达式的值，以确保它们是正确的。&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; add(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std::cerr &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;add() called (x=&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; x &amp;lt;&amp;lt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;, y=&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; y &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;)&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; x + y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;void&lt;/span&gt; printResult(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; z)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;The answer is: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; z &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; getUserInput()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Enter a number: &amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cin &amp;gt;&amp;gt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x{ getUserInput() };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std::cerr &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;main::x = &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; x &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y{ getUserInput() };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std::cerr &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;main::y = &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; y &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; + &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; y &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; z{ add(x, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;) };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std::cerr &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;main::z = &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; z &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	printResult(z);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;现在我们将得到输出：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Enter a number: 4
main::x = 4
Enter a number: 3
main::y = 3
add() called (x=4, y=5)
main::z = 9
The answer is: 9
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;虽然为诊断目的向程序添加调试语句是一种常见的基本技术，也是一种功能性技术（尤其是当调试器由于某种原因不可用时），但由于多种原因它并不是很好：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;调试语句使您的代码混乱。&lt;/li&gt;
&lt;li&gt;调试语句使程序的输出混乱。&lt;/li&gt;
&lt;li&gt;调试语句必须在完成后删除，这使得它们不可重用。&lt;/li&gt;
&lt;li&gt;调试语句需要修改您的代码以添加和删除，这可能会引入新的错误。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;条件化调试代码&#34;&gt;条件化调试代码&lt;/h3&gt;
&lt;p&gt;一种更容易在整个程序中禁用和启用调试的方法是使用预处理器指令使调试语句有条件：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#define ENABLE_DEBUG &lt;/span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// comment out to disable debugging
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; getUserInput()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#ifdef ENABLE_DEBUG
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;std::cerr &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;getUserInput() called&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Enter a number: &amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cin &amp;gt;&amp;gt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#ifdef ENABLE_DEBUG
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;std::cerr &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;main() called&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x{ getUserInput() };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;You entered: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;现在我们可以通过注释/取消注释#define ENABLE_DEBUG 来启用调试。这使我们能够重用以前添加的调试语句，然后在用完它们后将它们禁用，而不必从代码中实际删除它们&lt;/p&gt;
&lt;p&gt;这解决了必须删除调试语句的问题以及这样做的风险，但代价是代码更加混乱。这种方法的另一个缺点是，如果您输入错误（例如拼错“DEBUG”）或忘记将标头包含到代码文件中，则可能无法启用该文件的部分或全部调试&lt;/p&gt;
&lt;h3 id=&#34;使用日志&#34;&gt;使用日志&lt;/h3&gt;
&lt;p&gt;通过预处理器进行条件化调试的另一种方法是将调试信息发送到日志文件。日志文件是记录软件中发生的事件的文件（通常存储在磁盘上）。将信息写入日志文件的过程称为日志记录。大多数应用程序和操作系统都会写入可用于帮助诊断发生的问题的日志文件&lt;/p&gt;
&lt;p&gt;日志文件有几个优点。因为写入日志文件的信息与程序的输出是分开的，所以可以避免将正常输出和调试输出混合在一起造成的混乱。日志文件也可以很容易地发送给其他人进行诊断——所以如果有人使用你的软件有问题，你可以让他们把日志文件发给你，这可能会帮助你找到问题所在的线索&lt;/p&gt;
&lt;p&gt;虽然您可以编写自己的代码来创建日志文件并将输出发送给它们，但最好还是使用许多现有的第三方日志记录工具之一&lt;/p&gt;
&lt;p&gt;Using the &lt;a href=&#34;https://github.com/SergiusTheBest/plog&#34;&gt;plog&lt;/a&gt; logger：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;plog/Log.h&amp;gt; // Step 1: include the logger headers&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;plog/Initializers/RollingFileInitializer.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; getUserInput()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	PLOGD &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;getUserInput() called&amp;#34;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// PLOGD is defined by the plog library
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Enter a number: &amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cin &amp;gt;&amp;gt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	plog::init(plog::debug, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Logfile.txt&amp;#34;&lt;/span&gt;); &lt;span style=&#34;color:#007f7f&#34;&gt;// Step 2: initialize the logger
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	PLOGD &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;main() called&amp;#34;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// Step 3: Output to the log as if you were writing to the console
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x{ getUserInput() };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;You entered: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是上述记录器的输出（在 &lt;code&gt;Logfile.txt&lt;/code&gt; 文件中）：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2018-12-26 20:03:33.295 DEBUG [4752] [main@14] main() called
2018-12-26 20:03:33.296 DEBUG [4752] [getUserInput@4] getUserInput() called
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;您如何包含、初始化和使用记录器将根据您选择的特定记录器而有所不同&lt;/p&gt;
&lt;p&gt;请注意，使用此方法也不需要条件编译指令，因为大多数记录器都有减少/消除将输出写入日志的方法。这使得代码更容易阅读，因为条件编译行增加了很多混乱。使用 plog，可以通过将 init 语句更改为以下内容来暂时禁用日志记录：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plog::init(plog::none , &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Logfile.txt&amp;#34;&lt;/span&gt;); &lt;span style=&#34;color:#007f7f&#34;&gt;// plog::none eliminates writing of most messages, essentially turning logging off
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;使用集成调试器stepping步进&#34;&gt;使用集成调试器：Stepping（步进）&lt;/h2&gt;
&lt;p&gt;当您运行您的程序时，执行从 main 函数的顶部开始，然后逐个语句按顺序执行，直到程序结束。在你的程序运行的任何时间点，程序都在跟踪很多事情：你正在使用的变量的值，调用了哪些函数（这样当这些函数返回时，程序就会知道在哪里返回），以及程序中的当前执行点（因此它知道接下来要执行哪个语句）。所有这些跟踪信息都称为您的程序状态（或简称为状态）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Stepping&lt;/strong&gt; 是一组相关调试器功能的名称，这些功能让我们逐条语句地执行（单步执行）我们的代码&lt;/p&gt;
&lt;p&gt;箭头标记表示接下来将执行所指向的行&lt;/p&gt;
&lt;h3 id=&#34;step-into&#34;&gt;Step into&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;步入&lt;/strong&gt; 命令执行程序正常执行路径中的下一条语句，然后暂停程序的执行，以便我们可以使用调试器检查程序的状态。如果正在执行的语句包含一个函数调用，step into 会使程序跳转到被调用函数的顶部，并在那里暂停&lt;/p&gt;
&lt;h3 id=&#34;step-over&#34;&gt;Step over&lt;/h3&gt;
&lt;p&gt;同&lt;strong&gt;步入&lt;/strong&gt;命令一样，&lt;strong&gt;步过&lt;/strong&gt;命令执行程序正常执行路径中的下一条语句。然而，step into 将输入函数调用并逐行执行它们，step over 将不间断地执行整个函数，并在函数执行后将控制权返回给您&lt;/p&gt;
&lt;p&gt;step over 命令提供了一种方便的方法来跳过函数，当您确定它们已经工作或现在对调试它们不感兴趣时&lt;/p&gt;
&lt;h3 id=&#34;step-out&#34;&gt;Step out&lt;/h3&gt;
&lt;p&gt;与其他两个步进命令不同，&lt;strong&gt;步出&lt;/strong&gt; 命令不只是执行下一行代码。相反，它&lt;strong&gt;执行当前正在执行的函数中的所有剩余代码&lt;/strong&gt;，然后在函数返回时将控制权返回给您&lt;/p&gt;
&lt;p&gt;当你不小心进入了一个你不想调试的函数时，这个命令最有用&lt;/p&gt;
&lt;h2 id=&#34;使用集成调试器running-and-breakpoints运行和断点&#34;&gt;使用集成调试器：Running and breakpoints（运行和断点）&lt;/h2&gt;
&lt;h3 id=&#34;run-to-cursor&#34;&gt;Run to cursor&lt;/h3&gt;
&lt;p&gt;第一个有用的命令通常称为&lt;strong&gt;运行到光标&lt;/strong&gt;。此运行到光标命令执行程序，直到执行到达光标选择的语句。然后它将控制权返回给您，以便您可以从那时开始进行调试&lt;/p&gt;
&lt;h3 id=&#34;breakpoints&#34;&gt;Breakpoints&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;断点&lt;/strong&gt; 是一个特殊的标记，它告诉调试器在调试模式下运行时在断点处停止执行程序&lt;/p&gt;
&lt;h2 id=&#34;使用集成调试器调用堆栈&#34;&gt;使用集成调试器：调用堆栈&lt;/h2&gt;
&lt;p&gt;调用堆栈是为到达当前执行点而调用的所有活动函数的列表。调用堆栈包括每个调用的函数的条目，以及函数返回时将返回到哪一行代码。每当调用一个新函数时，该函数就会被添加到调用堆栈的顶部。当前函数返回给调用者时，它会从调用栈的顶部移除，控制权会返回到它下面的函数&lt;/p&gt;
&lt;p&gt;调用堆栈窗口是一个显示当前调用堆栈的调试器窗口&lt;/p&gt;
&lt;p&gt;函数名称后的行号显示了每个函数中要执行的下一行&lt;/p&gt;
&lt;p&gt;由于调用堆栈的顶部条目代表当前正在执行的函数，因此此处的行号显示了执行恢复时将执行的下一行。调用堆栈中的其余条目表示将在某个时间点返回的函数，因此这些条目的行号表示函数返回后将执行的下一条语句&lt;/p&gt;
&lt;h2 id=&#34;在问题成为问题之前发现问题&#34;&gt;在问题成为问题之前发现问题&lt;/h2&gt;
&lt;h3 id=&#34;重构你的代码&#34;&gt;重构你的代码&lt;/h3&gt;
&lt;p&gt;当您向程序添加新功能（“行为更改”）时，您会发现某些功能的长度会增加。随着函数越来越长，它们变得越来越复杂，也越来越难以理解&lt;/p&gt;
&lt;p&gt;解决此问题的一种方法是将单个长函数分解为多个较短的函数。这种在不改变代码行为的情况下对代码进行结构更改的过程（通常是为了使您的程序更有组织性、模块化或性能）称为&lt;strong&gt;重构&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;一个函数占据一个垂直屏幕的代码通常被认为太长了——如果你必须滚动才能阅读整个函数，函数的可理解性会显着下降。但越短越好 &amp;ndash; 少于十行的功能是好的。少于五行的函数就更好了&lt;/p&gt;
&lt;p&gt;更改代码时，&lt;strong&gt;进行行为更改或结构更改&lt;/strong&gt;，然后重新测试正确性。同时进行行为和结构更改往往会导致更多错误以及更难发现的错误&lt;/p&gt;
&lt;h3 id=&#34;约束&#34;&gt;约束&lt;/h3&gt;
&lt;p&gt;基于约束的技术涉及添加一些额外的代码（如果需要，可以在非调试构建中编译出来）以检查是否违反了某些假设或期望集&lt;/p&gt;
&lt;p&gt;例如，如果我们正在编写一个函数来计算一个数字的阶乘，它需要一个非负参数，该函数可以检查以确保调用者在继续之前传递了一个非负数。如果调用者传入一个负数，那么该函数可能会立即出错，而不是产生一些不确定的结果，从而有助于确保立即发现问题&lt;/p&gt;
&lt;p&gt;一种常见的方法是通过 assert 和 static_assert&lt;/p&gt;
&lt;h1 id=&#34;基本数据类型&#34;&gt;基本数据类型&lt;/h1&gt;
&lt;h2 id=&#34;数据类型大小&#34;&gt;数据类型大小&lt;/h2&gt;
&lt;p&gt;数据类型的大小取决于编译器和计算机体系结构！&lt;/p&gt;
&lt;p&gt;C++ 仅保证每个基本数据类型都具有最小大小

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/26/6381d2545c3fa.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/26/6381d2545c3fa.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;p&gt;为了获得最大的兼容性，您不应假设变量大于指定的最小大小&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bool:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;char:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;char&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;wchar_t:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;wchar_t&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;char16_t:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;char16_t&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;char32_t:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;char32_t&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;short:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;short&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;int:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;long:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;long&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;long long:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;long&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;float:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;float&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;double:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;long double:&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;long&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bytes&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;下面是我的 x64 机器的输出，使用 Clion：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;bool:           1 bytes
char:           1 bytes
wchar_t:        2 bytes
char16_t:       2 bytes
char32_t:       4 bytes
short:          2 bytes
int:            4 bytes
long:           4 bytes
long long:      8 bytes
float:          4 bytes
double:         8 bytes
long double:    16 bytes
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果您使用不同类型的机器或不同的编译器，您的结果可能会有所不同。请注意，您不能对 void 类型使用 sizeof 运算符，因为它没有大小（这样做会导致编译错误）&lt;/p&gt;
&lt;h2 id=&#34;无符号整数和有符号整数&#34;&gt;无符号整数和有符号整数&lt;/h2&gt;
&lt;p&gt;有符号整数范围：

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/26/6381d81f385fa.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/26/6381d81f385fa.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;p&gt;无符号整数范围：

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/26/6381d91f961eb.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/26/6381d91f961eb.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;p&gt;如果无符号整数超出范围，则将其除以大于该类型的最大数，只保留余数&lt;/p&gt;
&lt;p&gt;在 C++ 的数学运算中（例如算术或比较），如果使用一个有符号整数和一个无符号整数，则&lt;strong&gt;有符号整数将转换为无符号整数&lt;/strong&gt;。并且无符号整数不能存储负数，这会导致数据丢失&lt;/p&gt;
&lt;p&gt;在保存整数（甚至应该是非负的整数）和数学运算时，有符号数优于无符号数。避免混合有符号和无符号数字&lt;/p&gt;
&lt;p&gt;在 C++ 中仍然有一些情况必须使用无符号数：&lt;/p&gt;
&lt;p&gt;首先，在处理位操作时首选无符号数。当需要明确定义的环绕行为时，它们也很有用（在某些算法中很有用，例如加密和随机数生成）&lt;/p&gt;
&lt;p&gt;其次，无符号数的使用在某些情况下仍然是不可避免的，主要是那些与数组索引有关的情况。。在这些情况下，无符号值可以转换为有符号值&lt;/p&gt;
&lt;h2 id=&#34;固定宽度整数和-size_t&#34;&gt;固定宽度整数和 size_t&lt;/h2&gt;
&lt;h3 id=&#34;fixed-width-整数&#34;&gt;Fixed-width 整数&lt;/h3&gt;
&lt;p&gt;为什么整数变量的大小不固定？&lt;/p&gt;
&lt;p&gt;这可以追溯到 C，当时计算机速度很慢，性能是最受关注的问题。 C 选择有意保留整数的大小，以便编译器实现者可以选择在目标计算机体系结构上表现最佳的 int 大小&lt;/p&gt;
&lt;p&gt;C99 定义了一组固定宽度的整数（在 stdint.h 头文件中），保证在任何体系结构上都具有相同的大小&lt;/p&gt;
&lt;p&gt;C++ 正式采用这些固定宽度整数作为 C++11 的一部分。可以通过包含 &lt;code&gt;&amp;lt;cstdint&amp;gt;&lt;/code&gt; 头文件来访问它们，它们在 std 命名空间内定义&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/26/6381dcb67d0e0.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/26/6381dcb67d0e0.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h3 id=&#34;fast-and-least-整数&#34;&gt;Fast and least 整数&lt;/h3&gt;
&lt;p&gt;The fast 类型（&lt;code&gt;std::int_fast#_t&lt;/code&gt; 和 &lt;code&gt;std::uint_fast#_t&lt;/code&gt;）提供最快的有符号/无符号整数类型，宽度至少为 # 位（其中 # = 8、16、32 或 64）。例如，&lt;code&gt;std::int_fast32_t&lt;/code&gt; 将为您提供最快的至少 32 位的有符号整数类型&lt;/p&gt;
&lt;p&gt;The least 类型（&lt;code&gt;std::int_least#_t&lt;/code&gt; 和 &lt;code&gt;std::uint_least#_t&lt;/code&gt;）提供宽度至少为 # 位（其中 # = 8、16、32 或 64）的最小有符号/无符号整数类型。例如，&lt;code&gt;std::uint_least32_t&lt;/code&gt; 将为您提供至少 32 位的最小无符号整数类型&lt;/p&gt;
&lt;p&gt;示例：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cstdint&amp;gt; // for fixed-width integers&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;least 8:  &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int_least8_t&lt;/span&gt;) * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bits&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;least 16: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int_least16_t&lt;/span&gt;) * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bits&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;least 32: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int_least32_t&lt;/span&gt;) * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bits&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;fast 8:  &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int_fast8_t&lt;/span&gt;) * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bits&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;fast 16: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int_fast16_t&lt;/span&gt;) * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bits&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;fast 32: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int_fast32_t&lt;/span&gt;) * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; bits&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Result：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;least 8:  8 bits
least 16: 16 bits
least 32: 32 bits

fast 8:  8 bits
fast 16: 16 bits
fast 32: 32 bits
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然而，这些快速且最小的整数有其自身的缺点：首先，真正使用它们的程序员并不多，不熟悉会导致错误。其次，快速类型会导致与我们在 4 字节整数中看到的相同类型的内存浪费。最严重的是，由于快速/最小整数的大小可能会有所不同，因此您的程序可能会在解析为不同大小的架构上表现出不同的行为&lt;/p&gt;
&lt;h3 id=&#34;stdint8_t-和-stduint8_t-可能表现得像字符而不是整数&#34;&gt;std::int8_t 和 std::uint8_t 可能表现得像字符而不是整数&lt;/h3&gt;
&lt;p&gt;由于 C++ 规范中的疏忽，大多数编译器分别将 std::int8_t 和 std::uint8_t（以及相应的快速和最小固定宽度类型）定义为 signed char 和 unsigned char 类型，并将其视为相同的类型。这意味着这些 8 位类型的行为可能（或可能不）与其他固定宽度类型不同，这可能会导致错误。此行为是系统相关的，因此在一种体系结构上正确运行的程序可能无法编译或在另一种体系结构上正确运行&lt;/p&gt;
&lt;p&gt;为了保持一致性，最好完全避免使用 std::int8_t 和 std::uint8_t（以及相关的快速和最少类型）（改用 std::int16_t 或 std::uint16_t）&lt;/p&gt;
&lt;p&gt;8 位固定宽度整数类型通常被视为字符而不是整数值（这可能因系统而异）。大多数情况下首选 16 位固定整数类型&lt;/p&gt;
&lt;h3 id=&#34;best-practice&#34;&gt;Best practice&lt;/h3&gt;
&lt;p&gt;我们的立场是正确比快速更好，在编译时失败比运行时更好——因此，我们建议避免使用快速/最少的类型，而使用固定宽度的类型。如果您后来发现需要支持无法编译固定宽度类型的平台，那么您可以在此时决定如何迁移您的程序（并彻底测试）&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;当整数的大小无关紧要时，首选 int（例如，数字将始终适合 2 字节有符号整数的范围）。例如，如果您要求用户输入他们的年龄，或者从 1 数到 10，则 int 是 16 位还是 32 位都没有关系（数字将适合任何一种方式）。这将涵盖您可能遇到的绝大多数情况&lt;/li&gt;
&lt;li&gt;存储需要保证范围的数量时，首选 &lt;code&gt;std::int#_t&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;在进行位操作或需要明确定义的环绕行为时，首选 &lt;code&gt;std::uint#_t&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;尽可能避免以下情况：
&lt;ol&gt;
&lt;li&gt;存储数量的无符号类型&lt;/li&gt;
&lt;li&gt;8 位固定宽度整数类型&lt;/li&gt;
&lt;li&gt;Fast and least 整数类型&lt;/li&gt;
&lt;li&gt;任何特定于编译器的固定宽度整数——例如，Visual Studio 定义了 &lt;code&gt;__int8&lt;/code&gt;、&lt;code&gt;__int16&lt;/code&gt; ……&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;size_t&#34;&gt;size_t&lt;/h3&gt;
&lt;p&gt;sizeof（以及许多返回大小或长度值的函数）返回一个 std::size_t 类型的值。 std::size_t 被定义为无符号整数类型，通常用于表示对象的大小或长度&lt;/p&gt;
&lt;p&gt;有趣的是，我们可以使用 sizeof 运算符（返回 std::size_t 类型的值）来询问 std::size_t 本身的大小：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cstddef&amp;gt; // std::size_t&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;(std::size_t) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;就像整数的大小会因系统而异一样，std::size_t 的大小也会有所不同。 std::size_t 保证为无符号且至少为 16 位，但在大多数系统上将等同于应用程序的地址宽度。也就是说，对于 32 位应用程序，std::size_t 通常是 32 位无符号整数，而对于 64 位应用程序，size_t 通常是 64 位无符号整数。 size_t 被定义为足够大以容纳系统上可创建的最大对象的大小（以字节为单位）。例如，如果 std::size_t 为 4 字节宽，则系统上可创建的最大对象不能大于 4,294,967,295 字节，因为 4,294,967,295 是 4 字节无符号整数可以存储的最大数字。这只是对象大小的上限，实际大小限制可能会更低，具体取决于您使用的编译器&lt;/p&gt;
&lt;p&gt;根据定义，任何大小（以字节为单位）大于 size_t 可以容纳的最大整数值的对象都被视为格式错误（并将导致编译错误），因为 sizeof 运算符将无法在不环绕的情况下返回大小&lt;/p&gt;
&lt;h2 id=&#34;浮点数ieee-754&#34;&gt;浮点数（IEEE 754）&lt;/h2&gt;
&lt;h3 id=&#34;浮点范围和浮点精度&#34;&gt;浮点范围和浮点精度&lt;/h3&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/26/63820f12cc479.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/26/63820f12cc479.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;p&gt;使用浮点文字时，始终至少包含一位小数（即使小数为 0）。这有助于编译器理解该数字是浮点数而不是整数&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int x{5}; // 5 means integer
double y{5.0}; // 5.0 is a floating point literal (no suffix means double type by default)
float z{5.0f}; // 5.0 is a floating point literal, f suffix means float type
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;始终确保字面量的类型与分配给它们或用于初始化的变量的类型相匹配。否则会导致不必要的转换，可能会导致精度损失&lt;/p&gt;
&lt;p&gt;确保在应该使用浮点文字的地方不使用整数文字。这包括初始化浮点对象或为浮点对象赋值、进行浮点运算以及调用需要浮点值的函数&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/26/6382110b7d067.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/26/6382110b7d067.png&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;p&gt;输出浮点数时，std::cout 的默认精度为 6——也就是说，它假定所有浮点变量仅对 6 位有效（浮点数的最小精度），因此它将截断之后的任何内容&lt;/p&gt;
&lt;p&gt;浮点变量的精度位数取决于大小（浮点数的精度低于双精度数）和存储的特定值（某些值的精度高于其他值）。浮点值的精度在 6 到 9 位之间，大多数浮点值至少有 7 位有效数字。双精度值的精度在 15 到 18 位之间，大多数双精度值至少有 16 位有效数字。 Long double 的最小精度为 15、18 或 33 位有效数字，具体取决于它占用的字节数&lt;/p&gt;
&lt;h3 id=&#34;舍入误差&#34;&gt;舍入误差&lt;/h3&gt;
&lt;p&gt;我们可以使用名为 std::setprecision() 的输出操纵器函数覆盖 std::cout 显示的默认精度。输出操纵器改变数据的输出方式，并在 iomanip 标头中定义&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#include &amp;lt;iostream&amp;gt;
#include &amp;lt;iomanip&amp;gt; // for output manipulator std::setprecision()

int main()
{
    std::cout &amp;lt;&amp;lt; std::setprecision(16); // show 16 digits of precision
    std::cout &amp;lt;&amp;lt; 3.33333333333333333333333333333333333333f &amp;lt;&amp;lt;&amp;#39;\n&amp;#39;; // f suffix means float
    std::cout &amp;lt;&amp;lt; 3.33333333333333333333333333333333333333 &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;; // no suffix means double

    return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在使用需要比变量所能容纳的精度更高的浮点数时，必须小心&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;除非空间非常宝贵，否则最好使用 double over float，因为 float 缺乏精度通常会导致不准确&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;值 123456789.0 具有 10 位有效数字，但浮点值通常具有 7 位精度（而 123456792 的结果仅精确到 7 位有效数字）。我们失去了一些精度！当由于无法精确存储数字而导致精度丢失时，这称为&lt;strong&gt;舍入误差&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;数学运算（例如加法和乘法）往往会使舍入误差增大。所以即使0.1在第17位有效位有舍入误差，但是当我们加上0.1十次时，舍入误差已经爬到第16位有效位了。继续操作会导致此错误变得越来越严重&lt;/p&gt;
&lt;h3 id=&#34;nan-和-inf&#34;&gt;NaN 和 Inf&lt;/h3&gt;
&lt;p&gt;有两种特殊类别的浮点数。第一个是 &lt;code&gt;Inf&lt;/code&gt;，代表无穷大。 Inf 可以是正数或负数。第二个是 &lt;code&gt;NaN&lt;/code&gt;，代表“不是数字”。有几种不同类型的 NaN（我们不会在这里讨论）。 NaN 和 Inf 仅在编译器对浮点数使用特定格式 (IEEE 754) 时可用&lt;/p&gt;
&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;总而言之，关于浮点数你应该记住两件事：&lt;/p&gt;
&lt;p&gt;浮点数对于存储非常大或非常小的数字很有用，包括带有小数部分的数字&lt;/p&gt;
&lt;p&gt;浮点数通常有小的舍入误差，即使数字的有效数字少于精度也是如此。很多时候这些都没有引起注意，因为它们太小了，而且因为输出的数字被截断了。但是，浮点数的比较可能不会给出预期的结果。对这些值执行数学运算将导致舍入误差变大&lt;/p&gt;
&lt;h2 id=&#34;布尔值&#34;&gt;布尔值&lt;/h2&gt;
&lt;p&gt;如果您希望 std::cout 打印“true”或“false”而不是 0 或 1，您可以使用 std::boolalpha。这是一个例子：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;true&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; std::boolalpha; &lt;span style=&#34;color:#007f7f&#34;&gt;// print bools as true or false
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;true&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;您可以使用 std::noboolalpha 将其关闭&lt;/p&gt;
&lt;p&gt;您不能使用除 0 1 外的整数初始化布尔值：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt; b{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// error: narrowing conversions disallowed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::cout &amp;lt;&amp;lt; b;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;但是，在任何可以将整数转换为布尔值的上下文中，整数 0 将转换为 false，而任何其他整数将转换为 true&lt;/p&gt;
&lt;p&gt;事实证明，std::cin 只接受布尔变量的两个输入：0 和 1（不是 true 或 false）。任何其他输入都会导致 std::cin 无声地失败。在这种情况下，因为我们输入了 true，所以 std::cin 默默地失败了。失败的输入也会将变量清零，因此 b 也被赋值 false。因此，当 std::cout 打印 b 的值时，它打印 0&lt;/p&gt;
&lt;p&gt;要允许 std::cin 接受“false”和“true”作为输入，必须启用 std::boolalpha 选项：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt; b{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Enter a boolean value: &amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#007f7f&#34;&gt;// Allow the user to enter &amp;#39;true&amp;#39; or &amp;#39;false&amp;#39; for boolean values
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#007f7f&#34;&gt;// This is case-sensitive, so True or TRUE will not work
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::cin &amp;gt;&amp;gt; std::boolalpha;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cin &amp;gt;&amp;gt; b;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;You entered: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; b &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;但是，当启用 std::boolalpha 时，“0”和“1”将不再被视为布尔值&lt;/p&gt;
&lt;h2 id=&#34;chars&#34;&gt;Chars&lt;/h2&gt;
&lt;p&gt;char 数据类型旨在保存单个字符。字符可以是单个字母、数字、符号或空格&lt;/p&gt;
&lt;p&gt;char 数据类型是整数类型，这意味着基础值存储为整数。类似于布尔值 0 被解释为 false 而非零被解释为 true 的方式，char 变量存储的整数被解释为 ASCII 字符&lt;/p&gt;
&lt;p&gt;Char 由 C++ 定义为大小始终为 1 个字节。默认情况下，char 可以是有符号的或无符号的（尽管它通常是有符号的）。如果您使用 chars 来保存 ASCII 字符，则不需要指定符号（因为有符号和无符号字符都可以保存 0 到 127 之间的值）&lt;/p&gt;
&lt;p&gt;如果您使用 char 来保存小整数（除非您明确优化空间，否则您不应该这样做），您应该始终指定它是有符号的还是无符号的。 signed char 可以保存 -128 到 127 之间的数字。unsigned char 可以保存 0 到 255 之间的数字&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;将单个字符放在单引号中（ e.g. &lt;code&gt;&#39;t&#39;&lt;/code&gt; or &lt;code&gt;&#39;\n&#39;&lt;/code&gt;, not &lt;code&gt;&amp;quot;t&amp;quot;&lt;/code&gt; or &lt;code&gt;&amp;quot;\n&amp;quot;&lt;/code&gt;）这有助于编译器更有效地进行优化&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;出于向后兼容性的原因，许多 C++ 编译器支持多字符文字，即包含多个字符（例如“56”）的字符文字。如果支持，它们具有实现定义的值（意味着它因编译器而异）。因为它们不是 C++ 标准的一部分，而且它们的值也没有严格定义，所以应该避免使用多字符文字&lt;/p&gt;
&lt;p&gt;ASCII 之外最著名的映射是 Unicode 标准，它将超过 144,000 个整数映射到许多不同语言的字符。由于 Unicode 包含如此多的代码点，因此单个 Unicode 代码点需要 32 位来表示一个字符（称为 UTF-32）。但是，Unicode 字符也可以使用多个 16 位或 8 位字符（分别称为 UTF-16 和 UTF-8）进行编码&lt;/p&gt;
&lt;p&gt;char16_t 和 char32_t 添加到 C++11 以提供对 16 位和 32 位 Unicode 字符的明确支持。 C++20 中添加了 char8_t&lt;/p&gt;
&lt;p&gt;您不需要使用 char8_t、char16_t 或 char32_t，除非您计划让您的程序与 Unicode 兼容&lt;/p&gt;
&lt;p&gt;同时，在处理字符（和字符串）时，您应该只使用 ASCII 字符。使用来自其他字符集的字符可能会导致您的字符显示不正确&lt;/p&gt;
&lt;h2 id=&#34;通过-static_cast-运算符进行显式类型转换&#34;&gt;通过 static_cast 运算符进行显式类型转换&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;static_cast&amp;lt;new_type&amp;gt;(expression)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;static_cast&lt;/code&gt; 将表达式中的值作为输入，并返回转换为 &lt;code&gt;new_type&lt;/code&gt; 指定类型（例如 int、bool、char、double）的值&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;void&lt;/span&gt; print(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	print( &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt;&amp;gt;(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5.5&lt;/span&gt;) ); &lt;span style=&#34;color:#007f7f&#34;&gt;// explicitly convert double value 5.5 to an int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;常量和符号常量&#34;&gt;常量和符号常量&lt;/h2&gt;
&lt;h3 id=&#34;const-variables&#34;&gt;const variables&lt;/h3&gt;
&lt;p&gt;Const 变量必须在定义它们时进行初始化，然后不能通过赋值更改该值&lt;/p&gt;
&lt;p&gt;Const 变量可以从其他变量（包括非常量变量）初始化&lt;/p&gt;
&lt;p&gt;命名时以 “k” 开头, 大小写混合,例如：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const int kDaysInAWeek = 7;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;符号常量&#34;&gt;符号常量&lt;/h3&gt;
&lt;p&gt;符号常量指的是&lt;strong&gt;被赋予常量值的名称&lt;/strong&gt;。&lt;code&gt;const variables&lt;/code&gt; 是一种符号常量，因为变量有一个名称（它的标识符）和一个常量值&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#define MAX_STUDENTS_PER_CLASS 30
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;The class has &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; MAX_STUDENTS_PER_CLASS &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; students.&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;编译此程序时，预处理器会将 MAX_STUDENTS_PER_CLASS 替换为字面值 30，然后编译器会将其编译为您的可执行文件&lt;/p&gt;
&lt;p&gt;因为类对象宏有一个名字，并且替换文本是一个常量值，所以带有替换文本的类对象宏也是符号常量&lt;/p&gt;
&lt;h3 id=&#34;对于符号常量更喜欢常量变量而不是类对象宏&#34;&gt;对于符号常量，更喜欢常量变量而不是类对象宏&lt;/h3&gt;
&lt;p&gt;首先，因为宏是由预处理器解析的，所有出现的宏都在编译之前被定义的值替换。如果您正在调试代码，您将看不到实际值（例如 30）——您只会看到符号常量的名称（例如 MAX_STUDENTS_PER_CLASS）。因为这些#defined 值不是变量，所以您无法在调试器中添加监视来查看它们的值。如果您想知道 MAX_STUDENTS_PER_CLASS 解析为什么值，您必须找到 MAX_STUDENTS_PER_CLASS 的定义（可能在不同的文件中）。这会使您的程序更难调试&lt;/p&gt;
&lt;p&gt;其次，宏可能与普通代码有命名冲突&lt;/p&gt;
&lt;p&gt;第三，宏不遵循正常的作用域规则，这意味着在极少数情况下，在程序的一部分中定义的宏可能会与在程序的另一部分中编写的代码发生冲突，而它不应该与之交互&lt;/p&gt;
&lt;h2 id=&#34;编译时常量常量表达式和-constexpr&#34;&gt;编译时常量、常量表达式和 constexpr&lt;/h2&gt;
&lt;h3 id=&#34;constant-expressions&#34;&gt;Constant expressions&lt;/h3&gt;
&lt;p&gt;常量表达式是可以在编译时由编译器求值的表达式。要成为常量表达式，表达式中的所有值必须在编译时已知（并且所有调用的运算符和函数必须支持编译时求值）&lt;/p&gt;
&lt;p&gt;在编译时对常量表达式求值会使我们的编译时间变长（因为编译器必须做更多的工作），但这样的表达式只需要求值一次（而不是每次程序运行时）。生成的可执行文件速度更快，使用的内存更少&lt;/p&gt;
&lt;h3 id=&#34;compile-time-constants&#34;&gt;Compile-time constants&lt;/h3&gt;
&lt;p&gt;编译时常量是其值在编译时已知的常量。文字（例如“1”、“2.3”和“Hello, world!”）是一种编译时常量&lt;/p&gt;
&lt;p&gt;Const 变量可能是也可能不是编译时常量&lt;/p&gt;
&lt;h3 id=&#34;compile-time-const&#34;&gt;Compile-time const&lt;/h3&gt;
&lt;p&gt;如果 const 变量的初始值设定项是常量表达式，则它是编译时常量&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x { &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt; };  &lt;span style=&#34;color:#007f7f&#34;&gt;// x is a compile-time const
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y { &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt; };  &lt;span style=&#34;color:#007f7f&#34;&gt;// y is a compile-time const
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; z { x + y }; &lt;span style=&#34;color:#007f7f&#34;&gt;// x + y is a compile-time expression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; z &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;因为 x 和 y 的初始化值是常量表达式，所以 x 和 y 是编译时常量。这意味着 x + y 也是常量表达式。所以当编译器编译这个程序时，它可以计算 x + y 的值，并将常量表达式替换为结果文字 7&lt;/p&gt;
&lt;h3 id=&#34;runtime-const&#34;&gt;Runtime const&lt;/h3&gt;
&lt;p&gt;任何使用非常量表达式初始化的 const 变量都是运行时常量。运行时常量是其初始化值直到运行时才知道的常量&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; getNumber()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Enter a number: &amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cin &amp;gt;&amp;gt; y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt; };           &lt;span style=&#34;color:#007f7f&#34;&gt;// x is a compile time constant
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; y{ getNumber() }; &lt;span style=&#34;color:#007f7f&#34;&gt;// y is a runtime constant
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; z{ x + y };       &lt;span style=&#34;color:#007f7f&#34;&gt;// x + y is a runtime expression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; z &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;     &lt;span style=&#34;color:#007f7f&#34;&gt;// this is also a runtime expression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;即使 y 是常量，初始化值（getNumber() 的返回值）直到运行时才知道。因此，y 是运行时常量，而不是编译时常量。因此，表达式 x + y 是一个运行时表达式&lt;/p&gt;
&lt;h3 id=&#34;constexpr-关键字&#34;&gt;constexpr 关键字&lt;/h3&gt;
&lt;p&gt;当你声明一个 const 变量时，编译器会隐式地跟踪它是运行时常量还是编译时常量。在大多数情况下，除了优化目的之外，这无关紧要，但有一些奇怪的情况，C++ 需要编译时常量而不是运行时常量&lt;/p&gt;
&lt;p&gt;因为编译时常量通常允许更好的优化（并且几乎没有缺点），所以我们通常希望尽可能使用编译时常量&lt;/p&gt;
&lt;p&gt;我们可以寻求编译器的帮助，以确保我们得到一个我们期望的编译时常量。为此，我们在变量声明中使用 constexpr 关键字而不是 const。 constexpr（“常量表达式”的缩写）变量只能是编译时常量。如果 constexpr 变量的初始化值不是常量表达式，编译器会出错&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; five()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; gravity { &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;9.8&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// ok: 9.8 is a constant expression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; sum { &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt; };      &lt;span style=&#34;color:#007f7f&#34;&gt;// ok: 4 + 5 is a constant expression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; something { sum };  &lt;span style=&#34;color:#007f7f&#34;&gt;// ok: sum is a constant expression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Enter your age: &amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; age{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cin &amp;gt;&amp;gt; age;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; myAge { age };      &lt;span style=&#34;color:#007f7f&#34;&gt;// compile error: age is not a constant expression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; f { five() };       &lt;span style=&#34;color:#007f7f&#34;&gt;// compile error: return value of five() is not a constant expression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;任何在初始化后不应修改且其初始值设定项在编译时已知的变量都应声明为 &lt;code&gt;constexpr&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;任何在初始化后不应修改且其初始值设定项在编译时未知的变量都应声明为 &lt;code&gt;const&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;literals&#34;&gt;Literals&lt;/h2&gt;
&lt;p&gt;文字是直接插入代码中的未命名值。例如：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;;                   &lt;span style=&#34;color:#007f7f&#34;&gt;// 5 is an integer literal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt; myNameIsAlex { &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;true&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// true is a boolean literal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3.4&lt;/span&gt;;           &lt;span style=&#34;color:#007f7f&#34;&gt;// 3.4 is a double literal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如对象有类型一样，所有文字都有类型。文字的类型是从文字的值推导出来的&lt;/p&gt;
&lt;h2 id=&#34;十进制二进制十六进制和八进制&#34;&gt;十进制、二进制、十六进制和八进制&lt;/h2&gt;
&lt;h3 id=&#34;二进制文字和数字分隔符&#34;&gt;二进制文字和数字分隔符&lt;/h3&gt;
&lt;p&gt;在 C++14 之前，不支持二进制文字。然而，十六进制文字为我们提供了一个有用的解决方法（您可能仍会在现有代码库中看到）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; bin{};    &lt;span style=&#34;color:#007f7f&#34;&gt;// assume 16-bit ints
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x0001&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0000 0001 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x0002&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0000 0010 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x0004&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0000 0100 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x0008&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0000 1000 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x0010&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0001 0000 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x0020&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0010 0000 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x0040&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0100 0000 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x0080&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 1000 0000 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x00FF&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 1111 1111 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x00B3&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 1011 0011 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0xF770&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 1111 0111 0111 0000 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在 C++14 中，我们可以通过使用 0b 前缀来使用二进制文字：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; bin{};        &lt;span style=&#34;color:#007f7f&#34;&gt;// assume 16-bit ints
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1&lt;/span&gt;;        &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0000 0001 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b11&lt;/span&gt;;       &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0000 0011 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1010&lt;/span&gt;;     &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 0000 1010 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bin = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b11110000&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 0000 0000 1111 0000 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;由于长文本可能难以阅读，C++14 还添加了使用引号 (‘) 作为数字分隔符的功能（分隔符不能出现在值的第一位数字之前）（数字分隔符纯粹是视觉上的，不会以任何方式影响字面值）&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; bin { &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1011&amp;#39;0010&lt;/span&gt; };  &lt;span style=&#34;color:#007f7f&#34;&gt;// assign binary 1011 0010 to the variable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;long&lt;/span&gt; value { &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&amp;#39;132&amp;#39;673&amp;#39;462&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// much easier to read than 2132673462
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;以十进制八进制或十六进制输出值&#34;&gt;以十进制、八进制或十六进制输出值&lt;/h3&gt;
&lt;p&gt;默认情况下，C++ 以十进制形式输出值。但是，您可以通过使用 std::dec、std::oct 和 std::hex I/O 操纵器更改输出格式：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; x { &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;12&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// decimal (by default)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; std::hex &amp;lt;&amp;lt; x &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// hexadecimal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// now hexadecimal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; std::oct &amp;lt;&amp;lt; x &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// octal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; std::dec &amp;lt;&amp;lt; x &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// return to decimal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// decimal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;以二进制输出值&#34;&gt;以二进制输出值&lt;/h3&gt;
&lt;p&gt;以二进制形式输出值有点困难，因为 std::cout 没有内置此功能。幸运的是，C++ 标准库包含一个名为 std::bitset 的类型，它将为我们完成此操作（在 &lt;code&gt;&amp;lt;bitset&amp;gt;&lt;/code&gt; 标头中）。要使用 std::bitset，我们可以定义一个 std::bitset 变量并告诉 std::bitset 我们要存储多少位。位数必须是编译时常量。 std::bitset 可以用无符号整数值（任何格式，包括十进制、八进制、十六进制或二进制）初始化&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;bitset&amp;gt; // for std::bitset&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#007f7f&#34;&gt;// std::bitset&amp;lt;8&amp;gt; means we want to store 8 bits
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; bin1{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1100&amp;#39;0101&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// binary literal for binary 1100 0101
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; bin2{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0xC5&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// hexadecimal literal for binary 1100 0101
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; bin1 &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt; &amp;lt;&amp;lt; bin2 &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;&amp;gt;{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1010&lt;/span&gt; } &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// create a temporary std::bitset and print it
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;stdstring&#34;&gt;std::string&lt;/h2&gt;
&lt;h3 id=&#34;使用-stdgetline-输入文本&#34;&gt;使用 std::getline() 输入文本&lt;/h3&gt;
&lt;p&gt;事实证明，当使用 operator&amp;raquo; 从 std::cin 中提取字符串时，operator&amp;raquo; 只返回它遇到的第一个空格之前的字符。任何其他字符都留在 std::cin 中，等待下一次提取&lt;/p&gt;
&lt;p&gt;要将整行输入读入字符串，最好改用 &lt;code&gt;std::getline()&lt;/code&gt; 函数。 std::getline() 需要两个参数：第一个是 std::cin，第二个是您的字符串变量&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string&amp;gt; // For std::string and std::getline&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Enter your full name: &amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::string name{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::getline(std::cin &amp;gt;&amp;gt; std::ws, name); &lt;span style=&#34;color:#007f7f&#34;&gt;// read a full line of text into name
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Enter your age: &amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::string age{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::getline(std::cin &amp;gt;&amp;gt; std::ws, age); &lt;span style=&#34;color:#007f7f&#34;&gt;// read a full line of text into age
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Your name is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; name &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; and your age is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; age &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;std::ws&lt;/code&gt; 输入操纵器告诉 std::cin 在提取之前&lt;strong&gt;忽略任何前导空格&lt;/strong&gt;。前导空白是出现在字符串开头的任何空白字符（空格、制表符、换行符）&lt;/p&gt;
&lt;p&gt;如果使用 &lt;code&gt;std::getline()&lt;/code&gt; 读取字符串，请使用 &lt;code&gt;std::cin &amp;gt;&amp;gt; std::ws&lt;/code&gt; 输入操纵器忽略前导空格&lt;/p&gt;
&lt;p&gt;将提取运算符 (&amp;raquo;) 与 std::cin 一起使用会忽略前导空格&lt;/p&gt;
&lt;p&gt;std::getline() 不会忽略前导空格，除非您使用输入操纵器 std::ws&lt;/p&gt;
&lt;h3 id=&#34;字符串长度&#34;&gt;字符串长度&lt;/h3&gt;
&lt;p&gt;如果我们想知道 std::string 中有多少个字符，我们可以向 std::string 对象询问它的长度。注意 std::string::length() 返回一个无符号整数值（很可能是 size_t 类型）。如果你想将长度分配给一个 int 变量，你应该对其进行 static_cast 以避免编译器关于有符号/无符号转换的警告：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; length { &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt;&amp;gt;(name.length()) };
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;stdstring-的初始化和复制开销很大&#34;&gt;std::string 的初始化和复制开销很大&lt;/h3&gt;
&lt;p&gt;每当初始化 std::string 时，都会生成用于初始化它的字符串的副本。每当 std::string 按值传递给 std::string 参数时，都会生成另一个副本。不要按值传递 std::string，因为生成 std::string 的副本开销很大。更喜欢 std::string_view 参数&lt;/p&gt;
&lt;h3 id=&#34;literals-forstdstring--stdstring_view&#34;&gt;Literals for &lt;code&gt;std::string&lt;/code&gt; &amp;amp; &lt;code&gt;std::string_view&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;双引号字符串文字（比如“Hello, world!”）默认是 C 风格的字符串&lt;/p&gt;
&lt;p&gt;我们可以通过在双引号字符串文字后使用 s 后缀来创建类型为 std::string 的字符串文字&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string&amp;gt;      // for std::string&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string_view&amp;gt; // for std::string_view&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;using&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;namespace&lt;/span&gt; std::literals; &lt;span style=&#34;color:#007f7f&#34;&gt;// easiest way to access the s and sv suffixes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;foo&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;;   &lt;span style=&#34;color:#007f7f&#34;&gt;// no suffix is a C-style string literal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;goo&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;s;  &lt;span style=&#34;color:#007f7f&#34;&gt;// s suffix is a std::string literal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;moo&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;sv; &lt;span style=&#34;color:#007f7f&#34;&gt;// sv suffix is a std::string_view literal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;“s”后缀位于命名空间 std::literals::string_literals 中。“sv”后缀位于命名空间 std::literals::string_view_literals 中。访问文字后缀的最简单方法是通过使用指令使用命名空间 std::literals。这是可以使用整个命名空间的例外情况之一，因为其中定义的后缀不太可能与您的任何代码冲突&lt;/p&gt;
&lt;p&gt;你可能不需要经常使用 std::string 文字（因为用 C 风格的字符串文字初始化 std::string 对象很好），但我们会在以后的课程中看到一些使用 std 的情况::string literals 而不是 C 风格的 string literals 使事情变得更容易&lt;/p&gt;
&lt;h3 id=&#34;constexpr-字符串&#34;&gt;Constexpr 字符串&lt;/h3&gt;
&lt;p&gt;如果您尝试定义一个 constexpr std::string，您的编译器可能会产生一个错误&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;using&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;namespace&lt;/span&gt; std::literals;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::string name{ &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Alex&amp;#34;&lt;/span&gt;s }; &lt;span style=&#34;color:#007f7f&#34;&gt;// compile error
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;My name is: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; name;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;发生这种情况是因为 constexpr std::string 在 C++17 或更早版本中不受支持，并且在 C++20 中仅提供最低限度的支持。如果您需要 constexpr 字符串，请改用 std::string_view&lt;/p&gt;
&lt;h2 id=&#34;stdstring_view&#34;&gt;std::string_view&lt;/h2&gt;
&lt;h3 id=&#34;stdstring_view-c17&#34;&gt;std::string_view C++17&lt;/h3&gt;
&lt;p&gt;为了解决 std::string 初始化（或复制）成本高昂的问题，C++17 引入了 std::string_view（位于 &amp;lt;string_view&amp;gt; 标头中）。 std::string_view 提供对现有字符串（C 风格字符串文字、std::string 或 char 数组）的只读访问，而无需制作副本&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string_view&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;void&lt;/span&gt; printSV(std::string_view str) &lt;span style=&#34;color:#007f7f&#34;&gt;// now a std::string_view
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; str &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::string_view s{ &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Hello, world!&amp;#34;&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// now a std::string_view
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    printSV(s);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;当我们用 C 风格的字符串文字“Hello, world!”初始化 std::string_view s 时，s 提供对“Hello, world!”的只读访问。无需复制字符串。当我们将 s 传递给 printSV() 时，参数 str 从 s 初始化。这使我们能够通过 str 访问“Hello, world!”，不用再次复制字符串&lt;/p&gt;
&lt;p&gt;当您需要只读字符串时，尤其是对于函数参数，优先使用 std::string_view 而不是 std::string&lt;/p&gt;
&lt;h3 id=&#34;constexpr-stdstring_view&#34;&gt;constexpr std::string_view&lt;/h3&gt;
&lt;p&gt;std::string_view 完全支持 constexpr：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string_view&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::string_view s{ &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Hello, world!&amp;#34;&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; s &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// s will be replaced with &amp;#34;Hello, world!&amp;#34; at compile-time
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;stdstring--stdstring_view&#34;&gt;std::string &amp;amp; std::string_view&lt;/h3&gt;
&lt;p&gt;可以使用 std::string 初始值设定项创建 std::string_view，并且 std::string 将隐式转换为 std::string_view：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string_view&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;void&lt;/span&gt; printSV(std::string_view str)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; str &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::string s{ &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Hello, world&amp;#34;&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::string_view sv{ s }; &lt;span style=&#34;color:#007f7f&#34;&gt;// Initialize a std::string_view from a std::string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; sv &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    printSV(s); &lt;span style=&#34;color:#007f7f&#34;&gt;// implicitly convert a std::string to std::string_view
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;因为 std::string 复制了它的初始化器（这开销很大），C++ 不允许将 std::string_view 隐式转换为 std::string。但是，我们可以使用 std::string_view 初始值设定项显式创建 std::string，或者我们可以使用 static_cast 将现有的 std::string_view 转换为 std::string&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;string_view&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;void&lt;/span&gt; printString(std::string str)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; str &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std::string_view sv{ &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;balloon&amp;#34;&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std::string str{ sv }; &lt;span style=&#34;color:#007f7f&#34;&gt;// okay, we can create std::string using std::string_view initializer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#007f7f&#34;&gt;// printString(sv);   // compile error: won&amp;#39;t implicitly convert std::string_view to a std::string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  printString(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;static_cast&lt;/span&gt;&amp;lt;std::string&amp;gt;(sv)); &lt;span style=&#34;color:#007f7f&#34;&gt;// okay, we can explicitly cast a std::string_view to a std::string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;operators操作符&#34;&gt;Operators（操作符）&lt;/h1&gt;
&lt;h2 id=&#34;----运算符&#34;&gt;&lt;code&gt;,&lt;/code&gt; &amp;amp; &lt;code&gt;? :&lt;/code&gt; 运算符&lt;/h2&gt;
&lt;p&gt;C++ 没有定义函数参数或运算符操作数的计算顺序&lt;/p&gt;
&lt;p&gt;不要在给定语句中多次使用具有副作用的变量。如果这样做，结果可能是未定义的&lt;/p&gt;
&lt;p&gt;逗号在所有运算符中的优先级最低，甚至低于赋值&lt;/p&gt;
&lt;p&gt;请注意， &lt;code&gt;? :&lt;/code&gt; 运算符的优先级非常低。如果除了将结果分配给变量之外做任何事情，整个 &lt;code&gt;? :&lt;/code&gt; 运算符也需要用括号括起来&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std::cout &amp;lt;&amp;lt; ((x &amp;gt; y) ? x : y) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果在上述情况下我们不将整个条件运算符括起来会发生什么。因为 &amp;laquo; 运算符的优先级高于 ?: 运算符，所以语句：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std::cout &amp;lt;&amp;lt; (x &amp;gt; y) ? x : y &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;将评估为：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(std::cout &amp;lt;&amp;lt; (x &amp;gt; y)) ? x : y &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;比较浮点数大小&#34;&gt;比较浮点数大小&lt;/h2&gt;
&lt;p&gt;进行浮点相等的最常见方法涉及使用一个函数来查看两个数字是否几乎相同。如果它们“足够接近”，那么我们称它们相等。用于表示“足够接近”的值传统上称为 epsilon。 Epsilon 通常被定义为一个小的正数（例如 0.00000001，有时写作 1e-8）&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cmath&amp;gt; // for std::abs()&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// epsilon is an absolute value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt; approximatelyEqualAbs(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; a, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; b, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; absEpsilon)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// if the distance between a and b is less than absEpsilon, then a and b are &amp;#34;close enough&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; std::abs(a - b) &amp;lt;= absEpsilon;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;虽然这个功能可以工作，但不是很好。 0.00001 的 epsilon 适用于 1.0 左右的输入，对于 0.0000001 左右的输入太大，对于 10,000 这样的输入太小&lt;/p&gt;
&lt;p&gt;著名计算机科学家唐纳德·高德纳 (Donald Knuth) 在他的著作“计算机编程的艺术，第二卷：半数值算法 (Addison-Wesley, 1969)”一书中提出了以下方法：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;algorithm&amp;gt; // std::max&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cmath&amp;gt; // std::abs&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// return true if the difference between a and b is within epsilon percent of the larger of a and b
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt; approximatelyEqualRel(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; a, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; b, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; relEpsilon)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; (std::abs(a - b) &amp;lt;= (std::max(std::abs(a), std::abs(b)) * relEpsilon));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在这种情况下，epsilon 不是绝对数字，而是相对于 a 或 b 的大小。在 &amp;lt;= 运算符的左侧，std::abs(a - b) 告诉我们 a 和 b 之间的距离为正数。在 &amp;lt;= 运算符的右侧，我们需要计算我们愿意接受的“足够接近”的最大值。为此，该算法选择 a 和 b 中较大的一个（作为数字总体大小的粗略指标），然后将其乘以 relEpsilon。在此函数中，relEpsilon 表示百分比。例如，如果我们想说“足够接近”意味着 a 和 b 在 a 和 b 中较大者的 1% 以内，我们传入 0.01 (1% = 1/100 = 0.01) 的 relEpsilon。 relEpsilon 的值可以根据情况调整为最合适的值（例如，0.002 的 epsilon 表示在 0.2% 以内）&lt;/p&gt;
&lt;p&gt;要执行不等式 (!=) 而不是相等，只需调用此函数并使用逻辑 NOT 运算符 (!) 翻转结果：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (!approximatelyEqualRel(a, b, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.001&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; a &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34; is not equal to &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; b &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;虽然 approximatelyEqualRel() 函数适用于大多数情况，但它并不完美，尤其是当数字接近零时：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;algorithm&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cmath&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// return true if the difference between a and b is within epsilon percent of the larger of a and b
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt; approximatelyEqualRel(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; a, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; b, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; relEpsilon)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; (std::abs(a - b) &amp;lt;= (std::max(std::abs(a), std::abs(b)) * relEpsilon));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#007f7f&#34;&gt;// a is really close to 1.0, but has rounding errors, so it&amp;#39;s slightly smaller than 1.0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; a{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; + &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#007f7f&#34;&gt;// First, let&amp;#39;s compare a (almost 1.0) to 1.0.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::cout &amp;lt;&amp;lt; approximatelyEqualRel(a, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1.0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1e-8&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#007f7f&#34;&gt;// Second, let&amp;#39;s compare a-1.0 (almost 0.0) to 0.0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::cout &amp;lt;&amp;lt; approximatelyEqualRel(a-&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1.0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1e-8&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这会返回：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1
0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;避免这种情况的一种方法是同时使用绝对 epsilon（如我们在第一种方法中所做的）和相对 epsilon（如我们在 Knuth 的方法中所做的）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;// return true if the difference between a and b is less than absEpsilon, or within relEpsilon percent of the larger of a and b
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt; approximatelyEqualAbsRel(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; a, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; b, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; absEpsilon, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; relEpsilon)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// Check if the numbers are really close -- needed when comparing numbers near zero.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;double&lt;/span&gt; diff{ std::abs(a - b) };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (diff &amp;lt;= absEpsilon)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// Otherwise fall back to Knuth&amp;#39;s algorithm
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; (diff &amp;lt;= (std::max(std::abs(a), std::abs(b)) * relEpsilon));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在这个算法中，我们首先检查 a 和 b 在绝对值上是否接近，这处理了 a 和 b 都接近于零的情况。 absEpsilon 参数应设置为非常小的值（例如 1e-12）。如果失败，则我们使用相对 epsilon 回退到 Knuth 的算法&lt;/p&gt;
&lt;p&gt;浮点数的比较是一个困难的话题，并且没有适用于所有情况的“一刀切”算法。但是，absEpsilon 为 1e-12 和 relEpsilon 为 1e-8 的 approximatesEqualAbsRel() 应该足以处理您将遇到的大多数情况&lt;/p&gt;
&lt;h2 id=&#34;逻辑-xor-运算符&#34;&gt;逻辑 XOR 运算符&lt;/h2&gt;
&lt;p&gt;C++ 不提供逻辑 XOR 运算符。与逻辑或或逻辑与不同，逻辑异或不能进行短路评估。因此，从逻辑 OR 和逻辑 AND 运算符中创建逻辑 XOR 运算符具有挑战性。但是，您可以使用不等运算符 (!=) 轻松模拟逻辑 XOR：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (a != b) ... &lt;span style=&#34;color:#007f7f&#34;&gt;// a XOR b, assuming a and b are Booleans
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这可以扩展到多个操作数，如下所示：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (a != b != c != d) ... &lt;span style=&#34;color:#007f7f&#34;&gt;// a XOR b XOR c XOR d, assuming a, b, c, and d are Booleans
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;请注意，上述 XOR 模式仅在操作数为布尔值（而非整数）时才有效。如果您需要一种适用于非布尔操作数的逻辑 XOR 形式，您可以将它们静态转换为布尔值：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt;&amp;gt;(a) != &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt;&amp;gt;(b) != &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt;&amp;gt;(c) != &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;bool&lt;/span&gt;&amp;gt;(d)) ... &lt;span style=&#34;color:#007f7f&#34;&gt;// a XOR b XOR c XOR d, for any type that can be converted to bool
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;位操作&#34;&gt;位操作&lt;/h1&gt;
&lt;h2 id=&#34;位标志-and-位操作-via-stdbitset&#34;&gt;位标志 and 位操作 via std::bitset&lt;/h2&gt;
&lt;p&gt;要定义一组位标志，我们通常会使用适当大小的无符号整数（8 位、16 位、32 位等……取决于我们有多少标志），或 std::bitset&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;bitset&amp;gt; // for std::bitset&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; mybitset {}; &lt;span style=&#34;color:#007f7f&#34;&gt;// 8 bits in size means room for 8 flags
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;位操作是您应该明确使用无符号整数（或 std::bitset）的少数情况之一&lt;/p&gt;
&lt;p&gt;std::bitset 提供了 4 个可用于位操作的关键函数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;test() 允许我们查询某个位是 0 还是 1&lt;/li&gt;
&lt;li&gt;set() 允许我们打开一个位（如果位已经打开，这将不执行任何操作）&lt;/li&gt;
&lt;li&gt;reset() 允许我们关闭一个位（如果该位已经关闭，这将不执行任何操作）&lt;/li&gt;
&lt;li&gt;flip() 允许我们将位值从 0 翻转为 1，反之亦然&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些函数中的每一个都将我们要操作的位的位置作为它们唯一的参数&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;bitset&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; bits{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0101&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// we need 8 bits, start with bit pattern 0000 0101
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bits.set(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;); &lt;span style=&#34;color:#007f7f&#34;&gt;// set bit position 3 to 1 (now we have 0000 1101)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bits.flip(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;); &lt;span style=&#34;color:#007f7f&#34;&gt;// flip bit 4 (now we have 0001 1101)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    bits.reset(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;); &lt;span style=&#34;color:#007f7f&#34;&gt;// set bit 4 back to 0 (now we have 0000 1101)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;All the bits: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; bits &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Bit 3 has value: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; bits.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;Bit 4 has value: &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; bits.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;) &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;按位运算符&#34;&gt;按位运算符&lt;/h2&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/27/638344de90243.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/27/638344de90243.png&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


为避免意外，请使用无符号操作数或 std::bitset 的按位运算符&lt;/p&gt;
&lt;p&gt;在计算按位 XOR 时，如果一列中有奇数个 1 位，则该列的结果为 1&lt;/p&gt;
&lt;h2 id=&#34;位掩码&#34;&gt;位掩码&lt;/h2&gt;
&lt;p&gt;位掩码是一组预定义的位，用于选择哪些特定位将被后续操作修改。位掩码阻止按位运算符接触我们不想修改的位，并允许访问我们确实想要修改的位&lt;/p&gt;
&lt;p&gt;最简单的一组位掩码是为每个位位置定义一个位掩码。我们用 0 来屏蔽我们不关心的位，用 1 来表示我们想要修改的位&lt;/p&gt;
&lt;p&gt;尽管位掩码可以是文字，但它们通常被定义为符号常量，因此可以为它们指定一个有意义的名称并易于重用&lt;/p&gt;
&lt;h3 id=&#34;在-c14-中定义位掩码&#34;&gt;在 C++14 中定义位掩码&lt;/h3&gt;
&lt;p&gt;因为 C++14 支持二进制文字，所以定义这些位掩码很容易：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cstdint&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask0{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0001&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask1{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0010&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask2{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0100&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask3{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;1000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask4{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0001&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask5{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0010&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask6{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0100&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask7{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1000&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 7
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;在-c11-或更早版本中定义位掩码&#34;&gt;在 C++11 或更早版本中定义位掩码&lt;/h3&gt;
&lt;p&gt;由于 C++11 不支持二进制文字，我们必须使用其他方法来设置符号常量&lt;/p&gt;
&lt;p&gt;第一种方法是使用十六进制文字：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask0{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x01&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// hex for 0000 0001
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask1{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x02&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// hex for 0000 0010
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask2{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x04&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// hex for 0000 0100
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask3{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x08&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// hex for 0000 1000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask4{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x10&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// hex for 0001 0000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask5{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x20&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// hex for 0010 0000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask6{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x40&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// hex for 0100 0000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask7{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0x80&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// hex for 1000 0000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;另一种更简单的方法是使用左移运算符将一位移动到正确的位置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask0{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 0000 0001
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask1{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 0000 0010
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask2{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 0000 0100
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask3{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 0000 1000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask4{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 0001 0000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask5{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 0010 0000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask6{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;6&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 0100 0000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask7{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;7&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 1000 0000
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;testing-a-bit&#34;&gt;Testing a bit&lt;/h3&gt;
&lt;p&gt;要确定某个位是开还是关，我们使用 &lt;code&gt;&amp;amp;&lt;/code&gt; 结合相应位的位掩码：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cstdint&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask0{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0001&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask1{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0010&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask2{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0100&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask3{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;1000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask4{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0001&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask5{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0010&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask6{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0100&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask7{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1000&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 7
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; flags{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0101&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 8 bits in size means room for 8 flags
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 0 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; ((flags &amp;amp; mask0) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 1 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; ((flags &amp;amp; mask1) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;setting-a-bit&#34;&gt;Setting a bit&lt;/h3&gt;
&lt;p&gt;要设置（打开）位，我们将按位或等于（运算符 &lt;code&gt;|=&lt;/code&gt;）与相应位的位掩码结合使用：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cstdint&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask0{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0001&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask1{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0010&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask2{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0100&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask3{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;1000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask4{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0001&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask5{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0010&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask6{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0100&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask7{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1000&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 7
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; flags{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0101&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 8 bits in size means room for 8 flags
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 1 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; ((flags &amp;amp; mask1) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    flags |= mask1; &lt;span style=&#34;color:#007f7f&#34;&gt;// turn on bit 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 1 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; ((flags &amp;amp; mask1) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我们还可以使用按位或同时打开多个位：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;flags |= (mask4 | mask5); &lt;span style=&#34;color:#007f7f&#34;&gt;// turn bits 4 and 5 on at the same time
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;resetting-a-bit&#34;&gt;Resetting a bit&lt;/h3&gt;
&lt;p&gt;要清除位（关闭），我们同时使用 &lt;code&gt;&amp;amp;=&lt;/code&gt; 和 &lt;code&gt;~&lt;/code&gt; ：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cstdint&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask0{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0001&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask1{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0010&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask2{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0100&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask3{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;1000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask4{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0001&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask5{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0010&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask6{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0100&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask7{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1000&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 7
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; flags{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0101&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 8 bits in size means room for 8 flags
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 2 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; ((flags &amp;amp; mask2) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    flags &amp;amp;= ~mask2; &lt;span style=&#34;color:#007f7f&#34;&gt;// turn off bit 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 2 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; ((flags &amp;amp; mask2) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我们可以同时关闭多个位：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;flags &amp;amp;= ~(mask4 | mask5); &lt;span style=&#34;color:#007f7f&#34;&gt;// turn bits 4 and 5 off at the same time
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;flipping-a-bit&#34;&gt;Flipping a bit&lt;/h3&gt;
&lt;p&gt;要切换位状态，我们使用 &lt;code&gt;^=&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cstdint&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask0{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0001&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask1{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0010&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask2{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0100&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask3{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;1000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask4{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0001&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask5{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0010&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask6{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0100&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; mask7{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1000&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 7
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; flags{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0101&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 8 bits in size means room for 8 flags
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 2 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; ((flags &amp;amp; mask2) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    flags ^= mask2; &lt;span style=&#34;color:#007f7f&#34;&gt;// flip bit 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 2 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; ((flags &amp;amp; mask2) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    flags ^= mask2; &lt;span style=&#34;color:#007f7f&#34;&gt;// flip bit 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 2 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; ((flags &amp;amp; mask2) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我们可以同时翻转多个位：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;flags ^= (mask4 | mask5); &lt;span style=&#34;color:#007f7f&#34;&gt;// flip bits 4 and 5 at the same time
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;位掩码和-stdbitset&#34;&gt;位掩码和 std::bitset&lt;/h2&gt;
&lt;p&gt;std::bitset 支持全套位运算符。因此，尽管使用函数（测试、设置、重置和翻转）修改单个位更容易，但如果需要，您可以使用按位运算符和位掩码&lt;/p&gt;
&lt;p&gt;函数只允许您一次修改单个位。按位运算符允许您一次修改多个位&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;cstdint&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;bitset&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;int&lt;/span&gt; main()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; mask0{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0001&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; mask1{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0010&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; mask2{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0100&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; mask3{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;1000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; mask4{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0001&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; mask5{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0010&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; mask6{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0100&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;constexpr&lt;/span&gt; std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; mask7{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b1000&amp;#39;0000&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// represents bit 7
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::bitset&amp;lt;&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;&amp;gt; flags{ &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0b0000&amp;#39;0101&lt;/span&gt; }; &lt;span style=&#34;color:#007f7f&#34;&gt;// 8 bits in size means room for 8 flags
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 1 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; (flags.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 2 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; (flags.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	flags ^= (mask1 | mask2); &lt;span style=&#34;color:#007f7f&#34;&gt;// flip bits 1 and 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 1 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; (flags.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 2 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; (flags.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	flags |= (mask1 | mask2); &lt;span style=&#34;color:#007f7f&#34;&gt;// turn bits 1 and 2 on
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 1 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; (flags.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 2 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; (flags.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	flags &amp;amp;= ~(mask1 | mask2); &lt;span style=&#34;color:#007f7f&#34;&gt;// turn bits 1 and 2 off
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 1 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; (flags.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	std::cout &amp;lt;&amp;lt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;bit 2 is &amp;#34;&lt;/span&gt; &amp;lt;&amp;lt; (flags.test(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;) ? &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;on&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;off&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;summary-1&#34;&gt;Summary&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;query bit states&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (flags &amp;amp; option4) ... &lt;span style=&#34;color:#007f7f&#34;&gt;// if option4 is set, do something
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;set bits (turn on)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;flags |= option4; &lt;span style=&#34;color:#007f7f&#34;&gt;// turn option 4 on.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;flags |= (option4 | option5); &lt;span style=&#34;color:#007f7f&#34;&gt;// turn options 4 and 5 on.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;clear bits (turn off)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;flags &amp;amp;= ~option4; &lt;span style=&#34;color:#007f7f&#34;&gt;// turn option 4 off
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;flags &amp;amp;= ~(option4 | option5); &lt;span style=&#34;color:#007f7f&#34;&gt;// turn options 4 and 5 off
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;flip bit states&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;flags ^= option4; &lt;span style=&#34;color:#007f7f&#34;&gt;// flip option4 from on to off, or vice versa
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;flags ^= (option4 | option5); &lt;span style=&#34;color:#007f7f&#34;&gt;// flip options 4 and 5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;输出不是直接写入的，它存储在缓冲区中，直到缓冲区被刷新。输出到文件或终端历来很慢（终端或控制台仍然很慢），逐个字符地写入是低效率的，写入一大块字节要有效得多。若 cerr 被缓冲，那么如果程序以非正常方式崩溃，您可能会将有用的调试信息卡在缓冲区中，而不是打印到 stderr。stdout 是行缓冲的，即在您编写换行符或显式刷新缓冲区之前，输出不会发送到操作系统。通常，std::endl 函数通过插入换行符并刷新流来工作。读取 stdcin 会刷新 stdcout&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
      <content:encoded><![CDATA[<h1 id="入门">入门</h1>
<ol>
<li>当您在 IDE 中创建新项目时，大多数 IDE 会为您设置两种不同的构建配置：发布配置和调试配置，开发程序时使用调试构建配置。当您准备好将可执行文件发布给其他人时，或者想要测试性能时，请使用发布构建配置
<ol>
<li>Debug：<strong>调试版本，</strong> 包含调试信息，所以 <strong>容量比Release大很多，</strong> 并且不进行任何优化（优化会使调试复杂化，因为源代码和生成的指令间关系会更复杂），便于程序员调试</li>
<li>Release：<strong>发布版本，</strong> 不对源代码进行调试，编译时对应用程序的速度进行优化，<strong>使得程序在代码大小和运行速度上都是最优的</strong></li>
</ol>
</li>
</ol>
<pre tabindex="0"><code>对于 CLion 用户，您可以添加 Release：按 Alt+Ctrl+S 调出 Settings &gt; Build，Execution，Deployment &gt; CMake &gt; 单击 Profiles 部分中的 + 按钮，将自动添加 Release 选项
</code></pre><ol start="2">
<li><strong>禁用编译器扩展</strong>以确保您的程序（和编码实践）保持符合 C++ 标准并且可以在任何系统上运行</li>
</ol>
<pre tabindex="0"><code>CLion 使用 CMake 构建项目。
将行 set(CMAKE_CXX_EXTENSIONS OFF) 添加到 CMakeList.txt 以禁用扩展
</code></pre><ol start="3">
<li><strong>将你的警告级别调到最大</strong>，尤其是在你学习的时候。它将帮助您识别可能的问题</li>
</ol>
<pre tabindex="0"><code>在 Clion（从 2021.3 版本开始）中，要将警告级别调到最高，您可以按 Alt+Ctrl+S 调出 Settings ，然后选择 Editor &gt; Inspections &gt; C/C++，然后手动选中所有框，或者在窗口的右侧，在矩形的 severity 框中选择错误，然后在另一个框中选择 In All Scopes
</code></pre><ol start="4">
<li><strong>选择语言标准</strong>：在专业环境中，通常选择比最新标准低一个或两个版本的语言标准（例如，现在 C++20 已经出来了，这意味着 C++14 或 C++17）。这样做通常是为了确保编译器制造商有机会解决缺陷，以便更好地理解新功能的最佳实践。在相关的情况下，这也有助于确保更好的跨平台兼容性，因为某些平台上的编译器可能不会立即为更新的语言标准提供全面支持。启用 C++17 语言标准（或更高版本）后，您应该能够在没有任何警告或错误的情况下编译以下代码</li>
</ol>
<pre tabindex="0"><code>#include &lt;array&gt;
#include &lt;iostream&gt;
#include &lt;string_view&gt;
#include &lt;tuple&gt;
#include &lt;type_traits&gt;

namespace a:🅱️:c
{
    inline constexpr std::string_view str{ &#34;hello&#34; };
}

template &lt;class... T&gt;
std::tuple&lt;std::size_t, std::common_type_t&lt;T...&gt;&gt; sum(T... args)
{
    return { sizeof...(T), (args + ...) };
}

int main()
{
    auto [iNumbers, iSum]{ sum(1, 2, 3) };
    std::cout &lt;&lt; a:🅱️:c::str &lt;&lt; &#39; &#39; &lt;&lt; iNumbers &lt;&lt; &#39; &#39; &lt;&lt; iSum &lt;&lt; &#39;\n&#39;;

    std::array arr{ 1, 2, 3 };

    std::cout &lt;&lt; std::size(arr) &lt;&lt; &#39;\n&#39;;

    return 0;
}
</code></pre><h1 id="c-基础知识">C++ 基础知识</h1>
<h2 id="注释">注释</h2>
<h2 id="写在前面">写在前面</h2>
<ol>
<li>通常，注释应该用于三件事
<ol>
<li>在库、程序或函数级别，使用注释来<strong>描述作用</strong></li>
<li>在库、程序或函数内部，使用注释来描述<strong>如何操作</strong></li>
<li>在语句级别，使用注释来<strong>描述原因</strong></li>
</ol>
</li>
<li>注释是一种很好的方式来提醒自己（或告诉别人）你做出一个决定而不是另一个决定的原因</li>
<li>注释您的代码，像在对不知道代码功能的人说话一样写您的注释。不要假设你会记得你为什么做出特定的选择</li>
</ol>
<h2 id="单行注释">单行注释</h2>
<ol>
<li>在行的右侧添加注释会使代码和注释都难以阅读，尤其是在行很长的情况下。如果行相当短，评论可以简单地对齐（通常是一个制表位），像这样：</li>
</ol>
<pre tabindex="0"><code>std::cout &lt;&lt; &#34;Hello world!\n&#34;;                 // std::cout lives in the iostream library
std::cout &lt;&lt; &#34;It is very nice to meet you!\n&#34;; // this is much easier to read
std::cout &lt;&lt; &#34;Yeah!\n&#34;;                        // don&#39;t you think so?
</code></pre><ol start="2">
<li>但是，如果行很长，将注释放在右边会使行变得很长。在这种情况下，单行注释通常放在它正在注释的行之上：</li>
</ol>
<pre tabindex="0"><code>// std::cout lives in the iostream library
std::cout &lt;&lt; &#34;Hello world!\n&#34;;

// this is much easier to read
std::cout &lt;&lt; &#34;It is very nice to meet you!\n&#34;;

// don&#39;t you think so?
std::cout &lt;&lt; &#34;Yeah!\n&#34;;
</code></pre><ol start="3">
<li>Commenting out code</li>
</ol>
<pre tabindex="0"><code>//    std::cout &lt;&lt; 1;
</code></pre><h2 id="多行注释">多行注释</h2>
<ol>
<li>Explaining code</li>
</ol>
<pre tabindex="0"><code>/* This is a multi-line comment.
 * the matching asterisks to the left
 * can make this easier to read
 */
</code></pre><ol start="2">
<li>Commenting out code</li>
</ol>
<pre tabindex="0"><code>/*
    std::cout &lt;&lt; 1;
    std::cout &lt;&lt; 2;
    std::cout &lt;&lt; 3;
*/
</code></pre><h2 id="初始化">初始化</h2>
<ol>
<li>Default initialization：默认初始化</li>
</ol>
<pre tabindex="0"><code>int a; // no initializer
</code></pre><ol start="2">
<li>Copy initialization：在现代 C++ 中用的不多</li>
</ol>
<pre tabindex="0"><code>int width = 5; // copy initialization of value 5 into variable width
</code></pre><ol start="3">
<li>Direct initialization：当在括号内提供初始化程序时，这称为直接初始化。最初引入直接初始化是为了更有效地初始化复杂对象。但是，与复制初始化一样，直接初始化在现代 C++ 中使用不多</li>
</ol>
<pre tabindex="0"><code>int width( 5 ); // direct initialization of value 5 into variable width
</code></pre><ol start="4">
<li>Brace initialization：在 C++ 中初始化对象的现代方法是使用一种利用大括号的初始化形式&ndash;<strong>大括号初始化</strong>（也称为统一初始化或列表初始化）。引入大括号初始化是为了提供在大多数情况下都有效的<strong>更一致的初始化语法</strong>（这就是为什么它有时被称为“统一初始化”）。此外，大括号初始化提供了<strong>一种使用值列表初始化对象的方法</strong>（这就是为什么它有时被称为“列表初始化”）。大括号初始化有三种形式：</li>
</ol>
<pre tabindex="0"><code>int width { 5 }; // direct brace initialization of value 5 into variable width (preferred)
int height = { 6 }; // copy brace initialization of value 6 into variable height
int depth {}; // value initialization 
</code></pre><p><strong>大括号初始化</strong>有一个额外的好处：它不允许“缩小转换”。这意味着如果您尝试使用变量无法安全保存的值来初始化变量，<strong>编译器将产生错误，迫使您在继续之前解决这个问题</strong>。例如：</p>
<pre tabindex="0"><code>int width { 4.5 }; // error: a number with a fractional value can&#39;t fit into an int
</code></pre><h2 id="stdendl-vs-n">std::endl vs ‘\n’</h2>
<p>使用 std::endl 可能有点低效，因为它实际上做了两个工作：它将光标移动到控制台的下一行，并确保任何缓存的输出立即显示在屏幕上（这称为刷新输出）。当使用 std::cout 将文本写入控制台时，std::cout 通常会刷新输出（如果不刷新，通常也无关紧要），因此让 std::endl 执行刷新很少重要</p>
<p>因此，通常首选使用“\n”字符。 ‘\n’ 字符将光标移动到控制台的下一行，但不请求刷新，因此在刷新不会发生的情况下它会执行得更好。 ‘\n’ 字符也更易于阅读，因为它更短并且可以嵌入到现有文本中</p>
<p>这是一个以两种不同方式使用“\n”的示例：</p>
<pre tabindex="0"><code>#include &lt;iostream&gt; // for std::cout

int main()
{
    int x{ 5 };
    std::cout &lt;&lt; &#34;x is equal to: &#34; &lt;&lt; x &lt;&lt; &#39;\n&#39;; // Using &#39;\n&#39; standalone
    std::cout &lt;&lt; &#34;And that&#39;s all, folks!\n&#34;; // Using &#39;\n&#39; embedded into a double-quoted piece of text (note: no single quotes when used this way)
    return 0;
}
</code></pre><p>这打印：</p>
<pre tabindex="0"><code>x is equal to: 5
And that&#39;s all, folks!
</code></pre><p><strong>将文本输出到控制台时，优先使用“\n”而不是 std::endl</strong></p>
<h2 id="代码的可读性">代码的可读性</h2>
<ol>
<li>您的行的长度不应超过 80 个字符</li>
</ol>
<pre tabindex="0"><code>int main()
{
    std::cout &lt;&lt; &#34;This is a really, really, really, really, really, really, really, &#34;
        &#34;really long line\n&#34;; // one extra indentation for continuation line

    std::cout &lt;&lt; &#34;This is another really, really, really, really, really, really, really, &#34;
                 &#34;really long line\n&#34;; // text aligned with the previous line for continuation line

    std::cout &lt;&lt; &#34;This one is short\n&#34;;
}
</code></pre><p>如果用操作符（例如 &laquo; 或 +）拆分长行，则应将操作符放在下一行的开头，而不是当前行的结尾</p>
<pre tabindex="0"><code>std::cout &lt;&lt; 3 + 4
    + 5 + 6
    * 7 * 8;
</code></pre><p>许多编辑器都有一个内置功能（或插件/扩展），可以在给定的列（例如 80 个字符）处显示一行（称为“列指南”），因此您可以轻松查看行何时变得太长</p>
<p><strong>Clion column guide</strong> : File &gt; Settings &gt; Editor &gt; Code Style &gt; General &gt; 在 &ldquo;Visual guides&rdquo; 矩形框中键入 80 并应用更改
2. 使用空格通过对齐值或注释或在代码块之间添加间距来使您的代码更易于阅读</p>
<pre tabindex="0"><code>cost          = 57;
pricePerItem  = 24;
value         = 5;
numberOfItems = 17;

std::cout &lt;&lt; &#34;Hello world!\n&#34;;                  // cout lives in the iostream library
std::cout &lt;&lt; &#34;It is very nice to meet you!\n&#34;;  // these comments are easier to read
std::cout &lt;&lt; &#34;Yeah!\n&#34;;                         // especially when all lined up

// cout lives in the iostream library
std::cout &lt;&lt; &#34;Hello world!\n&#34;;

// these comments are easier to read
std::cout &lt;&lt; &#34;It is very nice to meet you!\n&#34;;

// when separated by whitespace
std::cout &lt;&lt; &#34;Yeah!\n&#34;;
</code></pre><h1 id="c-基础函数和文件">C++ 基础：函数和文件</h1>
<h2 id="函数返回值">函数返回值</h2>
<p>C++标准只定义了3种状态码的含义：0、EXIT_SUCCESS、EXIT_FAILURE。 0 和 EXIT_SUCCESS 都表示程序执行成功。 EXIT_FAILURE 表示程序没有成功执行</p>
<p>EXIT_SUCCESS 和 EXIT_FAILURE 是 <code>&lt;cstdlib&gt;</code> 标头中定义的预处理器宏：</p>
<pre tabindex="0"><code>#include &lt;cstdlib&gt; // for EXIT_SUCCESS and EXIT_FAILURE

int main()
{
    return EXIT_SUCCESS;
}
</code></pre><p>如果你想最大限度地提高可移植性，你应该只使用 0 或 EXIT_SUCCESS 来指示成功终止，或者使用 EXIT_FAILURE 来指示不成功终止</p>
<h2 id="前向声明和定义">前向声明和定义</h2>
<p>对于以下每个程序，说明它们是编译失败、链接失败、两者都失败，还是编译和链接成功。如果您不确定，请尝试编译它们！</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span><span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;3 + 4 + 5 = &#34;</span> &lt;&lt; add(<span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">5</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> x + y;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Doesn’t compile. The compiler will complain that the add() called in main() does not have the same number of parameters as the one that was forward declared.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span><span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;3 + 4 + 5 = &#34;</span> &lt;&lt; add(<span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">5</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y, <span style="color:#fff;font-weight:bold">int</span> z)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> x + y + z;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Doesn’t compile. The compiler will complain that it can’t find a matching add() function that takes 3 arguments, because the add() function that was forward declared only takes 2 arguments.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span><span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;3 + 4 = &#34;</span> &lt;&lt; add(<span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">4</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y, <span style="color:#fff;font-weight:bold">int</span> z)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> x + y + z;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Doesn’t link. The compiler will match the forward declaration of add to the function call to add() in main(). However, no add() function that takes two parameters was ever implemented (we only implemented one that took 3 parameters), so the linker will complain.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span><span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y, <span style="color:#fff;font-weight:bold">int</span> z);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;3 + 4 + 5 = &#34;</span> &lt;&lt; add(<span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">5</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y, <span style="color:#fff;font-weight:bold">int</span> z)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> x + y + z;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Compiles and links. The function call to add() matches the forward declaration, the implemented function also matches.</p>
<h2 id="具有多个cpp文件的程序">具有多个cpp文件的程序</h2>
<h3 id="cpp-文件">.cpp 文件</h3>
<p>编译器会单独编译每个文件。它不知道其他代码文件的内容，也不记得它从以前编译的代码文件中看到的任何内容。这种有限的可见性和短内存是有意的，因此文件可能具有名称相同的函数或变量而不会相互冲突。</p>
<p>C++ 语言支持&quot;分别编译&quot;（separatecompilation）。也就是说，一个程序所有的内容，可以分成不同的部分分别放在不同的 .cpp 文件里。.cpp 文件里的东西都是相对独立的，在编译（compile）时不需要与其他文件互通，只需要在编译成目标文件后再与其他的目标文件做一次链接（link）就行了。比如，在文件 a.cpp 中定义了一个全局函数 &ldquo;void a(){}&quot;，而在文件 b.cpp 中需要调用这个函数。即使这样，文件 a.cpp 和文件 b.cpp 并不需要相互知道对方的存在，而是可以分别地对它们进行编译，编译成目标文件之后再链接，整个程序就可以运行了</p>
<p>这是怎么实现的呢？从写程序的角度来讲，很简单。在文件 b.cpp 中，在调用 &ldquo;void a()&rdquo; 函数之前，先<strong>声明一下</strong>这个函数 &ldquo;voida();&quot;，就可以了。这是因为编译器在编译 b.cpp 的时候会生成一个符号表（symbol table），像 &ldquo;void a()&rdquo; 这样的看不到定义的符号，就会被存放在这个表中。再进行链接的时候，编译器就会在别的目标文件中去寻找这个符号的定义。一旦找到了，程序也就可以顺利地生成了</p>
<h3 id="h-文件">.h 文件</h3>
<p>考虑一下，如果有一个很常用的函数 &ldquo;void f() {}&quot;，在整个程序中的许多 .cpp 文件中都会被调用，那么，我们就只需要在一个文件中定义这个函数，而在其他的文件中声明这个函数就可以了。一个函数还好对付，声明起来也就一句话。但是，如果函数多了，比如是一大堆的数学函数，有好几百个，那怎么办？</p>
<p>头文件允许我们将声明放在一个位置，然后在我们需要的地方导入它们。这可以在多文件程序中节省大量的输入</p>
<p>头文件通常只包含函数和变量声明，而不包含函数和变量定义（否则可能会导致违反单一定义规则）。<strong>符号常量</strong>是一个例外</p>
<p>使用双引号 <code>&quot;&quot;</code> 包括您编写的或预期在当前目录中找到的头文件</p>
<p>使用尖括号 <code>&lt;&gt;</code> 来包含编译器、操作系统或您在系统其他位置安装的第三方库附带的标头</p>
<h4 id="为什么-iostream-没有-h-扩展名">为什么 iostream 没有 .h 扩展名？</h4>
<p>首次创建 C++ 时，标准库中的所有文件都以 .h 后缀结尾。生活是一致的，而且很好。 cout 和 cin 的原始版本在 iostream.h 中声明。当 ANSI 委员会对该语言进行标准化时，他们决定将标准库中使用的所有名称移动到 std 命名空间中，以帮助避免与用户定义的标识符发生命名冲突。然而，这带来了一个问题：如果他们将所有名称移动到 std 名称空间中，那么旧程序（包括 iostream.h）将不再工作！</p>
<p>为解决此问题，引入了一组缺少 .h 扩展名的新头文件。这些新的头文件定义了 std 命名空间内的所有名称。这样，包含 <code>#include &lt;iostream.h&gt;</code> 的旧程序不需要重写，新程序可以 <code>#include &lt;iostream&gt;</code></p>
<h4 id="include来自其他目录的头文件">Include来自其他目录的头文件</h4>
<p>一种（不好的）方法是在#include 行中包含一个指向您要包含的头文件的相对路径。例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&#34;headers/myHeader.h&#34;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&#34;../moreHeaders/myOtherHeader.h&#34;</span><span style="color:#0f0;font-weight:bold">
</span></span></span></code></pre></div><p>虽然这会编译（假设文件存在于那些相对目录中），但这种方法的缺点是它需要您在代码中反映您的目录结构。如果您更新了目录结构，您的代码将不再有效</p>
<p><strong>更好的方法</strong>是告诉你的编译器或 IDE 你在其他位置有一堆头文件，这样当它在当前目录中找不到它们时就会去那里寻找。这通常可以通过在 IDE 项目设置中设置包含路径或搜索目录来完成</p>
<p>这种方法的好处是，如果您更改了目录结构，您只需更改一个编译器或 IDE 设置，而不是每个代码文件</p>
<h4 id="headers-may-include-other-headers">Headers may include other headers</h4>
<p>当您的代码文件 <code>#includes</code> 第一个头文件时，您还将获得第一个头文件包含的任何其他头文件（以及那些包含的任何头文件，等等）。这些额外的头文件有时称为传递包含，因为它们是隐式包含而不是显式包含</p>
<p>每个文件都应该 <code>显式#include</code> 它需要编译的所有头文件。不要依赖从其他标头传递过来的标头</p>
<h4 id="include-头文件顺序">include 头文件顺序</h4>
<p>如果你的头文件写得正确并且<code>#include</code>了他们需要的一切，那么包含的顺序应该无关紧要</p>
<p>现在考虑以下场景：假设 header A 需要 header  B 的声明，但忘记包含它。在我们的代码文件中，如果我们在 header  A 之前包含 header  B，我们的代码仍然可以编译！这是因为编译器会先编译 B 中的所有声明，然后再编译 A 中依赖于这些声明的代码</p>
<p>但是，如果我们首先包含 header  A，那么编译器会报错，因为 A 的代码将在编译器看到 B 的声明之前编译。这实际上是更可取的，因为错误已经浮出水面，然后我们可以修复它.</p>
<p>为了最大限度地提高编译器标记缺少包含的机会，请按以下方式命令您的<code>#includes</code>：</p>
<ol>
<li>The paired header file</li>
<li>Other headers from your project</li>
<li>3rd party library headers</li>
<li>Standard library headers</li>
</ol>
<p>The headers for each grouping should be sorted alphabetically（按字母顺序排序）.</p>
<p>这样，如果您的某个用户定义的 Header 缺少第 3 方库或标准库 Header 的<code>#include</code>，则更有可能导致编译错误，因此您可以修复它</p>
<h4 id="header-file-best-practices">Header file best practices</h4>
<ol>
<li>始终 include header guards</li>
<li>不要在头文件中定义变量和函数（全局常量是一个例外）</li>
<li>为头文件指定与其关联的源文件相同的名称（例如，grades.h 与 grades.cpp 配对）</li>
<li>每个头文件应该有一个特定的工作，并且尽可能独立。例如，您可以将与功能 A 相关的所有声明放在 A.h 中，将与功能 B 相关的所有声明放在 B.h 中。这样如果你以后只关心 A，你可以只 include A.h 而不会得到任何与 B 相关的东西</li>
<li>请注意您需要为代码文件中使用的功能显式包含哪些 header</li>
<li>您编写的每个 header 都应该自行编译（它应该<code>#include</code> 它需要的每个依赖项）</li>
<li>仅 <code>#include</code> 您需要的内容（不要仅仅因为可以就包含所有内容）</li>
<li>不要<code>#include</code> .cpp 文件</li>
</ol>
<h4 id="header-guards">Header guards</h4>
<p>使用头文件，很容易导致头文件中的定义被多次包含的情况。当一个头文件 <code>#includes</code> 另一个头文件（这很常见）时，就会发生重复定义</p>
<p>Example:</p>
<p>square.h:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#007f7f">// We shouldn&#39;t be including function definitions in header files
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">// But for the sake of this example, we will
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> getSquareSides()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">4</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>geometry.h:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&#34;square.h&#34;</span><span style="color:#0f0;font-weight:bold">
</span></span></span></code></pre></div><p>main.cpp:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&#34;square.h&#34;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&#34;geometry.h&#34;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在预处理完所有 <code>#includes</code>  之后，main.cpp 最终看起来像这样：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> getSquareSides()  <span style="color:#007f7f">// from square.h
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">4</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> getSquareSides() <span style="color:#007f7f">// from geometry.h (via square.h)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">4</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>我们可以通过一种称为 <code>Header guards</code> 的机制来避免上述问题。<code>Header guards</code>  是采用以下形式的条件编译指令：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#ifndef SOME_UNIQUE_NAME_HERE
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#define SOME_UNIQUE_NAME_HERE
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// your declarations (and certain types of definitions) here
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#endif
</span></span></span></code></pre></div><p>当此标头为<code>#included</code> 时，预处理器会检查之前是否定义了 <code>SOME_UNIQUE_NAME_HERE</code>。如果这是我们第一次包含此标头，则不会定义 <code>SOME_UNIQUE_NAME_HERE</code>。因此，它 <code>#defines SOME_UNIQUE_NAME_HERE</code> 并包含文件的内容。如果标头再次包含到同一个文件中，<code>SOME_UNIQUE_NAME_HERE</code> 将在第一次包含标头的内容时已经定义，并且标头的内容将被忽略</p>
<p><strong>你所有的头文件都应该有头文件保护</strong>。 <code>SOME_UNIQUE_NAME_HERE</code> 可以是您想要的任何名称，但按照惯例设置为头文件的完整文件名，全部大写，使用下划线作为空格或标点符号</p>
<p>在大型程序中，可能有两个单独的头文件（包含在不同的目录中）最终具有相同的文件名（例如 <code>directoryA\config.h</code> 和 <code>directoryB\config.h</code>）。如果仅文件名用于包含保护（例如 <code>CONFIG_H</code>），这两个文件最终可能会使用相同的保护名称。如果发生这种情况，任何包含（直接或间接）这两个 config.h 文件的文件将不会收到要包含的包含文件的内容。这可能会导致编译错误</p>
<p>由于这种保护名称冲突的可能性，许多开发人员建议在标头保护中使用更复杂/唯一的名称。一些好的建议是 <code>&lt;PROJECT&gt;_&lt;PATH&gt;_&lt;FILE&gt;_H</code> 、<code>&lt;FILE&gt;_&lt;LARGE RANDOM NUMBER&gt;_H</code> 或 <code>&lt;FILE&gt;_&lt;CREATION DATE&gt;_H </code>的命名约定</p>
<h5 id="summary">Summary</h5>
<p>标头保护旨在确保给定标头文件的内容不会被多次复制到任何<strong>单个文件</strong>中，以防止重复定义</p>
<p>请注意，重复声明是可以的，因为一个声明可以多次声明而不会发生意外——但即使您的头文件由所有声明（无定义）组成，包含头文件保护仍然是 Best Practice</p>
<p>Note that header guards do <em>not</em> prevent the contents of a header file from being copied (once) into separate project files. This is a good thing, because we often need to reference the contents of a given header from different project files</p>
<h4 id="pragma-once">pragma once</h4>
<p>现代编译器使用 <code>#pragma</code> 指令支持一种更简单的替代形式的标头保护：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#pragma once
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// your code here
</span></span></span></code></pre></div><p><code>#pragma once</code> 与标头保护具有相同的目的，并且具有更短且不易出错的额外好处。对于大多数项目，<code>#pragma once</code> 工作正常，许多开发人员更喜欢使用它们而不是标头保护。然而，<code>#pragma once</code> 并不是 C++ 语言的正式部分（而且可能永远不会是，因为它无法以在所有情况下都可靠工作的方式实现）</p>
<p>为了最大的可移植性，优先使用 <code>header guards</code> 而不是 <code>#pragma once</code></p>
<h2 id="命名冲突和命名空间介绍">命名冲突和命名空间介绍</h2>
<h3 id="命名冲突">命名冲突</h3>
<p>大多数命名冲突发生在两种情况下：</p>
<p>两个（或更多）同名函数（或全局变量）被引入到属于同一程序的不同文件中。这将导致<strong>链接器错误</strong></p>
<p>两个（或更多）同名函数（或全局变量）被引入到同一个文件中。这将导致<strong>编译器错误</strong></p>
<h3 id="命名空间">命名空间</h3>
<p><strong>命名空间</strong>是一个区域，允许您在其中声明名称以消除歧义。命名空间为在其中声明的名称提供一个作用域区域（称为命名空间作用域）——这仅仅意味着在命名空间内声明的任何名称都不会被误认为是其他作用域中的相同名称</p>
<p><strong>命名空间</strong>通常用于对大型项目中的相关标识符进行分组，以帮助确保它们不会无意中与其他标识符发生冲突。例如，如果您将所有数学函数放在一个名为 math 的命名空间中，那么您的数学函数将不会与 math 命名空间之外的同名函数发生冲突</p>
<p>在 C++ 中，任何未在类、函数或命名空间内定义的名称都被视为隐式定义的命名空间的一部分，称为<strong>全局命名空间</strong>（有时也称为全局范围）</p>
<p>只有声明和定义语句可以出现在全局命名空间中。这意味着我们可以在全局命名空间中定义变量，尽管通常应该避免这种情况。这也意味着其他类型的语句（例如表达式语句）不能放在全局命名空间中（全局变量的初始化器是一个例外）：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt; // handled by preprocessor</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// All of the following statements are part of the global namespace
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> foo();    <span style="color:#007f7f">// okay: function forward declaration in the global namespace
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> x;         <span style="color:#007f7f">// compiles but strongly discouraged: uninitialized variable definition in the global namespace
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> y { <span style="color:#ff0;font-weight:bold">5</span> };   <span style="color:#007f7f">// compiles but discouraged: variable definition with initializer in the global namespace
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>x = <span style="color:#ff0;font-weight:bold">5</span>;         <span style="color:#007f7f">// compile error: executable statements are not allowed in the global namespace
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()     <span style="color:#007f7f">// okay: function definition in the global namespace
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> goo();    <span style="color:#007f7f">// okay: another function forward declaration in the global namespace
</span></span></span></code></pre></div><p>在最初设计 C++ 时，C++ 标准库中的所有标识符（包括 std::cin 和 std::cout）都可以在没有 std:: 前缀的情况下使用（它们是全局命名空间的一部分）。但是，这意味着标准库中的任何标识符都可能与您为自己的标识符选择的任何名称（也在全局命名空间中定义）发生冲突。当您#include 标准库中的新文件时，正在运行的代码可能会突然出现命名冲突。或者更糟的是，在一个版本的 C++ 下编译的程序可能无法在未来的 C++ 版本下编译，因为引入标准库的新标识符可能与已经编写的代码发生命名冲突。因此，C++ 将标准库中的所有功能移动到名为“std”（标准的缩写）的命名空间中</p>
<p>std::cout 的名字并不是真正的 std::cout。它实际上只是 cout，而 std 是标识符 cout 所属的命名空间的名称。因为 cout 是在 std 命名空间中定义的，所以名称 cout 不会与我们在全局命名空间中创建的任何名为 cout 的对象或函数发生冲突</p>
<h2 id="预处理器简介">预处理器简介</h2>
<p>在编译之前，代码文件会经历一个称为翻译的阶段。翻译阶段会发生很多事情，让您的代码准备好进行编译（如果您好奇，可以在此处找到翻译阶段列表）。应用了翻译的代码文件称为翻译单元</p>
<p>最值得注意的翻译阶段涉及预处理器。预处理器最好被认为是一个单独的程序，它可以处理每个代码文件中的文本</p>
<p>当预处理器运行时，它会扫描代码文件（从上到下），寻找预处理器指令。预处理程序指令（通常简称为 <strong>指令（Directives）</strong>）是以# 符号开头并以换行符（不是分号）结尾的指令。这些指令告诉预处理器执行某些文本操作任务。请注意，预处理器不理解 C++ 语法——相反，指令有自己的语法（在某些情况下类似于 C++ 语法，而在其他情况下，则不太相似）</p>
<p>请注意，预处理器不会以任何方式修改原始代码文件——相反，预处理器所做的所有文本更改都会在每次编译代码文件时临时发生在内存中或使用临时文件</p>
<h3 id="includes">Includes</h3>
<p>当您 <code>#include</code> 一个文件时，预处理器会用 include 文件的内容替换 <code>#include</code> 指令。然后对 include 的内容进行预处理（连同文件的其余部分），然后进行编译</p>
<h3 id="macro-defines">Macro defines</h3>
<p><code>#define</code> 指令可用于创建 <strong>宏</strong></p>
<p>有两种基本类型的宏：<strong>类对象宏</strong>和<strong>类函数宏</strong></p>
<p><strong>类函数宏</strong>的行为类似于函数，并且具有相似的目的。它们的使用通常被认为是危险的，它们几乎可以做的任何事情都可以通过一个正常的函数来完成</p>
<p><strong>类对象宏</strong>可以通过以下两种方式之一定义：</p>
<pre tabindex="0"><code>#define identifier
#define identifier substitution_text
</code></pre><p><strong>替换文本</strong>的类对象宏被用作（在 C 中）将名称分配给文字的一种方式。这不再是必需的，因为 C++ 中提供了更好的方法（Const 变量和符号常量）。带有替换文本的类对象宏现在通常只能在遗留代码中看到</p>
<p><strong>没有替换文本</strong>的类对象宏：标识符的任何进一步出现都将被删除并被替换为任何东西！</p>
<p>与带有替换文本的类对象宏不同，这种形式的宏通常被认为可以使用。</p>
<h3 id="conditional-compilation">Conditional compilation</h3>
<p><strong>条件编译预处理器指令</strong>允许您指定在什么条件下编译或不编译。有很多不同的条件编译指令，但我们在这里只介绍目前使用最多的三个：<code>#ifdef</code>、<code>#ifndef</code> 和 <code>#endif</code></p>
<p><code>#ifdef</code> 预处理器指令允许预处理器检查标识符是否先前已被<code>#defined</code>。如果是，编译 <code>#ifdef</code> 和匹配的 <code>#endif</code> 之间的代码。如果不是，代码将被忽略</p>
<p>考虑以下程序：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#define PRINT_JOE
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#ifdef PRINT_JOE
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Joe</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>; <span style="color:#007f7f">// will be compiled since PRINT_JOE is defined
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#0f0;font-weight:bold">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#ifdef PRINT_BOB
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Bob</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>; <span style="color:#007f7f">// will be ignored since PRINT_BOB is not defined
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#0f0;font-weight:bold">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>因为 <code>PRINT_JOE</code> 已被 <code>#defined</code>，<code>std::cout &lt;&lt; &quot;Joe\n&quot;</code> 行将被编译。因为 <code>PRINT_BOB</code> 尚未被 <code>#defined</code>，<code>std::cout &lt;&lt; &quot;Bob\n&quot; </code>行将被忽略</p>
<p><code>#ifndef</code> 与 <code>#ifdef</code> 相反，因为它允许您检查标识符是否尚未 <code>#defined</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#ifndef PRINT_BOB
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Bob</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>该程序打印 <code>“Bob”</code>，因为 <code>PRINT_BOB</code> 从未被  <code>#defined</code></p>
<p>条件编译的一个更常见的用途是使用 <code>#if 0</code> 将代码块排除在编译之外（就像它在注释块中一样）：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Joe</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#if 0</span><span style="color:#007f7f"> // Don&#39;t compile anything starting here
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    std::cout &lt;&lt; &#34;Bob\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    std::cout &lt;&lt; &#34;Steve\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#0f0;font-weight:bold">#endif // until this point
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这也提供了一种方便的方法来**“注释掉”包含多行注释的代码**（由于多行注释是不可嵌套的，因此不能使用另一个多行注释来注释掉）：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Joe</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#if 0</span><span style="color:#007f7f"> // Don&#39;t compile anything starting here
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    std::cout &lt;&lt; &#34;Bob\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    /* Some
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * multi-line
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * comment here
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    std::cout &lt;&lt; &#34;Steve\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#0f0;font-weight:bold">#endif // until this point
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>类对象宏不影响其他预处理器指令，宏只会导致普通代码的文本替换。其他预处理器命令将被忽略</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#define FOO 9 </span><span style="color:#007f7f">// Here&#39;s a macro substitution
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#ifdef FOO </span><span style="color:#007f7f">// This FOO does not get replaced because it’s part of another preprocessor directive
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; FOO; <span style="color:#007f7f">// This FOO gets replaced with 9 because it&#39;s part of the normal code
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#0f0;font-weight:bold">#endif
</span></span></span></code></pre></div><p>指令在编译前解析，逐个文件地从上到下解析</p>
<pre tabindex="0"><code>#include &lt;iostream&gt;

void foo()
{
#define MY_NAME &#34;Alex&#34;
}

int main()
{
	std::cout &lt;&lt; &#34;My name is: &#34; &lt;&lt; MY_NAME;

	return 0;
}
</code></pre><p>即使看起来 <code>#define MY_NAME “Alex”</code> 是在函数 <code>foo</code> 中定义的，预处理器也不会注意到，因为它不理解像函数这样的 C++ 概念。因此，该程序的行为与 <code>#define MY_NAME “Alex”</code> 在函数 <code>foo</code> 之前或之后立即定义的程序相同。为了一般的可读性，您通常希望在函数之外 <code>#define</code> 标识符</p>
<p>预处理器完成后，该文件中所有定义的标识符都将被丢弃。这意味着指令<strong>仅从定义点到定义它们的文件末尾有效</strong>。<strong>一个代码文件中定义的指令不会影响同一项目中的其他代码文件</strong></p>
<p>考虑以下示例：</p>
<p>function.cpp:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> doSomething()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#ifdef PRINT
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Printing!&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#ifndef PRINT
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Not printing!&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>}
</span></span></code></pre></div><p>main.cpp:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> doSomething(); <span style="color:#007f7f">// forward declaration for function doSomething()
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#define PRINT
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    doSomething();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上面的程序会打印：</p>
<pre tabindex="0"><code>Not printing!
</code></pre><p>尽管 <code>PRINT</code> 是在 <code>main.cpp</code> 中定义的，但这对 <code>function.cpp</code> 中的任何代码都没有任何影响（<code>PRINT</code> 只是从定义点到 <code>main.cpp</code> 末尾的 <code>#defined</code>）</p>
<h2 id="如何完成你的第一个程序">如何完成你的第一个程序</h2>
<ol>
<li>Design（设计）
<ol>
<li>定义目标。将此表示为面向用户的结果通常很有用，例如：
<ul>
<li>允许用户组织姓名和相关电话号码的列表</li>
<li>模拟球从塔上掉落到地面需要多长时间</li>
</ul>
</li>
<li>定义需求。既指您的解决方案需要遵守的约束（例如预算、时间线、空间、内存等），也指程序为满足用户需求而必须展示的能力。请注意，您的要求同样应该关注“什么”，而不是“如何”。例如：
<ul>
<li>应保存电话号码，以便日后调用</li>
<li>用户应该能够输入塔的高度</li>
</ul>
</li>
<li>定义您的工具、目标和备份计划
<ol>
<li>定义您的程序将运行的目标架构 和/或 操作系统</li>
<li>确定您将使用的工具集</li>
<li>确定您是单独编写程序还是作为团队的一部分编写程序’</li>
<li>定义您的测试/反馈/发布策略</li>
<li>确定您将如何备份您的代码</li>
</ol>
</li>
<li>将困难问题分解为简单问题。如果发现其中一个项目（功能）太难实现，只需将该项目拆分为多个子项目/子功能。最终，您应该达到程序中的每个功能都可以轻松实现的地步</li>
<li>弄清楚事件的顺序</li>
</ol>
</li>
<li>Implementation（实现）
<ol>
<li>概述您的主要功能。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Get first number from user
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">//    getUserInput();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Get mathematical operation from user
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">//    getMathematicalOperation();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Get second number from user
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">//    getUserInput();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Calculate result
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">//    calculateResult();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Print result
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">//    printResult();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="2">
<li>实现各个功能。对于每个函数，您将做三件事：
<ol>
<li>定义函数原型（输入和输出）</li>
<li>编写函数</li>
<li>测试功能</li>
</ol>
</li>
<li>最终测试。一旦你的程序“完成”，最后一步就是测试整个程序并确保它按预期工作。如果它不起作用，请修复它</li>
</ol>
</li>
<li>Words of advice when writing programs（忠告）
<ol>
<li><strong>Keep your programs simple to start</strong>.让你的第一个目标尽可能简单，一些你绝对可以实现的目标</li>
<li><strong>Add features over time</strong>.一旦您的简单程序运行良好并且运行良好，您就可以向其添加功能</li>
<li><strong>Focus on one area at a time</strong>.不要试图一次编写所有代码，也不要将注意力分散到多个任务上。一次专注于一项任务</li>
<li><strong>Test each piece of code as you go</strong>.编写一段代码，然后立即编译并测试它。如果它不起作用，您将确切地知道问题出在哪里，并且很容易修复。确定代码有效后，移至下一段并重复。完成代码的编写可能需要更长的时间，但是当您完成后，整个事情应该可以正常工作，并且您不必花费两倍的时间来弄清楚为什么它不起作用</li>
<li><strong>Don’t invest in perfecting early code</strong>.让你的功能最低限度地工作，然后继续。不要以完美为目标——重要的程序从来都不是完美的，而且总有更多的事情可以做来改进它们。达到“足够好”并继续前进</li>
</ol>
</li>
</ol>
<h1 id="调试-c-程序">调试 C++ 程序</h1>
<h2 id="调试过程">调试过程</h2>
<ol>
<li>找到问题的根本原因（通常是不起作用的代码行）</li>
<li>确保您了解问题发生的原因</li>
<li>确定您将如何解决问题</li>
<li>修复问题</li>
<li>重新测试以确保问题已解决并且没有出现新问题</li>
</ol>
<h2 id="调试策略">调试策略</h2>
<p>观察程序运行时的行为，并尝试从中诊断问题</p>
<ol>
<li>弄清楚如何<strong>重现问题</strong></li>
<li>运行程序并收集信息以<strong>缩小问题所在的范围</strong></li>
<li>重复前面的步骤，<strong>直到找到问题</strong></li>
</ol>
<h3 id="调试策略-1注释掉你的代码">调试策略 1：注释掉你的代码</h3>
<p>如果您的程序表现出错误行为，减少必须搜索的代码量的一种方法是注释掉一些代码并查看问题是否仍然存在。如果问题仍然存在，则注释掉的代码不负责任</p>
<h3 id="调试策略-2验证代码流">调试策略 2：验证代码流</h3>
<p>另一个在更复杂的程序中常见的问题是程序调用一个函数的次数太多或太少（包括根本不调用）</p>
<p>在这种情况下，将语句放在函数的顶部以打印函数的名称会很有帮助。这样，当程序运行时，您可以看到调用了哪些函数</p>
<p>当<strong>出于调试目的打印信息时</strong>，使用 <code>std::cerr</code> 而不是 <code>std::cout</code>。这样做的一个原因是 std::cout 可能被缓冲，这意味着在您要求 std::cout 输出信息和它实际输出信息之间可能会有一个暂停。如果您使用 std::cout 进行输出，然后您的程序随后立即崩溃，则 std::cout 可能已经或可能还没有实际输出。这可能会误导您了解问题出在哪里。另一方面，std::cerr 是无缓冲<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>的，这意味着您发送给它的任何内容都会立即输出。这有助于确保所有调试输出尽快出现（以一些性能为代价，我们在调试时通常不关心）</p>
<p>使用 std::cerr 还有助于明确输出的信息是针对错误情况而不是正常情况</p>
<p>添加临时调试语句时，不缩进它们会很有帮助。这使它们更容易在以后找到并移除</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> getValue()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>std::cerr &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;getValue() called</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">4</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>std::cerr &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;main() called</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; getValue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="调试策略-3打印值">调试策略 3：打印值</h3>
<p>对于某些类型的错误，程序可能会计算或传递错误的值。</p>
<p>我们还可以输出变量（包括参数）或表达式的值，以确保它们是正确的。</p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>std::cerr &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;add() called (x=&#34;</span> &lt;&lt; x &lt;&lt;<span style="color:#0ff;font-weight:bold">&#34;, y=&#34;</span> &lt;&lt; y &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;)</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> x + y;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> printResult(<span style="color:#fff;font-weight:bold">int</span> z)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;The answer is: &#34;</span> &lt;&lt; z &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> getUserInput()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Enter a number: &#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> x{};
</span></span><span style="display:flex;"><span>	std::cin &gt;&gt; x;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> x;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> x{ getUserInput() };
</span></span><span style="display:flex;"><span>std::cerr &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;main::x = &#34;</span> &lt;&lt; x &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> y{ getUserInput() };
</span></span><span style="display:flex;"><span>std::cerr &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;main::y = &#34;</span> &lt;&lt; y &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; x &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; + &#34;</span> &lt;&lt; y &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> z{ add(x, <span style="color:#ff0;font-weight:bold">5</span>) };
</span></span><span style="display:flex;"><span>std::cerr &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;main::z = &#34;</span> &lt;&lt; z &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>	printResult(z);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>现在我们将得到输出：</p>
<pre tabindex="0"><code>Enter a number: 4
main::x = 4
Enter a number: 3
main::y = 3
add() called (x=4, y=5)
main::z = 9
The answer is: 9
</code></pre><p>虽然为诊断目的向程序添加调试语句是一种常见的基本技术，也是一种功能性技术（尤其是当调试器由于某种原因不可用时），但由于多种原因它并不是很好：</p>
<ol>
<li>调试语句使您的代码混乱。</li>
<li>调试语句使程序的输出混乱。</li>
<li>调试语句必须在完成后删除，这使得它们不可重用。</li>
<li>调试语句需要修改您的代码以添加和删除，这可能会引入新的错误。</li>
</ol>
<h3 id="条件化调试代码">条件化调试代码</h3>
<p>一种更容易在整个程序中禁用和启用调试的方法是使用预处理器指令使调试语句有条件：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#define ENABLE_DEBUG </span><span style="color:#007f7f">// comment out to disable debugging
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> getUserInput()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#ifdef ENABLE_DEBUG
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>std::cerr &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;getUserInput() called</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Enter a number: &#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> x{};
</span></span><span style="display:flex;"><span>	std::cin &gt;&gt; x;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> x;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#ifdef ENABLE_DEBUG
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>std::cerr &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;main() called</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>    <span style="color:#fff;font-weight:bold">int</span> x{ getUserInput() };
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;You entered: &#34;</span> &lt;&lt; x;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>现在我们可以通过注释/取消注释#define ENABLE_DEBUG 来启用调试。这使我们能够重用以前添加的调试语句，然后在用完它们后将它们禁用，而不必从代码中实际删除它们</p>
<p>这解决了必须删除调试语句的问题以及这样做的风险，但代价是代码更加混乱。这种方法的另一个缺点是，如果您输入错误（例如拼错“DEBUG”）或忘记将标头包含到代码文件中，则可能无法启用该文件的部分或全部调试</p>
<h3 id="使用日志">使用日志</h3>
<p>通过预处理器进行条件化调试的另一种方法是将调试信息发送到日志文件。日志文件是记录软件中发生的事件的文件（通常存储在磁盘上）。将信息写入日志文件的过程称为日志记录。大多数应用程序和操作系统都会写入可用于帮助诊断发生的问题的日志文件</p>
<p>日志文件有几个优点。因为写入日志文件的信息与程序的输出是分开的，所以可以避免将正常输出和调试输出混合在一起造成的混乱。日志文件也可以很容易地发送给其他人进行诊断——所以如果有人使用你的软件有问题，你可以让他们把日志文件发给你，这可能会帮助你找到问题所在的线索</p>
<p>虽然您可以编写自己的代码来创建日志文件并将输出发送给它们，但最好还是使用许多现有的第三方日志记录工具之一</p>
<p>Using the <a href="https://github.com/SergiusTheBest/plog">plog</a> logger：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;plog/Log.h&gt; // Step 1: include the logger headers</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;plog/Initializers/RollingFileInitializer.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> getUserInput()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	PLOGD &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;getUserInput() called&#34;</span>; <span style="color:#007f7f">// PLOGD is defined by the plog library
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Enter a number: &#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> x{};
</span></span><span style="display:flex;"><span>	std::cin &gt;&gt; x;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> x;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	plog::init(plog::debug, <span style="color:#0ff;font-weight:bold">&#34;Logfile.txt&#34;</span>); <span style="color:#007f7f">// Step 2: initialize the logger
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	PLOGD &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;main() called&#34;</span>; <span style="color:#007f7f">// Step 3: Output to the log as if you were writing to the console
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> x{ getUserInput() };
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;You entered: &#34;</span> &lt;&lt; x;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这是上述记录器的输出（在 <code>Logfile.txt</code> 文件中）：</p>
<pre tabindex="0"><code>2018-12-26 20:03:33.295 DEBUG [4752] [main@14] main() called
2018-12-26 20:03:33.296 DEBUG [4752] [getUserInput@4] getUserInput() called
</code></pre><p>您如何包含、初始化和使用记录器将根据您选择的特定记录器而有所不同</p>
<p>请注意，使用此方法也不需要条件编译指令，因为大多数记录器都有减少/消除将输出写入日志的方法。这使得代码更容易阅读，因为条件编译行增加了很多混乱。使用 plog，可以通过将 init 语句更改为以下内容来暂时禁用日志记录：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>plog::init(plog::none , <span style="color:#0ff;font-weight:bold">&#34;Logfile.txt&#34;</span>); <span style="color:#007f7f">// plog::none eliminates writing of most messages, essentially turning logging off
</span></span></span></code></pre></div><h2 id="使用集成调试器stepping步进">使用集成调试器：Stepping（步进）</h2>
<p>当您运行您的程序时，执行从 main 函数的顶部开始，然后逐个语句按顺序执行，直到程序结束。在你的程序运行的任何时间点，程序都在跟踪很多事情：你正在使用的变量的值，调用了哪些函数（这样当这些函数返回时，程序就会知道在哪里返回），以及程序中的当前执行点（因此它知道接下来要执行哪个语句）。所有这些跟踪信息都称为您的程序状态（或简称为状态）</p>
<p><strong>Stepping</strong> 是一组相关调试器功能的名称，这些功能让我们逐条语句地执行（单步执行）我们的代码</p>
<p>箭头标记表示接下来将执行所指向的行</p>
<h3 id="step-into">Step into</h3>
<p><strong>步入</strong> 命令执行程序正常执行路径中的下一条语句，然后暂停程序的执行，以便我们可以使用调试器检查程序的状态。如果正在执行的语句包含一个函数调用，step into 会使程序跳转到被调用函数的顶部，并在那里暂停</p>
<h3 id="step-over">Step over</h3>
<p>同<strong>步入</strong>命令一样，<strong>步过</strong>命令执行程序正常执行路径中的下一条语句。然而，step into 将输入函数调用并逐行执行它们，step over 将不间断地执行整个函数，并在函数执行后将控制权返回给您</p>
<p>step over 命令提供了一种方便的方法来跳过函数，当您确定它们已经工作或现在对调试它们不感兴趣时</p>
<h3 id="step-out">Step out</h3>
<p>与其他两个步进命令不同，<strong>步出</strong> 命令不只是执行下一行代码。相反，它<strong>执行当前正在执行的函数中的所有剩余代码</strong>，然后在函数返回时将控制权返回给您</p>
<p>当你不小心进入了一个你不想调试的函数时，这个命令最有用</p>
<h2 id="使用集成调试器running-and-breakpoints运行和断点">使用集成调试器：Running and breakpoints（运行和断点）</h2>
<h3 id="run-to-cursor">Run to cursor</h3>
<p>第一个有用的命令通常称为<strong>运行到光标</strong>。此运行到光标命令执行程序，直到执行到达光标选择的语句。然后它将控制权返回给您，以便您可以从那时开始进行调试</p>
<h3 id="breakpoints">Breakpoints</h3>
<p><strong>断点</strong> 是一个特殊的标记，它告诉调试器在调试模式下运行时在断点处停止执行程序</p>
<h2 id="使用集成调试器调用堆栈">使用集成调试器：调用堆栈</h2>
<p>调用堆栈是为到达当前执行点而调用的所有活动函数的列表。调用堆栈包括每个调用的函数的条目，以及函数返回时将返回到哪一行代码。每当调用一个新函数时，该函数就会被添加到调用堆栈的顶部。当前函数返回给调用者时，它会从调用栈的顶部移除，控制权会返回到它下面的函数</p>
<p>调用堆栈窗口是一个显示当前调用堆栈的调试器窗口</p>
<p>函数名称后的行号显示了每个函数中要执行的下一行</p>
<p>由于调用堆栈的顶部条目代表当前正在执行的函数，因此此处的行号显示了执行恢复时将执行的下一行。调用堆栈中的其余条目表示将在某个时间点返回的函数，因此这些条目的行号表示函数返回后将执行的下一条语句</p>
<h2 id="在问题成为问题之前发现问题">在问题成为问题之前发现问题</h2>
<h3 id="重构你的代码">重构你的代码</h3>
<p>当您向程序添加新功能（“行为更改”）时，您会发现某些功能的长度会增加。随着函数越来越长，它们变得越来越复杂，也越来越难以理解</p>
<p>解决此问题的一种方法是将单个长函数分解为多个较短的函数。这种在不改变代码行为的情况下对代码进行结构更改的过程（通常是为了使您的程序更有组织性、模块化或性能）称为<strong>重构</strong></p>
<p>一个函数占据一个垂直屏幕的代码通常被认为太长了——如果你必须滚动才能阅读整个函数，函数的可理解性会显着下降。但越短越好 &ndash; 少于十行的功能是好的。少于五行的函数就更好了</p>
<p>更改代码时，<strong>进行行为更改或结构更改</strong>，然后重新测试正确性。同时进行行为和结构更改往往会导致更多错误以及更难发现的错误</p>
<h3 id="约束">约束</h3>
<p>基于约束的技术涉及添加一些额外的代码（如果需要，可以在非调试构建中编译出来）以检查是否违反了某些假设或期望集</p>
<p>例如，如果我们正在编写一个函数来计算一个数字的阶乘，它需要一个非负参数，该函数可以检查以确保调用者在继续之前传递了一个非负数。如果调用者传入一个负数，那么该函数可能会立即出错，而不是产生一些不确定的结果，从而有助于确保立即发现问题</p>
<p>一种常见的方法是通过 assert 和 static_assert</p>
<h1 id="基本数据类型">基本数据类型</h1>
<h2 id="数据类型大小">数据类型大小</h2>
<p>数据类型的大小取决于编译器和计算机体系结构！</p>
<p>C++ 仅保证每个基本数据类型都具有最小大小

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/26/6381d2545c3fa.png">
<img src="https://bu.dusays.com/2022/11/26/6381d2545c3fa.png" alt="1"  />
</a>
</div>

</p>
<p>为了获得最大的兼容性，您不应假设变量大于指定的最小大小</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bool:</span><span style="color:#0ff;font-weight:bold">\t\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">bool</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;char:</span><span style="color:#0ff;font-weight:bold">\t\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">char</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;wchar_t:</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">wchar_t</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;char16_t:</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">char16_t</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;char32_t:</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">char32_t</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;short:</span><span style="color:#0ff;font-weight:bold">\t\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">short</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;int:</span><span style="color:#0ff;font-weight:bold">\t\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">int</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;long:</span><span style="color:#0ff;font-weight:bold">\t\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">long</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;long long:</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">long</span> <span style="color:#fff;font-weight:bold">long</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;float:</span><span style="color:#0ff;font-weight:bold">\t\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">float</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;double:</span><span style="color:#0ff;font-weight:bold">\t\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">double</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;long double:</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">&#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">long</span> <span style="color:#fff;font-weight:bold">double</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bytes</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>下面是我的 x64 机器的输出，使用 Clion：</p>
<pre tabindex="0"><code>bool:           1 bytes
char:           1 bytes
wchar_t:        2 bytes
char16_t:       2 bytes
char32_t:       4 bytes
short:          2 bytes
int:            4 bytes
long:           4 bytes
long long:      8 bytes
float:          4 bytes
double:         8 bytes
long double:    16 bytes
</code></pre><p>如果您使用不同类型的机器或不同的编译器，您的结果可能会有所不同。请注意，您不能对 void 类型使用 sizeof 运算符，因为它没有大小（这样做会导致编译错误）</p>
<h2 id="无符号整数和有符号整数">无符号整数和有符号整数</h2>
<p>有符号整数范围：

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/26/6381d81f385fa.png">
<img src="https://bu.dusays.com/2022/11/26/6381d81f385fa.png" alt="1"  />
</a>
</div>

</p>
<p>无符号整数范围：

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/26/6381d91f961eb.png">
<img src="https://bu.dusays.com/2022/11/26/6381d91f961eb.png" alt="1"  />
</a>
</div>

</p>
<p>如果无符号整数超出范围，则将其除以大于该类型的最大数，只保留余数</p>
<p>在 C++ 的数学运算中（例如算术或比较），如果使用一个有符号整数和一个无符号整数，则<strong>有符号整数将转换为无符号整数</strong>。并且无符号整数不能存储负数，这会导致数据丢失</p>
<p>在保存整数（甚至应该是非负的整数）和数学运算时，有符号数优于无符号数。避免混合有符号和无符号数字</p>
<p>在 C++ 中仍然有一些情况必须使用无符号数：</p>
<p>首先，在处理位操作时首选无符号数。当需要明确定义的环绕行为时，它们也很有用（在某些算法中很有用，例如加密和随机数生成）</p>
<p>其次，无符号数的使用在某些情况下仍然是不可避免的，主要是那些与数组索引有关的情况。。在这些情况下，无符号值可以转换为有符号值</p>
<h2 id="固定宽度整数和-size_t">固定宽度整数和 size_t</h2>
<h3 id="fixed-width-整数">Fixed-width 整数</h3>
<p>为什么整数变量的大小不固定？</p>
<p>这可以追溯到 C，当时计算机速度很慢，性能是最受关注的问题。 C 选择有意保留整数的大小，以便编译器实现者可以选择在目标计算机体系结构上表现最佳的 int 大小</p>
<p>C99 定义了一组固定宽度的整数（在 stdint.h 头文件中），保证在任何体系结构上都具有相同的大小</p>
<p>C++ 正式采用这些固定宽度整数作为 C++11 的一部分。可以通过包含 <code>&lt;cstdint&gt;</code> 头文件来访问它们，它们在 std 命名空间内定义</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/26/6381dcb67d0e0.png">
<img src="https://bu.dusays.com/2022/11/26/6381dcb67d0e0.png" alt="1"  />
</a>
</div>

</p>
<h3 id="fast-and-least-整数">Fast and least 整数</h3>
<p>The fast 类型（<code>std::int_fast#_t</code> 和 <code>std::uint_fast#_t</code>）提供最快的有符号/无符号整数类型，宽度至少为 # 位（其中 # = 8、16、32 或 64）。例如，<code>std::int_fast32_t</code> 将为您提供最快的至少 32 位的有符号整数类型</p>
<p>The least 类型（<code>std::int_least#_t</code> 和 <code>std::uint_least#_t</code>）提供宽度至少为 # 位（其中 # = 8、16、32 或 64）的最小有符号/无符号整数类型。例如，<code>std::uint_least32_t</code> 将为您提供至少 32 位的最小无符号整数类型</p>
<p>示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cstdint&gt; // for fixed-width integers</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;least 8:  &#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(std::<span style="color:#fff;font-weight:bold">int_least8_t</span>) * <span style="color:#ff0;font-weight:bold">8</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bits</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;least 16: &#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(std::<span style="color:#fff;font-weight:bold">int_least16_t</span>) * <span style="color:#ff0;font-weight:bold">8</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bits</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;least 32: &#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(std::<span style="color:#fff;font-weight:bold">int_least32_t</span>) * <span style="color:#ff0;font-weight:bold">8</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bits</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;fast 8:  &#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(std::<span style="color:#fff;font-weight:bold">int_fast8_t</span>) * <span style="color:#ff0;font-weight:bold">8</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bits</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;fast 16: &#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(std::<span style="color:#fff;font-weight:bold">int_fast16_t</span>) * <span style="color:#ff0;font-weight:bold">8</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bits</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;fast 32: &#34;</span> &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(std::<span style="color:#fff;font-weight:bold">int_fast32_t</span>) * <span style="color:#ff0;font-weight:bold">8</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; bits</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Result：</p>
<pre tabindex="0"><code>least 8:  8 bits
least 16: 16 bits
least 32: 32 bits

fast 8:  8 bits
fast 16: 16 bits
fast 32: 32 bits
</code></pre><p>然而，这些快速且最小的整数有其自身的缺点：首先，真正使用它们的程序员并不多，不熟悉会导致错误。其次，快速类型会导致与我们在 4 字节整数中看到的相同类型的内存浪费。最严重的是，由于快速/最小整数的大小可能会有所不同，因此您的程序可能会在解析为不同大小的架构上表现出不同的行为</p>
<h3 id="stdint8_t-和-stduint8_t-可能表现得像字符而不是整数">std::int8_t 和 std::uint8_t 可能表现得像字符而不是整数</h3>
<p>由于 C++ 规范中的疏忽，大多数编译器分别将 std::int8_t 和 std::uint8_t（以及相应的快速和最小固定宽度类型）定义为 signed char 和 unsigned char 类型，并将其视为相同的类型。这意味着这些 8 位类型的行为可能（或可能不）与其他固定宽度类型不同，这可能会导致错误。此行为是系统相关的，因此在一种体系结构上正确运行的程序可能无法编译或在另一种体系结构上正确运行</p>
<p>为了保持一致性，最好完全避免使用 std::int8_t 和 std::uint8_t（以及相关的快速和最少类型）（改用 std::int16_t 或 std::uint16_t）</p>
<p>8 位固定宽度整数类型通常被视为字符而不是整数值（这可能因系统而异）。大多数情况下首选 16 位固定整数类型</p>
<h3 id="best-practice">Best practice</h3>
<p>我们的立场是正确比快速更好，在编译时失败比运行时更好——因此，我们建议避免使用快速/最少的类型，而使用固定宽度的类型。如果您后来发现需要支持无法编译固定宽度类型的平台，那么您可以在此时决定如何迁移您的程序（并彻底测试）</p>
<ol>
<li>当整数的大小无关紧要时，首选 int（例如，数字将始终适合 2 字节有符号整数的范围）。例如，如果您要求用户输入他们的年龄，或者从 1 数到 10，则 int 是 16 位还是 32 位都没有关系（数字将适合任何一种方式）。这将涵盖您可能遇到的绝大多数情况</li>
<li>存储需要保证范围的数量时，首选 <code>std::int#_t</code></li>
<li>在进行位操作或需要明确定义的环绕行为时，首选 <code>std::uint#_t</code></li>
<li>尽可能避免以下情况：
<ol>
<li>存储数量的无符号类型</li>
<li>8 位固定宽度整数类型</li>
<li>Fast and least 整数类型</li>
<li>任何特定于编译器的固定宽度整数——例如，Visual Studio 定义了 <code>__int8</code>、<code>__int16</code> ……</li>
</ol>
</li>
</ol>
<h3 id="size_t">size_t</h3>
<p>sizeof（以及许多返回大小或长度值的函数）返回一个 std::size_t 类型的值。 std::size_t 被定义为无符号整数类型，通常用于表示对象的大小或长度</p>
<p>有趣的是，我们可以使用 sizeof 运算符（返回 std::size_t 类型的值）来询问 std::size_t 本身的大小：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cstddef&gt; // std::size_t</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#fff;font-weight:bold">sizeof</span>(std::size_t) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>就像整数的大小会因系统而异一样，std::size_t 的大小也会有所不同。 std::size_t 保证为无符号且至少为 16 位，但在大多数系统上将等同于应用程序的地址宽度。也就是说，对于 32 位应用程序，std::size_t 通常是 32 位无符号整数，而对于 64 位应用程序，size_t 通常是 64 位无符号整数。 size_t 被定义为足够大以容纳系统上可创建的最大对象的大小（以字节为单位）。例如，如果 std::size_t 为 4 字节宽，则系统上可创建的最大对象不能大于 4,294,967,295 字节，因为 4,294,967,295 是 4 字节无符号整数可以存储的最大数字。这只是对象大小的上限，实际大小限制可能会更低，具体取决于您使用的编译器</p>
<p>根据定义，任何大小（以字节为单位）大于 size_t 可以容纳的最大整数值的对象都被视为格式错误（并将导致编译错误），因为 sizeof 运算符将无法在不环绕的情况下返回大小</p>
<h2 id="浮点数ieee-754">浮点数（IEEE 754）</h2>
<h3 id="浮点范围和浮点精度">浮点范围和浮点精度</h3>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/26/63820f12cc479.png">
<img src="https://bu.dusays.com/2022/11/26/63820f12cc479.png" alt="1"  />
</a>
</div>

</p>
<p>使用浮点文字时，始终至少包含一位小数（即使小数为 0）。这有助于编译器理解该数字是浮点数而不是整数</p>
<pre tabindex="0"><code>int x{5}; // 5 means integer
double y{5.0}; // 5.0 is a floating point literal (no suffix means double type by default)
float z{5.0f}; // 5.0 is a floating point literal, f suffix means float type
</code></pre><p>始终确保字面量的类型与分配给它们或用于初始化的变量的类型相匹配。否则会导致不必要的转换，可能会导致精度损失</p>
<p>确保在应该使用浮点文字的地方不使用整数文字。这包括初始化浮点对象或为浮点对象赋值、进行浮点运算以及调用需要浮点值的函数</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/26/6382110b7d067.png">
<img src="https://bu.dusays.com/2022/11/26/6382110b7d067.png" alt=""  />
</a>
</div>

</p>
<p>输出浮点数时，std::cout 的默认精度为 6——也就是说，它假定所有浮点变量仅对 6 位有效（浮点数的最小精度），因此它将截断之后的任何内容</p>
<p>浮点变量的精度位数取决于大小（浮点数的精度低于双精度数）和存储的特定值（某些值的精度高于其他值）。浮点值的精度在 6 到 9 位之间，大多数浮点值至少有 7 位有效数字。双精度值的精度在 15 到 18 位之间，大多数双精度值至少有 16 位有效数字。 Long double 的最小精度为 15、18 或 33 位有效数字，具体取决于它占用的字节数</p>
<h3 id="舍入误差">舍入误差</h3>
<p>我们可以使用名为 std::setprecision() 的输出操纵器函数覆盖 std::cout 显示的默认精度。输出操纵器改变数据的输出方式，并在 iomanip 标头中定义</p>
<pre tabindex="0"><code>#include &lt;iostream&gt;
#include &lt;iomanip&gt; // for output manipulator std::setprecision()

int main()
{
    std::cout &lt;&lt; std::setprecision(16); // show 16 digits of precision
    std::cout &lt;&lt; 3.33333333333333333333333333333333333333f &lt;&lt;&#39;\n&#39;; // f suffix means float
    std::cout &lt;&lt; 3.33333333333333333333333333333333333333 &lt;&lt; &#39;\n&#39;; // no suffix means double

    return 0;
}
</code></pre><p>在使用需要比变量所能容纳的精度更高的浮点数时，必须小心</p>
<p><strong>除非空间非常宝贵，否则最好使用 double over float，因为 float 缺乏精度通常会导致不准确</strong></p>
<p>值 123456789.0 具有 10 位有效数字，但浮点值通常具有 7 位精度（而 123456792 的结果仅精确到 7 位有效数字）。我们失去了一些精度！当由于无法精确存储数字而导致精度丢失时，这称为<strong>舍入误差</strong></p>
<p>数学运算（例如加法和乘法）往往会使舍入误差增大。所以即使0.1在第17位有效位有舍入误差，但是当我们加上0.1十次时，舍入误差已经爬到第16位有效位了。继续操作会导致此错误变得越来越严重</p>
<h3 id="nan-和-inf">NaN 和 Inf</h3>
<p>有两种特殊类别的浮点数。第一个是 <code>Inf</code>，代表无穷大。 Inf 可以是正数或负数。第二个是 <code>NaN</code>，代表“不是数字”。有几种不同类型的 NaN（我们不会在这里讨论）。 NaN 和 Inf 仅在编译器对浮点数使用特定格式 (IEEE 754) 时可用</p>
<h3 id="conclusion">Conclusion</h3>
<p>总而言之，关于浮点数你应该记住两件事：</p>
<p>浮点数对于存储非常大或非常小的数字很有用，包括带有小数部分的数字</p>
<p>浮点数通常有小的舍入误差，即使数字的有效数字少于精度也是如此。很多时候这些都没有引起注意，因为它们太小了，而且因为输出的数字被截断了。但是，浮点数的比较可能不会给出预期的结果。对这些值执行数学运算将导致舍入误差变大</p>
<h2 id="布尔值">布尔值</h2>
<p>如果您希望 std::cout 打印“true”或“false”而不是 0 或 1，您可以使用 std::boolalpha。这是一个例子：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#fff;font-weight:bold">true</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#fff;font-weight:bold">false</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; std::boolalpha; <span style="color:#007f7f">// print bools as true or false
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#fff;font-weight:bold">true</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#fff;font-weight:bold">false</span> &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>您可以使用 std::noboolalpha 将其关闭</p>
<p>您不能使用除 0 1 外的整数初始化布尔值：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">bool</span> b{ <span style="color:#ff0;font-weight:bold">4</span> }; <span style="color:#007f7f">// error: narrowing conversions disallowed
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::cout &lt;&lt; b;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>但是，在任何可以将整数转换为布尔值的上下文中，整数 0 将转换为 false，而任何其他整数将转换为 true</p>
<p>事实证明，std::cin 只接受布尔变量的两个输入：0 和 1（不是 true 或 false）。任何其他输入都会导致 std::cin 无声地失败。在这种情况下，因为我们输入了 true，所以 std::cin 默默地失败了。失败的输入也会将变量清零，因此 b 也被赋值 false。因此，当 std::cout 打印 b 的值时，它打印 0</p>
<p>要允许 std::cin 接受“false”和“true”作为输入，必须启用 std::boolalpha 选项：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">bool</span> b{};
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Enter a boolean value: &#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// Allow the user to enter &#39;true&#39; or &#39;false&#39; for boolean values
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#007f7f">// This is case-sensitive, so True or TRUE will not work
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::cin &gt;&gt; std::boolalpha;
</span></span><span style="display:flex;"><span>	std::cin &gt;&gt; b;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;You entered: &#34;</span> &lt;&lt; b &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>但是，当启用 std::boolalpha 时，“0”和“1”将不再被视为布尔值</p>
<h2 id="chars">Chars</h2>
<p>char 数据类型旨在保存单个字符。字符可以是单个字母、数字、符号或空格</p>
<p>char 数据类型是整数类型，这意味着基础值存储为整数。类似于布尔值 0 被解释为 false 而非零被解释为 true 的方式，char 变量存储的整数被解释为 ASCII 字符</p>
<p>Char 由 C++ 定义为大小始终为 1 个字节。默认情况下，char 可以是有符号的或无符号的（尽管它通常是有符号的）。如果您使用 chars 来保存 ASCII 字符，则不需要指定符号（因为有符号和无符号字符都可以保存 0 到 127 之间的值）</p>
<p>如果您使用 char 来保存小整数（除非您明确优化空间，否则您不应该这样做），您应该始终指定它是有符号的还是无符号的。 signed char 可以保存 -128 到 127 之间的数字。unsigned char 可以保存 0 到 255 之间的数字</p>
<p><strong>将单个字符放在单引号中（ e.g. <code>'t'</code> or <code>'\n'</code>, not <code>&quot;t&quot;</code> or <code>&quot;\n&quot;</code>）这有助于编译器更有效地进行优化</strong></p>
<p>出于向后兼容性的原因，许多 C++ 编译器支持多字符文字，即包含多个字符（例如“56”）的字符文字。如果支持，它们具有实现定义的值（意味着它因编译器而异）。因为它们不是 C++ 标准的一部分，而且它们的值也没有严格定义，所以应该避免使用多字符文字</p>
<p>ASCII 之外最著名的映射是 Unicode 标准，它将超过 144,000 个整数映射到许多不同语言的字符。由于 Unicode 包含如此多的代码点，因此单个 Unicode 代码点需要 32 位来表示一个字符（称为 UTF-32）。但是，Unicode 字符也可以使用多个 16 位或 8 位字符（分别称为 UTF-16 和 UTF-8）进行编码</p>
<p>char16_t 和 char32_t 添加到 C++11 以提供对 16 位和 32 位 Unicode 字符的明确支持。 C++20 中添加了 char8_t</p>
<p>您不需要使用 char8_t、char16_t 或 char32_t，除非您计划让您的程序与 Unicode 兼容</p>
<p>同时，在处理字符（和字符串）时，您应该只使用 ASCII 字符。使用来自其他字符集的字符可能会导致您的字符显示不正确</p>
<h2 id="通过-static_cast-运算符进行显式类型转换">通过 static_cast 运算符进行显式类型转换</h2>
<pre tabindex="0"><code>static_cast&lt;new_type&gt;(expression)
</code></pre><p><code>static_cast</code> 将表达式中的值作为输入，并返回转换为 <code>new_type</code> 指定类型（例如 int、bool、char、double）的值</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> print(<span style="color:#fff;font-weight:bold">int</span> x)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; x;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	print( <span style="color:#fff;font-weight:bold">static_cast</span>&lt;<span style="color:#fff;font-weight:bold">int</span>&gt;(<span style="color:#ff0;font-weight:bold">5.5</span>) ); <span style="color:#007f7f">// explicitly convert double value 5.5 to an int
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="常量和符号常量">常量和符号常量</h2>
<h3 id="const-variables">const variables</h3>
<p>Const 变量必须在定义它们时进行初始化，然后不能通过赋值更改该值</p>
<p>Const 变量可以从其他变量（包括非常量变量）初始化</p>
<p>命名时以 “k” 开头, 大小写混合,例如：</p>
<pre tabindex="0"><code>const int kDaysInAWeek = 7;
</code></pre><h3 id="符号常量">符号常量</h3>
<p>符号常量指的是<strong>被赋予常量值的名称</strong>。<code>const variables</code> 是一种符号常量，因为变量有一个名称（它的标识符）和一个常量值</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#define MAX_STUDENTS_PER_CLASS 30
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;The class has &#34;</span> &lt;&lt; MAX_STUDENTS_PER_CLASS &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; students.</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>编译此程序时，预处理器会将 MAX_STUDENTS_PER_CLASS 替换为字面值 30，然后编译器会将其编译为您的可执行文件</p>
<p>因为类对象宏有一个名字，并且替换文本是一个常量值，所以带有替换文本的类对象宏也是符号常量</p>
<h3 id="对于符号常量更喜欢常量变量而不是类对象宏">对于符号常量，更喜欢常量变量而不是类对象宏</h3>
<p>首先，因为宏是由预处理器解析的，所有出现的宏都在编译之前被定义的值替换。如果您正在调试代码，您将看不到实际值（例如 30）——您只会看到符号常量的名称（例如 MAX_STUDENTS_PER_CLASS）。因为这些#defined 值不是变量，所以您无法在调试器中添加监视来查看它们的值。如果您想知道 MAX_STUDENTS_PER_CLASS 解析为什么值，您必须找到 MAX_STUDENTS_PER_CLASS 的定义（可能在不同的文件中）。这会使您的程序更难调试</p>
<p>其次，宏可能与普通代码有命名冲突</p>
<p>第三，宏不遵循正常的作用域规则，这意味着在极少数情况下，在程序的一部分中定义的宏可能会与在程序的另一部分中编写的代码发生冲突，而它不应该与之交互</p>
<h2 id="编译时常量常量表达式和-constexpr">编译时常量、常量表达式和 constexpr</h2>
<h3 id="constant-expressions">Constant expressions</h3>
<p>常量表达式是可以在编译时由编译器求值的表达式。要成为常量表达式，表达式中的所有值必须在编译时已知（并且所有调用的运算符和函数必须支持编译时求值）</p>
<p>在编译时对常量表达式求值会使我们的编译时间变长（因为编译器必须做更多的工作），但这样的表达式只需要求值一次（而不是每次程序运行时）。生成的可执行文件速度更快，使用的内存更少</p>
<h3 id="compile-time-constants">Compile-time constants</h3>
<p>编译时常量是其值在编译时已知的常量。文字（例如“1”、“2.3”和“Hello, world!”）是一种编译时常量</p>
<p>Const 变量可能是也可能不是编译时常量</p>
<h3 id="compile-time-const">Compile-time const</h3>
<p>如果 const 变量的初始值设定项是常量表达式，则它是编译时常量</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">const</span> <span style="color:#fff;font-weight:bold">int</span> x { <span style="color:#ff0;font-weight:bold">3</span> };  <span style="color:#007f7f">// x is a compile-time const
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">const</span> <span style="color:#fff;font-weight:bold">int</span> y { <span style="color:#ff0;font-weight:bold">4</span> };  <span style="color:#007f7f">// y is a compile-time const
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">const</span> <span style="color:#fff;font-weight:bold">int</span> z { x + y }; <span style="color:#007f7f">// x + y is a compile-time expression
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; z &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>因为 x 和 y 的初始化值是常量表达式，所以 x 和 y 是编译时常量。这意味着 x + y 也是常量表达式。所以当编译器编译这个程序时，它可以计算 x + y 的值，并将常量表达式替换为结果文字 7</p>
<h3 id="runtime-const">Runtime const</h3>
<p>任何使用非常量表达式初始化的 const 变量都是运行时常量。运行时常量是其初始化值直到运行时才知道的常量</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> getNumber()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Enter a number: &#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> y{};
</span></span><span style="display:flex;"><span>    std::cin &gt;&gt; y;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> y;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">const</span> <span style="color:#fff;font-weight:bold">int</span> x{ <span style="color:#ff0;font-weight:bold">3</span> };           <span style="color:#007f7f">// x is a compile time constant
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">const</span> <span style="color:#fff;font-weight:bold">int</span> y{ getNumber() }; <span style="color:#007f7f">// y is a runtime constant
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">const</span> <span style="color:#fff;font-weight:bold">int</span> z{ x + y };       <span style="color:#007f7f">// x + y is a runtime expression
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; z &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;     <span style="color:#007f7f">// this is also a runtime expression
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>即使 y 是常量，初始化值（getNumber() 的返回值）直到运行时才知道。因此，y 是运行时常量，而不是编译时常量。因此，表达式 x + y 是一个运行时表达式</p>
<h3 id="constexpr-关键字">constexpr 关键字</h3>
<p>当你声明一个 const 变量时，编译器会隐式地跟踪它是运行时常量还是编译时常量。在大多数情况下，除了优化目的之外，这无关紧要，但有一些奇怪的情况，C++ 需要编译时常量而不是运行时常量</p>
<p>因为编译时常量通常允许更好的优化（并且几乎没有缺点），所以我们通常希望尽可能使用编译时常量</p>
<p>我们可以寻求编译器的帮助，以确保我们得到一个我们期望的编译时常量。为此，我们在变量声明中使用 constexpr 关键字而不是 const。 constexpr（“常量表达式”的缩写）变量只能是编译时常量。如果 constexpr 变量的初始化值不是常量表达式，编译器会出错</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> five()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">5</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">constexpr</span> <span style="color:#fff;font-weight:bold">double</span> gravity { <span style="color:#ff0;font-weight:bold">9.8</span> }; <span style="color:#007f7f">// ok: 9.8 is a constant expression
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> <span style="color:#fff;font-weight:bold">int</span> sum { <span style="color:#ff0;font-weight:bold">4</span> + <span style="color:#ff0;font-weight:bold">5</span> };      <span style="color:#007f7f">// ok: 4 + 5 is a constant expression
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> <span style="color:#fff;font-weight:bold">int</span> something { sum };  <span style="color:#007f7f">// ok: sum is a constant expression
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Enter your age: &#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> age{};
</span></span><span style="display:flex;"><span>    std::cin &gt;&gt; age;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">constexpr</span> <span style="color:#fff;font-weight:bold">int</span> myAge { age };      <span style="color:#007f7f">// compile error: age is not a constant expression
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> <span style="color:#fff;font-weight:bold">int</span> f { five() };       <span style="color:#007f7f">// compile error: return value of five() is not a constant expression
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>任何在初始化后不应修改且其初始值设定项在编译时已知的变量都应声明为 <code>constexpr</code></p>
<p>任何在初始化后不应修改且其初始值设定项在编译时未知的变量都应声明为 <code>const</code></p>
<h2 id="literals">Literals</h2>
<p>文字是直接插入代码中的未命名值。例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">5</span>;                   <span style="color:#007f7f">// 5 is an integer literal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">bool</span> myNameIsAlex { <span style="color:#fff;font-weight:bold">true</span> }; <span style="color:#007f7f">// true is a boolean literal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>std::cout &lt;&lt; <span style="color:#ff0;font-weight:bold">3.4</span>;           <span style="color:#007f7f">// 3.4 is a double literal
</span></span></span></code></pre></div><p>如对象有类型一样，所有文字都有类型。文字的类型是从文字的值推导出来的</p>
<h2 id="十进制二进制十六进制和八进制">十进制、二进制、十六进制和八进制</h2>
<h3 id="二进制文字和数字分隔符">二进制文字和数字分隔符</h3>
<p>在 C++14 之前，不支持二进制文字。然而，十六进制文字为我们提供了一个有用的解决方法（您可能仍会在现有代码库中看到）：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> bin{};    <span style="color:#007f7f">// assume 16-bit ints
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x0001</span>; <span style="color:#007f7f">// assign binary 0000 0000 0000 0001 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x0002</span>; <span style="color:#007f7f">// assign binary 0000 0000 0000 0010 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x0004</span>; <span style="color:#007f7f">// assign binary 0000 0000 0000 0100 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x0008</span>; <span style="color:#007f7f">// assign binary 0000 0000 0000 1000 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x0010</span>; <span style="color:#007f7f">// assign binary 0000 0000 0001 0000 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x0020</span>; <span style="color:#007f7f">// assign binary 0000 0000 0010 0000 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x0040</span>; <span style="color:#007f7f">// assign binary 0000 0000 0100 0000 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x0080</span>; <span style="color:#007f7f">// assign binary 0000 0000 1000 0000 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x00FF</span>; <span style="color:#007f7f">// assign binary 0000 0000 1111 1111 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0x00B3</span>; <span style="color:#007f7f">// assign binary 0000 0000 1011 0011 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0xF770</span>; <span style="color:#007f7f">// assign binary 1111 0111 0111 0000 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在 C++14 中，我们可以通过使用 0b 前缀来使用二进制文字：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> bin{};        <span style="color:#007f7f">// assume 16-bit ints
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0b1</span>;        <span style="color:#007f7f">// assign binary 0000 0000 0000 0001 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0b11</span>;       <span style="color:#007f7f">// assign binary 0000 0000 0000 0011 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0b1010</span>;     <span style="color:#007f7f">// assign binary 0000 0000 0000 1010 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bin = <span style="color:#ff0;font-weight:bold">0b11110000</span>; <span style="color:#007f7f">// assign binary 0000 0000 1111 0000 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>由于长文本可能难以阅读，C++14 还添加了使用引号 (‘) 作为数字分隔符的功能（分隔符不能出现在值的第一位数字之前）（数字分隔符纯粹是视觉上的，不会以任何方式影响字面值）</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> bin { <span style="color:#ff0;font-weight:bold">0b1011&#39;0010</span> };  <span style="color:#007f7f">// assign binary 1011 0010 to the variable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">long</span> value { <span style="color:#ff0;font-weight:bold">2&#39;132&#39;673&#39;462</span> }; <span style="color:#007f7f">// much easier to read than 2132673462
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="以十进制八进制或十六进制输出值">以十进制、八进制或十六进制输出值</h3>
<p>默认情况下，C++ 以十进制形式输出值。但是，您可以通过使用 std::dec、std::oct 和 std::hex I/O 操纵器更改输出格式：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> x { <span style="color:#ff0;font-weight:bold">12</span> };
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; x &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>; <span style="color:#007f7f">// decimal (by default)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; std::hex &lt;&lt; x &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>; <span style="color:#007f7f">// hexadecimal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; x &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>; <span style="color:#007f7f">// now hexadecimal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; std::oct &lt;&lt; x &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>; <span style="color:#007f7f">// octal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; std::dec &lt;&lt; x &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>; <span style="color:#007f7f">// return to decimal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; x &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>; <span style="color:#007f7f">// decimal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="以二进制输出值">以二进制输出值</h3>
<p>以二进制形式输出值有点困难，因为 std::cout 没有内置此功能。幸运的是，C++ 标准库包含一个名为 std::bitset 的类型，它将为我们完成此操作（在 <code>&lt;bitset&gt;</code> 标头中）。要使用 std::bitset，我们可以定义一个 std::bitset 变量并告诉 std::bitset 我们要存储多少位。位数必须是编译时常量。 std::bitset 可以用无符号整数值（任何格式，包括十进制、八进制、十六进制或二进制）初始化</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;bitset&gt; // for std::bitset</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// std::bitset&lt;8&gt; means we want to store 8 bits
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; bin1{ <span style="color:#ff0;font-weight:bold">0b1100&#39;0101</span> }; <span style="color:#007f7f">// binary literal for binary 1100 0101
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; bin2{ <span style="color:#ff0;font-weight:bold">0xC5</span> }; <span style="color:#007f7f">// hexadecimal literal for binary 1100 0101
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; bin1 &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span> &lt;&lt; bin2 &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; std::bitset&lt;<span style="color:#ff0;font-weight:bold">4</span>&gt;{ <span style="color:#ff0;font-weight:bold">0b1010</span> } &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>; <span style="color:#007f7f">// create a temporary std::bitset and print it
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="stdstring">std::string</h2>
<h3 id="使用-stdgetline-输入文本">使用 std::getline() 输入文本</h3>
<p>事实证明，当使用 operator&raquo; 从 std::cin 中提取字符串时，operator&raquo; 只返回它遇到的第一个空格之前的字符。任何其他字符都留在 std::cin 中，等待下一次提取</p>
<p>要将整行输入读入字符串，最好改用 <code>std::getline()</code> 函数。 std::getline() 需要两个参数：第一个是 std::cin，第二个是您的字符串变量</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string&gt; // For std::string and std::getline</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Enter your full name: &#34;</span>;
</span></span><span style="display:flex;"><span>    std::string name{};
</span></span><span style="display:flex;"><span>    std::getline(std::cin &gt;&gt; std::ws, name); <span style="color:#007f7f">// read a full line of text into name
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Enter your age: &#34;</span>;
</span></span><span style="display:flex;"><span>    std::string age{};
</span></span><span style="display:flex;"><span>    std::getline(std::cin &gt;&gt; std::ws, age); <span style="color:#007f7f">// read a full line of text into age
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Your name is &#34;</span> &lt;&lt; name &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; and your age is &#34;</span> &lt;&lt; age &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>std::ws</code> 输入操纵器告诉 std::cin 在提取之前<strong>忽略任何前导空格</strong>。前导空白是出现在字符串开头的任何空白字符（空格、制表符、换行符）</p>
<p>如果使用 <code>std::getline()</code> 读取字符串，请使用 <code>std::cin &gt;&gt; std::ws</code> 输入操纵器忽略前导空格</p>
<p>将提取运算符 (&raquo;) 与 std::cin 一起使用会忽略前导空格</p>
<p>std::getline() 不会忽略前导空格，除非您使用输入操纵器 std::ws</p>
<h3 id="字符串长度">字符串长度</h3>
<p>如果我们想知道 std::string 中有多少个字符，我们可以向 std::string 对象询问它的长度。注意 std::string::length() 返回一个无符号整数值（很可能是 size_t 类型）。如果你想将长度分配给一个 int 变量，你应该对其进行 static_cast 以避免编译器关于有符号/无符号转换的警告：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> length { <span style="color:#fff;font-weight:bold">static_cast</span>&lt;<span style="color:#fff;font-weight:bold">int</span>&gt;(name.length()) };
</span></span></code></pre></div><h3 id="stdstring-的初始化和复制开销很大">std::string 的初始化和复制开销很大</h3>
<p>每当初始化 std::string 时，都会生成用于初始化它的字符串的副本。每当 std::string 按值传递给 std::string 参数时，都会生成另一个副本。不要按值传递 std::string，因为生成 std::string 的副本开销很大。更喜欢 std::string_view 参数</p>
<h3 id="literals-forstdstring--stdstring_view">Literals for <code>std::string</code> &amp; <code>std::string_view</code></h3>
<p>双引号字符串文字（比如“Hello, world!”）默认是 C 风格的字符串</p>
<p>我们可以通过在双引号字符串文字后使用 s 后缀来创建类型为 std::string 的字符串文字</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string&gt;      // for std::string</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string_view&gt; // for std::string_view</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">using</span> <span style="color:#fff;font-weight:bold">namespace</span> std::literals; <span style="color:#007f7f">// easiest way to access the s and sv suffixes
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;foo</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>;   <span style="color:#007f7f">// no suffix is a C-style string literal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;goo</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>s;  <span style="color:#007f7f">// s suffix is a std::string literal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;moo</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>sv; <span style="color:#007f7f">// sv suffix is a std::string_view literal
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>“s”后缀位于命名空间 std::literals::string_literals 中。“sv”后缀位于命名空间 std::literals::string_view_literals 中。访问文字后缀的最简单方法是通过使用指令使用命名空间 std::literals。这是可以使用整个命名空间的例外情况之一，因为其中定义的后缀不太可能与您的任何代码冲突</p>
<p>你可能不需要经常使用 std::string 文字（因为用 C 风格的字符串文字初始化 std::string 对象很好），但我们会在以后的课程中看到一些使用 std 的情况::string literals 而不是 C 风格的 string literals 使事情变得更容易</p>
<h3 id="constexpr-字符串">Constexpr 字符串</h3>
<p>如果您尝试定义一个 constexpr std::string，您的编译器可能会产生一个错误</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">using</span> <span style="color:#fff;font-weight:bold">namespace</span> std::literals;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::string name{ <span style="color:#0ff;font-weight:bold">&#34;Alex&#34;</span>s }; <span style="color:#007f7f">// compile error
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;My name is: &#34;</span> &lt;&lt; name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>发生这种情况是因为 constexpr std::string 在 C++17 或更早版本中不受支持，并且在 C++20 中仅提供最低限度的支持。如果您需要 constexpr 字符串，请改用 std::string_view</p>
<h2 id="stdstring_view">std::string_view</h2>
<h3 id="stdstring_view-c17">std::string_view C++17</h3>
<p>为了解决 std::string 初始化（或复制）成本高昂的问题，C++17 引入了 std::string_view（位于 &lt;string_view&gt; 标头中）。 std::string_view 提供对现有字符串（C 风格字符串文字、std::string 或 char 数组）的只读访问，而无需制作副本</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string_view&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> printSV(std::string_view str) <span style="color:#007f7f">// now a std::string_view
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; str &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::string_view s{ <span style="color:#0ff;font-weight:bold">&#34;Hello, world!&#34;</span> }; <span style="color:#007f7f">// now a std::string_view
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    printSV(s);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>当我们用 C 风格的字符串文字“Hello, world!”初始化 std::string_view s 时，s 提供对“Hello, world!”的只读访问。无需复制字符串。当我们将 s 传递给 printSV() 时，参数 str 从 s 初始化。这使我们能够通过 str 访问“Hello, world!”，不用再次复制字符串</p>
<p>当您需要只读字符串时，尤其是对于函数参数，优先使用 std::string_view 而不是 std::string</p>
<h3 id="constexpr-stdstring_view">constexpr std::string_view</h3>
<p>std::string_view 完全支持 constexpr：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string_view&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::string_view s{ <span style="color:#0ff;font-weight:bold">&#34;Hello, world!&#34;</span> };
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; s &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>; <span style="color:#007f7f">// s will be replaced with &#34;Hello, world!&#34; at compile-time
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="stdstring--stdstring_view">std::string &amp; std::string_view</h3>
<p>可以使用 std::string 初始值设定项创建 std::string_view，并且 std::string 将隐式转换为 std::string_view：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string_view&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> printSV(std::string_view str)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; str &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::string s{ <span style="color:#0ff;font-weight:bold">&#34;Hello, world&#34;</span> };
</span></span><span style="display:flex;"><span>    std::string_view sv{ s }; <span style="color:#007f7f">// Initialize a std::string_view from a std::string
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; sv &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    printSV(s); <span style="color:#007f7f">// implicitly convert a std::string to std::string_view
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>因为 std::string 复制了它的初始化器（这开销很大），C++ 不允许将 std::string_view 隐式转换为 std::string。但是，我们可以使用 std::string_view 初始值设定项显式创建 std::string，或者我们可以使用 static_cast 将现有的 std::string_view 转换为 std::string</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string_view&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> printString(std::string str)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; str &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  std::string_view sv{ <span style="color:#0ff;font-weight:bold">&#34;balloon&#34;</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  std::string str{ sv }; <span style="color:#007f7f">// okay, we can create std::string using std::string_view initializer
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">// printString(sv);   // compile error: won&#39;t implicitly convert std::string_view to a std::string
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>  printString(<span style="color:#fff;font-weight:bold">static_cast</span>&lt;std::string&gt;(sv)); <span style="color:#007f7f">// okay, we can explicitly cast a std::string_view to a std::string
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="operators操作符">Operators（操作符）</h1>
<h2 id="----运算符"><code>,</code> &amp; <code>? :</code> 运算符</h2>
<p>C++ 没有定义函数参数或运算符操作数的计算顺序</p>
<p>不要在给定语句中多次使用具有副作用的变量。如果这样做，结果可能是未定义的</p>
<p>逗号在所有运算符中的优先级最低，甚至低于赋值</p>
<p>请注意， <code>? :</code> 运算符的优先级非常低。如果除了将结果分配给变量之外做任何事情，整个 <code>? :</code> 运算符也需要用括号括起来</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std::cout &lt;&lt; ((x &gt; y) ? x : y) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span></code></pre></div><p>如果在上述情况下我们不将整个条件运算符括起来会发生什么。因为 &laquo; 运算符的优先级高于 ?: 运算符，所以语句：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std::cout &lt;&lt; (x &gt; y) ? x : y &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span></code></pre></div><p>将评估为：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>(std::cout &lt;&lt; (x &gt; y)) ? x : y &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span></code></pre></div><h2 id="比较浮点数大小">比较浮点数大小</h2>
<p>进行浮点相等的最常见方法涉及使用一个函数来查看两个数字是否几乎相同。如果它们“足够接近”，那么我们称它们相等。用于表示“足够接近”的值传统上称为 epsilon。 Epsilon 通常被定义为一个小的正数（例如 0.00000001，有时写作 1e-8）</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cmath&gt; // for std::abs()</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// epsilon is an absolute value
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">bool</span> approximatelyEqualAbs(<span style="color:#fff;font-weight:bold">double</span> a, <span style="color:#fff;font-weight:bold">double</span> b, <span style="color:#fff;font-weight:bold">double</span> absEpsilon)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// if the distance between a and b is less than absEpsilon, then a and b are &#34;close enough&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> std::abs(a - b) &lt;= absEpsilon;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>虽然这个功能可以工作，但不是很好。 0.00001 的 epsilon 适用于 1.0 左右的输入，对于 0.0000001 左右的输入太大，对于 10,000 这样的输入太小</p>
<p>著名计算机科学家唐纳德·高德纳 (Donald Knuth) 在他的著作“计算机编程的艺术，第二卷：半数值算法 (Addison-Wesley, 1969)”一书中提出了以下方法：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;algorithm&gt; // std::max</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cmath&gt; // std::abs</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// return true if the difference between a and b is within epsilon percent of the larger of a and b
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">bool</span> approximatelyEqualRel(<span style="color:#fff;font-weight:bold">double</span> a, <span style="color:#fff;font-weight:bold">double</span> b, <span style="color:#fff;font-weight:bold">double</span> relEpsilon)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> (std::abs(a - b) &lt;= (std::max(std::abs(a), std::abs(b)) * relEpsilon));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在这种情况下，epsilon 不是绝对数字，而是相对于 a 或 b 的大小。在 &lt;= 运算符的左侧，std::abs(a - b) 告诉我们 a 和 b 之间的距离为正数。在 &lt;= 运算符的右侧，我们需要计算我们愿意接受的“足够接近”的最大值。为此，该算法选择 a 和 b 中较大的一个（作为数字总体大小的粗略指标），然后将其乘以 relEpsilon。在此函数中，relEpsilon 表示百分比。例如，如果我们想说“足够接近”意味着 a 和 b 在 a 和 b 中较大者的 1% 以内，我们传入 0.01 (1% = 1/100 = 0.01) 的 relEpsilon。 relEpsilon 的值可以根据情况调整为最合适的值（例如，0.002 的 epsilon 表示在 0.2% 以内）</p>
<p>要执行不等式 (!=) 而不是相等，只需调用此函数并使用逻辑 NOT 运算符 (!) 翻转结果：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (!approximatelyEqualRel(a, b, <span style="color:#ff0;font-weight:bold">0.001</span>))
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; a &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34; is not equal to &#34;</span> &lt;&lt; b &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span></code></pre></div><p>虽然 approximatelyEqualRel() 函数适用于大多数情况，但它并不完美，尤其是当数字接近零时：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;algorithm&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cmath&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// return true if the difference between a and b is within epsilon percent of the larger of a and b
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">bool</span> approximatelyEqualRel(<span style="color:#fff;font-weight:bold">double</span> a, <span style="color:#fff;font-weight:bold">double</span> b, <span style="color:#fff;font-weight:bold">double</span> relEpsilon)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> (std::abs(a - b) &lt;= (std::max(std::abs(a), std::abs(b)) * relEpsilon));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// a is really close to 1.0, but has rounding errors, so it&#39;s slightly smaller than 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">double</span> a{ <span style="color:#ff0;font-weight:bold">0.1</span> + <span style="color:#ff0;font-weight:bold">0.1</span> + <span style="color:#ff0;font-weight:bold">0.1</span> + <span style="color:#ff0;font-weight:bold">0.1</span> + <span style="color:#ff0;font-weight:bold">0.1</span> + <span style="color:#ff0;font-weight:bold">0.1</span> + <span style="color:#ff0;font-weight:bold">0.1</span> + <span style="color:#ff0;font-weight:bold">0.1</span> + <span style="color:#ff0;font-weight:bold">0.1</span> + <span style="color:#ff0;font-weight:bold">0.1</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// First, let&#39;s compare a (almost 1.0) to 1.0.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::cout &lt;&lt; approximatelyEqualRel(a, <span style="color:#ff0;font-weight:bold">1.0</span>, <span style="color:#ff0;font-weight:bold">1e-8</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// Second, let&#39;s compare a-1.0 (almost 0.0) to 0.0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::cout &lt;&lt; approximatelyEqualRel(a-<span style="color:#ff0;font-weight:bold">1.0</span>, <span style="color:#ff0;font-weight:bold">0.0</span>, <span style="color:#ff0;font-weight:bold">1e-8</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这会返回：</p>
<pre tabindex="0"><code>1
0
</code></pre><p>避免这种情况的一种方法是同时使用绝对 epsilon（如我们在第一种方法中所做的）和相对 epsilon（如我们在 Knuth 的方法中所做的）：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#007f7f">// return true if the difference between a and b is less than absEpsilon, or within relEpsilon percent of the larger of a and b
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">bool</span> approximatelyEqualAbsRel(<span style="color:#fff;font-weight:bold">double</span> a, <span style="color:#fff;font-weight:bold">double</span> b, <span style="color:#fff;font-weight:bold">double</span> absEpsilon, <span style="color:#fff;font-weight:bold">double</span> relEpsilon)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Check if the numbers are really close -- needed when comparing numbers near zero.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">double</span> diff{ std::abs(a - b) };
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (diff &lt;= absEpsilon)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Otherwise fall back to Knuth&#39;s algorithm
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> (diff &lt;= (std::max(std::abs(a), std::abs(b)) * relEpsilon));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在这个算法中，我们首先检查 a 和 b 在绝对值上是否接近，这处理了 a 和 b 都接近于零的情况。 absEpsilon 参数应设置为非常小的值（例如 1e-12）。如果失败，则我们使用相对 epsilon 回退到 Knuth 的算法</p>
<p>浮点数的比较是一个困难的话题，并且没有适用于所有情况的“一刀切”算法。但是，absEpsilon 为 1e-12 和 relEpsilon 为 1e-8 的 approximatesEqualAbsRel() 应该足以处理您将遇到的大多数情况</p>
<h2 id="逻辑-xor-运算符">逻辑 XOR 运算符</h2>
<p>C++ 不提供逻辑 XOR 运算符。与逻辑或或逻辑与不同，逻辑异或不能进行短路评估。因此，从逻辑 OR 和逻辑 AND 运算符中创建逻辑 XOR 运算符具有挑战性。但是，您可以使用不等运算符 (!=) 轻松模拟逻辑 XOR：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (a != b) ... <span style="color:#007f7f">// a XOR b, assuming a and b are Booleans
</span></span></span></code></pre></div><p>这可以扩展到多个操作数，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (a != b != c != d) ... <span style="color:#007f7f">// a XOR b XOR c XOR d, assuming a, b, c, and d are Booleans
</span></span></span></code></pre></div><p>请注意，上述 XOR 模式仅在操作数为布尔值（而非整数）时才有效。如果您需要一种适用于非布尔操作数的逻辑 XOR 形式，您可以将它们静态转换为布尔值：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">static_cast</span>&lt;<span style="color:#fff;font-weight:bold">bool</span>&gt;(a) != <span style="color:#fff;font-weight:bold">static_cast</span>&lt;<span style="color:#fff;font-weight:bold">bool</span>&gt;(b) != <span style="color:#fff;font-weight:bold">static_cast</span>&lt;<span style="color:#fff;font-weight:bold">bool</span>&gt;(c) != <span style="color:#fff;font-weight:bold">static_cast</span>&lt;<span style="color:#fff;font-weight:bold">bool</span>&gt;(d)) ... <span style="color:#007f7f">// a XOR b XOR c XOR d, for any type that can be converted to bool
</span></span></span></code></pre></div><h1 id="位操作">位操作</h1>
<h2 id="位标志-and-位操作-via-stdbitset">位标志 and 位操作 via std::bitset</h2>
<p>要定义一组位标志，我们通常会使用适当大小的无符号整数（8 位、16 位、32 位等……取决于我们有多少标志），或 std::bitset</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;bitset&gt; // for std::bitset</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; mybitset {}; <span style="color:#007f7f">// 8 bits in size means room for 8 flags
</span></span></span></code></pre></div><p>位操作是您应该明确使用无符号整数（或 std::bitset）的少数情况之一</p>
<p>std::bitset 提供了 4 个可用于位操作的关键函数：</p>
<ul>
<li>test() 允许我们查询某个位是 0 还是 1</li>
<li>set() 允许我们打开一个位（如果位已经打开，这将不执行任何操作）</li>
<li>reset() 允许我们关闭一个位（如果该位已经关闭，这将不执行任何操作）</li>
<li>flip() 允许我们将位值从 0 翻转为 1，反之亦然</li>
</ul>
<p>这些函数中的每一个都将我们要操作的位的位置作为它们唯一的参数</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;bitset&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; bits{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0101</span> }; <span style="color:#007f7f">// we need 8 bits, start with bit pattern 0000 0101
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bits.set(<span style="color:#ff0;font-weight:bold">3</span>); <span style="color:#007f7f">// set bit position 3 to 1 (now we have 0000 1101)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bits.flip(<span style="color:#ff0;font-weight:bold">4</span>); <span style="color:#007f7f">// flip bit 4 (now we have 0001 1101)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bits.reset(<span style="color:#ff0;font-weight:bold">4</span>); <span style="color:#007f7f">// set bit 4 back to 0 (now we have 0000 1101)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;All the bits: &#34;</span> &lt;&lt; bits &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Bit 3 has value: &#34;</span> &lt;&lt; bits.test(<span style="color:#ff0;font-weight:bold">3</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;Bit 4 has value: &#34;</span> &lt;&lt; bits.test(<span style="color:#ff0;font-weight:bold">4</span>) &lt;&lt; <span style="color:#0ff;font-weight:bold">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="按位运算符">按位运算符</h2>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/27/638344de90243.png">
<img src="https://bu.dusays.com/2022/11/27/638344de90243.png" alt=""  />
</a>
</div>


为避免意外，请使用无符号操作数或 std::bitset 的按位运算符</p>
<p>在计算按位 XOR 时，如果一列中有奇数个 1 位，则该列的结果为 1</p>
<h2 id="位掩码">位掩码</h2>
<p>位掩码是一组预定义的位，用于选择哪些特定位将被后续操作修改。位掩码阻止按位运算符接触我们不想修改的位，并允许访问我们确实想要修改的位</p>
<p>最简单的一组位掩码是为每个位位置定义一个位掩码。我们用 0 来屏蔽我们不关心的位，用 1 来表示我们想要修改的位</p>
<p>尽管位掩码可以是文字，但它们通常被定义为符号常量，因此可以为它们指定一个有意义的名称并易于重用</p>
<h3 id="在-c14-中定义位掩码">在 C++14 中定义位掩码</h3>
<p>因为 C++14 支持二进制文字，所以定义这些位掩码很容易：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cstdint&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask0{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0001</span> }; <span style="color:#007f7f">// represents bit 0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask1{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0010</span> }; <span style="color:#007f7f">// represents bit 1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask2{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0100</span> }; <span style="color:#007f7f">// represents bit 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask3{ <span style="color:#ff0;font-weight:bold">0b0000&#39;1000</span> }; <span style="color:#007f7f">// represents bit 3
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask4{ <span style="color:#ff0;font-weight:bold">0b0001&#39;0000</span> }; <span style="color:#007f7f">// represents bit 4
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask5{ <span style="color:#ff0;font-weight:bold">0b0010&#39;0000</span> }; <span style="color:#007f7f">// represents bit 5
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask6{ <span style="color:#ff0;font-weight:bold">0b0100&#39;0000</span> }; <span style="color:#007f7f">// represents bit 6
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask7{ <span style="color:#ff0;font-weight:bold">0b1000&#39;0000</span> }; <span style="color:#007f7f">// represents bit 7
</span></span></span></code></pre></div><h3 id="在-c11-或更早版本中定义位掩码">在 C++11 或更早版本中定义位掩码</h3>
<p>由于 C++11 不支持二进制文字，我们必须使用其他方法来设置符号常量</p>
<p>第一种方法是使用十六进制文字：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask0{ <span style="color:#ff0;font-weight:bold">0x01</span> }; <span style="color:#007f7f">// hex for 0000 0001
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask1{ <span style="color:#ff0;font-weight:bold">0x02</span> }; <span style="color:#007f7f">// hex for 0000 0010
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask2{ <span style="color:#ff0;font-weight:bold">0x04</span> }; <span style="color:#007f7f">// hex for 0000 0100
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask3{ <span style="color:#ff0;font-weight:bold">0x08</span> }; <span style="color:#007f7f">// hex for 0000 1000
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask4{ <span style="color:#ff0;font-weight:bold">0x10</span> }; <span style="color:#007f7f">// hex for 0001 0000
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask5{ <span style="color:#ff0;font-weight:bold">0x20</span> }; <span style="color:#007f7f">// hex for 0010 0000
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask6{ <span style="color:#ff0;font-weight:bold">0x40</span> }; <span style="color:#007f7f">// hex for 0100 0000
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask7{ <span style="color:#ff0;font-weight:bold">0x80</span> }; <span style="color:#007f7f">// hex for 1000 0000
</span></span></span></code></pre></div><p>另一种更简单的方法是使用左移运算符将一位移动到正确的位置：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask0{ <span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">0</span> }; <span style="color:#007f7f">// 0000 0001
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask1{ <span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">1</span> }; <span style="color:#007f7f">// 0000 0010
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask2{ <span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">2</span> }; <span style="color:#007f7f">// 0000 0100
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask3{ <span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">3</span> }; <span style="color:#007f7f">// 0000 1000
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask4{ <span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">4</span> }; <span style="color:#007f7f">// 0001 0000
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask5{ <span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">5</span> }; <span style="color:#007f7f">// 0010 0000
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask6{ <span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">6</span> }; <span style="color:#007f7f">// 0100 0000
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask7{ <span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">7</span> }; <span style="color:#007f7f">// 1000 0000
</span></span></span></code></pre></div><h3 id="testing-a-bit">Testing a bit</h3>
<p>要确定某个位是开还是关，我们使用 <code>&amp;</code> 结合相应位的位掩码：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cstdint&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask0{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0001</span> }; <span style="color:#007f7f">// represents bit 0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask1{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0010</span> }; <span style="color:#007f7f">// represents bit 1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask2{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0100</span> }; <span style="color:#007f7f">// represents bit 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask3{ <span style="color:#ff0;font-weight:bold">0b0000&#39;1000</span> }; <span style="color:#007f7f">// represents bit 3
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask4{ <span style="color:#ff0;font-weight:bold">0b0001&#39;0000</span> }; <span style="color:#007f7f">// represents bit 4
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask5{ <span style="color:#ff0;font-weight:bold">0b0010&#39;0000</span> }; <span style="color:#007f7f">// represents bit 5
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask6{ <span style="color:#ff0;font-weight:bold">0b0100&#39;0000</span> }; <span style="color:#007f7f">// represents bit 6
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask7{ <span style="color:#ff0;font-weight:bold">0b1000&#39;0000</span> }; <span style="color:#007f7f">// represents bit 7
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	std::<span style="color:#fff;font-weight:bold">uint8_t</span> flags{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0101</span> }; <span style="color:#007f7f">// 8 bits in size means room for 8 flags
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 0 is &#34;</span> &lt;&lt; ((flags &amp; mask0) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 1 is &#34;</span> &lt;&lt; ((flags &amp; mask1) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="setting-a-bit">Setting a bit</h3>
<p>要设置（打开）位，我们将按位或等于（运算符 <code>|=</code>）与相应位的位掩码结合使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cstdint&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask0{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0001</span> }; <span style="color:#007f7f">// represents bit 0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask1{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0010</span> }; <span style="color:#007f7f">// represents bit 1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask2{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0100</span> }; <span style="color:#007f7f">// represents bit 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask3{ <span style="color:#ff0;font-weight:bold">0b0000&#39;1000</span> }; <span style="color:#007f7f">// represents bit 3
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask4{ <span style="color:#ff0;font-weight:bold">0b0001&#39;0000</span> }; <span style="color:#007f7f">// represents bit 4
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask5{ <span style="color:#ff0;font-weight:bold">0b0010&#39;0000</span> }; <span style="color:#007f7f">// represents bit 5
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask6{ <span style="color:#ff0;font-weight:bold">0b0100&#39;0000</span> }; <span style="color:#007f7f">// represents bit 6
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask7{ <span style="color:#ff0;font-weight:bold">0b1000&#39;0000</span> }; <span style="color:#007f7f">// represents bit 7
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::<span style="color:#fff;font-weight:bold">uint8_t</span> flags{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0101</span> }; <span style="color:#007f7f">// 8 bits in size means room for 8 flags
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 1 is &#34;</span> &lt;&lt; ((flags &amp; mask1) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    flags |= mask1; <span style="color:#007f7f">// turn on bit 1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 1 is &#34;</span> &lt;&lt; ((flags &amp; mask1) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>我们还可以使用按位或同时打开多个位：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>flags |= (mask4 | mask5); <span style="color:#007f7f">// turn bits 4 and 5 on at the same time
</span></span></span></code></pre></div><h3 id="resetting-a-bit">Resetting a bit</h3>
<p>要清除位（关闭），我们同时使用 <code>&amp;=</code> 和 <code>~</code> ：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cstdint&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask0{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0001</span> }; <span style="color:#007f7f">// represents bit 0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask1{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0010</span> }; <span style="color:#007f7f">// represents bit 1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask2{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0100</span> }; <span style="color:#007f7f">// represents bit 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask3{ <span style="color:#ff0;font-weight:bold">0b0000&#39;1000</span> }; <span style="color:#007f7f">// represents bit 3
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask4{ <span style="color:#ff0;font-weight:bold">0b0001&#39;0000</span> }; <span style="color:#007f7f">// represents bit 4
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask5{ <span style="color:#ff0;font-weight:bold">0b0010&#39;0000</span> }; <span style="color:#007f7f">// represents bit 5
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask6{ <span style="color:#ff0;font-weight:bold">0b0100&#39;0000</span> }; <span style="color:#007f7f">// represents bit 6
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask7{ <span style="color:#ff0;font-weight:bold">0b1000&#39;0000</span> }; <span style="color:#007f7f">// represents bit 7
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::<span style="color:#fff;font-weight:bold">uint8_t</span> flags{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0101</span> }; <span style="color:#007f7f">// 8 bits in size means room for 8 flags
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 2 is &#34;</span> &lt;&lt; ((flags &amp; mask2) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    flags &amp;= ~mask2; <span style="color:#007f7f">// turn off bit 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 2 is &#34;</span> &lt;&lt; ((flags &amp; mask2) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>我们可以同时关闭多个位：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>flags &amp;= ~(mask4 | mask5); <span style="color:#007f7f">// turn bits 4 and 5 off at the same time
</span></span></span></code></pre></div><h3 id="flipping-a-bit">Flipping a bit</h3>
<p>要切换位状态，我们使用 <code>^=</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cstdint&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask0{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0001</span> }; <span style="color:#007f7f">// represents bit 0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask1{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0010</span> }; <span style="color:#007f7f">// represents bit 1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask2{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0100</span> }; <span style="color:#007f7f">// represents bit 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask3{ <span style="color:#ff0;font-weight:bold">0b0000&#39;1000</span> }; <span style="color:#007f7f">// represents bit 3
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask4{ <span style="color:#ff0;font-weight:bold">0b0001&#39;0000</span> }; <span style="color:#007f7f">// represents bit 4
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask5{ <span style="color:#ff0;font-weight:bold">0b0010&#39;0000</span> }; <span style="color:#007f7f">// represents bit 5
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask6{ <span style="color:#ff0;font-weight:bold">0b0100&#39;0000</span> }; <span style="color:#007f7f">// represents bit 6
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">constexpr</span> std::<span style="color:#fff;font-weight:bold">uint8_t</span> mask7{ <span style="color:#ff0;font-weight:bold">0b1000&#39;0000</span> }; <span style="color:#007f7f">// represents bit 7
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::<span style="color:#fff;font-weight:bold">uint8_t</span> flags{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0101</span> }; <span style="color:#007f7f">// 8 bits in size means room for 8 flags
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 2 is &#34;</span> &lt;&lt; ((flags &amp; mask2) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>    flags ^= mask2; <span style="color:#007f7f">// flip bit 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 2 is &#34;</span> &lt;&lt; ((flags &amp; mask2) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>    flags ^= mask2; <span style="color:#007f7f">// flip bit 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 2 is &#34;</span> &lt;&lt; ((flags &amp; mask2) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>我们可以同时翻转多个位：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>flags ^= (mask4 | mask5); <span style="color:#007f7f">// flip bits 4 and 5 at the same time
</span></span></span></code></pre></div><h2 id="位掩码和-stdbitset">位掩码和 std::bitset</h2>
<p>std::bitset 支持全套位运算符。因此，尽管使用函数（测试、设置、重置和翻转）修改单个位更容易，但如果需要，您可以使用按位运算符和位掩码</p>
<p>函数只允许您一次修改单个位。按位运算符允许您一次修改多个位</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;cstdint&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;iostream&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;bitset&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; mask0{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0001</span> }; <span style="color:#007f7f">// represents bit 0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; mask1{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0010</span> }; <span style="color:#007f7f">// represents bit 1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; mask2{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0100</span> }; <span style="color:#007f7f">// represents bit 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; mask3{ <span style="color:#ff0;font-weight:bold">0b0000&#39;1000</span> }; <span style="color:#007f7f">// represents bit 3
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; mask4{ <span style="color:#ff0;font-weight:bold">0b0001&#39;0000</span> }; <span style="color:#007f7f">// represents bit 4
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; mask5{ <span style="color:#ff0;font-weight:bold">0b0010&#39;0000</span> }; <span style="color:#007f7f">// represents bit 5
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; mask6{ <span style="color:#ff0;font-weight:bold">0b0100&#39;0000</span> }; <span style="color:#007f7f">// represents bit 6
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">constexpr</span> std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; mask7{ <span style="color:#ff0;font-weight:bold">0b1000&#39;0000</span> }; <span style="color:#007f7f">// represents bit 7
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>	std::bitset&lt;<span style="color:#ff0;font-weight:bold">8</span>&gt; flags{ <span style="color:#ff0;font-weight:bold">0b0000&#39;0101</span> }; <span style="color:#007f7f">// 8 bits in size means room for 8 flags
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 1 is &#34;</span> &lt;&lt; (flags.test(<span style="color:#ff0;font-weight:bold">1</span>) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 2 is &#34;</span> &lt;&lt; (flags.test(<span style="color:#ff0;font-weight:bold">2</span>) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	flags ^= (mask1 | mask2); <span style="color:#007f7f">// flip bits 1 and 2
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 1 is &#34;</span> &lt;&lt; (flags.test(<span style="color:#ff0;font-weight:bold">1</span>) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 2 is &#34;</span> &lt;&lt; (flags.test(<span style="color:#ff0;font-weight:bold">2</span>) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	flags |= (mask1 | mask2); <span style="color:#007f7f">// turn bits 1 and 2 on
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 1 is &#34;</span> &lt;&lt; (flags.test(<span style="color:#ff0;font-weight:bold">1</span>) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 2 is &#34;</span> &lt;&lt; (flags.test(<span style="color:#ff0;font-weight:bold">2</span>) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	flags &amp;= ~(mask1 | mask2); <span style="color:#007f7f">// turn bits 1 and 2 off
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 1 is &#34;</span> &lt;&lt; (flags.test(<span style="color:#ff0;font-weight:bold">1</span>) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>	std::cout &lt;&lt; <span style="color:#0ff;font-weight:bold">&#34;bit 2 is &#34;</span> &lt;&lt; (flags.test(<span style="color:#ff0;font-weight:bold">2</span>) ? <span style="color:#0ff;font-weight:bold">&#34;on</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;off</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="summary-1">Summary</h2>
<ol>
<li>query bit states</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (flags &amp; option4) ... <span style="color:#007f7f">// if option4 is set, do something
</span></span></span></code></pre></div><ol start="2">
<li>set bits (turn on)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>flags |= option4; <span style="color:#007f7f">// turn option 4 on.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>flags |= (option4 | option5); <span style="color:#007f7f">// turn options 4 and 5 on.
</span></span></span></code></pre></div><ol start="3">
<li>clear bits (turn off)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>flags &amp;= ~option4; <span style="color:#007f7f">// turn option 4 off
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>flags &amp;= ~(option4 | option5); <span style="color:#007f7f">// turn options 4 and 5 off
</span></span></span></code></pre></div><ol start="4">
<li>flip bit states</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>flags ^= option4; <span style="color:#007f7f">// flip option4 from on to off, or vice versa
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>flags ^= (option4 | option5); <span style="color:#007f7f">// flip options 4 and 5
</span></span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>输出不是直接写入的，它存储在缓冲区中，直到缓冲区被刷新。输出到文件或终端历来很慢（终端或控制台仍然很慢），逐个字符地写入是低效率的，写入一大块字节要有效得多。若 cerr 被缓冲，那么如果程序以非正常方式崩溃，您可能会将有用的调试信息卡在缓冲区中，而不是打印到 stderr。stdout 是行缓冲的，即在您编写换行符或显式刷新缓冲区之前，输出不会发送到操作系统。通常，std::endl 函数通过插入换行符并刷新流来工作。读取 stdcin 会刷新 stdcout&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
    <item>
      <title>Linux 网络编程</title>
      <link>https://xancoding.cn/posts/linux-network-programming/</link>
      <pubDate>Tue, 15 Nov 2022 12:50:59 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/linux-network-programming/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/25911735/&#34;&gt;《TCP/IP网络编程》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/24722611/&#34;&gt;《Linux高性能服务器编程》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/25900403/&#34;&gt;《UNIX环境高级编程》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/1500149/&#34;&gt;《Unix网络编程》&lt;/a&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/25911735/&#34; urlstring=&#34;https://book.douban.com/subject/25911735/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/24722611/&#34; urlstring=&#34;https://book.douban.com/subject/24722611/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/25900403/&#34; urlstring=&#34;https://book.douban.com/subject/25900403/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/1500149/&#34; urlstring=&#34;https://book.douban.com/subject/1500149/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<ul>
<li><a href="https://book.douban.com/subject/25911735/">《TCP/IP网络编程》</a></li>
<li><a href="https://book.douban.com/subject/24722611/">《Linux高性能服务器编程》</a></li>
<li><a href="https://book.douban.com/subject/25900403/">《UNIX环境高级编程》</a></li>
<li><a href="https://book.douban.com/subject/1500149/">《Unix网络编程》</a>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/25911735/" urlstring="https://book.douban.com/subject/25911735/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/24722611/" urlstring="https://book.douban.com/subject/24722611/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/25900403/" urlstring="https://book.douban.com/subject/25900403/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/1500149/" urlstring="https://book.douban.com/subject/1500149/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>计算机组成原理</title>
      <link>https://xancoding.cn/posts/principles-of-computer-composition/</link>
      <pubDate>Tue, 15 Nov 2022 12:47:32 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/principles-of-computer-composition/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1EW411u7th?vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;计算机科学速成 [40 集全/精校] - Crash Course Computer Science&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1BE411D7ii/?spm_id_from=333.337.search-card.all.click&#34;&gt;王道计算机考研 计算机组成原理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1t4411e7LH/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;计算机组成原理（哈工大刘宏伟）135讲（全）高清&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1iW411d7hd?p=1&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;【精校中英字幕】2015 CMU 15-213 CSAPP 深入理解计算机系统&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://book.douban.com/subject/26365491/&#34;&gt;《程序是怎样跑起来的》&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/26397183/&#34;&gt;《计算机是怎样跑起来的》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/2110638/&#34;&gt;《计算机组成与设计硬件/软件接口》&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;指令格式是 RISC 的&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;第一章：计算机抽象以及相关技术&lt;/strong&gt;，这个章节主要是介绍了计算机组成的思想，可以简单快读看，不用重点读&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;第二章：指令&lt;/strong&gt;，大体上讲的是计算机是如果识别和运行指令的，以及代码到指令的过程&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;第三章：计算机的算数运算&lt;/strong&gt;，介绍的是计算机是如何进行加减乘除法的，以及浮点数的运算&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;第五章：层次化存储&lt;/strong&gt;，讲的是计算机的存储层次结构，而且重点讲的是 CPU Cahe&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://book.douban.com/subject/26912767/&#34;&gt;《深入理解计算机系统（原书第3版）》CSAPP&lt;/a&gt;&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;指令格式是 x86 的&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;计算机组成 + 操作系统 + 汇编 + C语言 + Linux系统编程&lt;/strong&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/26365491/&#34; urlstring=&#34;https://book.douban.com/subject/26365491/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/26397183/&#34; urlstring=&#34;https://book.douban.com/subject/26397183/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/2110638/&#34; urlstring=&#34;https://book.douban.com/subject/2110638/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/26912767/&#34; urlstring=&#34;https://book.douban.com/subject/26912767/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<ul>
<li><a href="https://www.bilibili.com/video/BV1EW411u7th?vd_source=ae16ff6478eb15c1b87880540263910b">计算机科学速成 [40 集全/精校] - Crash Course Computer Science</a></li>
<li><a href="https://www.bilibili.com/video/BV1BE411D7ii/?spm_id_from=333.337.search-card.all.click">王道计算机考研 计算机组成原理</a></li>
<li><a href="https://www.bilibili.com/video/BV1t4411e7LH/?spm_id_from=333.337.search-card.all.click&amp;vd_source=ae16ff6478eb15c1b87880540263910b">计算机组成原理（哈工大刘宏伟）135讲（全）高清</a></li>
<li><a href="https://www.bilibili.com/video/BV1iW411d7hd?p=1&amp;vd_source=ae16ff6478eb15c1b87880540263910b">【精校中英字幕】2015 CMU 15-213 CSAPP 深入理解计算机系统</a></li>
</ul>
<hr>
<ul>
<li><strong><a href="https://book.douban.com/subject/26365491/">《程序是怎样跑起来的》</a></strong></li>
<li><a href="https://book.douban.com/subject/26397183/">《计算机是怎样跑起来的》</a></li>
<li><a href="https://book.douban.com/subject/2110638/">《计算机组成与设计硬件/软件接口》</a>
<ul>
<li>指令格式是 RISC 的</li>
</ul>
<ol>
<li><strong>第一章：计算机抽象以及相关技术</strong>，这个章节主要是介绍了计算机组成的思想，可以简单快读看，不用重点读</li>
<li><strong>第二章：指令</strong>，大体上讲的是计算机是如果识别和运行指令的，以及代码到指令的过程</li>
<li><strong>第三章：计算机的算数运算</strong>，介绍的是计算机是如何进行加减乘除法的，以及浮点数的运算</li>
<li><strong>第五章：层次化存储</strong>，讲的是计算机的存储层次结构，而且重点讲的是 CPU Cahe</li>
</ol>
</li>
<li><strong><a href="https://book.douban.com/subject/26912767/">《深入理解计算机系统（原书第3版）》CSAPP</a></strong>
<ul>
<li>指令格式是 x86 的</li>
<li><strong>计算机组成 + 操作系统 + 汇编 + C语言 + Linux系统编程</strong>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26365491/" urlstring="https://book.douban.com/subject/26365491/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26397183/" urlstring="https://book.douban.com/subject/26397183/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/2110638/" urlstring="https://book.douban.com/subject/2110638/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26912767/" urlstring="https://book.douban.com/subject/26912767/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>数据库</title>
      <link>https://xancoding.cn/posts/database/</link>
      <pubDate>Tue, 15 Nov 2022 12:38:04 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/database/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1PJ411F78b?spm_id_from=333.999.0.0&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;哈工大数据库系统&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1Rv41177Af?p=1&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;【尚硅谷】Redis&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;mysql&#34;&gt;MySQL&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/3354490/&#34;&gt;《MySQL必知必会》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/35231266/&#34;&gt;《MySQL 是怎么运行的：从根儿上理解 MySQL》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/24708143/&#34;&gt;《MySQL技术内幕：InnoDB存储引擎》&lt;/a&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/3354490/&#34; urlstring=&#34;https://book.douban.com/subject/3354490/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/35231266/&#34; urlstring=&#34;https://book.douban.com/subject/35231266/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/24708143/&#34; urlstring=&#34;https://book.douban.com/subject/24708143/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;redis&#34;&gt;Redis&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/25900156/&#34;&gt;《Redis设计与实现》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/26612779/&#34;&gt;《Redis实战》&lt;/a&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/25900156/&#34; urlstring=&#34;https://book.douban.com/subject/25900156/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/26612779/&#34; urlstring=&#34;https://book.douban.com/subject/26612779/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<ul>
<li><a href="https://www.bilibili.com/video/BV1PJ411F78b?spm_id_from=333.999.0.0&amp;vd_source=ae16ff6478eb15c1b87880540263910b">哈工大数据库系统</a></li>
<li><a href="https://www.bilibili.com/video/BV1Rv41177Af?p=1&amp;vd_source=ae16ff6478eb15c1b87880540263910b">【尚硅谷】Redis</a></li>
</ul>
<hr>
<h1 id="mysql">MySQL</h1>
<ul>
<li><a href="https://book.douban.com/subject/3354490/">《MySQL必知必会》</a></li>
<li><a href="https://book.douban.com/subject/35231266/">《MySQL 是怎么运行的：从根儿上理解 MySQL》</a></li>
<li><a href="https://book.douban.com/subject/24708143/">《MySQL技术内幕：InnoDB存储引擎》</a>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/3354490/" urlstring="https://book.douban.com/subject/3354490/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/35231266/" urlstring="https://book.douban.com/subject/35231266/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/24708143/" urlstring="https://book.douban.com/subject/24708143/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
<h1 id="redis">Redis</h1>
<ul>
<li><a href="https://book.douban.com/subject/25900156/">《Redis设计与实现》</a></li>
<li><a href="https://book.douban.com/subject/26612779/">《Redis实战》</a>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/25900156/" urlstring="https://book.douban.com/subject/25900156/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26612779/" urlstring="https://book.douban.com/subject/26612779/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>操作系统</title>
      <link>https://xancoding.cn/posts/os/</link>
      <pubDate>Tue, 15 Nov 2022 12:04:42 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/os/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1Cm4y1d7Ur/?spm_id_from=333.788&#34;&gt;NJU操作系统&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://jyywiki.cn/OS/2022/&#34;&gt;操作系统：设计与实现 (2022 春季学期)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1iW411d7hd?p=1&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;【精校中英字幕】2015 CMU 15-213 CSAPP 深入理解计算机系统&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/33463930/&#34;&gt;《操作系统导论》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/35208251/&#34;&gt;《现代操作系统》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/5064311/&#34;&gt;《操作系统:精髓与设计原理》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://book.douban.com/subject/26912767/&#34;&gt;《深入理解计算机系统（原书第3版）》CSAPP&lt;/a&gt;&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;计算机组成 + 操作系统 + 汇编 + C语言 + Linux系统编程&lt;/strong&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/33463930/&#34; urlstring=&#34;https://book.douban.com/subject/33463930/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/35208251/&#34; urlstring=&#34;https://book.douban.com/subject/35208251/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/5064311/&#34; urlstring=&#34;https://book.douban.com/subject/5064311/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/26912767/&#34; urlstring=&#34;https://book.douban.com/subject/26912767/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<ul>
<li><a href="https://www.bilibili.com/video/BV1Cm4y1d7Ur/?spm_id_from=333.788">NJU操作系统</a>
<ul>
<li><a href="http://jyywiki.cn/OS/2022/">操作系统：设计与实现 (2022 春季学期)</a></li>
</ul>
</li>
<li><a href="https://www.bilibili.com/video/BV1iW411d7hd?p=1&amp;vd_source=ae16ff6478eb15c1b87880540263910b">【精校中英字幕】2015 CMU 15-213 CSAPP 深入理解计算机系统</a></li>
</ul>
<hr>
<ul>
<li><a href="https://book.douban.com/subject/33463930/">《操作系统导论》</a></li>
<li><a href="https://book.douban.com/subject/35208251/">《现代操作系统》</a></li>
<li><a href="https://book.douban.com/subject/5064311/">《操作系统:精髓与设计原理》</a></li>
<li><strong><a href="https://book.douban.com/subject/26912767/">《深入理解计算机系统（原书第3版）》CSAPP</a></strong>
<ul>
<li><strong>计算机组成 + 操作系统 + 汇编 + C语言 + Linux系统编程</strong>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/33463930/" urlstring="https://book.douban.com/subject/33463930/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/35208251/" urlstring="https://book.douban.com/subject/35208251/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/5064311/" urlstring="https://book.douban.com/subject/5064311/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26912767/" urlstring="https://book.douban.com/subject/26912767/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>计算机网络课程大作业</title>
      <link>https://xancoding.cn/posts/wireshark/</link>
      <pubDate>Sat, 12 Nov 2022 11:38:21 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/wireshark/</guid>
      <description>&lt;h1 id=&#34;要求&#34;&gt;要求&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;团队合作、合理分工、按组为单位进行&lt;/li&gt;
&lt;li&gt;报告文字内容不可拷贝粘贴现有文献，应反映小组所做的工作，有分析，实践性的选题应有具体操作或者配置过程描述，辅以截图或实验数据&lt;/li&gt;
&lt;li&gt;所交报告中应在最后注明组员分工、参考文献，报告字数3000-6000&lt;/li&gt;
&lt;li&gt;不同班级的小组可选择相同的题目，但重复计数（由各班学委协调），不可多于3组，且报告内容不可相同，要求独立完成各组任务&lt;/li&gt;
&lt;li&gt;除了个别综述性的选题，其它选题要求在实际平台上实践&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;选题&#34;&gt;选题&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;基于网络嗅探软件（wireshark）的协议分析实验&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;Wireshark的深入学习与掌握，如过滤器的使用，归纳方法&lt;/li&gt;
&lt;li&gt;通过实验阐述ARP的工作原理&lt;/li&gt;
&lt;li&gt;利用实验结果分析ICMP协议的报文结构字段定义&lt;/li&gt;
&lt;li&gt;基于实验数据深入分析TCP协议的连接过程原理，报文的分片等功能&lt;/li&gt;
&lt;li&gt;从校园网发起向外网中某Web服务器的访问，记录并分析从MAC层协议、IP协议、TCP协议一直到HTTP协议的过程&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;基于网络嗅探软件wireshark的协议分析实验&#34;&gt;基于网络嗅探软件Wireshark的协议分析实验&lt;/h1&gt;
&lt;h2 id=&#34;wireshark-是什么&#34;&gt;Wireshark 是什么？&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Wirkshark 是一个功能十分强大的开源的网络数据包分析器，能够在多种平台上抓取和分析网络包&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Wirkshark 可被用于检查安全问题和解决网络问题，也可供开发者调试协议的实现和学习网络协议的原理&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Wireshark使用 Npcap or WinPcap 作为接口，直接与网卡进行数据报文交换&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;wireshark-下载与安装&#34;&gt;Wireshark 下载与安装&lt;/h2&gt;
&lt;p&gt;官网地址：&lt;a href=&#34;https://www.wireshark.org/&#34;&gt;https://www.wireshark.org/&lt;/a&gt;，直接点击下一步下一步安装即可

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636eef0324bca.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636eef0324bca.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


但是，我在安装过程中报了如下的错误：

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/11/636e699429bad.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/11/636e699429bad.png&#34; alt=&#34;npcap&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


排查了好久，没找到合适的解决办法&lt;br&gt;
最后，下载 WinPcap 来代替 Npcap ，成功运行。&lt;/p&gt;
&lt;h2 id=&#34;wireshark-基本用法&#34;&gt;Wireshark 基本用法&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;简单抓包基础步骤：选择捕获接口 -&amp;gt; 获取网络实时痕迹 -&amp;gt; 获取报文 -&amp;gt; 深入解析&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id=&#34;选择接口网卡&#34;&gt;选择接口（网卡）&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;网络上传输的数据包需要经过网卡到达计算机，Wireshark可以捕获流经网卡的数据包&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在使用Wireshark捕获数据前，先要选择捕获接口。一台计算机可能会有不止一个网卡，此时需要选择你要捕获数据的接口。&lt;/p&gt;
&lt;p&gt;选择菜单栏上的 捕获-&amp;gt;选项

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636eef03d463f.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636eef03d463f.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


选择想要捕获数据的接口后，点击开始

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636ef1eb47349.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636ef1eb47349.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h3 id=&#34;界面说明&#34;&gt;界面说明&lt;/h3&gt;
&lt;p&gt;开始捕获后，Wireshark会把捕获到的报文显示到界面上&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;显示过滤器&lt;/strong&gt;用于设置过滤条件进行数据列表区数据过滤&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;数据列表区&lt;/strong&gt;展示的是Wireshark捕获到的所有数据包的列表，每个数据包包含 编号、时间戳、源地址、目标地址、协议、长度以及数据包信息&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;数据详细区&lt;/strong&gt;展示的是在数据列表区中选中的数据包的分协议展示
&lt;ol&gt;
&lt;li&gt;&lt;u&gt;Frame&lt;/u&gt;：物理层的数据帧概况&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Ethernet II&lt;/u&gt;：数据链路层以太网帧头部信息&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Internet Protocol Version 4&lt;/u&gt;： 互联网层IP包头部信息&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Transmission Control Protocol&lt;/u&gt;：传输层的数据段头部信息，此处是TCP&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;数据字节区&lt;/strong&gt;展示的是选中的数据包的源数据。另外，在数据详细区选中的某层或某字段，对应的数据会在数据字节区中高亮

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636efb5f7ea6d.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636efb5f7ea6d.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;过滤器设置&#34;&gt;过滤器设置&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;根据我们想要抓取的数据包，对过滤器进行设置。过滤掉冗余的数据包，找到我们需要的信息&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;捕获过滤器&#34;&gt;捕获过滤器&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;捕获过滤器表达式作用在Wireshark捕获数据包之前，只捕获符合条件的数据包&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;当需要处理大量数据时，使用捕获过滤器可以节省大量资源&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&#34;界面说明-1&#34;&gt;界面说明&lt;/h5&gt;
&lt;p&gt;选择菜单栏上的 捕获-&amp;gt;捕获过滤器

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636efe3d72678.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636efe3d72678.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


点击 &lt;code&gt;+&lt;/code&gt; 即可添加新的过滤规则&lt;br&gt;
&lt;code&gt;Filter Name&lt;/code&gt; 指代过滤器名称，用来给自己看该过滤器的过滤效果&lt;br&gt;
&lt;code&gt;Filter Expression&lt;/code&gt; 指代过滤器表达式，需要使用 &lt;code&gt;Berkeley Packet Filter&lt;/code&gt; 语法书写

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636efe3e2ce20.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636efe3e2ce20.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h5 id=&#34;语法规则&#34;&gt;语法规则&lt;/h5&gt;
&lt;p&gt;捕获过滤器使用 &lt;code&gt;BPF&lt;/code&gt; 语法，表达式由多个原语组成：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-markdown&#34; data-lang=&#34;markdown&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;原语(primitives)：由名称或数字，以及描述它的多个限定词组成。  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; 限定词(qualifiers)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; Types：设置数字或者名称所指示类型，例如host www.baidu.com，如果没有指定此值，则默认使用“host”关键字
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; host、post
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; net，设定子网， net 192.168.0.0 mask 255.255.255.0等价于net 192.168.0.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; port，设置端口范围，例如port 6000-8000
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; Dir：设置网络出入方向，例如dst port 80，如果没有特别指明来源或目的地，则默认使用“src or dst”作为关键字
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; src、dst、src or dst、src and dst(src：源端口，dst：目标端口)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; Proto：指定协议类型，例如udp，如果没有特别指明是什么协议，则默认使用所有支持的协议
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; ether、fddi、tr、wlan、ip、ip6、arp、rarp、decnet、tcp、udp、icmp、igmp、icmp、igrp、pim、ah、esp、vrrp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; 其他
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; gateway：指明网关IP地址，等价于ether host &amp;#39;ehost&amp;#39; and not host &amp;#39;host&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; broadcast：广播报文，例如ether broadcast或者ip broadcast
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; multicast：多播报文，例如ip multicast或者ip6 multicast
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; less、greater：小于或者大于
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; 原语运算符
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; 与：&lt;span style=&#34;color:#f00&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;或者and
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; 或：||或者or
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;*&lt;/span&gt; 非：!或者not
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;转载自：https://juejin.cn/post/6844904066229747720 &lt;/div&gt; 
&lt;h5 id=&#34;应用示例&#34;&gt;应用示例&lt;/h5&gt;
&lt;p&gt;只抓取源端口或者目的端口范围6000到8000，并且是一个tcp协议或者ipv6的数据包&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;src or dst port 6000-8000 &amp;amp;&amp;amp; tcp or ip6    
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;只抓取IP地址为192.168.0.10的数据包&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;host 192.168.0.10
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;显示过滤器&#34;&gt;显示过滤器&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;显示过滤器表达式作用在在Wireshark捕获数据包之后，从已捕获的所有数据包中显示出符合条件的数据包&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;显示过滤表达式在工具栏下方的“应用显示过滤器”输入框输入即可生效

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636f11a82564a.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636f11a82564a.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h5 id=&#34;基本过滤表达式&#34;&gt;基本过滤表达式&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;一条基本的表达式由&lt;strong&gt;过滤项&lt;/strong&gt;、&lt;strong&gt;过滤关系&lt;/strong&gt;、&lt;strong&gt;过滤值&lt;/strong&gt;三项组成&lt;/li&gt;
&lt;li&gt;例如：&lt;code&gt;ip.addr == 192.168.1.1&lt;/code&gt;，其中 &lt;code&gt;ip.addr&lt;/code&gt; 为过滤项，&lt;code&gt;==&lt;/code&gt; 为过滤关系，&lt;code&gt;192.168.1.1&lt;/code&gt; 为过滤值。&lt;/li&gt;
&lt;li&gt;该表达式的意思是 &lt;strong&gt;找出所有ip协议中源或目标ip等于192.168.1.1的数据包&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h6 id=&#34;过滤项&#34;&gt;过滤项&lt;/h6&gt;
&lt;ol&gt;
&lt;li&gt;Wireshark的过滤项是 &lt;code&gt;协议.协议字段&lt;/code&gt; 的模式，Wireshark支持的全部协议及协议字段可查看&lt;a href=&#34;https://www.wireshark.org/docs/dfref/&#34;&gt;官方说明&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;以端口为例，端口出现于tcp协议中。所以有端口这个过滤项且其写法就是tcp.port&lt;/li&gt;
&lt;li&gt;Wireshark出于缩减长度的原因，有些字段没有使用协议规定的名称而是使用简写，比如Destination Port在Wireshark中写为dstport&lt;/li&gt;
&lt;li&gt;Wireshark出于简便使用的原因，增加了一些协议中没有的字段，比如tcp协议只有源端口和目标端口字段，为了简便使用Wireshark增加了tcp.port来同时代表这两个字段&lt;/li&gt;
&lt;li&gt;实际使用时我们输入&lt;code&gt;协议.&lt;/code&gt;后Wireshark就会有支持的字段提示&lt;/li&gt;
&lt;/ol&gt;
&lt;h6 id=&#34;过滤关系&#34;&gt;过滤关系&lt;/h6&gt;
&lt;p&gt;过滤关系指的是大于、等于、小于等等式关系，具体可以看&lt;a href=&#34;https://www.wireshark.org/docs/wsug_html/#DispCompOps&#34;&gt;官方给出的表&lt;/a&gt;

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636f11ecb35db.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636f11ecb35db.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h6 id=&#34;过滤值&#34;&gt;过滤值&lt;/h6&gt;
&lt;p&gt;过滤值就是设定的过滤项应该满足过滤关系的标准，比如500、5000、50000等等。&lt;br&gt;
过滤值的写法一般已经被过滤项和过滤关系设定好了，只是填下自己的期望值就可以了。&lt;/p&gt;
&lt;h5 id=&#34;复合过滤表达式&#34;&gt;复合过滤表达式&lt;/h5&gt;
&lt;p&gt;所谓复合过滤表达示，就是指由多条基本过滤表达式组合而成的表达示。&lt;br&gt;
基本过滤表达式的写法还是不变的，复合过滤表达示多出来的东西就只是基本过滤表达示的“连接词”，我们依然直接参照&lt;a href=&#34;https://www.wireshark.org/docs/wsug_html/#FiltLogOps&#34;&gt;官方给出的表&lt;/a&gt;

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636f11cc4be71.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636f11cc4be71.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h5 id=&#34;常见显示过滤需求及其对应表达式&#34;&gt;常见显示过滤需求及其对应表达式&lt;/h5&gt;
&lt;h6 id=&#34;数据链路层&#34;&gt;数据链路层&lt;/h6&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;筛选mac地址为04:f9:38:ad:13:26的数据包----eth.src == 04:f9:38:ad:13:26

筛选源mac地址为04:f9:38:ad:13:26的数据包----eth.src == 04:f9:38:ad:13:26
&lt;/code&gt;&lt;/pre&gt;&lt;h6 id=&#34;网络层&#34;&gt;网络层&lt;/h6&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;筛选ip地址为192.168.1.1的数据包----ip.addr == 192.168.1.1

筛选192.168.1.0网段的数据---- ip contains &amp;#34;192.168.1&amp;#34;

筛选192.168.1.1和192.168.1.2之间的数据包----ip.addr == 192.168.1.1 &amp;amp;&amp;amp; ip.addr == 192.168.1.2

筛选从192.168.1.1到192.168.1.2的数据包----ip.src == 192.168.1.1 &amp;amp;&amp;amp; ip.dst == 192.168.1.2
&lt;/code&gt;&lt;/pre&gt;&lt;h6 id=&#34;传输层&#34;&gt;传输层&lt;/h6&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;筛选tcp协议的数据包----tcp

筛选除tcp协议以外的数据包----!tcp

筛选端口为80的数据包----tcp.port == 80

筛选12345端口和80端口之间的数据包----tcp.port == 12345 &amp;amp;&amp;amp; tcp.port == 80

筛选从12345端口到80端口的数据包----tcp.srcport == 12345 &amp;amp;&amp;amp; tcp.dstport == 80
&lt;/code&gt;&lt;/pre&gt;&lt;h6 id=&#34;应用层&#34;&gt;应用层&lt;/h6&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;特别说明----http中http.request表示请求头中的第一行（如GET index.jsp HTTP/1.1），http.response表示响应头中的第一行（如HTTP/1.1 200 OK），其他头部都用http.header_name形式。

筛选url中包含.php的http数据包----http.request.uri contains &amp;#34;.php&amp;#34;

筛选内容包含username的http数据包----http contains &amp;#34;username&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;通过实验阐述arp的工作原理&#34;&gt;通过实验阐述ARP的工作原理&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ARP即地址解析协议（Address Resolution Protocol），是根据IP地址获取MAC地址的一个TCP/IP协议&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ARP用于解决同一个局域网上的主机或路由器的IP地址和MAC地址的映射问题&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;每一台主机都设有一个 ARP高速缓存，里面存有 本局域网上 各主机和路由器的IP地址到MAC地址的映射表&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;arp工作流程&#34;&gt;ARP工作流程&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;当主机A要向&lt;strong&gt;本局域网&lt;/strong&gt;上的某台主机B发送IP数据报时，就现在其ARP高速缓存中查找有无主机B的IP地址。若有，查出其对应的MAC地址，写入MAC帧；若没有，进行下述步骤&lt;/li&gt;
&lt;li&gt;主机A的ARP进程在本局域网上广播一个ARP请求分组，其中有自己的IP地址到MAC地址的映射&lt;/li&gt;
&lt;li&gt;本局域网上的所有主机运行的ARP进程都收到此ARP请求分组&lt;/li&gt;
&lt;li&gt;主机B的IP地址与ARP请求分组中要查询的IP地址一致，就收下这个ARP请求分组，将主机A的MAC映射写入自己的ARP高速缓存，并向主机A发送ARP响应分组，同时在这个ARP响应分组中写入自己的MAC地址。由于其余所有主机的IP地址都与ARP请求分组中要查询的IP地址不一致，因此不理睬&lt;/li&gt;
&lt;li&gt;主机A收到主机B的ARP响应分组后，就在其ARP高速缓存中写入主机B的IP地址到MAC地址的映射&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;实验步骤及内容&#34;&gt;实验步骤及内容&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;主机A&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IP地址：192.168.31.248&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MAC地址：c0:3c:59:5e:37:47&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;主机B&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IP地址：192.168.31.186&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MAC地址：28:7f:cf:12:af:89&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;arp命令练习&#34;&gt;ARP命令练习&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;在&lt;code&gt;cmd&lt;/code&gt;中使用&lt;code&gt;ipconfig/all&lt;/code&gt;命令，查看自己的IP地址和MAC地址，同时让小组成员连接同一个&lt;code&gt;WIFI&lt;/code&gt;执行相同的操作并记录&lt;/li&gt;
&lt;/ol&gt;
&lt;center&gt; 
	&lt;img style=&#34;border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);&#34; src=&#34;https://bu.dusays.com/2022/11/12/636f62756d2e9.png&#34;&gt;
	&lt;br&gt;
	&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;主机A IP地址和MAC地址&lt;/div&gt; 
 &lt;/center&gt;
&lt;center&gt; 
	&lt;img style=&#34;border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);&#34; src=&#34;https://bu.dusays.com/2022/11/12/636f6331a7d39.png&#34;&gt;
	&lt;br&gt;
	&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;主机B IP地址和MAC地址&lt;/div&gt; 
 &lt;/center&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;主机A使用&lt;code&gt;arp -a&lt;/code&gt;查看ARP缓存表

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636f603bde062.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636f603bde062.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;主机A通过&lt;code&gt;ping&lt;/code&gt;主机B的IP来添加动态ARP缓存表数据

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636f60cfe4604.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636f60cfe4604.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


我在&lt;code&gt;ping&lt;/code&gt;主机B&lt;code&gt;ip&lt;/code&gt;地址时碰到&lt;strong&gt;请求超时&lt;/strong&gt;的问题。&lt;br&gt;
经排查，是因为windows防火墙默认设置的是不让别人ping通，通过修改防火墙相关设置解决了该问题。&lt;br&gt;
&lt;strong&gt;步骤：控制面板 →  系统和安全 → Windows防火墙 → 高级设置 → 入站规则 → 文件和打印机共享（回显请求 - ICMPv4-In）设置为启用&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;主机A使用&lt;code&gt;arp -a&lt;/code&gt;查看ARP缓存表，发生新增一条数据

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636f6169b6f50.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636f6169b6f50.png&#34; alt=&#34;3&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;以管理员身份运行&lt;code&gt;cmd&lt;/code&gt;，执行&lt;code&gt;arp -d *&lt;/code&gt;，删除缓存信息

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/12/636f62661400d.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/12/636f62661400d.png&#34; alt=&#34;4&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;抓包分析arp协议&#34;&gt;抓包分析ARP协议&lt;/h4&gt;
&lt;h5 id=&#34;当arp缓存对应数据为空时&#34;&gt;当ARP缓存对应数据为空时&lt;/h5&gt;
&lt;h6 id=&#34;实验步骤&#34;&gt;实验步骤&lt;/h6&gt;
&lt;ol&gt;
&lt;li&gt;主机A执行&lt;code&gt;arp -d *&lt;/code&gt;，删除缓存信息&lt;/li&gt;
&lt;li&gt;主机A运行Wireshark，设置显示过滤器表达式为&lt;code&gt;arp.dst.proto_ipv4 == 192.168.31.186 and arp.src.proto_ipv4 == 192.168.31.248 or icmp &lt;/code&gt;&lt;/li&gt;
&lt;li&gt;主机A&lt;code&gt;ping&lt;/code&gt;主机B的&lt;code&gt;ip地址&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h6 id=&#34;结果分析&#34;&gt;结果分析&lt;/h6&gt;
&lt;ol&gt;
&lt;li&gt;主机A将自己的&lt;code&gt;ip地址 192.168.31.248&lt;/code&gt; &amp;amp; &lt;code&gt;MAC地址 c0:3c:59:5e:37:47&lt;/code&gt;写入请求分组，并将&lt;code&gt;目的ip地址&lt;/code&gt;设置为&lt;code&gt;192.168.31.186&lt;/code&gt;，&lt;code&gt;目的MAC地址&lt;/code&gt;设置为&lt;code&gt;00:00:00:00:00:00&lt;/code&gt;，对本局域网内的所有主机进行广播&lt;/li&gt;
&lt;/ol&gt;
&lt;center&gt; 
	&lt;img style=&#34;border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);&#34; src=&#34;https://bu.dusays.com/2022/11/12/636f8f33f1a20.png&#34;&gt;
	&lt;br&gt;
	&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;主机A发出的ARP请求分组&lt;/div&gt; 
 &lt;/center&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;主机B收下这个ARP请求分组，将主机A的MAC映射写入自己的ARP高速缓存，并向主机A发送ARP响应分组，同时在这个ARP响应分组中写入自己的MAC地址，即&lt;code&gt;28:7f:cf:12:af:89&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;主机A收到主机B的ARP响应分组后，就在其ARP高速缓存中写入主机B的IP地址到MAC地址的映射&lt;/li&gt;
&lt;/ol&gt;
&lt;center&gt; 
	&lt;img style=&#34;border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);&#34; src=&#34;https://bu.dusays.com/2022/11/12/636f8e7d3f758.png&#34;&gt;
	&lt;br&gt;
	&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;主机A收到的来自主机B的ARP响应分组&lt;/div&gt; 
 &lt;/center&gt;
&lt;center&gt; 
	&lt;img style=&#34;border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);&#34; src=&#34;https://bu.dusays.com/2022/11/12/636f8ea2d8434.png&#34;&gt;
	&lt;br&gt;
	&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;主机A的ARP高速缓存表&lt;/div&gt; 
 &lt;/center&gt;
&lt;h5 id=&#34;当arp缓存对应数据不为空时&#34;&gt;当ARP缓存对应数据不为空时&lt;/h5&gt;
&lt;h6 id=&#34;实验步骤-1&#34;&gt;实验步骤&lt;/h6&gt;
&lt;ol&gt;
&lt;li&gt;主机A运行Wireshark，设置显示过滤器表达式为&lt;code&gt;arp.dst.proto_ipv4 == 192.168.31.186 and arp.src.proto_ipv4 == 192.168.31.248 or icmp&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;主机A &lt;code&gt;ping&lt;/code&gt;主机B的&lt;code&gt;ip地址&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h6 id=&#34;结果分析-1&#34;&gt;结果分析&lt;/h6&gt;
&lt;p&gt;主机A没有发出&lt;code&gt;ARP&lt;/code&gt;请求，而主机B接受到了主机A的ICMP报文，说明主机A直接使用了高速缓存区内的对应数据，而没有发出广播&lt;/p&gt;
&lt;center&gt; 
	&lt;img style=&#34;border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);&#34; src=&#34;https://bu.dusays.com/2022/11/12/636f910b7f31d.png&#34;&gt;
	&lt;br&gt;
	&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;主机A发出的报文&lt;/div&gt; 
 &lt;/center&gt;
&lt;h2 id=&#34;利用实验结果分析icmp协议的报文结构字段定义&#34;&gt;利用实验结果分析ICMP协议的报文结构字段定义&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ICMP即互联网控制报文协议（Internet Control Message Protocol），网络设备（包括路由器）使用它来发送错误消息和指示与另一个IP 地址通信时成功或失败的操作信息&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;center&gt; 
	&lt;img style=&#34;border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);&#34; src=&#34;https://bu.dusays.com/2022/11/12/636fbbc74f13c.png&#34;&gt;
	&lt;br&gt;
	&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;ICMP报文结构&lt;/div&gt; 
 &lt;/center&gt;
&lt;h3 id=&#34;icmp报文格式&#34;&gt;ICMP报文格式&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;+0------7-------15---------------31
|  Type | Code  |    Checksum    |
+--------------------------------+
|          Message Body          |
|        (Variable length)       |
+--------------------------------+
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;icmp报文格式解释&#34;&gt;ICMP报文格式解释&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;u&gt;Type&lt;/u&gt;：占一个字节，标识ICMP报文的类型，可以分为差错报告报文和询问报文两大类&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Code&lt;/u&gt;：占一个字节，用于进一步区分某种类型中的不同情况&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Checksum&lt;/u&gt;：占两个字节，检验报文在传输过程中是否出现差错&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;icmp应用举例&#34;&gt;ICMP应用举例&lt;/h3&gt;
&lt;h4 id=&#34;ping命令&#34;&gt;Ping命令&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;「ping」是用来探测本机与网络中另一主机之间是否可达的命令&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在此次实验中，使用主机A在&lt;code&gt;cmd&lt;/code&gt;环境下&lt;code&gt;ping baidu.com&lt;/code&gt;，分析回送请求报文和回送回答报文&lt;/p&gt;
&lt;h5 id=&#34;回送请求报文&#34;&gt;回送请求报文&lt;/h5&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63702d8239c61.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63702d8239c61.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Internet Control Message Protocol
    Type: 8 (Echo (ping) request)
    Code: 0
    Checksum: 0x4ae9 [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 626 (0x0272)
    Sequence Number (LE): 29186 (0x7202)
    [Response frame: 215]
    Data (32 bytes)
        Data: 6162636465666768696a6b6c6d6e6f7071727374757677616263646566676869
        [Length: 32]
&lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;
&lt;li&gt;Type的值为 &lt;strong&gt;8&lt;/strong&gt;，Code的值为 &lt;strong&gt;0&lt;/strong&gt;，表示回显请求&lt;/li&gt;
&lt;li&gt;Checksum的值为 &lt;strong&gt;0x4ae9&lt;/strong&gt;，这里校验和验证正确&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Identifier&lt;/u&gt;：识别码，用于区分不同进程的应用。由于Window系统与Linux系统发出的ping报文的字节序不一样，所以需要 &lt;strong&gt;BE&lt;/strong&gt; 和 &lt;strong&gt;LE&lt;/strong&gt; 两个值，而这两个值所表示的十六进制值（HEX）是相同的。这里的 &lt;strong&gt;BE&lt;/strong&gt; 指的是大端字节序，在Linux中使用；&lt;strong&gt;LE&lt;/strong&gt;指的是小端字节序，在Windows中使用&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Sequence Number&lt;/u&gt;：序列号，用于对应请求与响应。这里对于 &lt;strong&gt;BE&lt;/strong&gt; 和 &lt;strong&gt;LE&lt;/strong&gt; 解释同上。&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;回送回答报文&#34;&gt;回送回答报文&lt;/h5&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63702d83032ff.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63702d83032ff.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Internet Control Message Protocol
    Type: 0 (Echo (ping) reply)
    Code: 0
    Checksum: 0x52e9 [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 626 (0x0272)
    Sequence Number (LE): 29186 (0x7202)
    [Request frame: 213]
    [Response time: 20.855 ms]
    Data (32 bytes)
        Data: 6162636465666768696a6b6c6d6e6f7071727374757677616263646566676869
        [Length: 32]
&lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;
&lt;li&gt;Type的值为 &lt;strong&gt;0&lt;/strong&gt;，Code的值为 &lt;strong&gt;0&lt;/strong&gt;，表示回送回答&lt;/li&gt;
&lt;li&gt;Checksum的值为 &lt;strong&gt;0x52e9&lt;/strong&gt;，这里校验和验证正确&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Identifier&lt;/u&gt;：识别码，用于区分不同进程的应用&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Sequence Number&lt;/u&gt;：序列号，用于对应请求与响应。这里的值 &lt;strong&gt;626&lt;/strong&gt; 同上文 &lt;strong&gt;回送请求报文&lt;/strong&gt; &lt;code&gt;Sequence Number&lt;/code&gt; 的值，说明这俩请求和响应是对应的&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;tracert命令&#34;&gt;Tracert命令&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;「Tracert」是用来显示可能的路由（路径）和测量数据包在 IP 网络中的传输延迟的命令&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在此次实验中，使用主机A在&lt;code&gt;cmd&lt;/code&gt;环境下&lt;code&gt;tracert baidu.com&lt;/code&gt;，分析报文&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63703bc9a2bf1.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63703bc9a2bf1.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h5 id=&#34;差错报告报文&#34;&gt;差错报告报文&lt;/h5&gt;
&lt;p&gt;ICMP的差错报告报文中，会把收到的需要进行差错报告的IP的数据提取出来作为ICMP报文的数据部分&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63703c4b4a1e1.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63703c4b4a1e1.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Internet Protocol Version 4, Src: 192.168.31.248, Dst: 110.242.68.66
    0100 .... = Version: 4
    .... 0101 = Header Length: 20 bytes (5)
    Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)
        0000 00.. = Differentiated Services Codepoint: Default (0)
        .... ..00 = Explicit Congestion Notification: Not ECN-Capable Transport (0)
    Total Length: 92
    Identification: 0x1f2e (7982)
    000. .... = Flags: 0x0
        0... .... = Reserved bit: Not set
        .0.. .... = Don&amp;#39;t fragment: Not set
        ..0. .... = More fragments: Not set
    ...0 0000 0000 0000 = Fragment Offset: 0
    Time to Live: 1
        [Expert Info (Note/Sequence): &amp;#34;Time To Live&amp;#34; only 1]
            [&amp;#34;Time To Live&amp;#34; only 1]
            [Severity level: Note]
            [Group: Sequence]
    Protocol: ICMP (1)
    Header Checksum: 0x0000 [validation disabled]
    [Header checksum status: Unverified]
    Source Address: 192.168.31.248
    Destination Address: 110.242.68.66

Internet Control Message Protocol
    Type: 8 (Echo (ping) request)
    Code: 0
    Checksum: 0xf4e4 [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 794 (0x031a)
    Sequence Number (LE): 6659 (0x1a03)
    [No response seen]
        [Expert Info (Warning/Sequence): No response seen to ICMP request]
            [No response seen to ICMP request]
            [Severity level: Warning]
            [Group: Sequence]
    Data (64 bytes)
        Data: 000000000000000000000000000000000000000000000000000000000000000000000000…
        [Length: 64]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63703c4c1fe7e.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63703c4c1fe7e.png&#34; alt=&#34;3&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Internet Control Message Protocol
    Type: 11 (Time-to-live exceeded)
    Code: 0 (Time to live exceeded in transit)
    Checksum: 0xf4ff [correct]
    [Checksum Status: Good]
    Unused: 00000000
    Internet Protocol Version 4, Src: 192.168.31.248, Dst: 110.242.68.66
        0100 .... = Version: 4
        .... 0101 = Header Length: 20 bytes (5)
        Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)
            0000 00.. = Differentiated Services Codepoint: Default (0)
            .... ..00 = Explicit Congestion Notification: Not ECN-Capable Transport (0)
        Total Length: 92
        Identification: 0x1f2e (7982)
        000. .... = Flags: 0x0
            0... .... = Reserved bit: Not set
            .0.. .... = Don&amp;#39;t fragment: Not set
            ..0. .... = More fragments: Not set
        ...0 0000 0000 0000 = Fragment Offset: 0
        Time to Live: 1
            [Expert Info (Note/Sequence): &amp;#34;Time To Live&amp;#34; only 1]
                [&amp;#34;Time To Live&amp;#34; only 1]
                [Severity level: Note]
                [Group: Sequence]
        Protocol: ICMP (1)
        Header Checksum: 0x069f [validation disabled]
        [Header checksum status: Unverified]
        Source Address: 192.168.31.248
        Destination Address: 110.242.68.66
    Internet Control Message Protocol
        Type: 8 (Echo (ping) request)
        Code: 0
        Checksum: 0xf4e4 [unverified] [in ICMP error packet]
        [Checksum Status: Unverified]
        Identifier (BE): 1 (0x0001)
        Identifier (LE): 256 (0x0100)
        Sequence Number (BE): 794 (0x031a)
        Sequence Number (LE): 6659 (0x1a03)
        Data (64 bytes)
            Data: 000000000000000000000000000000000000000000000000000000000000000000000000…
            [Length: 64]
&lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;
&lt;li&gt;Type的值为 &lt;strong&gt;11&lt;/strong&gt;，Code的值为 &lt;strong&gt;0&lt;/strong&gt;，表示超时报错&lt;/li&gt;
&lt;li&gt;图1的&lt;strong&gt;回送请求报文&lt;/strong&gt;出错，图2相对应的&lt;strong&gt;差错报告报文&lt;/strong&gt;，把图1报文的IP数据报的首部和数据字段的前8个字节提取出来，作为ICMP报文的数据字段&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;基于实验数据深入分析tcp协议功能&#34;&gt;基于实验数据深入分析TCP协议功能&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;TCP即传输控制协议（Transmission Control Protocol），是面向连接的运输层协议&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;tcp报文格式&#34;&gt;TCP报文格式&lt;/h3&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63704be4d65f3.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63704be4d65f3.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h3 id=&#34;tcp报文格式解释&#34;&gt;TCP报文格式解释&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;u&gt;源端口&lt;/u&gt;和&lt;u&gt;目的端口&lt;/u&gt;：各占 2 字节，和 IP 头部的 &lt;strong&gt;源地址&lt;/strong&gt; 和 &lt;strong&gt;目的地址&lt;/strong&gt; 一起唯一地标识了每个连接&lt;/li&gt;
&lt;li&gt;&lt;u&gt;序列号&lt;/u&gt;：占 4 字节，TCP连接中传送的数据流中的&lt;strong&gt;每一个字节都按顺序编号&lt;/strong&gt;，序号字段的值指的是&lt;strong&gt;本报文段&lt;/strong&gt;所发送的数据的第一个字节的序号&lt;/li&gt;
&lt;li&gt;&lt;u&gt;确认号&lt;/u&gt;：占 4 字节，是期望收到对方的下一个报文段的数据的第一个字节的序号&lt;/li&gt;
&lt;li&gt;&lt;u&gt;数据偏移&lt;/u&gt;：占 4 位，它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远，实际是指出TCP报文段的首部长度&lt;/li&gt;
&lt;li&gt;&lt;u&gt;保留&lt;/u&gt;：占 6 位，保留为今后使用，默认置0&lt;/li&gt;
&lt;li&gt;&lt;u&gt;紧急 URG(URGent)&lt;/u&gt;：当 URG = 1 时，表明紧急指针字段有效。它告诉系统此报文段中有紧急数据，应尽快传送(相当于高优先级的数据)&lt;/li&gt;
&lt;li&gt;&lt;u&gt;确认 ACK(ACKnowledegment)&lt;/u&gt;：只有当 ACK = 1 时确认号字段有效，当 ACK = 0 时确认号无效&lt;/li&gt;
&lt;li&gt;&lt;u&gt;推送 PSH(PuSH)&lt;/u&gt;：接收 TCP 收到 PSH = 1 的报文段，就尽快地交付接收应用进程，不再等到整个缓存都填满了后再向上交付&lt;/li&gt;
&lt;li&gt;&lt;u&gt;复位 RST(ReSeT)&lt;/u&gt;：当 RST = 1 时，表明 TCP 连接中出现严重差错（如由于主机崩溃或其他原因）必须释放连接，然后再重新建立运输连接。RST置1还用来拒绝一个非法报文或拒绝打开一个连接&lt;/li&gt;
&lt;li&gt;&lt;u&gt;同步 SYN(SYNchronization)&lt;/u&gt;：在连接建立时用来同步序号。当 SYN = 1 而 ACK = 0 时，表明这是一个连接请求报文段。对方若同意建立连接，则在响应的报文段中使 SYN = 1 和 ACK = 1&lt;/li&gt;
&lt;li&gt;&lt;u&gt;终止 FIN(FINish)&lt;/u&gt;：用来释放一个连接。FIN = 1 表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。&lt;/li&gt;
&lt;li&gt;&lt;u&gt;窗口&lt;/u&gt;：占 2 字节，指的是发送本报文段的一方的&lt;strong&gt;接收窗口&lt;/strong&gt;。用于流量控制，指示接收方愿意接收的字节数量&lt;/li&gt;
&lt;li&gt;&lt;u&gt;检验和&lt;/u&gt;：占 2 字节，检验和字段检验的范围包括TCP首部和数据这两部分。在计算检验和时，要在 TCP 报文段的前面加上 12 字节的伪首部&lt;/li&gt;
&lt;li&gt;&lt;u&gt;选项&lt;/u&gt;：长度可变，最长可达 40 字节。如 &lt;strong&gt;最长报文段长度MSS&lt;/strong&gt;、&lt;strong&gt;窗口扩大&lt;/strong&gt;选项、&lt;strong&gt;时间戳&lt;/strong&gt;选项等等&lt;/li&gt;
&lt;li&gt;&lt;u&gt;填充字段&lt;/u&gt;：仅仅是为了使整个TCP首部长度为 4 字节的整数倍&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;实验步骤-2&#34;&gt;实验步骤&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;下载 &lt;a href=&#34;https://files.cnblogs.com/files/ggll611928/TCP-UDP-Socket%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7-v2.2.rar&#34;&gt;TCP/UDP Socket 调试工具&lt;/a&gt;

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370874b20e3e.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370874b20e3e.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;在&lt;code&gt;cmd&lt;/code&gt;中&lt;code&gt;ping zhihu.com&lt;/code&gt;，得到&lt;code&gt;ip地址&lt;/code&gt;为&lt;code&gt;103.41.167.234&lt;/code&gt;

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637087b2b3a4b.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637087b2b3a4b.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;使用TCP调试工具，创建一个连接

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370887550c8b.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370887550c8b.png&#34; alt=&#34;3&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;打开Wireshark，设置显示过滤器为 &lt;code&gt;ip.addr == 103.41.167.234&lt;/code&gt;

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637088cda466f.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637088cda466f.png&#34; alt=&#34;4&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;在TCP调试工具中，点击 &lt;strong&gt;连接&lt;/strong&gt;

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63708928070a7.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63708928070a7.png&#34; alt=&#34;5&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;在TCP调试工具中，发送数据 &lt;code&gt;Hello World!!!&lt;/code&gt;后，连接自动断开

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63708c752ff6b.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63708c752ff6b.png&#34; alt=&#34;6&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;在Wireshark中捕获到以下数据包

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63708cca0d6f9.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63708cca0d6f9.png&#34; alt=&#34;7&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;三次握手&#34;&gt;三次握手&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;三次握手目的是保证双方都有发送和接收的能力&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637052e140268.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637052e140268.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一开始，客户端和服务端都处于 &lt;code&gt;CLOSE&lt;/code&gt; 状态。先是服务端主动监听某个端口，处于 &lt;code&gt;LISTEN&lt;/code&gt; 状态&lt;/li&gt;
&lt;li&gt;客户端随机初始化 &lt;strong&gt;序列号 seq&lt;/strong&gt; 为 &lt;strong&gt;x&lt;/strong&gt;，同时把 &lt;strong&gt;SYN&lt;/strong&gt; 置1，接着把报文发送给服务端。之后，TCP客户端进入 &lt;code&gt;SYN-SENT&lt;/code&gt; 状态

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637090318e9b1.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637090318e9b1.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;服务器收到连接请求报文段后，若同意连接，将进行下述操作。首先，随机初始化自己的 &lt;strong&gt;序列号 seq&lt;/strong&gt; 为 &lt;strong&gt;y&lt;/strong&gt;，其次把 &lt;strong&gt;确认号 ack&lt;/strong&gt; 置为 &lt;strong&gt;x + 1&lt;/strong&gt;，接着 &lt;strong&gt;SYN&lt;/strong&gt; 和 &lt;strong&gt;ACK&lt;/strong&gt; 均置为1，最后把该报文发给客户端。这时，服务端进入&lt;code&gt;SYN-RCVD&lt;/code&gt; 状态

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370903f2af73.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370903f2af73.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;客户端收到服务端报文后，还要向服务端回应最后一个应答报文。首先将应答报文的 &lt;strong&gt;ACK&lt;/strong&gt; 置为1，&lt;strong&gt;确认号 ack&lt;/strong&gt; 置为 &lt;strong&gt;y + 1&lt;/strong&gt;，&lt;strong&gt;序列号 seq&lt;/strong&gt; 置为 &lt;strong&gt;x + 1&lt;/strong&gt;，最后把报文发送给服务端。之后，客户端处于&lt;code&gt;ESTABLISHED&lt;/code&gt; 状态，因为它一收一发了

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/63709042a0303.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/63709042a0303.png&#34; alt=&#34;3&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;服务端收到客户端的应答报文后，也进入 &lt;code&gt;ESTABLISHED&lt;/code&gt; 状态，因为它也一收一发了&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;四次挥手&#34;&gt;四次挥手&lt;/h3&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637055a33c4fe.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637055a33c4fe.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;客户端打算关闭连接，此时会发送一个 TCP 首部 &lt;code&gt;FIN&lt;/code&gt; 标志位被置为 &lt;code&gt;1&lt;/code&gt; 的报文并指明自己当前的 &lt;strong&gt;序列号 seq&lt;/strong&gt; 为 &lt;strong&gt;u&lt;/strong&gt;，之后客户端进入 &lt;code&gt;FIN_WAIT_1&lt;/code&gt; 状态

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637095cced990.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637095cced990.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;服务端收到该报文后，就向客户端发送 &lt;code&gt;ACK&lt;/code&gt; 应答报文，指明自己当前的 &lt;strong&gt;序列号 seq&lt;/strong&gt; 为 &lt;strong&gt;v&lt;/strong&gt;， &lt;strong&gt;确认号 ack&lt;/strong&gt; 为 &lt;strong&gt;u + 1&lt;/strong&gt;，接着服务端进入 &lt;code&gt;CLOSE_WAIT&lt;/code&gt; 状态

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637095cf921e9.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637095cf921e9.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;客户端收到服务端的 &lt;code&gt;ACK&lt;/code&gt; 应答报文后，之后进入 &lt;code&gt;FIN_WAIT_2&lt;/code&gt; 状态&lt;/li&gt;
&lt;li&gt;等待服务端处理完数据后，也向客户端发送 &lt;code&gt;FIN&lt;/code&gt; 报文，报文的 &lt;code&gt;ACK&lt;/code&gt; 置为 &lt;code&gt;1&lt;/code&gt;，&lt;strong&gt;序列号 seq&lt;/strong&gt; 为 &lt;strong&gt;w&lt;/strong&gt;， &lt;strong&gt;确认号 ack&lt;/strong&gt; 为 &lt;strong&gt;u + 1&lt;/strong&gt;，之后服务端进入 &lt;code&gt;LAST_ACK&lt;/code&gt; 状态

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637095d1574be.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637095d1574be.png&#34; alt=&#34;3&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;客户端收到服务端的 &lt;code&gt;FIN&lt;/code&gt; 报文后，回一个 &lt;code&gt;ACK&lt;/code&gt; 应答报文，其中 &lt;strong&gt;序列号 seq&lt;/strong&gt; 为 &lt;strong&gt;u + 1&lt;/strong&gt;， &lt;strong&gt;确认号 ack&lt;/strong&gt; 为 &lt;strong&gt;w + 1&lt;/strong&gt;，之后进入 &lt;code&gt;TIME_WAIT&lt;/code&gt; 状态

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637095d2df5ff.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637095d2df5ff.png&#34; alt=&#34;4&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;服务端收到了 &lt;code&gt;ACK&lt;/code&gt; 应答报文后，就进入了 &lt;code&gt;CLOSE&lt;/code&gt; 状态，至此服务端已经完成连接的关闭&lt;/li&gt;
&lt;li&gt;客户端在经过 &lt;code&gt;2MSL&lt;/code&gt; 一段时间后，自动进入 &lt;code&gt;CLOSE&lt;/code&gt; 状态，至此客户端也完成连接的关闭&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;访问外网某服务器分析从mac层协议ip协议tcp协议一直到http协议的过程&#34;&gt;访问外网某服务器，分析从MAC层协议、IP协议、TCP协议一直到HTTP协议的过程&lt;/h2&gt;
&lt;h3 id=&#34;网络包的旅途&#34;&gt;网络包的旅途&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;用户输入网址&lt;/li&gt;
&lt;li&gt;浏览器解析网址，生成 HTTP 消息&lt;/li&gt;
&lt;li&gt;在发送 HTTP 消息给 Web 服务器之前，浏览器先向 DNS 服务器发送请求，查询与服务器域名相对应的 IP 地址&lt;/li&gt;
&lt;li&gt;通过 DNS 获取到 IP 后，浏览器把 HTTP 消息转交给 Socket 库&lt;/li&gt;
&lt;li&gt;Socket 库将收到的 HTTP 消息作为数据转交给协议栈&lt;/li&gt;
&lt;li&gt;TCP 按照网络包的长度对数据进行拆分，在每个包前面加上 TCP 头部并转交给 IP&lt;/li&gt;
&lt;li&gt;IP 在 TCP 包前面加上 IP 头部（目的 IP 为 Web 服务器 IP 地址，源 IP 为主机 IP 地址），IP 包生成后参考路由控制表决定接受此 IP 包的路由或主机的 IP 地址。随后，IP 包将被发送给连接这些路由器或主机网络接口的驱动程序&lt;/li&gt;
&lt;li&gt;如果尚不知道下一跳接收端的 MAC 地址，可以利用 ARP 查找，加上 MAC 头部，然后将包转交给网卡驱动&lt;/li&gt;
&lt;li&gt;网卡驱动收到 IP 模块发来的包，将其转交给网卡并发出发送指令&lt;/li&gt;
&lt;li&gt;网卡检查以太网的可发送状态，将数字信息转换为电信号发送出去&lt;/li&gt;
&lt;li&gt;服务端的局域网中有防火墙，对进入的包进行检查，判断是否允许通过&lt;/li&gt;
&lt;li&gt;Web 服务器前面有如果有缓存服务器，会拦截通过防火墙的包如果用户请求的页面已经缓存在服务器上，则代替服务器向用户返回页面数据&lt;/li&gt;
&lt;li&gt;如果请求的页面没有被缓存，缓存服务器会将请求转发给 Web 服务器&lt;/li&gt;
&lt;li&gt;Web 服务器收到包后，网卡和网卡驱动会接收这个包并转交给协议栈&lt;/li&gt;
&lt;li&gt;协议栈依次检查 IP 头部和 TCP 头部，如果没有问题则取出 HTTP 的数据块并进行组装&lt;/li&gt;
&lt;li&gt;HTTP 消息恢复成原始状态，然后通过 Socket 库转交给 Web 服务器&lt;/li&gt;
&lt;li&gt;Web 服务器分析 HTTP 消息的内容，并根据请求内容将读取的数据返回给客户端&lt;/li&gt;
&lt;li&gt;浏览器接收到响应包后，进行页面的渲染&lt;/li&gt;
&lt;li&gt;HTTP请求结束，TCP连接断开

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/15/6372e99613b66.jpg&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/15/6372e99613b66.jpg&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;dns&#34;&gt;DNS&lt;/h3&gt;
&lt;h4 id=&#34;dns报文结构&#34;&gt;DNS报文结构&lt;/h4&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370b7a2baa6b.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370b7a2baa6b.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h4 id=&#34;dns查询步骤&#34;&gt;DNS查询步骤&lt;/h4&gt;
&lt;p&gt;浏览器在解析域名时，会经过下列步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;浏览器会先看自身有没有对这个域名的缓存，如果有，就直接返回；如果没有，就去问操作系统&lt;/li&gt;
&lt;li&gt;操作系统也会去看自己的缓存，如果有，就直接返回；如果没有，再去 Hosts 文件看&lt;/li&gt;
&lt;li&gt;本地的 Hosts 文件，若有域名和 IP 地址的对应关系，直接使用该 IP 地址通信；如果没有，浏览器向本地域名服务器发出一个查询请求&lt;/li&gt;
&lt;li&gt;本地域名服务器查看有无缓存记录。若有，直接响应；若没有，本地域名服务器向根域名服务器查询&lt;/li&gt;
&lt;li&gt;根域名服务器响应本地域名服务器，给出对应域名的顶级域名服务器IP地址，让本地域名服务器去向其查询&lt;/li&gt;
&lt;li&gt;顶级域名服务器响应本地域名服务器，给出对应域名的权威域名服务器（权威 DNS 服务器，它是域名解析结果的原出处）IP地址，让本地域名服务器去向其查询&lt;/li&gt;
&lt;li&gt;权威 DNS 服务器查询后将对应的 IP 地址告诉本地 DNS 服务器&lt;/li&gt;
&lt;li&gt;本地 DNS 将 IP 地址返回给客户端，客户端和目标建立连接&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;实验步骤-3&#34;&gt;实验步骤&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;访问&lt;code&gt;http://www.smartclass.cn/Default.aspx&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;分析 &lt;code&gt;HTTP&lt;/code&gt; 请求报文及 &lt;code&gt;HTTP&lt;/code&gt; 响应报文&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;报文分析&#34;&gt;报文分析&lt;/h3&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370f2e0d407f.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370f2e0d407f.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h4 id=&#34;http报文结构&#34;&gt;HTTP报文结构&lt;/h4&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370f173089a1.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370f173089a1.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h4 id=&#34;http请求报文&#34;&gt;HTTP请求报文&lt;/h4&gt;
&lt;h5 id=&#34;数据链路层-1&#34;&gt;数据链路层&lt;/h5&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370f44ce10f8.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370f44ce10f8.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h5 id=&#34;网络层-1&#34;&gt;网络层&lt;/h5&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370f585c0330.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370f585c0330.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h5 id=&#34;传输层-1&#34;&gt;传输层&lt;/h5&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370f5871b2b2.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370f5871b2b2.png&#34; alt=&#34;3&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h5 id=&#34;应用层-1&#34;&gt;应用层&lt;/h5&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370f670b78f0.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370f670b78f0.png&#34; alt=&#34;4&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Hypertext Transfer Protocol
    GET /Default.aspx HTTP/1.1\r\n
    Host: www.smartclass.cn\r\n
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.42\r\n
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\n
    Accept-Encoding: gzip, deflate\r\n
    Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6\r\n
    Upgrade-Insecure-Requests: 1\r\n
    \r\n
    [Full request URI: http://www.smartclass.cn/Default.aspx]
    [HTTP request 1/14]
    [Response in frame: 1787]
    [Next request in frame: 1804]
&lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;
&lt;li&gt;&lt;u&gt;请求行&lt;/u&gt;：由 &lt;code&gt;请求方法字段&lt;/code&gt;、&lt;code&gt;URL字段&lt;/code&gt; 和 &lt;code&gt;HTTP协议版本字段&lt;/code&gt; 组成，如 &lt;strong&gt;GET /Default.aspx HTTP/1.1&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;u&gt;请求头部&lt;/u&gt;：关键字/值对组成，每行一对
&lt;ol&gt;
&lt;li&gt;&lt;u&gt;Host&lt;/u&gt;：请求的主机名&lt;/li&gt;
&lt;li&gt;&lt;u&gt;User-Agent&lt;/u&gt;：发出请求的浏览器类型&lt;/li&gt;
&lt;li&gt;&lt;u&gt;Accept&lt;/u&gt;：客户端可识别的内容类型列表&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;u&gt;空行&lt;/u&gt;：最后一个请求头之后是一个空行，发送回车符和换行符，通知服务器以下不再有请求头&lt;/li&gt;
&lt;li&gt;&lt;u&gt;请求数据&lt;/u&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;http响应报文&#34;&gt;HTTP响应报文&lt;/h4&gt;
&lt;h5 id=&#34;传输层-2&#34;&gt;传输层&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;TCP 协议会分段传输过大的数据段（Segment）保证传输的性能&lt;/li&gt;
&lt;li&gt;TCP 协议引入了最大分段大小（Maximum segment size，MSS）这一概念，它是 TCP 数据段能够携带的数据上限。在正常情况下，TCP 连接的 MSS 是 MTU - 40 字节，即 1460 字节
&lt;ul&gt;
&lt;li&gt;MSS：一个网络包的最大长度，以太网中一般为 &lt;code&gt;1500&lt;/code&gt; 字节&lt;/li&gt;
&lt;li&gt;MTU：除去 IP 和 TCP 头部之后，一个网络包所能容纳的 TCP 数据的最大长度&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;该报文 MSS 值为 1360，数据段分成 8 份从服务端发出，并在客户端经过拼接后被接收

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370fb4c09aa8.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370fb4c09aa8.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;应用层-2&#34;&gt;应用层&lt;/h5&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/6370fdbf7eb46.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/6370fdbf7eb46.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Hypertext Transfer Protocol
    HTTP/1.1 200 OK\r\n
        [Expert Info (Chat/Sequence): HTTP/1.1 200 OK\r\n]
            [HTTP/1.1 200 OK\r\n]
            [Severity level: Chat]
            [Group: Sequence]
        Response Version: HTTP/1.1
        Status Code: 200
        [Status Code Description: OK]
        Response Phrase: OK
    Date: Sun, 13 Nov 2022 13:06:05 GMT\r\n
    Content-Type: text/html; charset=utf-8\r\n
    Content-Length: 9696\r\n
        [Content length: 9696]
    Connection: keep-alive\r\n
    Cache-Control: private\r\n
    Content-Encoding: gzip\r\n
    Vary: Accept-Encoding\r\n
    MANUFACTURER: Hanboer\r\n
    X-AspNet-Version: 4.0.30319\r\n
    X-UA-Compatible: IE=edge,chrome=1\r\n
    Access-Control-Allow-Headers: content-type\r\n
    Access-Control-Allow-Methods: GET,POST,PUT,DELETE,OPTIONS\r\n
    Access-Control-Allow-Origin: http://localhost:9527\r\n
    Access-Control-Allow-Credentials: true\r\n
    \r\n
    [HTTP response 1/14]
    [Time since request: 0.067102000 seconds]
    [Request in frame: 1776]
    [Next request in frame: 1804]
    [Next response in frame: 1806]
    [Request URI: http://www.smartclass.cn/Webapi/V1/Live/GetPublicLives?csrkToken=0aat6ee1aaks3&amp;amp;IsLiving=true&amp;amp;Sort=StartTime&amp;amp;Order=0&amp;amp;PageSize=8&amp;amp;PageNumber=1&amp;amp;attribute=]
    Content-encoded entity body (gzip): 9696 bytes -&amp;gt; 40818 bytes
    File Data: 40818 bytes
&lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;
&lt;li&gt;&lt;u&gt;状态行&lt;/u&gt;：由 &lt;code&gt;HTTP版本&lt;/code&gt; 、&lt;code&gt;状态码&lt;/code&gt; 和&lt;code&gt;原因短语&lt;/code&gt; 组成，如 &lt;strong&gt;HTTP/1.1 200 OK&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;u&gt;响应头部&lt;/u&gt;：关键字/值对组成，每行一对&lt;/li&gt;
&lt;li&gt;&lt;u&gt;空行&lt;/u&gt;：最后一个响应头之后是一个空行，发送回车符和换行符，通知服务器以下不再有响应头&lt;/li&gt;
&lt;li&gt;&lt;u&gt;响应正文&lt;/u&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;参考&#34;&gt;参考&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.51cto.com/yttitan/1734425&#34;&gt;Wireshark系列之4 捕获过滤器&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.51cto.com/u_13579643/3647795?articleABtest=0&#34;&gt;网络——Wireshark工具&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://juejin.cn/post/6844904066229747720&#34;&gt;WireShark的基本用法&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/lsdb/p/9254544.html&#34;&gt;Wireshark使用教程（界面说明、捕获过滤器表达式、显示过滤器表达式）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.freebuf.com/sectool/256745.html&#34;&gt;一文精讲Wireshark的抓包和分析&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://bbs.huaweicloud.com/blogs/285673&#34;&gt;Wireshark简明教程，新手专用，挑实在的讲，不搞花里胡哨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.51cto.com/u_15688254/5694733&#34;&gt;WireShark网络封包抓包工具各个界面介绍&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://codeantenna.com/a/2zI6hbfTIM&#34;&gt;实验3.利用Wireshark分析ARP协议&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/364195316&#34;&gt;如何计算IP或ICMP协议首部里的checksum字段&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.51cto.com/ccieh3c/2654283&#34;&gt;带你深入熟悉你所不知道的ICMP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaoqqi.github.io/2016/10/05/network-wireshark-arp/&#34;&gt;使用Wireshark学习网络协议之ICMP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/xiaolincoding/p/12922927.html&#34;&gt;实战！我用 Wireshark 让你“看见“ TCP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://xiaolincoding.com/network/3_tcp/tcp_interview.html&#34;&gt;4.1 TCP 三次握手与四次挥手面试题&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.51cto.com/u_15103025/2643297&#34;&gt;Wireshark抓包TCP三次握手&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rgb-24bit.github.io/blog/2019/tcp-connect-manage.html&#34;&gt;TCP 中的三次握手和四次挥手&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.csdn.net/u014117943/article/details/118520498&#34;&gt;Wireshark配合TCP调试工具理解TCP三次握手和四次挥手过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://juejin.cn/post/7034547558664011783&#34;&gt;老生常谈的TCP三次握手和四次挥手，你会了吗？&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/biyeymyhjob/archive/2012/07/28/2612910.html&#34;&gt;HTTP请求报文和HTTP响应报文&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://draveness.me/whys-the-design-tcp-segment-ip-packet/&#34;&gt;为什么 TCP/IP 协议会拆分数据&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.pianshen.com/article/86011166321/&#34;&gt;HTTP的曲折：网络请求到层层封装和终端拆分&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://segmentfault.com/a/1190000019788537&#34;&gt;浅谈http协议（三）：HTTP 报文及其结构&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.wireshark.org/docs/wsug_html_chunked/ChapterWork.html&#34;&gt;Wireshark官方文档&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
      <content:encoded><![CDATA[<h1 id="要求">要求</h1>
<ol>
<li>团队合作、合理分工、按组为单位进行</li>
<li>报告文字内容不可拷贝粘贴现有文献，应反映小组所做的工作，有分析，实践性的选题应有具体操作或者配置过程描述，辅以截图或实验数据</li>
<li>所交报告中应在最后注明组员分工、参考文献，报告字数3000-6000</li>
<li>不同班级的小组可选择相同的题目，但重复计数（由各班学委协调），不可多于3组，且报告内容不可相同，要求独立完成各组任务</li>
<li>除了个别综述性的选题，其它选题要求在实际平台上实践</li>
</ol>
<h1 id="选题">选题</h1>
<blockquote>
<p><strong>基于网络嗅探软件（wireshark）的协议分析实验</strong></p>
</blockquote>
<ol>
<li>Wireshark的深入学习与掌握，如过滤器的使用，归纳方法</li>
<li>通过实验阐述ARP的工作原理</li>
<li>利用实验结果分析ICMP协议的报文结构字段定义</li>
<li>基于实验数据深入分析TCP协议的连接过程原理，报文的分片等功能</li>
<li>从校园网发起向外网中某Web服务器的访问，记录并分析从MAC层协议、IP协议、TCP协议一直到HTTP协议的过程</li>
</ol>
<h1 id="基于网络嗅探软件wireshark的协议分析实验">基于网络嗅探软件Wireshark的协议分析实验</h1>
<h2 id="wireshark-是什么">Wireshark 是什么？</h2>
<blockquote>
<p><strong>Wirkshark 是一个功能十分强大的开源的网络数据包分析器，能够在多种平台上抓取和分析网络包</strong></p>
<p><strong>Wirkshark 可被用于检查安全问题和解决网络问题，也可供开发者调试协议的实现和学习网络协议的原理</strong></p>
<p><strong>Wireshark使用 Npcap or WinPcap 作为接口，直接与网卡进行数据报文交换</strong></p>
</blockquote>
<h2 id="wireshark-下载与安装">Wireshark 下载与安装</h2>
<p>官网地址：<a href="https://www.wireshark.org/">https://www.wireshark.org/</a>，直接点击下一步下一步安装即可

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636eef0324bca.png">
<img src="https://bu.dusays.com/2022/11/12/636eef0324bca.png" alt="1"  />
</a>
</div>


但是，我在安装过程中报了如下的错误：

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/11/636e699429bad.png">
<img src="https://bu.dusays.com/2022/11/11/636e699429bad.png" alt="npcap"  />
</a>
</div>


排查了好久，没找到合适的解决办法<br>
最后，下载 WinPcap 来代替 Npcap ，成功运行。</p>
<h2 id="wireshark-基本用法">Wireshark 基本用法</h2>
<blockquote>
<p>简单抓包基础步骤：选择捕获接口 -&gt; 获取网络实时痕迹 -&gt; 获取报文 -&gt; 深入解析</p>
</blockquote>
<hr>
<h3 id="选择接口网卡">选择接口（网卡）</h3>
<blockquote>
<p><strong>网络上传输的数据包需要经过网卡到达计算机，Wireshark可以捕获流经网卡的数据包</strong></p>
</blockquote>
<p>在使用Wireshark捕获数据前，先要选择捕获接口。一台计算机可能会有不止一个网卡，此时需要选择你要捕获数据的接口。</p>
<p>选择菜单栏上的 捕获-&gt;选项

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636eef03d463f.png">
<img src="https://bu.dusays.com/2022/11/12/636eef03d463f.png" alt="1"  />
</a>
</div>


选择想要捕获数据的接口后，点击开始

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636ef1eb47349.png">
<img src="https://bu.dusays.com/2022/11/12/636ef1eb47349.png" alt="2"  />
</a>
</div>

</p>
<h3 id="界面说明">界面说明</h3>
<p>开始捕获后，Wireshark会把捕获到的报文显示到界面上</p>
<ol>
<li><strong>显示过滤器</strong>用于设置过滤条件进行数据列表区数据过滤</li>
<li><strong>数据列表区</strong>展示的是Wireshark捕获到的所有数据包的列表，每个数据包包含 编号、时间戳、源地址、目标地址、协议、长度以及数据包信息</li>
<li><strong>数据详细区</strong>展示的是在数据列表区中选中的数据包的分协议展示
<ol>
<li><u>Frame</u>：物理层的数据帧概况</li>
<li><u>Ethernet II</u>：数据链路层以太网帧头部信息</li>
<li><u>Internet Protocol Version 4</u>： 互联网层IP包头部信息</li>
<li><u>Transmission Control Protocol</u>：传输层的数据段头部信息，此处是TCP</li>
</ol>
</li>
<li><strong>数据字节区</strong>展示的是选中的数据包的源数据。另外，在数据详细区选中的某层或某字段，对应的数据会在数据字节区中高亮

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636efb5f7ea6d.png">
<img src="https://bu.dusays.com/2022/11/12/636efb5f7ea6d.png" alt="1"  />
</a>
</div>

</li>
</ol>
<h3 id="过滤器设置">过滤器设置</h3>
<blockquote>
<p><strong>根据我们想要抓取的数据包，对过滤器进行设置。过滤掉冗余的数据包，找到我们需要的信息</strong></p>
</blockquote>
<h4 id="捕获过滤器">捕获过滤器</h4>
<blockquote>
<p><strong>捕获过滤器表达式作用在Wireshark捕获数据包之前，只捕获符合条件的数据包</strong></p>
<p><strong>当需要处理大量数据时，使用捕获过滤器可以节省大量资源</strong></p>
</blockquote>
<h5 id="界面说明-1">界面说明</h5>
<p>选择菜单栏上的 捕获-&gt;捕获过滤器

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636efe3d72678.png">
<img src="https://bu.dusays.com/2022/11/12/636efe3d72678.png" alt="1"  />
</a>
</div>


点击 <code>+</code> 即可添加新的过滤规则<br>
<code>Filter Name</code> 指代过滤器名称，用来给自己看该过滤器的过滤效果<br>
<code>Filter Expression</code> 指代过滤器表达式，需要使用 <code>Berkeley Packet Filter</code> 语法书写

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636efe3e2ce20.png">
<img src="https://bu.dusays.com/2022/11/12/636efe3e2ce20.png" alt="2"  />
</a>
</div>

</p>
<h5 id="语法规则">语法规则</h5>
<p>捕获过滤器使用 <code>BPF</code> 语法，表达式由多个原语组成：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>原语(primitives)：由名称或数字，以及描述它的多个限定词组成。  
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">*</span> 限定词(qualifiers)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">*</span> Types：设置数字或者名称所指示类型，例如host www.baidu.com，如果没有指定此值，则默认使用“host”关键字
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">*</span> host、post
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">*</span> net，设定子网， net 192.168.0.0 mask 255.255.255.0等价于net 192.168.0.0/24
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">*</span> port，设置端口范围，例如port 6000-8000
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">*</span> Dir：设置网络出入方向，例如dst port 80，如果没有特别指明来源或目的地，则默认使用“src or dst”作为关键字
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">*</span> src、dst、src or dst、src and dst(src：源端口，dst：目标端口)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">*</span> Proto：指定协议类型，例如udp，如果没有特别指明是什么协议，则默认使用所有支持的协议
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">*</span> ether、fddi、tr、wlan、ip、ip6、arp、rarp、decnet、tcp、udp、icmp、igmp、icmp、igrp、pim、ah、esp、vrrp
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">*</span> 其他
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">*</span> gateway：指明网关IP地址，等价于ether host &#39;ehost&#39; and not host &#39;host&#39;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">*</span> broadcast：广播报文，例如ether broadcast或者ip broadcast
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">*</span> multicast：多播报文，例如ip multicast或者ip6 multicast
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">*</span> less、greater：小于或者大于
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">*</span> 原语运算符
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">*</span> 与：<span style="color:#f00">&amp;&amp;</span>或者and
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">*</span> 或：||或者or
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">*</span> 非：!或者not
</span></span></code></pre></div><div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">转载自：https://juejin.cn/post/6844904066229747720 </div> 
<h5 id="应用示例">应用示例</h5>
<p>只抓取源端口或者目的端口范围6000到8000，并且是一个tcp协议或者ipv6的数据包</p>
<pre tabindex="0"><code>src or dst port 6000-8000 &amp;&amp; tcp or ip6    
</code></pre><p>只抓取IP地址为192.168.0.10的数据包</p>
<pre tabindex="0"><code>host 192.168.0.10
</code></pre><h4 id="显示过滤器">显示过滤器</h4>
<blockquote>
<p><strong>显示过滤器表达式作用在在Wireshark捕获数据包之后，从已捕获的所有数据包中显示出符合条件的数据包</strong></p>
</blockquote>
<p>显示过滤表达式在工具栏下方的“应用显示过滤器”输入框输入即可生效

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636f11a82564a.png">
<img src="https://bu.dusays.com/2022/11/12/636f11a82564a.png" alt="1"  />
</a>
</div>

</p>
<h5 id="基本过滤表达式">基本过滤表达式</h5>
<ol>
<li>一条基本的表达式由<strong>过滤项</strong>、<strong>过滤关系</strong>、<strong>过滤值</strong>三项组成</li>
<li>例如：<code>ip.addr == 192.168.1.1</code>，其中 <code>ip.addr</code> 为过滤项，<code>==</code> 为过滤关系，<code>192.168.1.1</code> 为过滤值。</li>
<li>该表达式的意思是 <strong>找出所有ip协议中源或目标ip等于192.168.1.1的数据包</strong></li>
</ol>
<h6 id="过滤项">过滤项</h6>
<ol>
<li>Wireshark的过滤项是 <code>协议.协议字段</code> 的模式，Wireshark支持的全部协议及协议字段可查看<a href="https://www.wireshark.org/docs/dfref/">官方说明</a>。</li>
<li>以端口为例，端口出现于tcp协议中。所以有端口这个过滤项且其写法就是tcp.port</li>
<li>Wireshark出于缩减长度的原因，有些字段没有使用协议规定的名称而是使用简写，比如Destination Port在Wireshark中写为dstport</li>
<li>Wireshark出于简便使用的原因，增加了一些协议中没有的字段，比如tcp协议只有源端口和目标端口字段，为了简便使用Wireshark增加了tcp.port来同时代表这两个字段</li>
<li>实际使用时我们输入<code>协议.</code>后Wireshark就会有支持的字段提示</li>
</ol>
<h6 id="过滤关系">过滤关系</h6>
<p>过滤关系指的是大于、等于、小于等等式关系，具体可以看<a href="https://www.wireshark.org/docs/wsug_html/#DispCompOps">官方给出的表</a>

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636f11ecb35db.png">
<img src="https://bu.dusays.com/2022/11/12/636f11ecb35db.png" alt="1"  />
</a>
</div>

</p>
<h6 id="过滤值">过滤值</h6>
<p>过滤值就是设定的过滤项应该满足过滤关系的标准，比如500、5000、50000等等。<br>
过滤值的写法一般已经被过滤项和过滤关系设定好了，只是填下自己的期望值就可以了。</p>
<h5 id="复合过滤表达式">复合过滤表达式</h5>
<p>所谓复合过滤表达示，就是指由多条基本过滤表达式组合而成的表达示。<br>
基本过滤表达式的写法还是不变的，复合过滤表达示多出来的东西就只是基本过滤表达示的“连接词”，我们依然直接参照<a href="https://www.wireshark.org/docs/wsug_html/#FiltLogOps">官方给出的表</a>

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636f11cc4be71.png">
<img src="https://bu.dusays.com/2022/11/12/636f11cc4be71.png" alt="1"  />
</a>
</div>

</p>
<h5 id="常见显示过滤需求及其对应表达式">常见显示过滤需求及其对应表达式</h5>
<h6 id="数据链路层">数据链路层</h6>
<pre tabindex="0"><code>筛选mac地址为04:f9:38:ad:13:26的数据包----eth.src == 04:f9:38:ad:13:26

筛选源mac地址为04:f9:38:ad:13:26的数据包----eth.src == 04:f9:38:ad:13:26
</code></pre><h6 id="网络层">网络层</h6>
<pre tabindex="0"><code>筛选ip地址为192.168.1.1的数据包----ip.addr == 192.168.1.1

筛选192.168.1.0网段的数据---- ip contains &#34;192.168.1&#34;

筛选192.168.1.1和192.168.1.2之间的数据包----ip.addr == 192.168.1.1 &amp;&amp; ip.addr == 192.168.1.2

筛选从192.168.1.1到192.168.1.2的数据包----ip.src == 192.168.1.1 &amp;&amp; ip.dst == 192.168.1.2
</code></pre><h6 id="传输层">传输层</h6>
<pre tabindex="0"><code>筛选tcp协议的数据包----tcp

筛选除tcp协议以外的数据包----!tcp

筛选端口为80的数据包----tcp.port == 80

筛选12345端口和80端口之间的数据包----tcp.port == 12345 &amp;&amp; tcp.port == 80

筛选从12345端口到80端口的数据包----tcp.srcport == 12345 &amp;&amp; tcp.dstport == 80
</code></pre><h6 id="应用层">应用层</h6>
<pre tabindex="0"><code>特别说明----http中http.request表示请求头中的第一行（如GET index.jsp HTTP/1.1），http.response表示响应头中的第一行（如HTTP/1.1 200 OK），其他头部都用http.header_name形式。

筛选url中包含.php的http数据包----http.request.uri contains &#34;.php&#34;

筛选内容包含username的http数据包----http contains &#34;username&#34;
</code></pre><h2 id="通过实验阐述arp的工作原理">通过实验阐述ARP的工作原理</h2>
<blockquote>
<p><strong>ARP即地址解析协议（Address Resolution Protocol），是根据IP地址获取MAC地址的一个TCP/IP协议</strong></p>
<p><strong>ARP用于解决同一个局域网上的主机或路由器的IP地址和MAC地址的映射问题</strong></p>
<p><strong>每一台主机都设有一个 ARP高速缓存，里面存有 本局域网上 各主机和路由器的IP地址到MAC地址的映射表</strong></p>
</blockquote>
<h3 id="arp工作流程">ARP工作流程</h3>
<ol>
<li>当主机A要向<strong>本局域网</strong>上的某台主机B发送IP数据报时，就现在其ARP高速缓存中查找有无主机B的IP地址。若有，查出其对应的MAC地址，写入MAC帧；若没有，进行下述步骤</li>
<li>主机A的ARP进程在本局域网上广播一个ARP请求分组，其中有自己的IP地址到MAC地址的映射</li>
<li>本局域网上的所有主机运行的ARP进程都收到此ARP请求分组</li>
<li>主机B的IP地址与ARP请求分组中要查询的IP地址一致，就收下这个ARP请求分组，将主机A的MAC映射写入自己的ARP高速缓存，并向主机A发送ARP响应分组，同时在这个ARP响应分组中写入自己的MAC地址。由于其余所有主机的IP地址都与ARP请求分组中要查询的IP地址不一致，因此不理睬</li>
<li>主机A收到主机B的ARP响应分组后，就在其ARP高速缓存中写入主机B的IP地址到MAC地址的映射</li>
</ol>
<h3 id="实验步骤及内容">实验步骤及内容</h3>
<blockquote>
<p><strong>主机A</strong></p>
<p><strong>IP地址：192.168.31.248</strong></p>
<p><strong>MAC地址：c0:3c:59:5e:37:47</strong></p>
<p><strong>主机B</strong></p>
<p><strong>IP地址：192.168.31.186</strong></p>
<p><strong>MAC地址：28:7f:cf:12:af:89</strong></p>
</blockquote>
<h4 id="arp命令练习">ARP命令练习</h4>
<ol>
<li>在<code>cmd</code>中使用<code>ipconfig/all</code>命令，查看自己的IP地址和MAC地址，同时让小组成员连接同一个<code>WIFI</code>执行相同的操作并记录</li>
</ol>
<center> 
	<img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://bu.dusays.com/2022/11/12/636f62756d2e9.png">
	<br>
	<div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">主机A IP地址和MAC地址</div> 
 </center>
<center> 
	<img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://bu.dusays.com/2022/11/12/636f6331a7d39.png">
	<br>
	<div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">主机B IP地址和MAC地址</div> 
 </center>
<ol start="2">
<li>主机A使用<code>arp -a</code>查看ARP缓存表

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636f603bde062.png">
<img src="https://bu.dusays.com/2022/11/12/636f603bde062.png" alt="1"  />
</a>
</div>

</li>
<li>主机A通过<code>ping</code>主机B的IP来添加动态ARP缓存表数据

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636f60cfe4604.png">
<img src="https://bu.dusays.com/2022/11/12/636f60cfe4604.png" alt="2"  />
</a>
</div>


我在<code>ping</code>主机B<code>ip</code>地址时碰到<strong>请求超时</strong>的问题。<br>
经排查，是因为windows防火墙默认设置的是不让别人ping通，通过修改防火墙相关设置解决了该问题。<br>
<strong>步骤：控制面板 →  系统和安全 → Windows防火墙 → 高级设置 → 入站规则 → 文件和打印机共享（回显请求 - ICMPv4-In）设置为启用</strong></li>
<li>主机A使用<code>arp -a</code>查看ARP缓存表，发生新增一条数据

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636f6169b6f50.png">
<img src="https://bu.dusays.com/2022/11/12/636f6169b6f50.png" alt="3"  />
</a>
</div>

</li>
<li>以管理员身份运行<code>cmd</code>，执行<code>arp -d *</code>，删除缓存信息

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/12/636f62661400d.png">
<img src="https://bu.dusays.com/2022/11/12/636f62661400d.png" alt="4"  />
</a>
</div>

</li>
</ol>
<h4 id="抓包分析arp协议">抓包分析ARP协议</h4>
<h5 id="当arp缓存对应数据为空时">当ARP缓存对应数据为空时</h5>
<h6 id="实验步骤">实验步骤</h6>
<ol>
<li>主机A执行<code>arp -d *</code>，删除缓存信息</li>
<li>主机A运行Wireshark，设置显示过滤器表达式为<code>arp.dst.proto_ipv4 == 192.168.31.186 and arp.src.proto_ipv4 == 192.168.31.248 or icmp </code></li>
<li>主机A<code>ping</code>主机B的<code>ip地址</code></li>
</ol>
<h6 id="结果分析">结果分析</h6>
<ol>
<li>主机A将自己的<code>ip地址 192.168.31.248</code> &amp; <code>MAC地址 c0:3c:59:5e:37:47</code>写入请求分组，并将<code>目的ip地址</code>设置为<code>192.168.31.186</code>，<code>目的MAC地址</code>设置为<code>00:00:00:00:00:00</code>，对本局域网内的所有主机进行广播</li>
</ol>
<center> 
	<img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://bu.dusays.com/2022/11/12/636f8f33f1a20.png">
	<br>
	<div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">主机A发出的ARP请求分组</div> 
 </center>
<ol start="2">
<li>主机B收下这个ARP请求分组，将主机A的MAC映射写入自己的ARP高速缓存，并向主机A发送ARP响应分组，同时在这个ARP响应分组中写入自己的MAC地址，即<code>28:7f:cf:12:af:89</code></li>
<li>主机A收到主机B的ARP响应分组后，就在其ARP高速缓存中写入主机B的IP地址到MAC地址的映射</li>
</ol>
<center> 
	<img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://bu.dusays.com/2022/11/12/636f8e7d3f758.png">
	<br>
	<div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">主机A收到的来自主机B的ARP响应分组</div> 
 </center>
<center> 
	<img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://bu.dusays.com/2022/11/12/636f8ea2d8434.png">
	<br>
	<div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">主机A的ARP高速缓存表</div> 
 </center>
<h5 id="当arp缓存对应数据不为空时">当ARP缓存对应数据不为空时</h5>
<h6 id="实验步骤-1">实验步骤</h6>
<ol>
<li>主机A运行Wireshark，设置显示过滤器表达式为<code>arp.dst.proto_ipv4 == 192.168.31.186 and arp.src.proto_ipv4 == 192.168.31.248 or icmp</code></li>
<li>主机A <code>ping</code>主机B的<code>ip地址</code></li>
</ol>
<h6 id="结果分析-1">结果分析</h6>
<p>主机A没有发出<code>ARP</code>请求，而主机B接受到了主机A的ICMP报文，说明主机A直接使用了高速缓存区内的对应数据，而没有发出广播</p>
<center> 
	<img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://bu.dusays.com/2022/11/12/636f910b7f31d.png">
	<br>
	<div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">主机A发出的报文</div> 
 </center>
<h2 id="利用实验结果分析icmp协议的报文结构字段定义">利用实验结果分析ICMP协议的报文结构字段定义</h2>
<blockquote>
<p><strong>ICMP即互联网控制报文协议（Internet Control Message Protocol），网络设备（包括路由器）使用它来发送错误消息和指示与另一个IP 地址通信时成功或失败的操作信息</strong></p>
</blockquote>
<center> 
	<img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://bu.dusays.com/2022/11/12/636fbbc74f13c.png">
	<br>
	<div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">ICMP报文结构</div> 
 </center>
<h3 id="icmp报文格式">ICMP报文格式</h3>
<pre tabindex="0"><code>+0------7-------15---------------31
|  Type | Code  |    Checksum    |
+--------------------------------+
|          Message Body          |
|        (Variable length)       |
+--------------------------------+
</code></pre><h3 id="icmp报文格式解释">ICMP报文格式解释</h3>
<ol>
<li><u>Type</u>：占一个字节，标识ICMP报文的类型，可以分为差错报告报文和询问报文两大类</li>
<li><u>Code</u>：占一个字节，用于进一步区分某种类型中的不同情况</li>
<li><u>Checksum</u>：占两个字节，检验报文在传输过程中是否出现差错</li>
</ol>
<h3 id="icmp应用举例">ICMP应用举例</h3>
<h4 id="ping命令">Ping命令</h4>
<blockquote>
<p><strong>「ping」是用来探测本机与网络中另一主机之间是否可达的命令</strong></p>
</blockquote>
<p>在此次实验中，使用主机A在<code>cmd</code>环境下<code>ping baidu.com</code>，分析回送请求报文和回送回答报文</p>
<h5 id="回送请求报文">回送请求报文</h5>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63702d8239c61.png">
<img src="https://bu.dusays.com/2022/11/13/63702d8239c61.png" alt="1"  />
</a>
</div>

</p>
<pre tabindex="0"><code>Internet Control Message Protocol
    Type: 8 (Echo (ping) request)
    Code: 0
    Checksum: 0x4ae9 [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 626 (0x0272)
    Sequence Number (LE): 29186 (0x7202)
    [Response frame: 215]
    Data (32 bytes)
        Data: 6162636465666768696a6b6c6d6e6f7071727374757677616263646566676869
        [Length: 32]
</code></pre><ol>
<li>Type的值为 <strong>8</strong>，Code的值为 <strong>0</strong>，表示回显请求</li>
<li>Checksum的值为 <strong>0x4ae9</strong>，这里校验和验证正确</li>
<li><u>Identifier</u>：识别码，用于区分不同进程的应用。由于Window系统与Linux系统发出的ping报文的字节序不一样，所以需要 <strong>BE</strong> 和 <strong>LE</strong> 两个值，而这两个值所表示的十六进制值（HEX）是相同的。这里的 <strong>BE</strong> 指的是大端字节序，在Linux中使用；<strong>LE</strong>指的是小端字节序，在Windows中使用</li>
<li><u>Sequence Number</u>：序列号，用于对应请求与响应。这里对于 <strong>BE</strong> 和 <strong>LE</strong> 解释同上。</li>
</ol>
<h5 id="回送回答报文">回送回答报文</h5>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63702d83032ff.png">
<img src="https://bu.dusays.com/2022/11/13/63702d83032ff.png" alt="2"  />
</a>
</div>

</p>
<pre tabindex="0"><code>Internet Control Message Protocol
    Type: 0 (Echo (ping) reply)
    Code: 0
    Checksum: 0x52e9 [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 626 (0x0272)
    Sequence Number (LE): 29186 (0x7202)
    [Request frame: 213]
    [Response time: 20.855 ms]
    Data (32 bytes)
        Data: 6162636465666768696a6b6c6d6e6f7071727374757677616263646566676869
        [Length: 32]
</code></pre><ol>
<li>Type的值为 <strong>0</strong>，Code的值为 <strong>0</strong>，表示回送回答</li>
<li>Checksum的值为 <strong>0x52e9</strong>，这里校验和验证正确</li>
<li><u>Identifier</u>：识别码，用于区分不同进程的应用</li>
<li><u>Sequence Number</u>：序列号，用于对应请求与响应。这里的值 <strong>626</strong> 同上文 <strong>回送请求报文</strong> <code>Sequence Number</code> 的值，说明这俩请求和响应是对应的</li>
</ol>
<h4 id="tracert命令">Tracert命令</h4>
<blockquote>
<p><strong>「Tracert」是用来显示可能的路由（路径）和测量数据包在 IP 网络中的传输延迟的命令</strong></p>
</blockquote>
<p>在此次实验中，使用主机A在<code>cmd</code>环境下<code>tracert baidu.com</code>，分析报文</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63703bc9a2bf1.png">
<img src="https://bu.dusays.com/2022/11/13/63703bc9a2bf1.png" alt="1"  />
</a>
</div>

</p>
<h5 id="差错报告报文">差错报告报文</h5>
<p>ICMP的差错报告报文中，会把收到的需要进行差错报告的IP的数据提取出来作为ICMP报文的数据部分</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63703c4b4a1e1.png">
<img src="https://bu.dusays.com/2022/11/13/63703c4b4a1e1.png" alt="2"  />
</a>
</div>

</p>
<pre tabindex="0"><code>Internet Protocol Version 4, Src: 192.168.31.248, Dst: 110.242.68.66
    0100 .... = Version: 4
    .... 0101 = Header Length: 20 bytes (5)
    Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)
        0000 00.. = Differentiated Services Codepoint: Default (0)
        .... ..00 = Explicit Congestion Notification: Not ECN-Capable Transport (0)
    Total Length: 92
    Identification: 0x1f2e (7982)
    000. .... = Flags: 0x0
        0... .... = Reserved bit: Not set
        .0.. .... = Don&#39;t fragment: Not set
        ..0. .... = More fragments: Not set
    ...0 0000 0000 0000 = Fragment Offset: 0
    Time to Live: 1
        [Expert Info (Note/Sequence): &#34;Time To Live&#34; only 1]
            [&#34;Time To Live&#34; only 1]
            [Severity level: Note]
            [Group: Sequence]
    Protocol: ICMP (1)
    Header Checksum: 0x0000 [validation disabled]
    [Header checksum status: Unverified]
    Source Address: 192.168.31.248
    Destination Address: 110.242.68.66

Internet Control Message Protocol
    Type: 8 (Echo (ping) request)
    Code: 0
    Checksum: 0xf4e4 [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 794 (0x031a)
    Sequence Number (LE): 6659 (0x1a03)
    [No response seen]
        [Expert Info (Warning/Sequence): No response seen to ICMP request]
            [No response seen to ICMP request]
            [Severity level: Warning]
            [Group: Sequence]
    Data (64 bytes)
        Data: 000000000000000000000000000000000000000000000000000000000000000000000000…
        [Length: 64]
</code></pre><p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63703c4c1fe7e.png">
<img src="https://bu.dusays.com/2022/11/13/63703c4c1fe7e.png" alt="3"  />
</a>
</div>

</p>
<pre tabindex="0"><code>Internet Control Message Protocol
    Type: 11 (Time-to-live exceeded)
    Code: 0 (Time to live exceeded in transit)
    Checksum: 0xf4ff [correct]
    [Checksum Status: Good]
    Unused: 00000000
    Internet Protocol Version 4, Src: 192.168.31.248, Dst: 110.242.68.66
        0100 .... = Version: 4
        .... 0101 = Header Length: 20 bytes (5)
        Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)
            0000 00.. = Differentiated Services Codepoint: Default (0)
            .... ..00 = Explicit Congestion Notification: Not ECN-Capable Transport (0)
        Total Length: 92
        Identification: 0x1f2e (7982)
        000. .... = Flags: 0x0
            0... .... = Reserved bit: Not set
            .0.. .... = Don&#39;t fragment: Not set
            ..0. .... = More fragments: Not set
        ...0 0000 0000 0000 = Fragment Offset: 0
        Time to Live: 1
            [Expert Info (Note/Sequence): &#34;Time To Live&#34; only 1]
                [&#34;Time To Live&#34; only 1]
                [Severity level: Note]
                [Group: Sequence]
        Protocol: ICMP (1)
        Header Checksum: 0x069f [validation disabled]
        [Header checksum status: Unverified]
        Source Address: 192.168.31.248
        Destination Address: 110.242.68.66
    Internet Control Message Protocol
        Type: 8 (Echo (ping) request)
        Code: 0
        Checksum: 0xf4e4 [unverified] [in ICMP error packet]
        [Checksum Status: Unverified]
        Identifier (BE): 1 (0x0001)
        Identifier (LE): 256 (0x0100)
        Sequence Number (BE): 794 (0x031a)
        Sequence Number (LE): 6659 (0x1a03)
        Data (64 bytes)
            Data: 000000000000000000000000000000000000000000000000000000000000000000000000…
            [Length: 64]
</code></pre><ol>
<li>Type的值为 <strong>11</strong>，Code的值为 <strong>0</strong>，表示超时报错</li>
<li>图1的<strong>回送请求报文</strong>出错，图2相对应的<strong>差错报告报文</strong>，把图1报文的IP数据报的首部和数据字段的前8个字节提取出来，作为ICMP报文的数据字段</li>
</ol>
<h2 id="基于实验数据深入分析tcp协议功能">基于实验数据深入分析TCP协议功能</h2>
<blockquote>
<p><strong>TCP即传输控制协议（Transmission Control Protocol），是面向连接的运输层协议</strong></p>
</blockquote>
<h3 id="tcp报文格式">TCP报文格式</h3>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63704be4d65f3.png">
<img src="https://bu.dusays.com/2022/11/13/63704be4d65f3.png" alt="1"  />
</a>
</div>

</p>
<h3 id="tcp报文格式解释">TCP报文格式解释</h3>
<ol>
<li><u>源端口</u>和<u>目的端口</u>：各占 2 字节，和 IP 头部的 <strong>源地址</strong> 和 <strong>目的地址</strong> 一起唯一地标识了每个连接</li>
<li><u>序列号</u>：占 4 字节，TCP连接中传送的数据流中的<strong>每一个字节都按顺序编号</strong>，序号字段的值指的是<strong>本报文段</strong>所发送的数据的第一个字节的序号</li>
<li><u>确认号</u>：占 4 字节，是期望收到对方的下一个报文段的数据的第一个字节的序号</li>
<li><u>数据偏移</u>：占 4 位，它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远，实际是指出TCP报文段的首部长度</li>
<li><u>保留</u>：占 6 位，保留为今后使用，默认置0</li>
<li><u>紧急 URG(URGent)</u>：当 URG = 1 时，表明紧急指针字段有效。它告诉系统此报文段中有紧急数据，应尽快传送(相当于高优先级的数据)</li>
<li><u>确认 ACK(ACKnowledegment)</u>：只有当 ACK = 1 时确认号字段有效，当 ACK = 0 时确认号无效</li>
<li><u>推送 PSH(PuSH)</u>：接收 TCP 收到 PSH = 1 的报文段，就尽快地交付接收应用进程，不再等到整个缓存都填满了后再向上交付</li>
<li><u>复位 RST(ReSeT)</u>：当 RST = 1 时，表明 TCP 连接中出现严重差错（如由于主机崩溃或其他原因）必须释放连接，然后再重新建立运输连接。RST置1还用来拒绝一个非法报文或拒绝打开一个连接</li>
<li><u>同步 SYN(SYNchronization)</u>：在连接建立时用来同步序号。当 SYN = 1 而 ACK = 0 时，表明这是一个连接请求报文段。对方若同意建立连接，则在响应的报文段中使 SYN = 1 和 ACK = 1</li>
<li><u>终止 FIN(FINish)</u>：用来释放一个连接。FIN = 1 表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。</li>
<li><u>窗口</u>：占 2 字节，指的是发送本报文段的一方的<strong>接收窗口</strong>。用于流量控制，指示接收方愿意接收的字节数量</li>
<li><u>检验和</u>：占 2 字节，检验和字段检验的范围包括TCP首部和数据这两部分。在计算检验和时，要在 TCP 报文段的前面加上 12 字节的伪首部</li>
<li><u>选项</u>：长度可变，最长可达 40 字节。如 <strong>最长报文段长度MSS</strong>、<strong>窗口扩大</strong>选项、<strong>时间戳</strong>选项等等</li>
<li><u>填充字段</u>：仅仅是为了使整个TCP首部长度为 4 字节的整数倍</li>
</ol>
<h3 id="实验步骤-2">实验步骤</h3>
<ol>
<li>下载 <a href="https://files.cnblogs.com/files/ggll611928/TCP-UDP-Socket%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7-v2.2.rar">TCP/UDP Socket 调试工具</a>

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370874b20e3e.png">
<img src="https://bu.dusays.com/2022/11/13/6370874b20e3e.png" alt="1"  />
</a>
</div>

</li>
<li>在<code>cmd</code>中<code>ping zhihu.com</code>，得到<code>ip地址</code>为<code>103.41.167.234</code>

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637087b2b3a4b.png">
<img src="https://bu.dusays.com/2022/11/13/637087b2b3a4b.png" alt="2"  />
</a>
</div>

</li>
<li>使用TCP调试工具，创建一个连接

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370887550c8b.png">
<img src="https://bu.dusays.com/2022/11/13/6370887550c8b.png" alt="3"  />
</a>
</div>

</li>
<li>打开Wireshark，设置显示过滤器为 <code>ip.addr == 103.41.167.234</code>

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637088cda466f.png">
<img src="https://bu.dusays.com/2022/11/13/637088cda466f.png" alt="4"  />
</a>
</div>

</li>
<li>在TCP调试工具中，点击 <strong>连接</strong>

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63708928070a7.png">
<img src="https://bu.dusays.com/2022/11/13/63708928070a7.png" alt="5"  />
</a>
</div>

</li>
<li>在TCP调试工具中，发送数据 <code>Hello World!!!</code>后，连接自动断开

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63708c752ff6b.png">
<img src="https://bu.dusays.com/2022/11/13/63708c752ff6b.png" alt="6"  />
</a>
</div>

</li>
<li>在Wireshark中捕获到以下数据包

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63708cca0d6f9.png">
<img src="https://bu.dusays.com/2022/11/13/63708cca0d6f9.png" alt="7"  />
</a>
</div>

</li>
</ol>
<h3 id="三次握手">三次握手</h3>
<blockquote>
<p><strong>三次握手目的是保证双方都有发送和接收的能力</strong></p>
</blockquote>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637052e140268.png">
<img src="https://bu.dusays.com/2022/11/13/637052e140268.png" alt="1"  />
</a>
</div>

</p>
<ul>
<li>一开始，客户端和服务端都处于 <code>CLOSE</code> 状态。先是服务端主动监听某个端口，处于 <code>LISTEN</code> 状态</li>
<li>客户端随机初始化 <strong>序列号 seq</strong> 为 <strong>x</strong>，同时把 <strong>SYN</strong> 置1，接着把报文发送给服务端。之后，TCP客户端进入 <code>SYN-SENT</code> 状态

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637090318e9b1.png">
<img src="https://bu.dusays.com/2022/11/13/637090318e9b1.png" alt="1"  />
</a>
</div>

</li>
<li>服务器收到连接请求报文段后，若同意连接，将进行下述操作。首先，随机初始化自己的 <strong>序列号 seq</strong> 为 <strong>y</strong>，其次把 <strong>确认号 ack</strong> 置为 <strong>x + 1</strong>，接着 <strong>SYN</strong> 和 <strong>ACK</strong> 均置为1，最后把该报文发给客户端。这时，服务端进入<code>SYN-RCVD</code> 状态

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370903f2af73.png">
<img src="https://bu.dusays.com/2022/11/13/6370903f2af73.png" alt="2"  />
</a>
</div>

</li>
<li>客户端收到服务端报文后，还要向服务端回应最后一个应答报文。首先将应答报文的 <strong>ACK</strong> 置为1，<strong>确认号 ack</strong> 置为 <strong>y + 1</strong>，<strong>序列号 seq</strong> 置为 <strong>x + 1</strong>，最后把报文发送给服务端。之后，客户端处于<code>ESTABLISHED</code> 状态，因为它一收一发了

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/63709042a0303.png">
<img src="https://bu.dusays.com/2022/11/13/63709042a0303.png" alt="3"  />
</a>
</div>

</li>
<li>服务端收到客户端的应答报文后，也进入 <code>ESTABLISHED</code> 状态，因为它也一收一发了</li>
</ul>
<h3 id="四次挥手">四次挥手</h3>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637055a33c4fe.png">
<img src="https://bu.dusays.com/2022/11/13/637055a33c4fe.png" alt="1"  />
</a>
</div>

</p>
<ul>
<li>客户端打算关闭连接，此时会发送一个 TCP 首部 <code>FIN</code> 标志位被置为 <code>1</code> 的报文并指明自己当前的 <strong>序列号 seq</strong> 为 <strong>u</strong>，之后客户端进入 <code>FIN_WAIT_1</code> 状态

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637095cced990.png">
<img src="https://bu.dusays.com/2022/11/13/637095cced990.png" alt="1"  />
</a>
</div>

</li>
<li>服务端收到该报文后，就向客户端发送 <code>ACK</code> 应答报文，指明自己当前的 <strong>序列号 seq</strong> 为 <strong>v</strong>， <strong>确认号 ack</strong> 为 <strong>u + 1</strong>，接着服务端进入 <code>CLOSE_WAIT</code> 状态

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637095cf921e9.png">
<img src="https://bu.dusays.com/2022/11/13/637095cf921e9.png" alt="2"  />
</a>
</div>

</li>
<li>客户端收到服务端的 <code>ACK</code> 应答报文后，之后进入 <code>FIN_WAIT_2</code> 状态</li>
<li>等待服务端处理完数据后，也向客户端发送 <code>FIN</code> 报文，报文的 <code>ACK</code> 置为 <code>1</code>，<strong>序列号 seq</strong> 为 <strong>w</strong>， <strong>确认号 ack</strong> 为 <strong>u + 1</strong>，之后服务端进入 <code>LAST_ACK</code> 状态

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637095d1574be.png">
<img src="https://bu.dusays.com/2022/11/13/637095d1574be.png" alt="3"  />
</a>
</div>

</li>
<li>客户端收到服务端的 <code>FIN</code> 报文后，回一个 <code>ACK</code> 应答报文，其中 <strong>序列号 seq</strong> 为 <strong>u + 1</strong>， <strong>确认号 ack</strong> 为 <strong>w + 1</strong>，之后进入 <code>TIME_WAIT</code> 状态

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637095d2df5ff.png">
<img src="https://bu.dusays.com/2022/11/13/637095d2df5ff.png" alt="4"  />
</a>
</div>

</li>
<li>服务端收到了 <code>ACK</code> 应答报文后，就进入了 <code>CLOSE</code> 状态，至此服务端已经完成连接的关闭</li>
<li>客户端在经过 <code>2MSL</code> 一段时间后，自动进入 <code>CLOSE</code> 状态，至此客户端也完成连接的关闭</li>
</ul>
<h2 id="访问外网某服务器分析从mac层协议ip协议tcp协议一直到http协议的过程">访问外网某服务器，分析从MAC层协议、IP协议、TCP协议一直到HTTP协议的过程</h2>
<h3 id="网络包的旅途">网络包的旅途</h3>
<ol>
<li>用户输入网址</li>
<li>浏览器解析网址，生成 HTTP 消息</li>
<li>在发送 HTTP 消息给 Web 服务器之前，浏览器先向 DNS 服务器发送请求，查询与服务器域名相对应的 IP 地址</li>
<li>通过 DNS 获取到 IP 后，浏览器把 HTTP 消息转交给 Socket 库</li>
<li>Socket 库将收到的 HTTP 消息作为数据转交给协议栈</li>
<li>TCP 按照网络包的长度对数据进行拆分，在每个包前面加上 TCP 头部并转交给 IP</li>
<li>IP 在 TCP 包前面加上 IP 头部（目的 IP 为 Web 服务器 IP 地址，源 IP 为主机 IP 地址），IP 包生成后参考路由控制表决定接受此 IP 包的路由或主机的 IP 地址。随后，IP 包将被发送给连接这些路由器或主机网络接口的驱动程序</li>
<li>如果尚不知道下一跳接收端的 MAC 地址，可以利用 ARP 查找，加上 MAC 头部，然后将包转交给网卡驱动</li>
<li>网卡驱动收到 IP 模块发来的包，将其转交给网卡并发出发送指令</li>
<li>网卡检查以太网的可发送状态，将数字信息转换为电信号发送出去</li>
<li>服务端的局域网中有防火墙，对进入的包进行检查，判断是否允许通过</li>
<li>Web 服务器前面有如果有缓存服务器，会拦截通过防火墙的包如果用户请求的页面已经缓存在服务器上，则代替服务器向用户返回页面数据</li>
<li>如果请求的页面没有被缓存，缓存服务器会将请求转发给 Web 服务器</li>
<li>Web 服务器收到包后，网卡和网卡驱动会接收这个包并转交给协议栈</li>
<li>协议栈依次检查 IP 头部和 TCP 头部，如果没有问题则取出 HTTP 的数据块并进行组装</li>
<li>HTTP 消息恢复成原始状态，然后通过 Socket 库转交给 Web 服务器</li>
<li>Web 服务器分析 HTTP 消息的内容，并根据请求内容将读取的数据返回给客户端</li>
<li>浏览器接收到响应包后，进行页面的渲染</li>
<li>HTTP请求结束，TCP连接断开

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/15/6372e99613b66.jpg">
<img src="https://bu.dusays.com/2022/11/15/6372e99613b66.jpg" alt="1"  />
</a>
</div>

</li>
</ol>
<h3 id="dns">DNS</h3>
<h4 id="dns报文结构">DNS报文结构</h4>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370b7a2baa6b.png">
<img src="https://bu.dusays.com/2022/11/13/6370b7a2baa6b.png" alt="1"  />
</a>
</div>

</p>
<h4 id="dns查询步骤">DNS查询步骤</h4>
<p>浏览器在解析域名时，会经过下列步骤：</p>
<ol>
<li>浏览器会先看自身有没有对这个域名的缓存，如果有，就直接返回；如果没有，就去问操作系统</li>
<li>操作系统也会去看自己的缓存，如果有，就直接返回；如果没有，再去 Hosts 文件看</li>
<li>本地的 Hosts 文件，若有域名和 IP 地址的对应关系，直接使用该 IP 地址通信；如果没有，浏览器向本地域名服务器发出一个查询请求</li>
<li>本地域名服务器查看有无缓存记录。若有，直接响应；若没有，本地域名服务器向根域名服务器查询</li>
<li>根域名服务器响应本地域名服务器，给出对应域名的顶级域名服务器IP地址，让本地域名服务器去向其查询</li>
<li>顶级域名服务器响应本地域名服务器，给出对应域名的权威域名服务器（权威 DNS 服务器，它是域名解析结果的原出处）IP地址，让本地域名服务器去向其查询</li>
<li>权威 DNS 服务器查询后将对应的 IP 地址告诉本地 DNS 服务器</li>
<li>本地 DNS 将 IP 地址返回给客户端，客户端和目标建立连接</li>
</ol>
<h3 id="实验步骤-3">实验步骤</h3>
<ol>
<li>访问<code>http://www.smartclass.cn/Default.aspx</code></li>
<li>分析 <code>HTTP</code> 请求报文及 <code>HTTP</code> 响应报文</li>
</ol>
<h3 id="报文分析">报文分析</h3>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370f2e0d407f.png">
<img src="https://bu.dusays.com/2022/11/13/6370f2e0d407f.png" alt="1"  />
</a>
</div>

</p>
<h4 id="http报文结构">HTTP报文结构</h4>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370f173089a1.png">
<img src="https://bu.dusays.com/2022/11/13/6370f173089a1.png" alt="1"  />
</a>
</div>

</p>
<h4 id="http请求报文">HTTP请求报文</h4>
<h5 id="数据链路层-1">数据链路层</h5>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370f44ce10f8.png">
<img src="https://bu.dusays.com/2022/11/13/6370f44ce10f8.png" alt="1"  />
</a>
</div>

</p>
<h5 id="网络层-1">网络层</h5>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370f585c0330.png">
<img src="https://bu.dusays.com/2022/11/13/6370f585c0330.png" alt="2"  />
</a>
</div>

</p>
<h5 id="传输层-1">传输层</h5>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370f5871b2b2.png">
<img src="https://bu.dusays.com/2022/11/13/6370f5871b2b2.png" alt="3"  />
</a>
</div>

</p>
<h5 id="应用层-1">应用层</h5>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370f670b78f0.png">
<img src="https://bu.dusays.com/2022/11/13/6370f670b78f0.png" alt="4"  />
</a>
</div>

</p>
<pre tabindex="0"><code>Hypertext Transfer Protocol
    GET /Default.aspx HTTP/1.1\r\n
    Host: www.smartclass.cn\r\n
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.42\r\n
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\n
    Accept-Encoding: gzip, deflate\r\n
    Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6\r\n
    Upgrade-Insecure-Requests: 1\r\n
    \r\n
    [Full request URI: http://www.smartclass.cn/Default.aspx]
    [HTTP request 1/14]
    [Response in frame: 1787]
    [Next request in frame: 1804]
</code></pre><ol>
<li><u>请求行</u>：由 <code>请求方法字段</code>、<code>URL字段</code> 和 <code>HTTP协议版本字段</code> 组成，如 <strong>GET /Default.aspx HTTP/1.1</strong></li>
<li><u>请求头部</u>：关键字/值对组成，每行一对
<ol>
<li><u>Host</u>：请求的主机名</li>
<li><u>User-Agent</u>：发出请求的浏览器类型</li>
<li><u>Accept</u>：客户端可识别的内容类型列表</li>
</ol>
</li>
<li><u>空行</u>：最后一个请求头之后是一个空行，发送回车符和换行符，通知服务器以下不再有请求头</li>
<li><u>请求数据</u></li>
</ol>
<h4 id="http响应报文">HTTP响应报文</h4>
<h5 id="传输层-2">传输层</h5>
<ul>
<li>TCP 协议会分段传输过大的数据段（Segment）保证传输的性能</li>
<li>TCP 协议引入了最大分段大小（Maximum segment size，MSS）这一概念，它是 TCP 数据段能够携带的数据上限。在正常情况下，TCP 连接的 MSS 是 MTU - 40 字节，即 1460 字节
<ul>
<li>MSS：一个网络包的最大长度，以太网中一般为 <code>1500</code> 字节</li>
<li>MTU：除去 IP 和 TCP 头部之后，一个网络包所能容纳的 TCP 数据的最大长度</li>
</ul>
</li>
<li>该报文 MSS 值为 1360，数据段分成 8 份从服务端发出，并在客户端经过拼接后被接收

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370fb4c09aa8.png">
<img src="https://bu.dusays.com/2022/11/13/6370fb4c09aa8.png" alt="1"  />
</a>
</div>

</li>
</ul>
<h5 id="应用层-2">应用层</h5>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/6370fdbf7eb46.png">
<img src="https://bu.dusays.com/2022/11/13/6370fdbf7eb46.png" alt="1"  />
</a>
</div>

</p>
<pre tabindex="0"><code>Hypertext Transfer Protocol
    HTTP/1.1 200 OK\r\n
        [Expert Info (Chat/Sequence): HTTP/1.1 200 OK\r\n]
            [HTTP/1.1 200 OK\r\n]
            [Severity level: Chat]
            [Group: Sequence]
        Response Version: HTTP/1.1
        Status Code: 200
        [Status Code Description: OK]
        Response Phrase: OK
    Date: Sun, 13 Nov 2022 13:06:05 GMT\r\n
    Content-Type: text/html; charset=utf-8\r\n
    Content-Length: 9696\r\n
        [Content length: 9696]
    Connection: keep-alive\r\n
    Cache-Control: private\r\n
    Content-Encoding: gzip\r\n
    Vary: Accept-Encoding\r\n
    MANUFACTURER: Hanboer\r\n
    X-AspNet-Version: 4.0.30319\r\n
    X-UA-Compatible: IE=edge,chrome=1\r\n
    Access-Control-Allow-Headers: content-type\r\n
    Access-Control-Allow-Methods: GET,POST,PUT,DELETE,OPTIONS\r\n
    Access-Control-Allow-Origin: http://localhost:9527\r\n
    Access-Control-Allow-Credentials: true\r\n
    \r\n
    [HTTP response 1/14]
    [Time since request: 0.067102000 seconds]
    [Request in frame: 1776]
    [Next request in frame: 1804]
    [Next response in frame: 1806]
    [Request URI: http://www.smartclass.cn/Webapi/V1/Live/GetPublicLives?csrkToken=0aat6ee1aaks3&amp;IsLiving=true&amp;Sort=StartTime&amp;Order=0&amp;PageSize=8&amp;PageNumber=1&amp;attribute=]
    Content-encoded entity body (gzip): 9696 bytes -&gt; 40818 bytes
    File Data: 40818 bytes
</code></pre><ol>
<li><u>状态行</u>：由 <code>HTTP版本</code> 、<code>状态码</code> 和<code>原因短语</code> 组成，如 <strong>HTTP/1.1 200 OK</strong></li>
<li><u>响应头部</u>：关键字/值对组成，每行一对</li>
<li><u>空行</u>：最后一个响应头之后是一个空行，发送回车符和换行符，通知服务器以下不再有响应头</li>
<li><u>响应正文</u></li>
</ol>
<h2 id="参考">参考</h2>
<ol>
<li><a href="https://blog.51cto.com/yttitan/1734425">Wireshark系列之4 捕获过滤器</a></li>
<li><a href="https://blog.51cto.com/u_13579643/3647795?articleABtest=0">网络——Wireshark工具</a></li>
<li><a href="https://juejin.cn/post/6844904066229747720">WireShark的基本用法</a></li>
<li><a href="https://www.cnblogs.com/lsdb/p/9254544.html">Wireshark使用教程（界面说明、捕获过滤器表达式、显示过滤器表达式）</a></li>
<li><a href="https://www.freebuf.com/sectool/256745.html">一文精讲Wireshark的抓包和分析</a></li>
<li><a href="https://bbs.huaweicloud.com/blogs/285673">Wireshark简明教程，新手专用，挑实在的讲，不搞花里胡哨</a></li>
<li><a href="https://blog.51cto.com/u_15688254/5694733">WireShark网络封包抓包工具各个界面介绍</a></li>
<li><a href="https://codeantenna.com/a/2zI6hbfTIM">实验3.利用Wireshark分析ARP协议</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/364195316">如何计算IP或ICMP协议首部里的checksum字段</a></li>
<li><a href="https://blog.51cto.com/ccieh3c/2654283">带你深入熟悉你所不知道的ICMP</a></li>
<li><a href="https://zhaoqqi.github.io/2016/10/05/network-wireshark-arp/">使用Wireshark学习网络协议之ICMP</a></li>
<li><a href="https://www.cnblogs.com/xiaolincoding/p/12922927.html">实战！我用 Wireshark 让你“看见“ TCP</a></li>
<li><a href="https://xiaolincoding.com/network/3_tcp/tcp_interview.html">4.1 TCP 三次握手与四次挥手面试题</a></li>
<li><a href="https://blog.51cto.com/u_15103025/2643297">Wireshark抓包TCP三次握手</a></li>
<li><a href="https://rgb-24bit.github.io/blog/2019/tcp-connect-manage.html">TCP 中的三次握手和四次挥手</a></li>
<li><a href="https://blog.csdn.net/u014117943/article/details/118520498">Wireshark配合TCP调试工具理解TCP三次握手和四次挥手过程</a></li>
<li><a href="https://juejin.cn/post/7034547558664011783">老生常谈的TCP三次握手和四次挥手，你会了吗？</a></li>
<li><a href="https://www.cnblogs.com/biyeymyhjob/archive/2012/07/28/2612910.html">HTTP请求报文和HTTP响应报文</a></li>
<li><a href="https://draveness.me/whys-the-design-tcp-segment-ip-packet/">为什么 TCP/IP 协议会拆分数据</a></li>
<li><a href="https://www.pianshen.com/article/86011166321/">HTTP的曲折：网络请求到层层封装和终端拆分</a></li>
<li><a href="https://segmentfault.com/a/1190000019788537">浅谈http协议（三）：HTTP 报文及其结构</a></li>
<li><a href="https://www.wireshark.org/docs/wsug_html_chunked/ChapterWork.html">Wireshark官方文档</a></li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>AcWing Web 应用课</title>
      <link>https://xancoding.cn/posts/acw-web/</link>
      <pubDate>Wed, 02 Nov 2022 15:49:03 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/acw-web/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.colopen-blog.com/Engineer/acw_web/&#34;&gt;AcWing Web 应用课 | Colopen&amp;rsquo;s blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/activity/content/punch_the_clock/1150/&#34;&gt;AcWing Web 应用课&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/4078555/&#34;&gt;HTML 基础标签&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/4194723/&#34;&gt;CSS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/4719082/&#34;&gt;JavaScript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/5501588/&#34;&gt;React&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/5639568/&#34;&gt;Vue3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/&#34;&gt;MDN官方文档&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Learn/Getting_started_with_the_web&#34;&gt;Web 入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Learn/HTML&#34;&gt;HTML —— 构建 Web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Learn/CSS&#34;&gt;CSS —— 设计Web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript&#34;&gt;JavaScript —— 用户端动态脚本&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Learn/Tools_and_testing/Client-side_JavaScript_frameworks/React_getting_started&#34;&gt;React 入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Learn/Tools_and_testing/Client-side_JavaScript_frameworks/Vue_getting_started&#34;&gt;Vue 入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial&#34;&gt;Canvas 教程&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;VSCode&lt;/code&gt; 自动生成缺省的 &lt;code&gt;HTML&lt;/code&gt; 代码框架&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-HTML&#34; data-lang=&#34;HTML&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0f0;font-weight:bold&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;font-weight:bold&#34;&gt;html&lt;/span&gt; &lt;span style=&#34;color:#007f7f&#34;&gt;lang&lt;/span&gt;=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;en&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;font-weight:bold&#34;&gt;head&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;font-weight:bold&#34;&gt;meta&lt;/span&gt; &lt;span style=&#34;color:#007f7f&#34;&gt;charset&lt;/span&gt;=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;UTF-8&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;font-weight:bold&#34;&gt;meta&lt;/span&gt; &lt;span style=&#34;color:#007f7f&#34;&gt;http-equiv&lt;/span&gt;=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;X-UA-Compatible&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#007f7f&#34;&gt;content&lt;/span&gt;=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;IE=edge&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;font-weight:bold&#34;&gt;meta&lt;/span&gt; &lt;span style=&#34;color:#007f7f&#34;&gt;name&lt;/span&gt;=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;viewport&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#007f7f&#34;&gt;content&lt;/span&gt;=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;width=device-width, initial-scale=1.0&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;font-weight:bold&#34;&gt;title&lt;/span&gt;&amp;gt;Document&amp;lt;/&lt;span style=&#34;font-weight:bold&#34;&gt;title&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;font-weight:bold&#34;&gt;head&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;font-weight:bold&#34;&gt;body&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;font-weight:bold&#34;&gt;body&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;font-weight:bold&#34;&gt;html&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;输入&lt;code&gt;！&lt;/code&gt;，接着输入 &lt;code&gt;tab&lt;/code&gt; 键，自动生成缺省的 &lt;code&gt;HTML&lt;/code&gt; 代码框架&lt;/li&gt;
&lt;li&gt;再按三下 &lt;code&gt;tab&lt;/code&gt; 键，光标会移动到 &lt;code&gt;&amp;lt;body&amp;gt;&lt;/code&gt; 与 &lt;code&gt;&amp;lt;/body&amp;gt;&lt;/code&gt; 之间的空行&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;kof&#34;&gt;KOF&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Xancoding/Leaning-jQuery&#34;&gt;KOF&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/video/3830/&#34;&gt;AcWing Web 应用课 | 中期项目——拳皇（上） | Vedio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/video/3833/&#34;&gt;AcWing Web 应用课 | 中期项目——拳皇（下） | Vedio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;基础操作&#34;&gt;基础操作&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;操作如下：
角色一: w 跳 a 左移 d 右移 j 拳击 
角色二: ↑ 跳 ← 左移 → 右移 1 拳击
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;文件结构&#34;&gt;文件结构&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;|-- README.md
|-- static
|   |-- css
|   |   `-- base.css
|   |-- images
|   |   |-- background
|   |   |   `-- 0.gif
|   |   `-- player
|   |       `-- kyo
|   |           |-- 0.gif
|   |           |-- 1.gif
|   |           |-- 2.gif
|   |           |-- 3.gif
|   |           |-- 4.gif
|   |           |-- 5.gif
|   |           `-- 6.gif
|   `-- js
|       |-- ac_game_object
|       |   `-- base.js
|       |-- base.js
|       |-- controller
|       |   `-- base.js
|       |-- game_map
|       |   `-- base.js
|       |-- player
|       |   |-- base.js
|       |   `-- kyo.js
|       `-- utils
|           `-- gif.js
`-- templates
    `-- index.html
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;整体架构&#34;&gt;整体架构&lt;/h3&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/02/63627b3105c46.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/02/63627b3105c46.png&#34; alt=&#34;KOFStructure&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h3 id=&#34;逻辑结构&#34;&gt;逻辑结构&lt;/h3&gt;
&lt;center&gt; 
	&lt;img style=&#34;border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);&#34; src=&#34;https://bu.dusays.com/2022/11/02/63627ace5a2f9.png&#34;&gt;
	&lt;br&gt;
	&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;Retrieved from：https://www.acwing.com/solution/content/139831/&lt;/div&gt; 
 &lt;/center&gt;
&lt;h3 id=&#34;html&#34;&gt;HTML&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;templates/index.html&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;!DOCTYPE html&amp;gt;

&amp;lt;html lang=&amp;#34;en&amp;#34;&amp;gt;

&amp;lt;head&amp;gt;

  &amp;lt;meta charset=&amp;#34;UTF-8&amp;#34;&amp;gt;

  &amp;lt;meta http-equiv=&amp;#34;X-UA-Compatible&amp;#34; content=&amp;#34;IE=edge&amp;#34;&amp;gt;

  &amp;lt;meta name=&amp;#34;viewport&amp;#34; content=&amp;#34;width=device-width, initial-scale=1.0&amp;#34;&amp;gt;

  &amp;lt;title&amp;gt;KOF&amp;lt;/title&amp;gt;

  &amp;lt;link rel=&amp;#34;stylesheet&amp;#34; href=&amp;#34;../static/css/base.css&amp;#34;&amp;gt;

  &amp;lt;script src=&amp;#34;https://cdn.acwing.com/static/jquery/js/jquery-3.3.1.min.js&amp;#34;&amp;gt;&amp;lt;/script&amp;gt;

&amp;lt;/head&amp;gt;

&amp;lt;body&amp;gt;

  &amp;lt;div id=&amp;#34;kof&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;

  

  &amp;lt;script type=&amp;#34;module&amp;#34;&amp;gt;

    import {KOF} from &amp;#39;../static/js/base.js&amp;#39;;

  

    let kof = new KOF(&amp;#39;kof&amp;#39;);

  &amp;lt;/script&amp;gt;

&amp;lt;/body&amp;gt;

&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;css&#34;&gt;CSS&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;css/base.css&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#kof {

  width: 1280px;

  height: 720px;

  background-image: url(&amp;#39;../images/background/0.gif&amp;#39;);

  background-size: 200% 100%;

  background-position: top;

  position: absolute;

}

  

#kof&amp;gt;.kof-head {

  width: 100%;

  height: 80px;

  position: absolute;

  top: 0;

  display: flex;

  align-items: center;

}

  

#kof&amp;gt;.kof-head&amp;gt;.kof-head-hp-0 {

  height: 40px;

  width: calc(50% - 60px);

  margin-left: 20px;

  border: white 5px solid;

  box-sizing: border-box;

  border-right: none;

}

  

#kof&amp;gt;.kof-head&amp;gt;.kof-head-timer {

  height: 60px;

  width: 80px;

  background-color: orange;

  border: white 5px solid;

  box-sizing: border-box;

  color: white;

  font-size: 30px;

  font-weight: 800;

  text-align: center;

  line-height: 50px;

  user-select: none;

}

  

#kof&amp;gt;.kof-head&amp;gt;.kof-head-hp-1 {

  height: 40px;

  width: calc(50% - 60px);

  border: white 5px solid;

  box-sizing: border-box;

  border-left: none;

}

  

#kof&amp;gt;.kof-head&amp;gt;.kof-head-hp-0&amp;gt;div {

  background-color: red;

  height: 100%;

  width: 100%;

  float: right;

}

  

#kof&amp;gt;.kof-head&amp;gt;.kof-head-hp-1&amp;gt;div {

  background-color: red;

  height: 100%;

  width: 100%;

}

  

#kof&amp;gt;.kof-head&amp;gt;.kof-head-hp-0&amp;gt;div&amp;gt;div {

  background-color: lightgreen;

  height: 100%;

  width: 100%;

  float: right;

}

  

#kof&amp;gt;.kof-head&amp;gt;.kof-head-hp-1&amp;gt;div&amp;gt;div {

  background-color: lightgreen;

  height: 100%;

  width: 100%;

}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;javascript&#34;&gt;JavaScript&lt;/h3&gt;
&lt;h4 id=&#34;逻辑结构-1&#34;&gt;逻辑结构&lt;/h4&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/03/63631ec3461ef.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/03/63631ec3461ef.png&#34; alt=&#34;逻辑结构&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h4 id=&#34;kof-1&#34;&gt;KOF&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;js/base.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import { GameMap } from &amp;#39;../js/game_map/base.js&amp;#39;

import { Kyo } from &amp;#39;../js/player/kyo.js&amp;#39;;

  

export class KOF {

  constructor(id) {

    this.$kof = $(&amp;#39;#&amp;#39; + id);

  

    this.game_map = new GameMap(this);

    this.players = [

      new Kyo(this, {

        id: 0,

        x: 200,

        y: 0,

        width: 120,

        height: 200,

        color: &amp;#39;blue&amp;#39;

      }),

      new Kyo(this, {

        id: 1,

        x: 900,

        y: 0,

        width: 120,

        height: 200,

        color: &amp;#39;red&amp;#39;

      })

    ]

  }

}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;acgameobject&#34;&gt;AcGameObject&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;js/ac_game_object/base.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;let AC_GAME_OBJECTS = [];

  

export class AcGameObject {

  constructor() {

    AC_GAME_OBJECTS.push(this);

  

    this.timedelta = 0;

    this.has_call_start = false;

  }

  

  start() {  // 初始化

  
  

  }

  

  update() {  // 每一帧执行一次

  

  }

  

  destory() {  // 删除当前对象

    for (let i in AC_GAME_OBJECTS) {

      if (AC_GAME_OBJECTS[i] === this) {

        AC_GAME_OBJECTS.splice(i, 1);

        break;

      }

    }

  }

}

  

let last_timestamp;   // 上一次执行函数时的时刻

  

/**

 * @description 该函数每一帧执行一次

 * @param {number} timestamp 当前执行函数时的时刻

 */

  

let AC_GAME_OBJECTS_FRAME = (timestamp) =&amp;gt; {

  for (let obj of AC_GAME_OBJECTS) {

    if (!obj.has_call_start) {

      obj.start();

      obj.has_call_start = true;

    } else {

      obj.timedelta = timestamp - last_timestamp;

      obj.update();

    }

  }

  

  last_timestamp = timestamp;

  requestAnimationFrame(AC_GAME_OBJECTS_FRAME);

}

  

requestAnimationFrame(AC_GAME_OBJECTS_FRAME);
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;controller&#34;&gt;Controller&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;controller&lt;/code&gt; 控制器，读取玩家的输入
&lt;code&gt;js/constroller/base.js&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;export class Controller {   // 手动实现键盘触发事件——当前按住的按键（效果不同于keydown）

  constructor($canvas) {

    this.$canvas = $canvas;

    this.pressed_keys = new Set();    // Set 对象允许你存储任何类型的唯一值

    this.start();

  }

  

  start() {

    let outer = this;

    this.$canvas.keydown(function(e){   // keydown：某个键是否被按住，事件会连续触发

      outer.pressed_keys.add(e.key);

    });

  

    this.$canvas.keyup(function(e){   // keyup：某个按键是否被释放

      outer.pressed_keys.delete(e.key);

    });

  

  }

}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;gamemap&#34;&gt;GameMap&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;js/game_map/base.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import {AcGameObject} from &amp;#39;../ac_game_object/base.js&amp;#39;

import { Controller } from &amp;#39;../controller/base.js&amp;#39;;

  

export class GameMap extends AcGameObject {

  constructor(root) {

    super();

  

    this.root = root;

    this.$canvas = $(&amp;#39;&amp;lt;canvas width=&amp;#34;1280&amp;#34; height=&amp;#34;720&amp;#34; tabindex=0&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;);   // 构造一个jQuery对象  其中，tabindex=&amp;#34;0&amp;#34;使&amp;lt;canvas&amp;gt;元素可以聚焦

    this.ctx = this.$canvas[0].getContext(&amp;#39;2d&amp;#39;);  // this.$canvas[0]是&amp;lt;canvas&amp;gt;元素的DOM对象   this.ctx用于画布的渲染

    this.root.$kof.append(this.$canvas);

    this.$canvas.focus();   // 聚焦，使之可以获取输入

  

    this.controller = new Controller(this.$canvas);

  

    // 加入血条

    this.root.$kof.append($(`

      &amp;lt;div class=&amp;#34;kof-head&amp;#34;&amp;gt;

        &amp;lt;div class=&amp;#34;kof-head-hp-0&amp;#34;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;

        &amp;lt;div class=&amp;#34;kof-head-timer&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;

        &amp;lt;div class=&amp;#34;kof-head-hp-1&amp;#34;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;

      &amp;lt;/div&amp;gt;

    `));

  

    // 加入计时表

    this.time_left = 60000;  //单位：毫秒（因为定义的timedelta单位是ms）

    this.$timer = this.root.$kof.find(&amp;#39;.kof-head-timer&amp;#39;);

  }

  

  start() {

  

  }

  

  update() {

    this.update_time();

  

    this.render();

  }

  

  update_time() {

    this.time_left -= this.timedelta;

    if (this.time_left &amp;lt; 0) {   // 时间到，游戏结束

      this.time_left = 0;

  

      let [a, b] = this.root.players;

      if (a.status !== 6 &amp;amp;&amp;amp; b.status !== 6) {

        a.statu = b.status = 6;

        a.frame_current_cnt = b.frame_current_cnt = 0;

        a.vx = b.vx = 0;

      }

    }

    this.$timer.text(parseInt(this.time_left / 1000));

  }

  

  render() {

    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);

  }

}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;player&#34;&gt;Player&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;js/player/base.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import { AcGameObject } from &amp;#39;../ac_game_object/base.js&amp;#39;;

  

export class Player extends AcGameObject {

  constructor(root, info) {

    super();

  

    this.root = root;

    this.id = info.id;

    this.x = info.x;

    this.y = info.y;

    this.width = info.width;

    this.height = info.height;

    this.color = info.color;

  

    this.direction = 1;

  

    this.vx = 0;

    this.vy = 0;

  

    this.speedx = 400;  // 水平速度

    this.speedy = -1000;  // 跳跃初始速度

  

    this.gravity = 50;

  

    this.ctx = this.root.game_map.ctx;

    this.pressed_keys = this.root.game_map.controller.pressed_keys;

    this.status = 3;  // 0：静止， 1：向前，2：向后，3：跳跃，4：攻击，5：被攻击，6：死亡   随着项目的完善，动作会变的很多，这时用数组存储字符串代替this.status会更方便

    this.animations = new Map();  // 存储GIF动画的每一帧

    this.frame_current_cnt = 0;  // 记录当前的帧数

  

    this.hp = 100;

    this.$hp = this.root.$kof.find(`.kof-head-hp-${this.id}&amp;gt;div`);

    this.$hp_div = this.$hp.find(&amp;#39;div&amp;#39;);

  }

  start() {

  }

  

  update_control() {

    let w, a, d, j;

    if (this.id === 0) {

      w = this.pressed_keys.has(&amp;#39;w&amp;#39;);

      a = this.pressed_keys.has(&amp;#39;a&amp;#39;);

      d = this.pressed_keys.has(&amp;#39;d&amp;#39;);

      j = this.pressed_keys.has(&amp;#39;j&amp;#39;);

    } else {

      w = this.pressed_keys.has(&amp;#39;ArrowUp&amp;#39;);

      a = this.pressed_keys.has(&amp;#39;ArrowLeft&amp;#39;);

      d = this.pressed_keys.has(&amp;#39;ArrowRight&amp;#39;);

      j = this.pressed_keys.has(&amp;#39;1&amp;#39;);

    }

  

    if (this.status === 0 || this.status === 1) {   // 静止状态 || 移动状态

      if (j) {  // 攻击

        this.status = 4;

        this.vx = 0;

        this.frame_current_cnt = 0;

      } else if (w) {  // 跳跃

        if (d) {  // 向右跳

          this.vx = this.speedx;

        } else if (a) {  // 向左跳

          this.vx = -this.speedx;

        } else {  // 垂直跳

          this.vx = 0;

        }

        this.vy = this.speedy;

        this.status = 3;

        this.frame_current_cnt = 0; // 每次跳跃重新记录帧数，确保跳跃动画正常

  

      } else if (d) {  // 向右移动

        this.vx = this.speedx;

        this.status = 1;

      } else if (a) {  // 向左移动

        this.vx = - this.speedx;

        this.status = 1;

      } else {  // 静止

        this.vx = 0;

      }

    }

  

  }

  update_move() {

    this.vy += this.gravity;

  

    this.x += this.vx * this.timedelta / 1000;

    this.y += this.vy * this.timedelta / 1000;

  

    // 确保两个角色不会重叠   a 是自己、b 是对手

    // let [a, b] = this.root.players;

    // if (a !== this) [a,b] = [b, a];

  

    // let r1 = {

    //   x1: a.x,

    //   y1: a.y,

    //   x2: a.x + a.width,

    //   y2: a.x + a.height,

    // };

    // let r2 = {

    //   x1: b.x,

    //   y1: b.y,

    //   x2: b.x + b.width,

    //   y2: b.x + b.height,

    // };

  

    // if (this.is_collusion(r1, r2)) {

    //   b.x += this.vx * this.timedelta / 1000 / 2;

    //   b.y += this.vy * this.timedelta / 1000 / 2;

    //   a.x -= this.vx * this.timedelta / 1000 / 2;

    //   a.y -= this.vy * this.timedelta / 1000 / 2;

  

    //   if (this.status === 3) this.status = 0;

    // }

  

    // 落到平地上后静止

    if (this.y &amp;gt; 450) {

      this.y = 450;

      this.vy = 0;

      if (this.status === 3) this.status = 0;   // 因为任何时刻都有重力施加，不加这一句会导致状态只有静止状态

    }

  

    // 不能超出左右边界

    if (this.x &amp;lt; 0) {

      this.x = 0;

    } else if (this.x + this.width &amp;gt; this.root.game_map.$canvas.width()) {

      this.x = this.root.game_map.$canvas.width() - this.width;

    }

  

  }

  

  update_direction() {  // 确保两个角色始终相对

    if (this.status === 6) return;

  

    let players = this.root.players;

    if (players[0] &amp;amp;&amp;amp; players[1]) {

      let me = this, you = players[1 - this.id];

      if (me.x &amp;lt; you.x) me.direction = 1;

      else me.direction = -1;

    }

  }

  

  is_collusion(r1, r2) {  // 判断两个矩阵是否有交集

    if (Math.max(r1.x1, r2.x1) &amp;gt; Math.min(r1.x2, r2.x2))

      return false;

    if (Math.max(r1.y1, r2.y1) &amp;gt; Math.min(r1.y2,r2.y2))

      return false;

    return true;

  }

  

  is_attack() {

    if (this.status === 6) return;  // 已经倒地，无法再被攻击

  

    this.status = 5;

    this.frame_current_cnt = 0;

  

    this.hp = Math.max(this.hp - 10, 0);

  

    this.$hp_div.animate({  // 血条减少，渐变

      width: this.$hp.parent().width() * this.hp / 100,

    }, 350);

  

    this.$hp.animate({  // 血条减少，渐变

      width: this.$hp.parent().width() * this.hp / 100,

    }, 600);

  

    if (this.hp &amp;lt;= 0) {

      this.status = 6;

      this.frame_current_cnt = 0;

      this.vx = 0;

    }

  }

  

  update_attack() {   // 判定是否被攻击到

    if (this.status === 4 &amp;amp;&amp;amp; this.frame_current_cnt === 18) {   // 第18帧时动画挥出拳，判断此时是否拳头与对方有碰撞

      let me = this, you = this.root.players[1 - this.id];

      let r1;  // 攻击判定矩形

      let r2;  // 敌方人物矩形

      if (this.direction &amp;gt; 0) {

        r1 = {

          x1: me.x + 120,

          y1: me.y + 40,

          x2: me.x + 120 + 100,

          y2: me.y + 40 + 20,

        }

      } else {

        r1 = {

          x1: me.x + me.width - 120 - 100,

          y1: me.y + 40,

          x2: me.x + me.width - 120 - 100 + 100,

          y2: me.y + 40 + 20,

        }

      }

  

      r2 = {

        x1: you.x,

        y2: you.y,

        x2: you.x + you.width,

        y2: you.y + you.height

      };

  

      if (this.is_collusion(r1, r2)) {

        you.is_attack();

      }

    }

  }

  

  update() {

    this.update_attack();

    this.update_direction();

    this.update_control();

    this.update_move();

    this.render();

  }

  

  render() {

  

    let status = this.status;

  

    if (this.status === 1 &amp;amp;&amp;amp; this.direction * this.vx &amp;lt; 0) status = 2;    // 后退状态

  

    let obj = this.animations.get(status);

    if (obj &amp;amp;&amp;amp; obj.loaded) {    // GIF 已经加载完成

      if (this.direction &amp;gt; 0) {  // 正方向

        let k = parseInt(this.frame_current_cnt / obj.frame_rate) % obj.frame_cnt;  // 通过obj.frame_rate控制渲染动画的速率，方便控制动画，而不只是单纯的每一帧都渲染一次

        let image = obj.gif.frames[k].image;

        this.ctx.drawImage(image, this.x, this.y + obj.offset_y, image.width * obj.scale, image.height * obj.scale);

      } else {  // 反方向   通过调整坐标系来翻转方向

        this.ctx.save();

        this.ctx.scale(-1, 1);

        this.ctx.translate(-this.root.game_map.$canvas.width(), 0);

  

        let k = parseInt(this.frame_current_cnt / obj.frame_rate) % obj.frame_cnt;

        let image = obj.gif.frames[k].image;

        this.ctx.drawImage(image, this.root.game_map.$canvas.width() - this.width - this.x, this.y + obj.offset_y, image.width * obj.scale, image.height * obj.scale);  // 不同于正方向时的渲染，因为此时坐标系改变，需要在对称的位置渲染

  

        this.ctx.restore();

      }

    }

  

    if (status === 4 || status === 5 || status === 6) {  // 确保不会一直循环GIF

      if (this.frame_current_cnt === obj.frame_rate * (obj.frame_cnt - 1)) {  // 确保此时已经播放完一次GIF动画

        if (status === 6) {   // 死亡倒地不起，这里的 -- 和 下面的 ++ 相抵消，使之在最后一帧不再变化

          this.frame_current_cnt--;

        } else {

          this.status = 0;

        }

      }

    }

  

    this.frame_current_cnt++;

  }

}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;js/player/kyo.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import { Player } from &amp;#34;../player/base.js&amp;#34;;

import {GIF} from &amp;#39;../utils/gif.js&amp;#39;

  

export class Kyo extends Player {

  constructor(root, info) {

    super(root, info);

  

    this.init_animations();   // 初始化动画

  }

  

  init_animations() {

    let outer = this;

    let offsets = [0, -22, -22, -150, 0, 0, 0];   // 偏移量 不同的动画高度不同，因此需要借助竖直方向上的偏移量将他们调整至同一水平面

    for (let i = 0; i &amp;lt; 7; ++ i) {  // 7个动作

      let gif = GIF();

      gif.load(`/static/images/player/kyo/${i}.gif`);

      this.animations.set(i, {  // 动画

        gif: gif,

        frame_cnt: 0,  // GIF帧数

        frame_rate: 5,  // 每5帧过渡一次

        offset_y: offsets[i],  // y方向偏移量

        loaded: false,  // 是否加载完成

        scale: 2,  // 放大2倍

      });

  

      gif.onload = function() {   // 加载完成

        let obj = outer.animations.get(i);

        obj.frame_cnt = gif.frames.length;

        obj.loaded = true;

  

        if (i === 3) {  // 调整跳跃时GIF播放速率

          obj.frame_rate = 4;

        }

      }

    }

  }

}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;gif&#34;&gt;GIF&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://stackoverflow.com/questions/48234696/how-to-put-a-gif-with-canvas/48348567#48348567&#34;&gt;Loading and playing GIF image to canvas&lt;/a&gt;    把玩家的&lt;code&gt;GIF&lt;/code&gt;动画渲染在&lt;code&gt;canvas&lt;/code&gt;上&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;js/utils/gif.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const GIF = function () {

  // **NOT** for commercial use.

  var timerID;                          // timer handle for set time out usage

  var st;                               // holds the stream object when loading.

  var interlaceOffsets = [0, 4, 2, 1]; // used in de-interlacing.

  var interlaceSteps = [8, 8, 4, 2];

  var interlacedBufSize;  // this holds a buffer to de interlace. Created on the first frame and when size changed

  var deinterlaceBuf;

  var pixelBufSize;    // this holds a buffer for pixels. Created on the first frame and when size changed

  var pixelBuf;

  const GIF_FILE = { // gif file data headers

    GCExt: 0xF9,

    COMMENT: 0xFE,

    APPExt: 0xFF,

    UNKNOWN: 0x01, // not sure what this is but need to skip it in parser

    IMAGE: 0x2C,

    EOF: 59,   // This is entered as decimal

    EXT: 0x21,

  };

  // simple buffered stream used to read from the file

  var Stream = function (data) {

      this.data = new Uint8ClampedArray(data);

      this.pos = 0;

      var len = this.data.length;

      this.getString = function (count) { // returns a string from current pos of len count

          var s = &amp;#34;&amp;#34;;

          while (count--) { s += String.fromCharCode(this.data[this.pos++]) }

          return s;

      };

      this.readSubBlocks = function () { // reads a set of blocks as a string

          var size, count, data = &amp;#34;&amp;#34;;

          do {

              count = size = this.data[this.pos++];

              while (count--) { data += String.fromCharCode(this.data[this.pos++]) }

          } while (size !== 0 &amp;amp;&amp;amp; this.pos &amp;lt; len);

          return data;

      }

      this.readSubBlocksB = function () { // reads a set of blocks as binary

          var size, count, data = [];

          do {

              count = size = this.data[this.pos++];

              while (count--) { data.push(this.data[this.pos++]); }

          } while (size !== 0 &amp;amp;&amp;amp; this.pos &amp;lt; len);

          return data;

      }

  };

  // LZW decoder uncompressed each frames pixels

  // this needs to be optimised.

  // minSize is the min dictionary as powers of two

  // size and data is the compressed pixels

  function lzwDecode(minSize, data) {

      var i, pixelPos, pos, clear, eod, size, done, dic, code, last, d, len;

      pos = pixelPos = 0;

      dic = [];

      clear = 1 &amp;lt;&amp;lt; minSize;

      eod = clear + 1;

      size = minSize + 1;

      done = false;

      while (!done) { // JavaScript optimisers like a clear exit though I never use &amp;#39;done&amp;#39; apart from fooling the optimiser

          last = code;

          code = 0;

          for (i = 0; i &amp;lt; size; i++) {

              if (data[pos &amp;gt;&amp;gt; 3] &amp;amp; (1 &amp;lt;&amp;lt; (pos &amp;amp; 7))) { code |= 1 &amp;lt;&amp;lt; i }

              pos++;

          }

          if (code === clear) { // clear and reset the dictionary

              dic = [];

              size = minSize + 1;

              for (i = 0; i &amp;lt; clear; i++) { dic[i] = [i] }

              dic[clear] = [];

              dic[eod] = null;

          } else {

              if (code === eod) { done = true; return }

              if (code &amp;gt;= dic.length) { dic.push(dic[last].concat(dic[last][0])) }

              else if (last !== clear) { dic.push(dic[last].concat(dic[code][0])) }

              d = dic[code];

              len = d.length;

              for (i = 0; i &amp;lt; len; i++) { pixelBuf[pixelPos++] = d[i] }

              if (dic.length === (1 &amp;lt;&amp;lt; size) &amp;amp;&amp;amp; size &amp;lt; 12) { size++ }

          }

      }

  };

  function parseColourTable(count) { // get a colour table of length count  Each entry is 3 bytes, for RGB.

      var colours = [];

      for (var i = 0; i &amp;lt; count; i++) { colours.push([st.data[st.pos++], st.data[st.pos++], st.data[st.pos++]]) }

      return colours;

  }

  function parse() {        // read the header. This is the starting point of the decode and async calls parseBlock

      var bitField;

      st.pos += 6;

      gif.width = (st.data[st.pos++]) + ((st.data[st.pos++]) &amp;lt;&amp;lt; 8);

      gif.height = (st.data[st.pos++]) + ((st.data[st.pos++]) &amp;lt;&amp;lt; 8);

      bitField = st.data[st.pos++];

      gif.colorRes = (bitField &amp;amp; 0b1110000) &amp;gt;&amp;gt; 4;

      gif.globalColourCount = 1 &amp;lt;&amp;lt; ((bitField &amp;amp; 0b111) + 1);

      gif.bgColourIndex = st.data[st.pos++];

      st.pos++;                    // ignoring pixel aspect ratio. if not 0, aspectRatio = (pixelAspectRatio + 15) / 64

      if (bitField &amp;amp; 0b10000000) { gif.globalColourTable = parseColourTable(gif.globalColourCount) } // global colour flag

      setTimeout(parseBlock, 0);

  }

  function parseAppExt() { // get application specific data. Netscape added iterations and terminator. Ignoring that

      st.pos += 1;

      if (&amp;#39;NETSCAPE&amp;#39; === st.getString(8)) { st.pos += 8 }  // ignoring this data. iterations (word) and terminator (byte)

      else {

          st.pos += 3;            // 3 bytes of string usually &amp;#34;2.0&amp;#34; when identifier is NETSCAPE

          st.readSubBlocks();     // unknown app extension

      }

  };

  function parseGCExt() { // get GC data

      var bitField;

      st.pos++;

      bitField = st.data[st.pos++];

      gif.disposalMethod = (bitField &amp;amp; 0b11100) &amp;gt;&amp;gt; 2;

      gif.transparencyGiven = bitField &amp;amp; 0b1 ? true : false; // ignoring bit two that is marked as  userInput???

      gif.delayTime = (st.data[st.pos++]) + ((st.data[st.pos++]) &amp;lt;&amp;lt; 8);

      gif.transparencyIndex = st.data[st.pos++];

      st.pos++;

  };

  function parseImg() {                           // decodes image data to create the indexed pixel image

      var deinterlace, frame, bitField;

      deinterlace = function (width) {                   // de interlace pixel data if needed

          var lines, fromLine, pass, toline;

          lines = pixelBufSize / width;

          fromLine = 0;

          if (interlacedBufSize !== pixelBufSize) {      // create the buffer if size changed or undefined.

              deinterlaceBuf = new Uint8Array(pixelBufSize);

              interlacedBufSize = pixelBufSize;

          }

          for (pass = 0; pass &amp;lt; 4; pass++) {

              for (toLine = interlaceOffsets[pass]; toLine &amp;lt; lines; toLine += interlaceSteps[pass]) {

                  deinterlaceBuf.set(pixelBuf.subarray(fromLine, fromLine + width), toLine * width);

                  fromLine += width;

              }

          }

      };

      frame = {}

      gif.frames.push(frame);

      frame.disposalMethod = gif.disposalMethod;

      frame.time = gif.length;

      frame.delay = gif.delayTime * 10;

      gif.length += frame.delay;

      if (gif.transparencyGiven) { frame.transparencyIndex = gif.transparencyIndex }

      else { frame.transparencyIndex = undefined }

      frame.leftPos = (st.data[st.pos++]) + ((st.data[st.pos++]) &amp;lt;&amp;lt; 8);

      frame.topPos = (st.data[st.pos++]) + ((st.data[st.pos++]) &amp;lt;&amp;lt; 8);

      frame.width = (st.data[st.pos++]) + ((st.data[st.pos++]) &amp;lt;&amp;lt; 8);

      frame.height = (st.data[st.pos++]) + ((st.data[st.pos++]) &amp;lt;&amp;lt; 8);

      bitField = st.data[st.pos++];

      frame.localColourTableFlag = bitField &amp;amp; 0b10000000 ? true : false;

      if (frame.localColourTableFlag) { frame.localColourTable = parseColourTable(1 &amp;lt;&amp;lt; ((bitField &amp;amp; 0b111) + 1)) }

      if (pixelBufSize !== frame.width * frame.height) { // create a pixel buffer if not yet created or if current frame size is different from previous

          pixelBuf = new Uint8Array(frame.width * frame.height);

          pixelBufSize = frame.width * frame.height;

      }

      lzwDecode(st.data[st.pos++], st.readSubBlocksB()); // decode the pixels

      if (bitField &amp;amp; 0b1000000) {                        // de interlace if needed

          frame.interlaced = true;

          deinterlace(frame.width);

      } else { frame.interlaced = false }

      processFrame(frame);                               // convert to canvas image

  };

  function processFrame(frame) { // creates a RGBA canvas image from the indexed pixel data.

      var ct, cData, dat, pixCount, ind, useT, i, pixel, pDat, col, frame, ti;

      frame.image = document.createElement(&amp;#39;canvas&amp;#39;);

      frame.image.width = gif.width;

      frame.image.height = gif.height;

      frame.image.ctx = frame.image.getContext(&amp;#34;2d&amp;#34;);

      ct = frame.localColourTableFlag ? frame.localColourTable : gif.globalColourTable;

      if (gif.lastFrame === null) { gif.lastFrame = frame }

      useT = (gif.lastFrame.disposalMethod === 2 || gif.lastFrame.disposalMethod === 3) ? true : false;

      if (!useT) { frame.image.ctx.drawImage(gif.lastFrame.image, 0, 0, gif.width, gif.height) }

      cData = frame.image.ctx.getImageData(frame.leftPos, frame.topPos, frame.width, frame.height);

      ti = frame.transparencyIndex;

      dat = cData.data;

      if (frame.interlaced) { pDat = deinterlaceBuf }

      else { pDat = pixelBuf }

      pixCount = pDat.length;

      ind = 0;

      for (i = 0; i &amp;lt; pixCount; i++) {

          pixel = pDat[i];

          col = ct[pixel];

          if (ti !== pixel) {

              dat[ind++] = col[0];

              dat[ind++] = col[1];

              dat[ind++] = col[2];

              dat[ind++] = 255;      // Opaque.

          } else

              if (useT) {

                  dat[ind + 3] = 0; // Transparent.

                  ind += 4;

              } else { ind += 4 }

      }

      frame.image.ctx.putImageData(cData, frame.leftPos, frame.topPos);

      gif.lastFrame = frame;

      if (!gif.waitTillDone &amp;amp;&amp;amp; typeof gif.onload === &amp;#34;function&amp;#34;) { doOnloadEvent() }// if !waitTillDone the call onload now after first frame is loaded

  };

  // **NOT** for commercial use.

  function finnished() { // called when the load has completed

      gif.loading = false;

      gif.frameCount = gif.frames.length;

      gif.lastFrame = null;

      st = undefined;

      gif.complete = true;

      gif.disposalMethod = undefined;

      gif.transparencyGiven = undefined;

      gif.delayTime = undefined;

      gif.transparencyIndex = undefined;

      gif.waitTillDone = undefined;

      pixelBuf = undefined; // dereference pixel buffer

      deinterlaceBuf = undefined; // dereference interlace buff (may or may not be used);

      pixelBufSize = undefined;

      deinterlaceBuf = undefined;

      gif.currentFrame = 0;

      if (gif.frames.length &amp;gt; 0) { gif.image = gif.frames[0].image }

      doOnloadEvent();

      if (typeof gif.onloadall === &amp;#34;function&amp;#34;) {

          (gif.onloadall.bind(gif))({ type: &amp;#39;loadall&amp;#39;, path: [gif] });

      }

      if (gif.playOnLoad) { gif.play() }

  }

  function canceled() { // called if the load has been cancelled

      finnished();

      if (typeof gif.cancelCallback === &amp;#34;function&amp;#34;) { (gif.cancelCallback.bind(gif))({ type: &amp;#39;canceled&amp;#39;, path: [gif] }) }

  }

  function parseExt() {              // parse extended blocks

      const blockID = st.data[st.pos++];

      if (blockID === GIF_FILE.GCExt) { parseGCExt() }

      else if (blockID === GIF_FILE.COMMENT) { gif.comment += st.readSubBlocks() }

      else if (blockID === GIF_FILE.APPExt) { parseAppExt() }

      else {

          if (blockID === GIF_FILE.UNKNOWN) { st.pos += 13; } // skip unknow block

          st.readSubBlocks();

      }

  

  }

  function parseBlock() { // parsing the blocks

      if (gif.cancel !== undefined &amp;amp;&amp;amp; gif.cancel === true) { canceled(); return }

  

      const blockId = st.data[st.pos++];

      if (blockId === GIF_FILE.IMAGE) { // image block

          parseImg();

          if (gif.firstFrameOnly) { finnished(); return }

      } else if (blockId === GIF_FILE.EOF) { finnished(); return }

      else { parseExt() }

      if (typeof gif.onprogress === &amp;#34;function&amp;#34;) {

          gif.onprogress({ bytesRead: st.pos, totalBytes: st.data.length, frame: gif.frames.length });

      }

      setTimeout(parseBlock, 0); // parsing frame async so processes can get some time in.

  };

  function cancelLoad(callback) { // cancels the loading. This will cancel the load before the next frame is decoded

      if (gif.complete) { return false }

      gif.cancelCallback = callback;

      gif.cancel = true;

      return true;

  }

  function error(type) {

      if (typeof gif.onerror === &amp;#34;function&amp;#34;) { (gif.onerror.bind(this))({ type: type, path: [this] }) }

      gif.onload = gif.onerror = undefined;

      gif.loading = false;

  }

  function doOnloadEvent() { // fire onload event if set

      gif.currentFrame = 0;

      gif.nextFrameAt = gif.lastFrameAt = new Date().valueOf(); // just sets the time now

      if (typeof gif.onload === &amp;#34;function&amp;#34;) { (gif.onload.bind(gif))({ type: &amp;#39;load&amp;#39;, path: [gif] }) }

      gif.onerror = gif.onload = undefined;

  }

  function dataLoaded(data) { // Data loaded create stream and parse

      st = new Stream(data);

      parse();

  }

  function loadGif(filename) { // starts the load

      var ajax = new XMLHttpRequest();

      ajax.responseType = &amp;#34;arraybuffer&amp;#34;;

      ajax.onload = function (e) {

          if (e.target.status === 404) { error(&amp;#34;File not found&amp;#34;) }

          else if (e.target.status &amp;gt;= 200 &amp;amp;&amp;amp; e.target.status &amp;lt; 300) { dataLoaded(ajax.response) }

          else { error(&amp;#34;Loading error : &amp;#34; + e.target.status) }

      };

      ajax.open(&amp;#39;GET&amp;#39;, filename, true);

      ajax.send();

      ajax.onerror = function (e) { error(&amp;#34;File error&amp;#34;) };

      this.src = filename;

      this.loading = true;

  }

  function play() { // starts play if paused

      if (!gif.playing) {

          gif.paused = false;

          gif.playing = true;

          playing();

      }

  }

  function pause() { // stops play

      gif.paused = true;

      gif.playing = false;

      clearTimeout(timerID);

  }

  function togglePlay() {

      if (gif.paused || !gif.playing) { gif.play() }

      else { gif.pause() }

  }

  function seekFrame(frame) { // seeks to frame number.

      clearTimeout(timerID);

      gif.currentFrame = frame % gif.frames.length;

      if (gif.playing) { playing() }

      else { gif.image = gif.frames[gif.currentFrame].image }

  }

  function seek(time) { // time in Seconds  // seek to frame that would be displayed at time

      clearTimeout(timerID);

      if (time &amp;lt; 0) { time = 0 }

      time *= 1000; // in ms

      time %= gif.length;

      var frame = 0;

      while (time &amp;gt; gif.frames[frame].time + gif.frames[frame].delay &amp;amp;&amp;amp; frame &amp;lt; gif.frames.length) { frame += 1 }

      gif.currentFrame = frame;

      if (gif.playing) { playing() }

      else { gif.image = gif.frames[gif.currentFrame].image }

  }

  function playing() {

      var delay;

      var frame;

      if (gif.playSpeed === 0) {

          gif.pause();

          return;

      } else {

          if (gif.playSpeed &amp;lt; 0) {

              gif.currentFrame -= 1;

              if (gif.currentFrame &amp;lt; 0) { gif.currentFrame = gif.frames.length - 1 }

              frame = gif.currentFrame;

              frame -= 1;

              if (frame &amp;lt; 0) { frame = gif.frames.length - 1 }

              delay = -gif.frames[frame].delay * 1 / gif.playSpeed;

          } else {

              gif.currentFrame += 1;

              gif.currentFrame %= gif.frames.length;

              delay = gif.frames[gif.currentFrame].delay * 1 / gif.playSpeed;

          }

          gif.image = gif.frames[gif.currentFrame].image;

          timerID = setTimeout(playing, delay);

      }

  }

  var gif = {                      // the gif image object

      onload: null,       // fire on load. Use waitTillDone = true to have load fire at end or false to fire on first frame

      onerror: null,       // fires on error

      onprogress: null,       // fires a load progress event

      onloadall: null,       // event fires when all frames have loaded and gif is ready

      paused: false,      // true if paused

      playing: false,      // true if playing

      waitTillDone: true,       // If true onload will fire when all frames loaded, if false, onload will fire when first frame has loaded

      loading: false,      // true if still loading

      firstFrameOnly: false,      // if true only load the first frame

      width: null,       // width in pixels

      height: null,       // height in pixels

      frames: [],         // array of frames

      comment: &amp;#34;&amp;#34;,         // comments if found in file. Note I remember that some gifs have comments per frame if so this will be all comment concatenated

      length: 0,          // gif length in ms (1/1000 second)

      currentFrame: 0,          // current frame.

      frameCount: 0,          // number of frames

      playSpeed: 1,          // play speed 1 normal, 2 twice 0.5 half, -1 reverse etc...

      lastFrame: null,       // temp hold last frame loaded so you can display the gif as it loads

      image: null,       // the current image at the currentFrame

      playOnLoad: true,       // if true starts playback when loaded

      // functions

      load: loadGif,    // call this to load a file

      cancel: cancelLoad, // call to stop loading

      play: play,       // call to start play

      pause: pause,      // call to pause

      seek: seek,       // call to seek to time

      seekFrame: seekFrame,  // call to seek to frame

      togglePlay: togglePlay, // call to toggle play and pause state

  };

  return gif;

}

  

export {

  GIF

}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;状态机&#34;&gt;状态机&lt;/h4&gt;
&lt;center&gt; 
	&lt;img style=&#34;border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);&#34; src=&#34;https://bu.dusays.com/2022/11/03/6363d89220c15.png&#34;&gt;
	&lt;br&gt;
	&lt;div style=&#34;color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;&#34;&gt;0：静止    1：移动     3：跳跃    4：攻击&lt;/div&gt; 
 &lt;/center&gt;
&lt;h2 id=&#34;myspace&#34;&gt;MySpace&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Xancoding/Learning-Vue&#34;&gt;MySpace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/video/3867/&#34;&gt;AcWing Web 应用课 | Vue3——网站整体布局、用户动态页面 | Vedio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/video/3875/&#34;&gt;AcWing Web 应用课 | Vue3——用户列表、登录、注册页面 | Vedio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
</description>
      <content:encoded><![CDATA[<ul>
<li><a href="https://www.colopen-blog.com/Engineer/acw_web/">AcWing Web 应用课 | Colopen&rsquo;s blog</a></li>
<li><a href="https://www.acwing.com/activity/content/punch_the_clock/1150/">AcWing Web 应用课</a>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/4078555/">HTML 基础标签</a></li>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/4194723/">CSS</a></li>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/4719082/">JavaScript</a></li>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/5501588/">React</a></li>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/5639568/">Vue3</a></li>
</ul>
</li>
<li><a href="https://developer.mozilla.org/zh-CN/">MDN官方文档</a>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Learn/Getting_started_with_the_web">Web 入门</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Learn/HTML">HTML —— 构建 Web</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Learn/CSS">CSS —— 设计Web</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript">JavaScript —— 用户端动态脚本</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Learn/Tools_and_testing/Client-side_JavaScript_frameworks/React_getting_started">React 入门</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Learn/Tools_and_testing/Client-side_JavaScript_frameworks/Vue_getting_started">Vue 入门</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial">Canvas 教程</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><code>VSCode</code> 自动生成缺省的 <code>HTML</code> 代码框架</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTML" data-lang="HTML"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">html</span> <span style="color:#007f7f">lang</span>=<span style="color:#0ff;font-weight:bold">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">meta</span> <span style="color:#007f7f">charset</span>=<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">meta</span> <span style="color:#007f7f">http-equiv</span>=<span style="color:#0ff;font-weight:bold">&#34;X-UA-Compatible&#34;</span> <span style="color:#007f7f">content</span>=<span style="color:#0ff;font-weight:bold">&#34;IE=edge&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">meta</span> <span style="color:#007f7f">name</span>=<span style="color:#0ff;font-weight:bold">&#34;viewport&#34;</span> <span style="color:#007f7f">content</span>=<span style="color:#0ff;font-weight:bold">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">title</span>&gt;Document&lt;/<span style="font-weight:bold">title</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">html</span>&gt;
</span></span></code></pre></div><ol>
<li>输入<code>！</code>，接着输入 <code>tab</code> 键，自动生成缺省的 <code>HTML</code> 代码框架</li>
<li>再按三下 <code>tab</code> 键，光标会移动到 <code>&lt;body&gt;</code> 与 <code>&lt;/body&gt;</code> 之间的空行</li>
</ol>
<hr>
<h2 id="kof">KOF</h2>
<ul>
<li><a href="https://github.com/Xancoding/Leaning-jQuery">KOF</a></li>
<li><a href="https://www.acwing.com/video/3830/">AcWing Web 应用课 | 中期项目——拳皇（上） | Vedio</a></li>
<li><a href="https://www.acwing.com/video/3833/">AcWing Web 应用课 | 中期项目——拳皇（下） | Vedio</a></li>
</ul>
<hr>
<h3 id="基础操作">基础操作</h3>
<pre tabindex="0"><code>操作如下：
角色一: w 跳 a 左移 d 右移 j 拳击 
角色二: ↑ 跳 ← 左移 → 右移 1 拳击
</code></pre><h3 id="文件结构">文件结构</h3>
<pre tabindex="0"><code>|-- README.md
|-- static
|   |-- css
|   |   `-- base.css
|   |-- images
|   |   |-- background
|   |   |   `-- 0.gif
|   |   `-- player
|   |       `-- kyo
|   |           |-- 0.gif
|   |           |-- 1.gif
|   |           |-- 2.gif
|   |           |-- 3.gif
|   |           |-- 4.gif
|   |           |-- 5.gif
|   |           `-- 6.gif
|   `-- js
|       |-- ac_game_object
|       |   `-- base.js
|       |-- base.js
|       |-- controller
|       |   `-- base.js
|       |-- game_map
|       |   `-- base.js
|       |-- player
|       |   |-- base.js
|       |   `-- kyo.js
|       `-- utils
|           `-- gif.js
`-- templates
    `-- index.html
</code></pre><h3 id="整体架构">整体架构</h3>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/02/63627b3105c46.png">
<img src="https://bu.dusays.com/2022/11/02/63627b3105c46.png" alt="KOFStructure"  />
</a>
</div>

</p>
<h3 id="逻辑结构">逻辑结构</h3>
<center> 
	<img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://bu.dusays.com/2022/11/02/63627ace5a2f9.png">
	<br>
	<div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">Retrieved from：https://www.acwing.com/solution/content/139831/</div> 
 </center>
<h3 id="html">HTML</h3>
<p><code>templates/index.html</code></p>
<pre tabindex="0"><code>&lt;!DOCTYPE html&gt;

&lt;html lang=&#34;en&#34;&gt;

&lt;head&gt;

  &lt;meta charset=&#34;UTF-8&#34;&gt;

  &lt;meta http-equiv=&#34;X-UA-Compatible&#34; content=&#34;IE=edge&#34;&gt;

  &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt;

  &lt;title&gt;KOF&lt;/title&gt;

  &lt;link rel=&#34;stylesheet&#34; href=&#34;../static/css/base.css&#34;&gt;

  &lt;script src=&#34;https://cdn.acwing.com/static/jquery/js/jquery-3.3.1.min.js&#34;&gt;&lt;/script&gt;

&lt;/head&gt;

&lt;body&gt;

  &lt;div id=&#34;kof&#34;&gt;&lt;/div&gt;

  

  &lt;script type=&#34;module&#34;&gt;

    import {KOF} from &#39;../static/js/base.js&#39;;

  

    let kof = new KOF(&#39;kof&#39;);

  &lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;
</code></pre><h3 id="css">CSS</h3>
<p><code>css/base.css</code></p>
<pre tabindex="0"><code>#kof {

  width: 1280px;

  height: 720px;

  background-image: url(&#39;../images/background/0.gif&#39;);

  background-size: 200% 100%;

  background-position: top;

  position: absolute;

}

  

#kof&gt;.kof-head {

  width: 100%;

  height: 80px;

  position: absolute;

  top: 0;

  display: flex;

  align-items: center;

}

  

#kof&gt;.kof-head&gt;.kof-head-hp-0 {

  height: 40px;

  width: calc(50% - 60px);

  margin-left: 20px;

  border: white 5px solid;

  box-sizing: border-box;

  border-right: none;

}

  

#kof&gt;.kof-head&gt;.kof-head-timer {

  height: 60px;

  width: 80px;

  background-color: orange;

  border: white 5px solid;

  box-sizing: border-box;

  color: white;

  font-size: 30px;

  font-weight: 800;

  text-align: center;

  line-height: 50px;

  user-select: none;

}

  

#kof&gt;.kof-head&gt;.kof-head-hp-1 {

  height: 40px;

  width: calc(50% - 60px);

  border: white 5px solid;

  box-sizing: border-box;

  border-left: none;

}

  

#kof&gt;.kof-head&gt;.kof-head-hp-0&gt;div {

  background-color: red;

  height: 100%;

  width: 100%;

  float: right;

}

  

#kof&gt;.kof-head&gt;.kof-head-hp-1&gt;div {

  background-color: red;

  height: 100%;

  width: 100%;

}

  

#kof&gt;.kof-head&gt;.kof-head-hp-0&gt;div&gt;div {

  background-color: lightgreen;

  height: 100%;

  width: 100%;

  float: right;

}

  

#kof&gt;.kof-head&gt;.kof-head-hp-1&gt;div&gt;div {

  background-color: lightgreen;

  height: 100%;

  width: 100%;

}
</code></pre><h3 id="javascript">JavaScript</h3>
<h4 id="逻辑结构-1">逻辑结构</h4>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/03/63631ec3461ef.png">
<img src="https://bu.dusays.com/2022/11/03/63631ec3461ef.png" alt="逻辑结构"  />
</a>
</div>

</p>
<h4 id="kof-1">KOF</h4>
<p><code>js/base.js</code></p>
<pre tabindex="0"><code>import { GameMap } from &#39;../js/game_map/base.js&#39;

import { Kyo } from &#39;../js/player/kyo.js&#39;;

  

export class KOF {

  constructor(id) {

    this.$kof = $(&#39;#&#39; + id);

  

    this.game_map = new GameMap(this);

    this.players = [

      new Kyo(this, {

        id: 0,

        x: 200,

        y: 0,

        width: 120,

        height: 200,

        color: &#39;blue&#39;

      }),

      new Kyo(this, {

        id: 1,

        x: 900,

        y: 0,

        width: 120,

        height: 200,

        color: &#39;red&#39;

      })

    ]

  }

}
</code></pre><h4 id="acgameobject">AcGameObject</h4>
<p><code>js/ac_game_object/base.js</code></p>
<pre tabindex="0"><code>let AC_GAME_OBJECTS = [];

  

export class AcGameObject {

  constructor() {

    AC_GAME_OBJECTS.push(this);

  

    this.timedelta = 0;

    this.has_call_start = false;

  }

  

  start() {  // 初始化

  
  

  }

  

  update() {  // 每一帧执行一次

  

  }

  

  destory() {  // 删除当前对象

    for (let i in AC_GAME_OBJECTS) {

      if (AC_GAME_OBJECTS[i] === this) {

        AC_GAME_OBJECTS.splice(i, 1);

        break;

      }

    }

  }

}

  

let last_timestamp;   // 上一次执行函数时的时刻

  

/**

 * @description 该函数每一帧执行一次

 * @param {number} timestamp 当前执行函数时的时刻

 */

  

let AC_GAME_OBJECTS_FRAME = (timestamp) =&gt; {

  for (let obj of AC_GAME_OBJECTS) {

    if (!obj.has_call_start) {

      obj.start();

      obj.has_call_start = true;

    } else {

      obj.timedelta = timestamp - last_timestamp;

      obj.update();

    }

  }

  

  last_timestamp = timestamp;

  requestAnimationFrame(AC_GAME_OBJECTS_FRAME);

}

  

requestAnimationFrame(AC_GAME_OBJECTS_FRAME);
</code></pre><h4 id="controller">Controller</h4>
<ul>
<li><code>controller</code> 控制器，读取玩家的输入
<code>js/constroller/base.js</code></li>
</ul>
<pre tabindex="0"><code>export class Controller {   // 手动实现键盘触发事件——当前按住的按键（效果不同于keydown）

  constructor($canvas) {

    this.$canvas = $canvas;

    this.pressed_keys = new Set();    // Set 对象允许你存储任何类型的唯一值

    this.start();

  }

  

  start() {

    let outer = this;

    this.$canvas.keydown(function(e){   // keydown：某个键是否被按住，事件会连续触发

      outer.pressed_keys.add(e.key);

    });

  

    this.$canvas.keyup(function(e){   // keyup：某个按键是否被释放

      outer.pressed_keys.delete(e.key);

    });

  

  }

}
</code></pre><h4 id="gamemap">GameMap</h4>
<p><code>js/game_map/base.js</code></p>
<pre tabindex="0"><code>import {AcGameObject} from &#39;../ac_game_object/base.js&#39;

import { Controller } from &#39;../controller/base.js&#39;;

  

export class GameMap extends AcGameObject {

  constructor(root) {

    super();

  

    this.root = root;

    this.$canvas = $(&#39;&lt;canvas width=&#34;1280&#34; height=&#34;720&#34; tabindex=0&gt;&lt;/canvas&gt;&#39;);   // 构造一个jQuery对象  其中，tabindex=&#34;0&#34;使&lt;canvas&gt;元素可以聚焦

    this.ctx = this.$canvas[0].getContext(&#39;2d&#39;);  // this.$canvas[0]是&lt;canvas&gt;元素的DOM对象   this.ctx用于画布的渲染

    this.root.$kof.append(this.$canvas);

    this.$canvas.focus();   // 聚焦，使之可以获取输入

  

    this.controller = new Controller(this.$canvas);

  

    // 加入血条

    this.root.$kof.append($(`

      &lt;div class=&#34;kof-head&#34;&gt;

        &lt;div class=&#34;kof-head-hp-0&#34;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;

        &lt;div class=&#34;kof-head-timer&#34;&gt;&lt;/div&gt;

        &lt;div class=&#34;kof-head-hp-1&#34;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;

      &lt;/div&gt;

    `));

  

    // 加入计时表

    this.time_left = 60000;  //单位：毫秒（因为定义的timedelta单位是ms）

    this.$timer = this.root.$kof.find(&#39;.kof-head-timer&#39;);

  }

  

  start() {

  

  }

  

  update() {

    this.update_time();

  

    this.render();

  }

  

  update_time() {

    this.time_left -= this.timedelta;

    if (this.time_left &lt; 0) {   // 时间到，游戏结束

      this.time_left = 0;

  

      let [a, b] = this.root.players;

      if (a.status !== 6 &amp;&amp; b.status !== 6) {

        a.statu = b.status = 6;

        a.frame_current_cnt = b.frame_current_cnt = 0;

        a.vx = b.vx = 0;

      }

    }

    this.$timer.text(parseInt(this.time_left / 1000));

  }

  

  render() {

    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);

  }

}
</code></pre><h4 id="player">Player</h4>
<p><code>js/player/base.js</code></p>
<pre tabindex="0"><code>import { AcGameObject } from &#39;../ac_game_object/base.js&#39;;

  

export class Player extends AcGameObject {

  constructor(root, info) {

    super();

  

    this.root = root;

    this.id = info.id;

    this.x = info.x;

    this.y = info.y;

    this.width = info.width;

    this.height = info.height;

    this.color = info.color;

  

    this.direction = 1;

  

    this.vx = 0;

    this.vy = 0;

  

    this.speedx = 400;  // 水平速度

    this.speedy = -1000;  // 跳跃初始速度

  

    this.gravity = 50;

  

    this.ctx = this.root.game_map.ctx;

    this.pressed_keys = this.root.game_map.controller.pressed_keys;

    this.status = 3;  // 0：静止， 1：向前，2：向后，3：跳跃，4：攻击，5：被攻击，6：死亡   随着项目的完善，动作会变的很多，这时用数组存储字符串代替this.status会更方便

    this.animations = new Map();  // 存储GIF动画的每一帧

    this.frame_current_cnt = 0;  // 记录当前的帧数

  

    this.hp = 100;

    this.$hp = this.root.$kof.find(`.kof-head-hp-${this.id}&gt;div`);

    this.$hp_div = this.$hp.find(&#39;div&#39;);

  }

  start() {

  }

  

  update_control() {

    let w, a, d, j;

    if (this.id === 0) {

      w = this.pressed_keys.has(&#39;w&#39;);

      a = this.pressed_keys.has(&#39;a&#39;);

      d = this.pressed_keys.has(&#39;d&#39;);

      j = this.pressed_keys.has(&#39;j&#39;);

    } else {

      w = this.pressed_keys.has(&#39;ArrowUp&#39;);

      a = this.pressed_keys.has(&#39;ArrowLeft&#39;);

      d = this.pressed_keys.has(&#39;ArrowRight&#39;);

      j = this.pressed_keys.has(&#39;1&#39;);

    }

  

    if (this.status === 0 || this.status === 1) {   // 静止状态 || 移动状态

      if (j) {  // 攻击

        this.status = 4;

        this.vx = 0;

        this.frame_current_cnt = 0;

      } else if (w) {  // 跳跃

        if (d) {  // 向右跳

          this.vx = this.speedx;

        } else if (a) {  // 向左跳

          this.vx = -this.speedx;

        } else {  // 垂直跳

          this.vx = 0;

        }

        this.vy = this.speedy;

        this.status = 3;

        this.frame_current_cnt = 0; // 每次跳跃重新记录帧数，确保跳跃动画正常

  

      } else if (d) {  // 向右移动

        this.vx = this.speedx;

        this.status = 1;

      } else if (a) {  // 向左移动

        this.vx = - this.speedx;

        this.status = 1;

      } else {  // 静止

        this.vx = 0;

      }

    }

  

  }

  update_move() {

    this.vy += this.gravity;

  

    this.x += this.vx * this.timedelta / 1000;

    this.y += this.vy * this.timedelta / 1000;

  

    // 确保两个角色不会重叠   a 是自己、b 是对手

    // let [a, b] = this.root.players;

    // if (a !== this) [a,b] = [b, a];

  

    // let r1 = {

    //   x1: a.x,

    //   y1: a.y,

    //   x2: a.x + a.width,

    //   y2: a.x + a.height,

    // };

    // let r2 = {

    //   x1: b.x,

    //   y1: b.y,

    //   x2: b.x + b.width,

    //   y2: b.x + b.height,

    // };

  

    // if (this.is_collusion(r1, r2)) {

    //   b.x += this.vx * this.timedelta / 1000 / 2;

    //   b.y += this.vy * this.timedelta / 1000 / 2;

    //   a.x -= this.vx * this.timedelta / 1000 / 2;

    //   a.y -= this.vy * this.timedelta / 1000 / 2;

  

    //   if (this.status === 3) this.status = 0;

    // }

  

    // 落到平地上后静止

    if (this.y &gt; 450) {

      this.y = 450;

      this.vy = 0;

      if (this.status === 3) this.status = 0;   // 因为任何时刻都有重力施加，不加这一句会导致状态只有静止状态

    }

  

    // 不能超出左右边界

    if (this.x &lt; 0) {

      this.x = 0;

    } else if (this.x + this.width &gt; this.root.game_map.$canvas.width()) {

      this.x = this.root.game_map.$canvas.width() - this.width;

    }

  

  }

  

  update_direction() {  // 确保两个角色始终相对

    if (this.status === 6) return;

  

    let players = this.root.players;

    if (players[0] &amp;&amp; players[1]) {

      let me = this, you = players[1 - this.id];

      if (me.x &lt; you.x) me.direction = 1;

      else me.direction = -1;

    }

  }

  

  is_collusion(r1, r2) {  // 判断两个矩阵是否有交集

    if (Math.max(r1.x1, r2.x1) &gt; Math.min(r1.x2, r2.x2))

      return false;

    if (Math.max(r1.y1, r2.y1) &gt; Math.min(r1.y2,r2.y2))

      return false;

    return true;

  }

  

  is_attack() {

    if (this.status === 6) return;  // 已经倒地，无法再被攻击

  

    this.status = 5;

    this.frame_current_cnt = 0;

  

    this.hp = Math.max(this.hp - 10, 0);

  

    this.$hp_div.animate({  // 血条减少，渐变

      width: this.$hp.parent().width() * this.hp / 100,

    }, 350);

  

    this.$hp.animate({  // 血条减少，渐变

      width: this.$hp.parent().width() * this.hp / 100,

    }, 600);

  

    if (this.hp &lt;= 0) {

      this.status = 6;

      this.frame_current_cnt = 0;

      this.vx = 0;

    }

  }

  

  update_attack() {   // 判定是否被攻击到

    if (this.status === 4 &amp;&amp; this.frame_current_cnt === 18) {   // 第18帧时动画挥出拳，判断此时是否拳头与对方有碰撞

      let me = this, you = this.root.players[1 - this.id];

      let r1;  // 攻击判定矩形

      let r2;  // 敌方人物矩形

      if (this.direction &gt; 0) {

        r1 = {

          x1: me.x + 120,

          y1: me.y + 40,

          x2: me.x + 120 + 100,

          y2: me.y + 40 + 20,

        }

      } else {

        r1 = {

          x1: me.x + me.width - 120 - 100,

          y1: me.y + 40,

          x2: me.x + me.width - 120 - 100 + 100,

          y2: me.y + 40 + 20,

        }

      }

  

      r2 = {

        x1: you.x,

        y2: you.y,

        x2: you.x + you.width,

        y2: you.y + you.height

      };

  

      if (this.is_collusion(r1, r2)) {

        you.is_attack();

      }

    }

  }

  

  update() {

    this.update_attack();

    this.update_direction();

    this.update_control();

    this.update_move();

    this.render();

  }

  

  render() {

  

    let status = this.status;

  

    if (this.status === 1 &amp;&amp; this.direction * this.vx &lt; 0) status = 2;    // 后退状态

  

    let obj = this.animations.get(status);

    if (obj &amp;&amp; obj.loaded) {    // GIF 已经加载完成

      if (this.direction &gt; 0) {  // 正方向

        let k = parseInt(this.frame_current_cnt / obj.frame_rate) % obj.frame_cnt;  // 通过obj.frame_rate控制渲染动画的速率，方便控制动画，而不只是单纯的每一帧都渲染一次

        let image = obj.gif.frames[k].image;

        this.ctx.drawImage(image, this.x, this.y + obj.offset_y, image.width * obj.scale, image.height * obj.scale);

      } else {  // 反方向   通过调整坐标系来翻转方向

        this.ctx.save();

        this.ctx.scale(-1, 1);

        this.ctx.translate(-this.root.game_map.$canvas.width(), 0);

  

        let k = parseInt(this.frame_current_cnt / obj.frame_rate) % obj.frame_cnt;

        let image = obj.gif.frames[k].image;

        this.ctx.drawImage(image, this.root.game_map.$canvas.width() - this.width - this.x, this.y + obj.offset_y, image.width * obj.scale, image.height * obj.scale);  // 不同于正方向时的渲染，因为此时坐标系改变，需要在对称的位置渲染

  

        this.ctx.restore();

      }

    }

  

    if (status === 4 || status === 5 || status === 6) {  // 确保不会一直循环GIF

      if (this.frame_current_cnt === obj.frame_rate * (obj.frame_cnt - 1)) {  // 确保此时已经播放完一次GIF动画

        if (status === 6) {   // 死亡倒地不起，这里的 -- 和 下面的 ++ 相抵消，使之在最后一帧不再变化

          this.frame_current_cnt--;

        } else {

          this.status = 0;

        }

      }

    }

  

    this.frame_current_cnt++;

  }

}
</code></pre><p><code>js/player/kyo.js</code></p>
<pre tabindex="0"><code>import { Player } from &#34;../player/base.js&#34;;

import {GIF} from &#39;../utils/gif.js&#39;

  

export class Kyo extends Player {

  constructor(root, info) {

    super(root, info);

  

    this.init_animations();   // 初始化动画

  }

  

  init_animations() {

    let outer = this;

    let offsets = [0, -22, -22, -150, 0, 0, 0];   // 偏移量 不同的动画高度不同，因此需要借助竖直方向上的偏移量将他们调整至同一水平面

    for (let i = 0; i &lt; 7; ++ i) {  // 7个动作

      let gif = GIF();

      gif.load(`/static/images/player/kyo/${i}.gif`);

      this.animations.set(i, {  // 动画

        gif: gif,

        frame_cnt: 0,  // GIF帧数

        frame_rate: 5,  // 每5帧过渡一次

        offset_y: offsets[i],  // y方向偏移量

        loaded: false,  // 是否加载完成

        scale: 2,  // 放大2倍

      });

  

      gif.onload = function() {   // 加载完成

        let obj = outer.animations.get(i);

        obj.frame_cnt = gif.frames.length;

        obj.loaded = true;

  

        if (i === 3) {  // 调整跳跃时GIF播放速率

          obj.frame_rate = 4;

        }

      }

    }

  }

}
</code></pre><h4 id="gif">GIF</h4>
<ul>
<li><a href="https://stackoverflow.com/questions/48234696/how-to-put-a-gif-with-canvas/48348567#48348567">Loading and playing GIF image to canvas</a>    把玩家的<code>GIF</code>动画渲染在<code>canvas</code>上</li>
</ul>
<hr>
<p><code>js/utils/gif.js</code></p>
<pre tabindex="0"><code>const GIF = function () {

  // **NOT** for commercial use.

  var timerID;                          // timer handle for set time out usage

  var st;                               // holds the stream object when loading.

  var interlaceOffsets = [0, 4, 2, 1]; // used in de-interlacing.

  var interlaceSteps = [8, 8, 4, 2];

  var interlacedBufSize;  // this holds a buffer to de interlace. Created on the first frame and when size changed

  var deinterlaceBuf;

  var pixelBufSize;    // this holds a buffer for pixels. Created on the first frame and when size changed

  var pixelBuf;

  const GIF_FILE = { // gif file data headers

    GCExt: 0xF9,

    COMMENT: 0xFE,

    APPExt: 0xFF,

    UNKNOWN: 0x01, // not sure what this is but need to skip it in parser

    IMAGE: 0x2C,

    EOF: 59,   // This is entered as decimal

    EXT: 0x21,

  };

  // simple buffered stream used to read from the file

  var Stream = function (data) {

      this.data = new Uint8ClampedArray(data);

      this.pos = 0;

      var len = this.data.length;

      this.getString = function (count) { // returns a string from current pos of len count

          var s = &#34;&#34;;

          while (count--) { s += String.fromCharCode(this.data[this.pos++]) }

          return s;

      };

      this.readSubBlocks = function () { // reads a set of blocks as a string

          var size, count, data = &#34;&#34;;

          do {

              count = size = this.data[this.pos++];

              while (count--) { data += String.fromCharCode(this.data[this.pos++]) }

          } while (size !== 0 &amp;&amp; this.pos &lt; len);

          return data;

      }

      this.readSubBlocksB = function () { // reads a set of blocks as binary

          var size, count, data = [];

          do {

              count = size = this.data[this.pos++];

              while (count--) { data.push(this.data[this.pos++]); }

          } while (size !== 0 &amp;&amp; this.pos &lt; len);

          return data;

      }

  };

  // LZW decoder uncompressed each frames pixels

  // this needs to be optimised.

  // minSize is the min dictionary as powers of two

  // size and data is the compressed pixels

  function lzwDecode(minSize, data) {

      var i, pixelPos, pos, clear, eod, size, done, dic, code, last, d, len;

      pos = pixelPos = 0;

      dic = [];

      clear = 1 &lt;&lt; minSize;

      eod = clear + 1;

      size = minSize + 1;

      done = false;

      while (!done) { // JavaScript optimisers like a clear exit though I never use &#39;done&#39; apart from fooling the optimiser

          last = code;

          code = 0;

          for (i = 0; i &lt; size; i++) {

              if (data[pos &gt;&gt; 3] &amp; (1 &lt;&lt; (pos &amp; 7))) { code |= 1 &lt;&lt; i }

              pos++;

          }

          if (code === clear) { // clear and reset the dictionary

              dic = [];

              size = minSize + 1;

              for (i = 0; i &lt; clear; i++) { dic[i] = [i] }

              dic[clear] = [];

              dic[eod] = null;

          } else {

              if (code === eod) { done = true; return }

              if (code &gt;= dic.length) { dic.push(dic[last].concat(dic[last][0])) }

              else if (last !== clear) { dic.push(dic[last].concat(dic[code][0])) }

              d = dic[code];

              len = d.length;

              for (i = 0; i &lt; len; i++) { pixelBuf[pixelPos++] = d[i] }

              if (dic.length === (1 &lt;&lt; size) &amp;&amp; size &lt; 12) { size++ }

          }

      }

  };

  function parseColourTable(count) { // get a colour table of length count  Each entry is 3 bytes, for RGB.

      var colours = [];

      for (var i = 0; i &lt; count; i++) { colours.push([st.data[st.pos++], st.data[st.pos++], st.data[st.pos++]]) }

      return colours;

  }

  function parse() {        // read the header. This is the starting point of the decode and async calls parseBlock

      var bitField;

      st.pos += 6;

      gif.width = (st.data[st.pos++]) + ((st.data[st.pos++]) &lt;&lt; 8);

      gif.height = (st.data[st.pos++]) + ((st.data[st.pos++]) &lt;&lt; 8);

      bitField = st.data[st.pos++];

      gif.colorRes = (bitField &amp; 0b1110000) &gt;&gt; 4;

      gif.globalColourCount = 1 &lt;&lt; ((bitField &amp; 0b111) + 1);

      gif.bgColourIndex = st.data[st.pos++];

      st.pos++;                    // ignoring pixel aspect ratio. if not 0, aspectRatio = (pixelAspectRatio + 15) / 64

      if (bitField &amp; 0b10000000) { gif.globalColourTable = parseColourTable(gif.globalColourCount) } // global colour flag

      setTimeout(parseBlock, 0);

  }

  function parseAppExt() { // get application specific data. Netscape added iterations and terminator. Ignoring that

      st.pos += 1;

      if (&#39;NETSCAPE&#39; === st.getString(8)) { st.pos += 8 }  // ignoring this data. iterations (word) and terminator (byte)

      else {

          st.pos += 3;            // 3 bytes of string usually &#34;2.0&#34; when identifier is NETSCAPE

          st.readSubBlocks();     // unknown app extension

      }

  };

  function parseGCExt() { // get GC data

      var bitField;

      st.pos++;

      bitField = st.data[st.pos++];

      gif.disposalMethod = (bitField &amp; 0b11100) &gt;&gt; 2;

      gif.transparencyGiven = bitField &amp; 0b1 ? true : false; // ignoring bit two that is marked as  userInput???

      gif.delayTime = (st.data[st.pos++]) + ((st.data[st.pos++]) &lt;&lt; 8);

      gif.transparencyIndex = st.data[st.pos++];

      st.pos++;

  };

  function parseImg() {                           // decodes image data to create the indexed pixel image

      var deinterlace, frame, bitField;

      deinterlace = function (width) {                   // de interlace pixel data if needed

          var lines, fromLine, pass, toline;

          lines = pixelBufSize / width;

          fromLine = 0;

          if (interlacedBufSize !== pixelBufSize) {      // create the buffer if size changed or undefined.

              deinterlaceBuf = new Uint8Array(pixelBufSize);

              interlacedBufSize = pixelBufSize;

          }

          for (pass = 0; pass &lt; 4; pass++) {

              for (toLine = interlaceOffsets[pass]; toLine &lt; lines; toLine += interlaceSteps[pass]) {

                  deinterlaceBuf.set(pixelBuf.subarray(fromLine, fromLine + width), toLine * width);

                  fromLine += width;

              }

          }

      };

      frame = {}

      gif.frames.push(frame);

      frame.disposalMethod = gif.disposalMethod;

      frame.time = gif.length;

      frame.delay = gif.delayTime * 10;

      gif.length += frame.delay;

      if (gif.transparencyGiven) { frame.transparencyIndex = gif.transparencyIndex }

      else { frame.transparencyIndex = undefined }

      frame.leftPos = (st.data[st.pos++]) + ((st.data[st.pos++]) &lt;&lt; 8);

      frame.topPos = (st.data[st.pos++]) + ((st.data[st.pos++]) &lt;&lt; 8);

      frame.width = (st.data[st.pos++]) + ((st.data[st.pos++]) &lt;&lt; 8);

      frame.height = (st.data[st.pos++]) + ((st.data[st.pos++]) &lt;&lt; 8);

      bitField = st.data[st.pos++];

      frame.localColourTableFlag = bitField &amp; 0b10000000 ? true : false;

      if (frame.localColourTableFlag) { frame.localColourTable = parseColourTable(1 &lt;&lt; ((bitField &amp; 0b111) + 1)) }

      if (pixelBufSize !== frame.width * frame.height) { // create a pixel buffer if not yet created or if current frame size is different from previous

          pixelBuf = new Uint8Array(frame.width * frame.height);

          pixelBufSize = frame.width * frame.height;

      }

      lzwDecode(st.data[st.pos++], st.readSubBlocksB()); // decode the pixels

      if (bitField &amp; 0b1000000) {                        // de interlace if needed

          frame.interlaced = true;

          deinterlace(frame.width);

      } else { frame.interlaced = false }

      processFrame(frame);                               // convert to canvas image

  };

  function processFrame(frame) { // creates a RGBA canvas image from the indexed pixel data.

      var ct, cData, dat, pixCount, ind, useT, i, pixel, pDat, col, frame, ti;

      frame.image = document.createElement(&#39;canvas&#39;);

      frame.image.width = gif.width;

      frame.image.height = gif.height;

      frame.image.ctx = frame.image.getContext(&#34;2d&#34;);

      ct = frame.localColourTableFlag ? frame.localColourTable : gif.globalColourTable;

      if (gif.lastFrame === null) { gif.lastFrame = frame }

      useT = (gif.lastFrame.disposalMethod === 2 || gif.lastFrame.disposalMethod === 3) ? true : false;

      if (!useT) { frame.image.ctx.drawImage(gif.lastFrame.image, 0, 0, gif.width, gif.height) }

      cData = frame.image.ctx.getImageData(frame.leftPos, frame.topPos, frame.width, frame.height);

      ti = frame.transparencyIndex;

      dat = cData.data;

      if (frame.interlaced) { pDat = deinterlaceBuf }

      else { pDat = pixelBuf }

      pixCount = pDat.length;

      ind = 0;

      for (i = 0; i &lt; pixCount; i++) {

          pixel = pDat[i];

          col = ct[pixel];

          if (ti !== pixel) {

              dat[ind++] = col[0];

              dat[ind++] = col[1];

              dat[ind++] = col[2];

              dat[ind++] = 255;      // Opaque.

          } else

              if (useT) {

                  dat[ind + 3] = 0; // Transparent.

                  ind += 4;

              } else { ind += 4 }

      }

      frame.image.ctx.putImageData(cData, frame.leftPos, frame.topPos);

      gif.lastFrame = frame;

      if (!gif.waitTillDone &amp;&amp; typeof gif.onload === &#34;function&#34;) { doOnloadEvent() }// if !waitTillDone the call onload now after first frame is loaded

  };

  // **NOT** for commercial use.

  function finnished() { // called when the load has completed

      gif.loading = false;

      gif.frameCount = gif.frames.length;

      gif.lastFrame = null;

      st = undefined;

      gif.complete = true;

      gif.disposalMethod = undefined;

      gif.transparencyGiven = undefined;

      gif.delayTime = undefined;

      gif.transparencyIndex = undefined;

      gif.waitTillDone = undefined;

      pixelBuf = undefined; // dereference pixel buffer

      deinterlaceBuf = undefined; // dereference interlace buff (may or may not be used);

      pixelBufSize = undefined;

      deinterlaceBuf = undefined;

      gif.currentFrame = 0;

      if (gif.frames.length &gt; 0) { gif.image = gif.frames[0].image }

      doOnloadEvent();

      if (typeof gif.onloadall === &#34;function&#34;) {

          (gif.onloadall.bind(gif))({ type: &#39;loadall&#39;, path: [gif] });

      }

      if (gif.playOnLoad) { gif.play() }

  }

  function canceled() { // called if the load has been cancelled

      finnished();

      if (typeof gif.cancelCallback === &#34;function&#34;) { (gif.cancelCallback.bind(gif))({ type: &#39;canceled&#39;, path: [gif] }) }

  }

  function parseExt() {              // parse extended blocks

      const blockID = st.data[st.pos++];

      if (blockID === GIF_FILE.GCExt) { parseGCExt() }

      else if (blockID === GIF_FILE.COMMENT) { gif.comment += st.readSubBlocks() }

      else if (blockID === GIF_FILE.APPExt) { parseAppExt() }

      else {

          if (blockID === GIF_FILE.UNKNOWN) { st.pos += 13; } // skip unknow block

          st.readSubBlocks();

      }

  

  }

  function parseBlock() { // parsing the blocks

      if (gif.cancel !== undefined &amp;&amp; gif.cancel === true) { canceled(); return }

  

      const blockId = st.data[st.pos++];

      if (blockId === GIF_FILE.IMAGE) { // image block

          parseImg();

          if (gif.firstFrameOnly) { finnished(); return }

      } else if (blockId === GIF_FILE.EOF) { finnished(); return }

      else { parseExt() }

      if (typeof gif.onprogress === &#34;function&#34;) {

          gif.onprogress({ bytesRead: st.pos, totalBytes: st.data.length, frame: gif.frames.length });

      }

      setTimeout(parseBlock, 0); // parsing frame async so processes can get some time in.

  };

  function cancelLoad(callback) { // cancels the loading. This will cancel the load before the next frame is decoded

      if (gif.complete) { return false }

      gif.cancelCallback = callback;

      gif.cancel = true;

      return true;

  }

  function error(type) {

      if (typeof gif.onerror === &#34;function&#34;) { (gif.onerror.bind(this))({ type: type, path: [this] }) }

      gif.onload = gif.onerror = undefined;

      gif.loading = false;

  }

  function doOnloadEvent() { // fire onload event if set

      gif.currentFrame = 0;

      gif.nextFrameAt = gif.lastFrameAt = new Date().valueOf(); // just sets the time now

      if (typeof gif.onload === &#34;function&#34;) { (gif.onload.bind(gif))({ type: &#39;load&#39;, path: [gif] }) }

      gif.onerror = gif.onload = undefined;

  }

  function dataLoaded(data) { // Data loaded create stream and parse

      st = new Stream(data);

      parse();

  }

  function loadGif(filename) { // starts the load

      var ajax = new XMLHttpRequest();

      ajax.responseType = &#34;arraybuffer&#34;;

      ajax.onload = function (e) {

          if (e.target.status === 404) { error(&#34;File not found&#34;) }

          else if (e.target.status &gt;= 200 &amp;&amp; e.target.status &lt; 300) { dataLoaded(ajax.response) }

          else { error(&#34;Loading error : &#34; + e.target.status) }

      };

      ajax.open(&#39;GET&#39;, filename, true);

      ajax.send();

      ajax.onerror = function (e) { error(&#34;File error&#34;) };

      this.src = filename;

      this.loading = true;

  }

  function play() { // starts play if paused

      if (!gif.playing) {

          gif.paused = false;

          gif.playing = true;

          playing();

      }

  }

  function pause() { // stops play

      gif.paused = true;

      gif.playing = false;

      clearTimeout(timerID);

  }

  function togglePlay() {

      if (gif.paused || !gif.playing) { gif.play() }

      else { gif.pause() }

  }

  function seekFrame(frame) { // seeks to frame number.

      clearTimeout(timerID);

      gif.currentFrame = frame % gif.frames.length;

      if (gif.playing) { playing() }

      else { gif.image = gif.frames[gif.currentFrame].image }

  }

  function seek(time) { // time in Seconds  // seek to frame that would be displayed at time

      clearTimeout(timerID);

      if (time &lt; 0) { time = 0 }

      time *= 1000; // in ms

      time %= gif.length;

      var frame = 0;

      while (time &gt; gif.frames[frame].time + gif.frames[frame].delay &amp;&amp; frame &lt; gif.frames.length) { frame += 1 }

      gif.currentFrame = frame;

      if (gif.playing) { playing() }

      else { gif.image = gif.frames[gif.currentFrame].image }

  }

  function playing() {

      var delay;

      var frame;

      if (gif.playSpeed === 0) {

          gif.pause();

          return;

      } else {

          if (gif.playSpeed &lt; 0) {

              gif.currentFrame -= 1;

              if (gif.currentFrame &lt; 0) { gif.currentFrame = gif.frames.length - 1 }

              frame = gif.currentFrame;

              frame -= 1;

              if (frame &lt; 0) { frame = gif.frames.length - 1 }

              delay = -gif.frames[frame].delay * 1 / gif.playSpeed;

          } else {

              gif.currentFrame += 1;

              gif.currentFrame %= gif.frames.length;

              delay = gif.frames[gif.currentFrame].delay * 1 / gif.playSpeed;

          }

          gif.image = gif.frames[gif.currentFrame].image;

          timerID = setTimeout(playing, delay);

      }

  }

  var gif = {                      // the gif image object

      onload: null,       // fire on load. Use waitTillDone = true to have load fire at end or false to fire on first frame

      onerror: null,       // fires on error

      onprogress: null,       // fires a load progress event

      onloadall: null,       // event fires when all frames have loaded and gif is ready

      paused: false,      // true if paused

      playing: false,      // true if playing

      waitTillDone: true,       // If true onload will fire when all frames loaded, if false, onload will fire when first frame has loaded

      loading: false,      // true if still loading

      firstFrameOnly: false,      // if true only load the first frame

      width: null,       // width in pixels

      height: null,       // height in pixels

      frames: [],         // array of frames

      comment: &#34;&#34;,         // comments if found in file. Note I remember that some gifs have comments per frame if so this will be all comment concatenated

      length: 0,          // gif length in ms (1/1000 second)

      currentFrame: 0,          // current frame.

      frameCount: 0,          // number of frames

      playSpeed: 1,          // play speed 1 normal, 2 twice 0.5 half, -1 reverse etc...

      lastFrame: null,       // temp hold last frame loaded so you can display the gif as it loads

      image: null,       // the current image at the currentFrame

      playOnLoad: true,       // if true starts playback when loaded

      // functions

      load: loadGif,    // call this to load a file

      cancel: cancelLoad, // call to stop loading

      play: play,       // call to start play

      pause: pause,      // call to pause

      seek: seek,       // call to seek to time

      seekFrame: seekFrame,  // call to seek to frame

      togglePlay: togglePlay, // call to toggle play and pause state

  };

  return gif;

}

  

export {

  GIF

}
</code></pre><h4 id="状态机">状态机</h4>
<center> 
	<img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://bu.dusays.com/2022/11/03/6363d89220c15.png">
	<br>
	<div style="color:orange; border-bottom: 1px solid #d9d9d9; 
	display: inline-block; 
	color: #999; 
	padding: 2px;">0：静止    1：移动     3：跳跃    4：攻击</div> 
 </center>
<h2 id="myspace">MySpace</h2>
<ul>
<li><a href="https://github.com/Xancoding/Learning-Vue">MySpace</a></li>
<li><a href="https://www.acwing.com/video/3867/">AcWing Web 应用课 | Vue3——网站整体布局、用户动态页面 | Vedio</a></li>
<li><a href="https://www.acwing.com/video/3875/">AcWing Web 应用课 | Vue3——用户列表、登录、注册页面 | Vedio</a></li>
</ul>
<hr>
]]></content:encoded>
    </item>
    
    <item>
      <title>如何为你的文章配图？</title>
      <link>https://xancoding.cn/posts/blog-drawing/</link>
      <pubDate>Mon, 31 Oct 2022 18:01:02 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/blog-drawing/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;画图的工具并不重要，重要的其实是你应该如何形成自己的规则体系，想要为博客配图并不是一件困难的事情，比较困难的是长期坚持并且经常思考，对自己形成的规则不断改善，最终就一定能够做好。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;推荐阅读&#34;&gt;推荐阅读&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.lucidchart.com/pages/&#34;&gt;Sketch&lt;/a&gt; UI 设计工具&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.figma.com/&#34;&gt;Figma&lt;/a&gt; UI 设计工具&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lanhuapp.com/&#34;&gt;蓝湖&lt;/a&gt; UI 设计工具&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.lucidchart.com/pages/&#34;&gt;LucidChart&lt;/a&gt; 绘制 UML 图、流程图的商业软件&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://excalidraw.com/&#34;&gt;Excalidraw&lt;/a&gt; 手绘风格图表工具&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://plantuml.com/&#34;&gt;Plantuml&lt;/a&gt; 快速编写UML图的组件&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://app.diagrams.net/&#34;&gt;Drawio&lt;/a&gt; 一款开源免费的流程图绘制软件&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.midjourney.com/home/&#34;&gt;Midjourney&lt;/a&gt; AI绘画&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/180534102&#34;&gt;Drawio —— 一款开源免费的流程图绘制软件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://397987634.notion.site/397987634/AI-764e6a50fbf04327945a12a07ce9654f&#34;&gt;AI绘画的关键词&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://draveness.me/sketch-and-sketch/&#34;&gt;技术文章配图指南&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://catcoding.me/p/weekly-15/&#34;&gt;编程和绘画；AI 从文本绘画；技术文章中的插图&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://sspai.com/post/75629&#34;&gt;在 AI 绘画的世界里，怎样才算一名合格的「甲方」？&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<blockquote>
<p><strong>画图的工具并不重要，重要的其实是你应该如何形成自己的规则体系，想要为博客配图并不是一件困难的事情，比较困难的是长期坚持并且经常思考，对自己形成的规则不断改善，最终就一定能够做好。</strong></p>
</blockquote>
<h1 id="推荐阅读">推荐阅读</h1>
<ul>
<li><a href="https://www.lucidchart.com/pages/">Sketch</a> UI 设计工具</li>
<li><a href="https://www.figma.com/">Figma</a> UI 设计工具</li>
<li><a href="https://lanhuapp.com/">蓝湖</a> UI 设计工具</li>
<li><a href="https://www.lucidchart.com/pages/">LucidChart</a> 绘制 UML 图、流程图的商业软件</li>
<li><a href="https://excalidraw.com/">Excalidraw</a> 手绘风格图表工具</li>
<li><a href="https://plantuml.com/">Plantuml</a> 快速编写UML图的组件</li>
<li><a href="https://app.diagrams.net/">Drawio</a> 一款开源免费的流程图绘制软件</li>
<li><a href="https://www.midjourney.com/home/">Midjourney</a> AI绘画</li>
</ul>
<hr>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/180534102">Drawio —— 一款开源免费的流程图绘制软件</a></li>
<li><a href="https://397987634.notion.site/397987634/AI-764e6a50fbf04327945a12a07ce9654f">AI绘画的关键词</a></li>
</ul>
<hr>
<ul>
<li>
<p><a href="https://draveness.me/sketch-and-sketch/">技术文章配图指南</a></p>
</li>
<li>
<p><a href="https://catcoding.me/p/weekly-15/">编程和绘画；AI 从文本绘画；技术文章中的插图</a></p>
</li>
<li>
<p><a href="https://sspai.com/post/75629">在 AI 绘画的世界里，怎样才算一名合格的「甲方」？</a></p>
</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>AcWing Django 框架课</title>
      <link>https://xancoding.cn/posts/acw-django/</link>
      <pubDate>Sat, 29 Oct 2022 18:23:59 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/acw-django/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.colopen-blog.com/Engineer/acw_django/&#34;&gt;AcWing Django 框架课 | Colopen&amp;rsquo;s blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/activity/content/punch_the_clock/72/&#34;&gt;AcWing Django 框架课&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;django-项目创建&#34;&gt;Django 项目创建&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/72577/&#34;&gt;2.1上课笔记 | 栎&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/73097/&#34;&gt;2.1上课笔记 | Andrew1729&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;启动初始项目&#34;&gt;启动初始项目&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;django-admin startproject acapp&lt;/code&gt;：在当前目录下创建名为&lt;code&gt;acapp&lt;/code&gt;的&lt;code&gt;django&lt;/code&gt;项目&lt;/li&gt;
&lt;li&gt;&lt;code&gt;python3 manage.py runserver 0.0.0.0:8000&lt;/code&gt;：启动项目
&lt;ol&gt;
&lt;li&gt;打开&lt;code&gt;settings.py&lt;/code&gt;，找到&lt;code&gt;ALLOWED_HOSTS=[]&lt;/code&gt;，修改成&lt;code&gt;ALLOWED_HOSTS=[&amp;quot;自己的服务器的公网IP&amp;quot;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;通过&lt;code&gt;自己的服务器公网IP:8000&lt;/code&gt; 打开Django页面&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;创建管理员登录页面&#34;&gt;创建管理员登录页面&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;在一级&lt;code&gt;acapp&lt;/code&gt;文件夹下，&lt;code&gt;python3 manage.py startapp XXX&lt;/code&gt;，&lt;code&gt;XXX&lt;/code&gt;是可以自定义的app名，这里用&lt;code&gt;game&lt;/code&gt;示例，这时候会多一个文件夹&lt;code&gt;game&lt;/code&gt;，树形结构如图：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;|-- game
|   |-- __init__.py
|   |-- admin.py          # 管理员页面
|   |-- apps.py           # 用的不多
|   |-- migrations        # 存储数据库
|   |   `-- __init__.py
|   |-- models.py         # 定义网站里的数据库表
|   |-- tests.py
|   `-- views.py          # 视图，即函数
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;code&gt;python3 manage.py migrate&lt;/code&gt;：将所有修改更新进数据库&lt;/li&gt;
&lt;li&gt;创建一个 &lt;strong&gt;管理员用户&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ python3 manage.py createsuperuser
&amp;gt; Username (leave blank to use &amp;#39;acs&amp;#39;): admin
&amp;gt; Email address: 
&amp;gt; Password: 123456
&amp;gt; Password (again): 123456
&amp;gt; Superuser created successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后利用该 &lt;strong&gt;管理员用户&lt;/strong&gt; 登录 &lt;code&gt;admin&lt;/code&gt; 页面，即可成功登陆&lt;/p&gt;
&lt;h2 id=&#34;创建用户登录页面&#34;&gt;创建用户登录页面&lt;/h2&gt;
&lt;h3 id=&#34;game-下的各个文件作用&#34;&gt;&lt;code&gt;game&lt;/code&gt; 下的各个文件作用&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;templates&lt;/code&gt;目录：管理 &lt;code&gt;html&lt;/code&gt;  文件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;urls&lt;/code&gt;目录：管理路由，即链接与函数的对应关系 (接收链接，调用相对应的函数)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;views&lt;/code&gt;目录：管理 &lt;code&gt;http&lt;/code&gt; 函数（接收浏览器请求，返回字符串至浏览器）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;models&lt;/code&gt;目录：管理数据库数据&lt;/li&gt;
&lt;li&gt;&lt;code&gt;static&lt;/code&gt;目录：管理静态文件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;consumers&lt;/code&gt;目录：管理&lt;code&gt;websocket&lt;/code&gt;函数&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;实现一个路由重定向&#34;&gt;实现一个路由重定向&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;url&lt;/code&gt; 输入网址 -&amp;gt; &lt;code&gt;acapp.urls&lt;/code&gt; -&amp;gt; &lt;code&gt;game.urls&lt;/code&gt; -&amp;gt; &lt;code&gt;game.views.index&lt;/code&gt; -&amp;gt; 展示页面&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;game.views&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这其中，&lt;code&gt;HttpResponse()&lt;/code&gt;内部使用&lt;code&gt;html&lt;/code&gt;的语法，返回的响应就直接用这个字符串作为页面，转换成&lt;code&gt;html&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.http import HttpResponse

def index(request):
    line1 = &amp;#39;&amp;lt;h1 style=&amp;#34;text-align: center&amp;#34;&amp;gt; 第一个网页 &amp;lt;/h1&amp;gt;&amp;#39;
    return HttpResponse(line1)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;game.urls&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这其中，&lt;code&gt;path(&#39;PATH&#39;, function, name)&lt;/code&gt;的含义是，在用户访问网站的时候，如果是&lt;code&gt;网站/game/PATH&lt;/code&gt;，就会调用&lt;code&gt;function&lt;/code&gt;，名字为&lt;code&gt;name&lt;/code&gt;，这是在&lt;code&gt;/game/&lt;/code&gt;目录下的调用，所以这个&lt;code&gt;PATH&lt;/code&gt;是在&lt;code&gt;/game/&lt;/code&gt;的基础上的&lt;strong&gt;相对路径&lt;/strong&gt;，所以他的&lt;strong&gt;绝对路径&lt;/strong&gt;是&lt;code&gt;网站/game/PATH&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.urls import path
from game.views import index

urlpatterns = [ 
    path(&amp;#34;&amp;#34;, index, name=&amp;#34;index&amp;#34;),
]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;acapp.urls&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这其中，&lt;code&gt;path(&#39;PATH&#39;, include(&#39;game.urls&#39;))&lt;/code&gt;的含义是：在用户访问网站的时候，如果是&lt;code&gt;网站/PATH&lt;/code&gt;，就会走到&lt;code&gt;/game/urls&lt;/code&gt;，并根据&lt;code&gt;/game/urls.py&lt;/code&gt;来跑路由，就是说，用户在访问&lt;code&gt;网站/&lt;/code&gt;的时候，由于此时调用的函数是&lt;code&gt;include(&#39;game.urls&#39;)&lt;/code&gt;，所以访问&lt;code&gt;网站/&lt;/code&gt;相当于根据&lt;code&gt;game/urls&lt;/code&gt;访问&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.contrib import admin
from django.urls import path, include

urlpatterns = [ 
    path(&amp;#39;&amp;#39;, include(&amp;#39;game.urls&amp;#39;)),
    path(&amp;#39;admin/&amp;#39;, admin.site.urls),
] 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后直接打开 &lt;code&gt;ip:socket&lt;/code&gt; 可以直接显示 &lt;code&gt;index&lt;/code&gt; 返回的网页&lt;/p&gt;
&lt;h1 id=&#34;创建菜单界面&#34;&gt;创建菜单界面&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/3199626/&#34;&gt;3. 创建菜单界面 | 讲义&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/73121/&#34;&gt;3.1 上课笔记 | 大家好今天是&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/73707/&#34;&gt;3.1 上课笔记 | 栎&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;构建项目框架&#34;&gt;构建项目框架&lt;/h2&gt;
&lt;h3 id=&#34;项目系统设计&#34;&gt;项目系统设计&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;menu&lt;/code&gt;：菜单页面&lt;/li&gt;
&lt;li&gt;&lt;code&gt;playground&lt;/code&gt;：游戏界面&lt;/li&gt;
&lt;li&gt;&lt;code&gt;settings&lt;/code&gt;：设置界面&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;项目文件结构&#34;&gt;项目文件结构&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;.
|-- README.md
|-- acapp
|   |-- __init__.py    # 文件夹在加上 __init__.py 文件后，python 便可以通过 import 来引用该文件夹
|   |-- asgi.py
|   |-- settings.py
|   |-- urls.py
|   `-- wsgi.py
|-- db.sqlite3
|-- game
|   |-- __init__.py
|   |-- admin.py
|   |-- apps.py
|   |-- migrations
|   |   `-- __init__.py
|   |-- models
|   |   `-- __init__.py
|   |-- static
|   |   |-- css
|   |   |   `-- game.css    # 一般一个工程，只有一个 css 文件就足够了
|   |   |-- image
|   |   |   `-- menu
|   |   |       `-- background.gif
|   |   `-- js
|   |       |-- dist
|   |       |   `-- game.js
|   |       `-- src
|   |           `-- zbase.js    # 总的 js 文件，命名以 z 开头会自动在字典序最后
|   |-- templates
|   |   `-- multiends
|   |       `-- web.html
|   |-- tests.py
|   |-- urls
|   |   |-- __init__.py
|   |   |-- index.py
|   |   |-- menu
|   |   |   |-- __init__.py
|   |   |   `-- index.py
|   |   |-- playground
|   |   |   |-- __init__.py
|   |   |   `-- index.py
|   |   `-- settings
|   |       |-- __init__.py
|   |       `-- index.py
|   `-- views
|       |-- __init__.py
|       |-- index.py
|       |-- menu
|       |   `-- __init__.py
|       |-- playground
|       |   `-- __init__.py
|       `-- settings
|           `-- __init__.py
|-- manage.py
`-- scripts
    `-- compress_game_js.sh
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;js-文件管理&#34;&gt;&lt;code&gt;js&lt;/code&gt; 文件管理&lt;/h4&gt;
&lt;p&gt;一般一个工程会有很多个 &lt;code&gt;.js&lt;/code&gt; 源文件，为了加快网络的传输，也为了每次写新的 &lt;code&gt;.js&lt;/code&gt; 文件不用每个 &lt;code&gt;html&lt;/code&gt; 都额外引入一次&lt;/p&gt;
&lt;p&gt;考虑用一个 &lt;code&gt;src&lt;/code&gt; 源文件夹来存储所有的 &lt;code&gt;.js&lt;/code&gt; 源文件&lt;/p&gt;
&lt;p&gt;然后用 &lt;code&gt;dist&lt;/code&gt; 文件夹来存放由 &lt;code&gt;src&lt;/code&gt; 下所有源文件整合生成的一个目标 &lt;code&gt;.js&lt;/code&gt; 文件&lt;/p&gt;
&lt;p&gt;这样既实现了快速传输的好处，也方便了后续编写 &lt;code&gt;html&lt;/code&gt; 文件时，引入 &lt;code&gt;.js&lt;/code&gt; 的便利&lt;/p&gt;
&lt;p&gt;创建一个脚本实现上述 &lt;strong&gt;整合&lt;/strong&gt; 的功能
&lt;code&gt;~/acapp/scripts/compress_game_js.sh&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#! /bin/bash

JS_PATH=/home/acs/acapp/game/static/js/
JS_PATH_DIST=${JS_PATH}dist/
JS_PATH_SRC=${JS_PATH}src/

find $JS_PATH_SRC -type f -name &amp;#39;*.js&amp;#39; | sort | xargs cat &amp;gt; ${JS_PATH_DIST}game.js
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;html-文件管理&#34;&gt;&lt;code&gt;html&lt;/code&gt; 文件管理&lt;/h4&gt;
&lt;p&gt;在 &lt;code&gt;templates&lt;/code&gt; 文件夹下创建 &lt;code&gt;menu&lt;/code&gt;、&lt;code&gt;playground&lt;/code&gt;、&lt;code&gt;settings&lt;/code&gt;、&lt;code&gt;multiends&lt;/code&gt; 四个文件夹，用于存储三个模块和终端的 &lt;code&gt;html&lt;/code&gt; 文件&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;multiends&lt;/code&gt; 下创建 &lt;code&gt;web.html&lt;/code&gt; 文件&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;{% load static %}
&amp;lt;!-- Django 中引入全局setting里的变量 static 的语法--&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;link rel=&amp;#34;stylesheet&amp;#34; href=&amp;#34;https://cdn.acwing.com/static/jquery-ui-dist/jquery-ui.min.css&amp;#34;&amp;gt;
    &amp;lt;script src=&amp;#34;https://cdn.acwing.com/static/jquery/js/jquery-3.3.1.min.js&amp;#34;&amp;gt;&amp;lt;/script&amp;gt;
    &amp;lt;!-- 上述两句引入 jQuery 库 --&amp;gt;
    &amp;lt;!-- 使用引入的变量 static 的语法如下 --&amp;gt;
    &amp;lt;link rel=&amp;#34;stylesheet&amp;#34; href=&amp;#34;{% static &amp;#39;css/game.css&amp;#39; %}&amp;#34;&amp;gt;
    &amp;lt;script src=&amp;#34;{% static &amp;#39;js/dist/game.js&amp;#39; %}&amp;#34;&amp;gt;&amp;lt;/script&amp;gt;
    &amp;lt;!-- 分别引入 css 文件和总的 js 文件 --&amp;gt;
&amp;lt;/head&amp;gt;

&amp;lt;body style=&amp;#34;margin: 0&amp;#34;&amp;gt;
    &amp;lt;div id=&amp;#34;ac_game_12345678&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;script&amp;gt;
        $(document).ready(function(){
            let ac_game = new AcGame(&amp;#34;ac_game_12345678&amp;#34;)
        })
    &amp;lt;/script&amp;gt;
&amp;lt;/body&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;views-视图管理&#34;&gt;&lt;code&gt;views&lt;/code&gt; 视图管理&lt;/h4&gt;
&lt;p&gt;在 &lt;code&gt;views&lt;/code&gt; 文件夹下新建三个模块的视图文件夹&lt;/p&gt;
&lt;p&gt;写一个 &lt;code&gt;index.py&lt;/code&gt; 文件，目的是在 &lt;code&gt;web&lt;/code&gt; 端被访问时，返回上面写的 &lt;code&gt;web.html&lt;/code&gt; 文件&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.shortcuts import render

def index(request):
  return render(request, &amp;#34;multiends/web.html&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;urls-路由管理&#34;&gt;&lt;code&gt;urls&lt;/code&gt; 路由管理&lt;/h4&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;                                     /-- &amp;#34;&amp;#34; -- index
                                    / -- &amp;#34;menu/&amp;#34; -- menu.index
             / &amp;#34;&amp;#34; --&amp;gt; &amp;#34;game.url&amp;#34; --&amp;gt; 
            /                       \ -- &amp;#34;playground/&amp;#34; -- playground.index
id:scoket -&amp;gt;                         \-- &amp;#34;settings/&amp;#34; -- settings.index
            \
             \ &amp;#34;/admin&amp;#34; -- 到达管理员页面
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;~/acapp/acapp/urls.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.contrib import admin
from django.urls import path, include

urlpatterns = [
  path(&amp;#39;&amp;#39;, include(&amp;#39;game.urls.index&amp;#39;)),
  path(&amp;#39;admin/&amp;#39;, admin.site.urls),
]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;~/acapp/game/urls/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.urls import path, include
from game.views.index import index

urlpatterns = [ 
    path(&amp;#34;&amp;#34;, index, name=&amp;#34;index&amp;#34;),
    path(&amp;#34;menu/&amp;#34;, include(&amp;#34;game.urls.menu.index&amp;#34;)),
    path(&amp;#34;playground/&amp;#34;, include(&amp;#34;game.urls.playground.index&amp;#34;)),
    path(&amp;#34;settings/&amp;#34;, include(&amp;#34;game.urls.settings.index&amp;#34;))
]
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;网页渲染流程&#34;&gt;网页渲染流程&lt;/h4&gt;
&lt;p&gt;根据用户的链接，首先进入&lt;code&gt;acapp/urls.py&lt;/code&gt;，根据&lt;code&gt;path&lt;/code&gt;再进入&lt;code&gt;game/urls/index.py&lt;/code&gt;，再根据&lt;code&gt;path&lt;/code&gt;进入下一层&lt;code&gt;url&lt;/code&gt;或调用相对应的&lt;code&gt;views&lt;/code&gt;中的&lt;code&gt;index.py&lt;/code&gt;函数，函数接收参数，在网页端渲染&lt;code&gt;templates/multiends&lt;/code&gt;下的&lt;code&gt;web.html&lt;/code&gt;，&lt;code&gt;html&lt;/code&gt;中有&lt;code&gt;JS&lt;/code&gt;执行&lt;/p&gt;
&lt;p&gt;注意：本项目为前后端分离，即通过&lt;code&gt;JS&lt;/code&gt;在&lt;code&gt;client&lt;/code&gt;中渲染项目(动态生成页面)，而不是在&lt;code&gt;server&lt;/code&gt;渲染项目&lt;/p&gt;
&lt;h3 id=&#34;修改全局配置&#34;&gt;修改全局配置&lt;/h3&gt;
&lt;h4 id=&#34;设置时区&#34;&gt;设置时区&lt;/h4&gt;
&lt;p&gt;修改项目的 &lt;strong&gt;UTC&lt;/strong&gt; 时间为 &lt;strong&gt;CN&lt;/strong&gt; 时间&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ vim /acapp/settings.py

******
TIME_ZONE = &amp;#39;Asia/Shanghai&amp;#39; # 原来默认是 UTC
******
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;添加配置文件&#34;&gt;添加配置文件&lt;/h4&gt;
&lt;p&gt;将新创建的 &lt;code&gt;game&lt;/code&gt; 下的 &lt;code&gt;apps.py&lt;/code&gt; 中的 &lt;code&gt;GameConfig&lt;/code&gt; 加到 &lt;code&gt;settings.py&lt;/code&gt; 下&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ vim /acapp/settings.py

******
INSTALLED_APPS = [
  &amp;#39;game.apps.GameConfig&amp;#39;,
  ......
]
******
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;声明将静态文件路径 &lt;code&gt;STATIC_ROOT&lt;/code&gt; 和 &lt;code&gt;MEDIA_ROOT&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ vim /acapp/settings.py

******
import os

......

STATIC_ROOT = os.path.join(BASE_DIR, &amp;#39;static&amp;#39;)
STATIC_URL = &amp;#39;/static/&amp;#39;

MEDIA_ROOT = os.path.join(BASE_DIR, &amp;#39;media&amp;#39;)
MEDIA_URL = &amp;#39;/media/&amp;#39;
******
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;创建菜单-menu-界面&#34;&gt;创建菜单 &lt;code&gt;menu&lt;/code&gt; 界面&lt;/h2&gt;
&lt;h3 id=&#34;搭建菜单-menu-界面的框架&#34;&gt;搭建菜单 &lt;code&gt;menu&lt;/code&gt; 界面的框架&lt;/h3&gt;
&lt;p&gt;我们采用的 &lt;strong&gt;前后端分离式&lt;/strong&gt; 开发，所有的 &lt;strong&gt;html&lt;/strong&gt; 渲染都要求在前端完成&lt;/p&gt;
&lt;p&gt;开发流程就是，先在 &lt;strong&gt;html&lt;/strong&gt; 里创建好一个有 &lt;strong&gt;id&lt;/strong&gt; 的 &lt;strong&gt;div&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;然后利用 &lt;strong&gt;js&lt;/strong&gt; 文件，捕获到该 &lt;strong&gt;div&lt;/strong&gt;，并进行 &lt;strong&gt;渲染&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/templates/multiends/web.html&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
    &amp;lt;div id=&amp;#34;ac_game_12345678&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;script&amp;gt;
        $(document).ready(function(){
            let ac_game = new AcGame(&amp;#34;ac_game_12345678&amp;#34;)
        })
    &amp;lt;/script&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;js/src/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGame {
    constructor(id) {
        this.id = id; 
        this.$ac_game = $(&amp;#39;#&amp;#39; + id);
        this.menu = new AcGameMenu(this);
    }   
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;js/src/menu/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGameMenu {
    constructor(root) {
        this.root = root;
        this.$menu = $(` 
&amp;lt;div class=&amp;#34;ac-game-menu&amp;#34;&amp;gt;
&amp;lt;/div&amp;gt;
`);
        this.root.$ac_game.append(this.$menu); 
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;css/game.css&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;.ac-game-menu {
    width: 100%;
    height: 100%;
    background-image: url(&amp;#39;/static/image/menu/background.gif&amp;#39;);
    background-size: 100% 100%;
    user-select: none;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里的 &lt;strong&gt;代码逻辑&lt;/strong&gt; 如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;html&lt;/code&gt; 页面执行到 &lt;code&gt;js&lt;/code&gt; 代码，利用 &lt;code&gt;AcGame类&lt;/code&gt; 创建对象 &lt;code&gt;ac_game&lt;/code&gt; 同时传递参数 &lt;code&gt;div&lt;/code&gt; 的 &lt;code&gt;id&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;AcGame&lt;/code&gt; 开始执行构造函数，在构造函数中，捕获 &lt;code&gt;html&lt;/code&gt; 标签，并利用 &lt;code&gt;AcGameMenu类&lt;/code&gt; 创建对象 &lt;code&gt;menu&lt;/code&gt;，并将整个对象作为参数下传&lt;/li&gt;
&lt;li&gt;&lt;code&gt;AcGameMenu&lt;/code&gt; 开始执行构造函数，然后创建 &lt;code&gt;html&lt;/code&gt; 代码，加到捕获到的 &lt;code&gt;html&lt;/code&gt; 代码下&lt;/li&gt;
&lt;li&gt;最终成功渲染出背景图片&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;设置菜单-menu-页面的内容&#34;&gt;设置菜单 &lt;code&gt;menu&lt;/code&gt; 页面的内容&lt;/h3&gt;
&lt;p&gt;主要内容就是在主页面中，显示：单人模式、多人模式、设置，三个按钮的选项
&lt;code&gt;js/src/menu/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGameMenu {
    constructor(root) {
        this.root = root;
        this.$menu = $(`
&amp;lt;div class=&amp;#34;ac-game-menu&amp;#34;&amp;gt;
    &amp;lt;div class=&amp;#34;ac-game-menu-field&amp;#34;&amp;gt;
        &amp;lt;div class=&amp;#34;ac-game-menu-field-item ac-game-menu-field-item-single-mode&amp;#34;&amp;gt;
            单人模式
        &amp;lt;/div&amp;gt;
        &amp;lt;div class=&amp;#34;ac-game-menu-field-item ac-game-menu-field-item-multi-mode&amp;#34;&amp;gt;
            多人模式
        &amp;lt;/div&amp;gt;
        &amp;lt;div class=&amp;#34;ac-game-menu-field-item ac-game-menu-field-item-settings-mode&amp;#34;&amp;gt;
            设置
        &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
`);
        this.root.$ac_game.append(this.$menu);
        this.$single_mode = this.$menu.find(&amp;#39;.ac-game-menu-field-item-single-mode&amp;#39;);
        this.$multi_mode = this.$menu.find(&amp;#39;.ac-game-menu-field-item-multi-mode&amp;#39;);
        this.$settings_mode = this.$menu.find(&amp;#39;.ac-game-menu-field-item-settings-mode&amp;#39;);
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;css/game.css&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;.ac-game-menu {
    width: 100%;
    height: 100%;
    background-image: url(&amp;#39;/static/image/menu/background.gif&amp;#39;);
    background-size: 100% 100%;
    user-select: none;
}
.ac-game-menu-field {
    width: 20vw;
    position: relative;
    top: 40vh;
    left: 19vh;
}
.ac-game-menu-field-item {
    height: 7vh;
    width: 18vw;
    color: white;
    font-size: 6vh;
    font-style: italic;
    padding: 2vh;
    margin: 1vh 0;
    cursor: pointer;
    text-align: center;
    background-color: rgba(39, 21, 28, 0.6);
    border-radius: 10px;
    letter-spacing: 0.5vw;
}
.ac-game-menu-field-item:hover {
    transform: scale(1.2);
    transition: 100ms;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;添加-单人模式-监听函数--打开游戏界面-功能&#34;&gt;添加 &amp;lsquo;单人模式&amp;rsquo; 监听函数 —— 打开游戏界面 功能&lt;/h3&gt;
&lt;p&gt;这里要实现的 &lt;strong&gt;逻辑&lt;/strong&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;点击 &amp;lsquo;单人模式&amp;rsquo; 按钮触发 &lt;code&gt;click&lt;/code&gt; 事件，随即触发监听函数，开始执行&lt;/li&gt;
&lt;li&gt;关闭 &lt;code&gt;menu&lt;/code&gt; 页面&lt;/li&gt;
&lt;li&gt;打开 &lt;code&gt;playground&lt;/code&gt; 页面&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;因此，我们先简易的实现一个 &lt;code&gt;playground&lt;/code&gt; 页面，方便调试该功能
&lt;code&gt;js/src/playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGamePlayground {
    constructor(root) {
        this.root = root;
        this.$playground = $(`&amp;lt;div&amp;gt;游戏界面&amp;lt;/div&amp;gt;`);

        this.hide();
        this.root.$ac_game.append(this.$playground);

        this.start();
    }
    start() {

    }
    show() {    //打开 playground 界面
        this.$playground.show();
    }
    hide() {    //关闭 playground 界面
        this.$playground.hide();
    }

}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在实现监听函数功能之前，先在 &lt;code&gt;/src/zbase.js&lt;/code&gt; 即主 &lt;code&gt;js&lt;/code&gt; 文件下，利用 &lt;code&gt;AcGamePlayground&lt;/code&gt; 类创建好 &lt;code&gt;playground&lt;/code&gt; 对象&lt;/p&gt;
&lt;p&gt;这样我们就能在前端，渲染出两个界面了，分别是：&lt;code&gt;menu&lt;/code&gt; 和 &lt;code&gt;playground&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/src/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGame {
    constructor(id) {
        this.id = id;
        this.$ac_game = $(&amp;#39;#&amp;#39; + id);
        this.menu = new AcGameMenu(this);
        // 把 playground 对象也建好，这样我们就同时有两个界面了
        this.playground = new AcGamePlayground(this);

        this.start();
    }                    
    start() {

    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后，我们开始实现 &lt;code&gt;ac-game-menu-field-item-single-mode&lt;/code&gt; 标签的 &lt;code&gt;click&lt;/code&gt; 事件的监听函数&lt;/p&gt;
&lt;p&gt;其功能之前讲过了，就是关闭 &lt;code&gt;menu&lt;/code&gt; 页面，打开 &lt;code&gt;playground&lt;/code&gt; 页面&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/src/menu/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGameMenu {
    constructor(root) {
        this.root = root;
        this.$menu = $(`
&amp;lt;div class=&amp;#34;ac-game-menu&amp;#34;&amp;gt;
    &amp;lt;div class=&amp;#34;ac-game-menu-field&amp;#34;&amp;gt;
        &amp;lt;div class=&amp;#34;ac-game-menu-field-item ac-game-menu-field-item-single-mode&amp;#34;&amp;gt;
            单人模式
        &amp;lt;/div&amp;gt;
        &amp;lt;div class=&amp;#34;ac-game-menu-field-item ac-game-menu-field-item-multi-mode&amp;#34;&amp;gt;
            多人模式
        &amp;lt;/div&amp;gt;
        &amp;lt;div class=&amp;#34;ac-game-menu-field-item ac-game-menu-field-item-settings-mode&amp;#34;&amp;gt;
            设置
        &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
`);
        this.root.$ac_game.append(this.$menu);
        this.$single_mode = this.$menu.find(&amp;#39;.ac-game-menu-field-item-single-mode&amp;#39;);
        this.$multi_mode = this.$menu.find(&amp;#39;.ac-game-menu-field-item-multi-mode&amp;#39;);
        this.$settings_mode = this.$menu.find(&amp;#39;.ac-game-menu-field-item-settings-mode&amp;#39;);

        this.start();
    }
    start() {
        this.add_listening_events();
    }
    add_listening_events() {
        let outer = this;
        this.$single_mode.click(function(){
            outer.hide();   // 关闭主页面
            outer.root.playground.show();   // 打开游戏界面
        });
    }

    show() {    //显示menu界面
        this.$menu.show();
    }
    hide() {    //隐藏menu界面
        this.$menu.hide();
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;创建游戏界面&#34;&gt;创建游戏界面&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/79181/&#34;&gt;4.1 上课笔记 | Andrew1729&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;若修改&lt;code&gt;static文件夹&lt;/code&gt;下的相关文件，需在&lt;code&gt;~/acapp&lt;/code&gt;下执行&lt;code&gt;./scripts/compress_game_js.sh&lt;/code&gt;来打包文件&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;前端的模块化引入&#34;&gt;前端的模块化引入&lt;/h2&gt;
&lt;p&gt;由于在 &lt;code&gt;html&lt;/code&gt; 代码部分，是将整个 &lt;code&gt;game.js&lt;/code&gt; 文件引入&lt;/p&gt;
&lt;p&gt;这样会导致在 &lt;code&gt;game.js&lt;/code&gt; 中定义的变量，会变成整个网页的 &lt;strong&gt;全局变量&lt;/strong&gt;（之后可能会引起变量重名的诸多问题）&lt;/p&gt;
&lt;p&gt;因此，我们考虑使用 &lt;strong&gt;模块化引入&lt;/strong&gt; 的功能，让网页只引入在 &lt;code&gt;html&lt;/code&gt; 中需要的部分&lt;/p&gt;
&lt;p&gt;修改 &lt;code&gt;web.html&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;!-- 首先，先删掉上面整个引入 game.js 的部分 --&amp;gt;
&amp;lt;!-- 然后，下方创建对象的部分，先使用模块化引入 --&amp;gt;
......
    &amp;lt;script type=&amp;#34;module&amp;#34;&amp;gt;
        import {AcGame} from &amp;#34;{% static &amp;#39;js/dist/game.js&amp;#39; %}&amp;#34;
        $(document).ready(function(){
            let ac_game = new AcGame(&amp;#34;ac_game_12345678&amp;#34;)
        })
    &amp;lt;/script&amp;gt;
......
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;此外，还有修改引入的类，在前面加上 &lt;code&gt;export&lt;/code&gt;，如下修改 &lt;code&gt;js/src/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;export class AcGame {
    ......
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这样，在全局中，只会出现引入的模块，其他的 &lt;code&gt;.js&lt;/code&gt; 代码不会出现在全局中&lt;/p&gt;
&lt;h2 id=&#34;构建游戏界面框架&#34;&gt;构建游戏界面框架&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;static/js/src/playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;......
    this.$playground = $(`&amp;lt;div class=&amp;#34;ac-game-playground&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;`);
......
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;game.css&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;......
.ac-game-playground {
    height: 100%;
    width: 100%;
    user-select: none;  // 禁用右键弹菜单
} 
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;实现游戏引擎框架&#34;&gt;实现游戏引擎框架&lt;/h2&gt;
&lt;p&gt;游戏中，物体在移动，其实现原理是：每一个动作都会渲染多张图片出来，然后图片快速的切换，从而实现动的过程&lt;/p&gt;
&lt;p&gt;因此，需要先实现一个游戏引擎的基类 &lt;code&gt;AcGameObject&lt;/code&gt; ，使得每帧能渲染一张图片出来&lt;/p&gt;
&lt;p&gt;该基类需要具备的功能有：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;start()&lt;/code&gt; 在游戏开始的第一帧时需要执行的任务（一般是创建对象）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;update()&lt;/code&gt; 在游戏开始后的每一帧均会执行的任务（一般是渲染当前对象的各种状态）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;on_destroy()&lt;/code&gt; 删掉该物体前需要执行的任务（一般是删掉动画，或者给对手加分）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;destroy()&lt;/code&gt; 删掉该物体&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;根据上述逻辑，我们就可以基本搭建出来一个游戏引擎的基类了，具体如下：
&lt;code&gt;/static/js/playground/ac_game_object/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; AC_GAME_OBJECTS = [];   &lt;span style=&#34;color:#007f7f&#34;&gt;// 用于记录当前画布中，需要渲染的对象有哪些
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGameObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        AC_GAME_OBJECTS.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;);  &lt;span style=&#34;color:#007f7f&#34;&gt;// 将当前新建的对象，加入到全局的画布中去，参与渲染
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.has_called_start = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;;  &lt;span style=&#34;color:#007f7f&#34;&gt;// 是否执行过 start 函数
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.timedelta = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;             &lt;span style=&#34;color:#007f7f&#34;&gt;// 当前帧距离上一帧的时间间隔
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 该数据记录是为了后续计算速度等参数的
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {   &lt;span style=&#34;color:#007f7f&#34;&gt;// 只会在第一帧执行一次
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    update() {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 每一帧均会执行一次
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    on_destroy() {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 在被销毁前执行一次
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    destroy() { &lt;span style=&#34;color:#007f7f&#34;&gt;// 删掉该物体
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.on_destroy();  &lt;span style=&#34;color:#007f7f&#34;&gt;//删掉该物体前，执行删前的操作
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 在全局渲染物体中，找到该物体，并将其删掉
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; AC_GAME_OBJECTS.length; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (AC_GAME_OBJECTS[i] === &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;) {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 三等号，在js里额外加了一层类型相等约束
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;                AC_GAME_OBJECTS.splice(i, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; last_timestamp;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; AC_GAME_ANIMATION = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(timestamp) {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 回调函数，实现：每一帧重绘时，都会执行一遍
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; AC_GAME_OBJECTS.length; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; obj = AC_GAME_OBJECTS[i];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (!obj.has_called_start) { &lt;span style=&#34;color:#007f7f&#34;&gt;// 如果还未执行初始帧动作，就先执行
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;            obj.start();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            obj.has_called_start = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 执行过初始帧，就执行每一帧的任务
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;            obj.timedelta = timestamp - last_timestamp;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            obj.update();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    last_timestamp = timestamp; &lt;span style=&#34;color:#007f7f&#34;&gt;// 更新最后一次时间戳
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    requestAnimationFrame(AC_GAME_ANIMATION);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;requestAnimationFrame(AC_GAME_ANIMATION);   &lt;span style=&#34;color:#007f7f&#34;&gt;// JS的API，可以调用1帧里面的函数。(有些浏览器的一秒帧数不一定相等)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;接下来所有的一切游戏，都是基于这个引擎的基类完成的&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;实现游戏地图功能&#34;&gt;实现游戏地图功能&lt;/h2&gt;
&lt;p&gt;目标：实现一个每一秒都在渲染的纯黑背景&lt;/p&gt;
&lt;p&gt;虽然现阶段要实现的地图较为简单，但为了后期的拓展性，故还是考虑新建一个文件夹来完成&lt;/p&gt;
&lt;p&gt;然后在 &lt;code&gt;js&lt;/code&gt; 中，已经封装好了一个 &lt;code&gt;canvas&lt;/code&gt; 的 &lt;code&gt;api&lt;/code&gt; 来帮助实现背景画布，直接调用即可&lt;/p&gt;
&lt;p&gt;先铺开画布，然后设置为黑色&lt;/p&gt;
&lt;p&gt;&lt;code&gt;static/js/playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGamePlayground {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ......
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// $(&amp;#39;.playground&amp;#39;)对象已经在 css 文件里渲染出高宽了
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 现在把他的高宽存下来，往下传递
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground.width();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground.height();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.game_map = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; GameMap(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ......
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .....
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;static/js/playground/game-map/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; GameMap &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;extends&lt;/span&gt; AcGameObject {    &lt;span style=&#34;color:#007f7f&#34;&gt;// 继承自游戏引擎基类
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    constructor(playground) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;super&lt;/span&gt;();    &lt;span style=&#34;color:#007f7f&#34;&gt;// 自函数功能：调用基类的构造函数
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground = playground;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$canvas = $(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;`&amp;lt;canvas&amp;gt;&amp;lt;/canvas&amp;gt;`&lt;/span&gt;); &lt;span style=&#34;color:#007f7f&#34;&gt;// 创建一个canvas的jQuery对象，就是我们要实现的画布
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$canvas[&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;].getContext(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;2d&amp;#39;&lt;/span&gt;); &lt;span style=&#34;color:#007f7f&#34;&gt;// jQuery对象是一个数组，第一个索引是html对象
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 设置画布的宽高
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.width = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.width;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.height = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.$playground.append(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$canvas);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    update() {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 游戏地图每帧都要渲染
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.render();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    render() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillStyle = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;rgba(0, 0, 0, 0.2)&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillRect(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.width, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.height);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;实现玩家显示功能&#34;&gt;实现玩家显示功能&lt;/h2&gt;
&lt;p&gt;毛坯版玩家显示，每个玩家定义成一个圆，然后渲染在前端&lt;/p&gt;
&lt;p&gt;需要对于玩家类定义多个参数，以方便日后拓展：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;x&lt;/code&gt; 当前位置的横坐标&lt;/li&gt;
&lt;li&gt;&lt;code&gt;y&lt;/code&gt; 当前位置的纵坐标&lt;/li&gt;
&lt;li&gt;&lt;code&gt;radius&lt;/code&gt; 当前的半径&lt;/li&gt;
&lt;li&gt;&lt;code&gt;speed&lt;/code&gt; 当前的速度&lt;/li&gt;
&lt;li&gt;&lt;code&gt;is_me&lt;/code&gt; 该对象是否是当前玩家操控的对象（一是区别于 bot，二是区别于 日后联机的其他玩家）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;static/js/playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGamePlayground {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ......
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players = [];  &lt;span style=&#34;color:#007f7f&#34;&gt;// 存放当前游戏中的所有玩家
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 将玩家加入游戏中
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Player(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;true&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ......
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .....
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;static/js/playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Player &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;extends&lt;/span&gt; AcGameObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(playground, x, y, radius, color, speed, is_me) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;super&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 把信息都存下来
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground = playground;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.game_map.ctx;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x = x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y = y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color = color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed = speed;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius = radius;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me = is_me;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 用于浮点数运算
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.eps = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.render();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    render() {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 渲染一个圆
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.beginPath();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.arc(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.PI, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillStyle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fill();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    on_destroy() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;实现玩家移动功能&#34;&gt;实现玩家移动功能&lt;/h2&gt;
&lt;p&gt;移动的实现逻辑很简单，就是让每帧渲染的圆的位置发生移动即可&lt;/p&gt;
&lt;p&gt;上述简单逻辑的实现如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Player &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;extends&lt;/span&gt; AcGameObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(....)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x += x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y += y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.render();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后我们来实现一个向鼠标点击位置移动的功能&lt;/p&gt;
&lt;p&gt;这就需要设置一个 &lt;code&gt;click&lt;/code&gt; 事件的监听函数，分别传递：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;鼠标点击事件&lt;/li&gt;
&lt;li&gt;鼠标点击位置的横坐标&lt;/li&gt;
&lt;li&gt;鼠标点击位置的纵坐标&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;然后开始让圆的位置逐步向鼠标点击位置进行移动&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me) {   &lt;span style=&#34;color:#007f7f&#34;&gt;// 对于用户玩家，加上监听函数
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.add_listening_events();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;add_listening_events() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 把鼠标右键调出菜单栏的功能关掉
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.game_map.$canvas.on(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;contextmenu&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 把右键控制移动功能加上
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.game_map.$canvas.mousedown(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 左键:1 中键:2 右键:3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (e.which === &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.move_to(e.clientX, e.clientY);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后，我们来实现移动功能的函数 &lt;code&gt;move_to(tx, ty)&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;constructor(...){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;    &lt;span style=&#34;color:#007f7f&#34;&gt;// x方向上的移动速度
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;    &lt;span style=&#34;color:#007f7f&#34;&gt;// y方向上的移动速度
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;   &lt;span style=&#34;color:#007f7f&#34;&gt;// 剩余移动距离
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;get_dist (x1, y1, x2, y2) { &lt;span style=&#34;color:#007f7f&#34;&gt;// 求两点的欧几里得距离
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; dx = x2 - x1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; dy = y2 - y1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.sqrt(dx * dx + dy * dy);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;move_to(tx, ty) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 计算移动距离
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.get_dist(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, tx, ty);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 计算移动角度，api接口：atan2(dy, dx)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; angle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.atan2(ty - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, tx - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 位移 1 个单位长度（向着矢量方向移动到单位圆上）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.cos(angle);  &lt;span style=&#34;color:#007f7f&#34;&gt;// 极直互化
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.sin(angle);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 浮点数精度运算
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length &amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.eps) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 计算单位帧里的移动距离
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; moved = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.min(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.timedelta / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1000&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x += &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx * moved;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y += &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy * moved;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 还要减掉移动的距离
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length -= moved;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.render();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样就实现了玩家的移动功能了，可以登录 &lt;code&gt;id:socket&lt;/code&gt; 调试该功能&lt;/p&gt;
&lt;h2 id=&#34;实现火球技能的功能&#34;&gt;实现火球技能的功能&lt;/h2&gt;
&lt;p&gt;火球对象的建立与玩家基本一致，直接照搬，在从细节上改改即可&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/skill/fireball/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; FireBall &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;extends&lt;/span&gt; AcGameObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(playground, player, x, y, radius, vx, vy, color, speed, move_length, damage) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;super&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground = playground;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.game_map.ctx;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.player = player;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x = x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y = y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx = vx;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy = vy;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius = radius;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color = color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed = speed;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length = move.length;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage = damage;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.eps = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length &amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.eps) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.destroy();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; moved = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.min(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.timedelta / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1000&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x += &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx * moved;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y += &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy * moved;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length -= moved;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.render();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    render() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.beginPath();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.arc(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt; * Pi, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillStyle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fill();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;} 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后在玩家身上实现发火球的功能&lt;/p&gt;
&lt;p&gt;基本实现逻辑：当前选中了火球技能，鼠标左键点击一处，向该处发射一个火球&lt;/p&gt;
&lt;p&gt;因此，为了知道用户是否选择了技能，需要加一个键盘触发事件监听函数，然后加一个鼠标左键触发事件监听函数&lt;/p&gt;
&lt;p&gt;然后发射一个火球即可&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;constructor(...) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.cur_skill = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;null&lt;/span&gt;;  &lt;span style=&#34;color:#007f7f&#34;&gt;// 记录当前选择的技能
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;add_listening_events() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.game_map.$canvas.mousedown(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 左键:1 中键:2 右键:3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (e.which === &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.move_to(e.clientX, e.clientY);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (e.which === &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;) {     &lt;span style=&#34;color:#007f7f&#34;&gt;// 鼠标左键事件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (outer.cur_skill === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;fireball&amp;#34;&lt;/span&gt;) {   &lt;span style=&#34;color:#007f7f&#34;&gt;// 当前已经选中火球技能
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;                outer.shoot_fireball(e.clientX, e.clientY);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        outer.cur_skill = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;null&lt;/span&gt;; &lt;span style=&#34;color:#007f7f&#34;&gt;// 清空当前技能
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    $(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;window&lt;/span&gt;).keydown(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (e.which === &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;81&lt;/span&gt;) {       &lt;span style=&#34;color:#007f7f&#34;&gt;// 键盘按下事件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;            outer.cur_skill = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;fireball&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;shoot_fireball(tx, ty) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 确定火球的参数
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; x = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, y = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y; &lt;span style=&#34;color:#007f7f&#34;&gt;// 火球发射点就是当前玩家的位置
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; radius = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.01&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; angle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.atan2(ty - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, tx - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; vx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.cos(angle), vy = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.sin(angle);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; color = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;orange&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; speed = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.5&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; move_length = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1.0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; damage = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.01&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; FireBall(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, x, y, radius, vx, vy, color, speed, move_length, damage);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样就成功实现了玩家发射火球的功能了&lt;/p&gt;
&lt;h2 id=&#34;实现单人模式下的人机功能&#34;&gt;实现单人模式下的人机功能&lt;/h2&gt;
&lt;p&gt;先创建好 5 个人机
&lt;code&gt;playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;//创建好 5 个人机
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (len i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Player(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样创建出来的 5 个人机是不会行动的&lt;/p&gt;
&lt;p&gt;我们写一个简易的 AI 程序，让他们也会移动&lt;/p&gt;
&lt;p&gt;这里实现的逻辑是：每次随机一个目的地，向目的地移动，然后再随机一个目的地，循环下去&lt;/p&gt;
&lt;p&gt;根据该逻辑，修改两个函数即可&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me) {   &lt;span style=&#34;color:#007f7f&#34;&gt;// 对于用户玩家，加上监听函数
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.add_listening_events();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; tx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.width;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; ty = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_to(tx, ty);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length &amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.eps) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (!&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me) {   &lt;span style=&#34;color:#007f7f&#34;&gt;// 如果是人机，停下来时再随机一个方向前进
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; tx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.width;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; ty = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_to(tx, ty);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;on_destroy() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.players.length; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.players[i] === &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.players.splice(i, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;实现技能命中效果碰撞检测功能&#34;&gt;实现技能命中效果（碰撞检测功能）&lt;/h2&gt;
&lt;p&gt;实现逻辑：检测两个圆的中心距离是否小于两个圆的半径之和&lt;/p&gt;
&lt;p&gt;小于等于时，代表发生碰撞，开始执行命中效果：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;被击中用户掉血&lt;/li&gt;
&lt;li&gt;被击中用户收到向后击退效果&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;碰撞检测写在火球类里，击退效果写在玩家类里&lt;/p&gt;
&lt;p&gt;&lt;code&gt;fireball/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (...) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 碰撞检测
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.players.length; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; player = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.players[i];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.player !== player &amp;amp;&amp;amp; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_collision(player)) {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 碰撞发生一定是在非施法者身上
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.attack(player);    &lt;span style=&#34;color:#007f7f&#34;&gt;// 火球命中，目标玩家执行击退效果
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.render();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;get_dist(x1, y1, x2, y2) {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 获得两点的欧几里得距离
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; dx = x2 - x1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; dy = y2 - y1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.sqrt(dx * dx + dy * dy);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;is_collision(player) {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 检测两个圆的中心距离是否小于两个圆的半径之和
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; distance = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.get_dist(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, player.x, player.y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (distance &amp;lt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius + player.radius))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;attack(player) {    &lt;span style=&#34;color:#007f7f&#34;&gt;// 火球命中，目标玩家执行击退效果
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; angle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.atan2(player.y - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, player.x - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x);   &lt;span style=&#34;color:#007f7f&#34;&gt;// 计算角度
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    player.is_attacked(angle, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage); &lt;span style=&#34;color:#007f7f&#34;&gt;// 火球命中，目标玩家执行击退效果
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.destroy(); &lt;span style=&#34;color:#007f7f&#34;&gt;// 火球命中后，自然消失
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;被击退的时候，原来的移动速度应该置为 0，当前的移动应该转为向被击中方向上的移动&lt;/strong&gt;
&lt;code&gt;player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;is_attacked(angle, damage) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius -= damage;  &lt;span style=&#34;color:#007f7f&#34;&gt;// 受伤，半径减少
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;10&lt;/span&gt;) { &lt;span style=&#34;color:#007f7f&#34;&gt;// 当半径小于10像素时，代表死亡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.destroy();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 开始执行击退效果
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_vx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.cos(angle);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_vy = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.sin(angle);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_speed = damage * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;100&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed *= &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.5&lt;/span&gt;;  &lt;span style=&#34;color:#007f7f&#34;&gt;// 被击中以后移动速度减半
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_speed &amp;gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.eps) {   &lt;span style=&#34;color:#007f7f&#34;&gt;// 当前仍处于击退效果中
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x += &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_vx * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_speed * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.timedelta / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y += &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_vy * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_speed * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.timedelta / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_speed *= &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.friction; &lt;span style=&#34;color:#007f7f&#34;&gt;// 击退速度乘以摩擦系数，已达到削减的目的
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;被击中以后的粒子效果特效&#34;&gt;被击中以后的粒子效果特效&lt;/h2&gt;
&lt;p&gt;实现逻辑：被击中以后，在玩家附近随机生成一些粒子小球&lt;/p&gt;
&lt;p&gt;因此我们要先实现 粒子小球 对象&lt;/p&gt;
&lt;p&gt;&lt;code&gt;static/js/src/playground/particle/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Particle &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;extends&lt;/span&gt; AcGameObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(playground, x, y, radius, vx, vy, color, speed) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;super&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground = playground;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.game_map.ctx;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x = x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y = y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius = radius;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx = vx;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy = vy;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color = color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed = speed;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.friction = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.9&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed &amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.eps) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.destroy;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x += &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vx * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.timedelta / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y += &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.vy * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.timedelta / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed *= &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.friction;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.render();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    render() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.beginPath();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.arc(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.PI, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillStyle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fill();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;} 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后我们在被击退功能模块，实现生成粒子小球的效果&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;粒子小球释放弧度为 $[0,2π)$ 的随机数
&lt;ul&gt;
&lt;li&gt;粒子小球的 x, y 分量比率根据弧度来设定&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;粒子小球的起始坐标应与玩家的坐标相同&lt;/li&gt;
&lt;li&gt;粒子小球的颜色与玩家颜色相同&lt;/li&gt;
&lt;li&gt;粒子小球的速度为玩家移动速度的 $10$ 倍&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;is_attacked(angle, damage) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 粒子小球效果
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;10&lt;/span&gt; + &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; x = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, y = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; radius = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; angle = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.PI * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; vx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.cos(angle), vy = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.sin(angle);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; color = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; speed = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.speed * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;10&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Particle(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground, x, y, radius, vx, vy, color, speed);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;一些小优化&#34;&gt;一些小优化&lt;/h2&gt;
&lt;h3 id=&#34;人机随机颜色&#34;&gt;人机随机颜色&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ......
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 创建好 5 个人机
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Player(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.get_random_color(), &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ......
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;get_random_color() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; colors = [&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;blue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;red&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;pink&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;grey&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;green&amp;#34;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; colors[&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.floor(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;)];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;人机ai随机攻击操作&#34;&gt;人机AI随机攻击操作&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;constructor (...) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.spent_time = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 初始人机冷却攻击时间
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.spent_time += &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.timedelta / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (!&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me &amp;amp;&amp;amp; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.spent_time &amp;gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt; &amp;amp;&amp;amp; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;180&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; player = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.players[&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.floor(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.players.length)];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.shoot_fireball(player.x, player.y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;部署nginx与对接acappஐ&#34;&gt;部署nginx与对接acappஐ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/3257028/&#34;&gt;5. 部署nginx与对接acapp | 讲义&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/79244/&#34;&gt;5.1 上课笔记 | Andrew1729&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/78903/&#34;&gt;5.1. 上课笔记 | 菊花&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/364622127&#34;&gt;Ngnix 介绍&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/36187963b553&#34;&gt;nginx 和uwsgi的区别与作用&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;nginx是什么&#34;&gt;Nginx是什么？&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Nginx是一款自由的、开源的、高性能的HTTP服务器和反向代理服务器&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nginx可以作为一个HTTP服务器进行网站的发布处理，另外Nginx可以作为反向代理进行负载均衡的实现&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nginx中HttpUwsgiModule的作用是与uWSGI服务器进行交换&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;uwsgi是什么&#34;&gt;uWSGI是什么？&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;uWSGI是一个全功能的HTTP服务器，实现了WSGI、uwsgi、http等协议&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;它要做的就是把HTTP协议转化成语言支持的网络协议。比如把HTTP协议转化成WSGI协议，让Python可以直接使用&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;WSGI协议是Python 语言定义的 Web 服务器和 Web 应用程序或框架之间的一种简单而通用的接口&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;简单来说uWSGI就是用来沟通nginx和django的一座桥梁&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;nginxuwsgidiango-工作流程&#34;&gt;Nginx+uWSGI+Diango 工作流程&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;nginx&lt;/code&gt; 是对外的服务接口，外部浏览器通过&lt;code&gt;url&lt;/code&gt;访问&lt;code&gt;nginx&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;nginx&lt;/code&gt; 接收到浏览器发送过来的&lt;code&gt;http&lt;/code&gt;请求，将包进行解析&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;分析&lt;code&gt;url&lt;/code&gt;，如果是静态文件请求就直接访问用户给&lt;code&gt;nginx&lt;/code&gt;配置的静态文件目录，直接返回用户请求的静态文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果不是静态文件，而是一个动态的请求，那么&lt;code&gt;nginx&lt;/code&gt;就将请求转发给&lt;code&gt;uwsgi&lt;/code&gt;，&lt;code&gt;uwsgi&lt;/code&gt; 接收到请求之后将包进行处理，处理成&lt;code&gt;wsgi&lt;/code&gt;可以接受的格式，并发给&lt;code&gt;wsgi&lt;/code&gt;，&lt;code&gt;wsgi&lt;/code&gt; 根据请求调用应用程序的某个文件，某个文件的某个函数，最后处理完将返回值再次交给&lt;code&gt;wsgi&lt;/code&gt;，&lt;code&gt;wsgi&lt;/code&gt;将返回值进行打包，打包成&lt;code&gt;uwsgi&lt;/code&gt;能够接收的格式，&lt;code&gt;uwsgi&lt;/code&gt;接收&lt;code&gt;wsgi&lt;/code&gt; 发送的请求，并转发给&lt;code&gt;nginx&lt;/code&gt;, &lt;code&gt;nginx&lt;/code&gt;最终将返回值返回给浏览器&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;uwsgi服务的开启关闭&#34;&gt;uwsgi服务的开启&amp;amp;&amp;amp;关闭&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;在&lt;code&gt;~/acapp&lt;/code&gt;启动uwsgi服务：&lt;strong&gt;&lt;code&gt;uwsgi --ini scripts/uwsgi.ini&lt;/code&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;关闭uwsgi服务：&lt;code&gt;sudo pkill -f uwsgi -9&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;针对-acapp-的优化&#34;&gt;针对 acapp 的优化&lt;/h2&gt;
&lt;h3 id=&#34;打包脚本优化&#34;&gt;打包脚本优化&lt;/h3&gt;
&lt;p&gt;由于现在 &lt;strong&gt;发布版本的脚本文件&lt;/strong&gt; 用的是打包在根目录里的 &lt;strong&gt;static&lt;/strong&gt; 文件夹&lt;/p&gt;
&lt;p&gt;每次修改好 &lt;strong&gt;static&lt;/strong&gt; 文件夹后，不仅需要对 &lt;strong&gt;js&lt;/strong&gt; 文件打包，还需要对 &lt;strong&gt;static&lt;/strong&gt; 文件夹打包&lt;/p&gt;
&lt;p&gt;不放把 &amp;ldquo;将static文件夹打包&amp;rdquo; 的 &lt;strong&gt;shell&lt;/strong&gt; 代码一起加入 &lt;strong&gt;js&lt;/strong&gt; 打包脚本中，从而实现一键打包&lt;/p&gt;
&lt;p&gt;&lt;code&gt;scripts/compress_game_js.sh&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#! /bin/bash

JS_PATH=/home/acs/acapp/game/static/js/
JS_PATH_DIST=${JS_PATH}dist/
JS_PATH_SRC=${JS_PATH}src/

find $JS_PATH_SRC -type f -name &amp;#39;*.js&amp;#39; | sort | xargs cat &amp;gt; ${JS_PATH_DIST}game.js

echo &amp;#34;yes&amp;#34; | python3 manage.py collectstatic
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;鼠标点击事件的相对偏移&#34;&gt;鼠标点击事件的相对偏移&lt;/h3&gt;
&lt;p&gt;由于写游戏界面的时候，玩家移动是按照鼠标相对于当前整个浏览器取的位置参数 &lt;code&gt;e.clientX&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;而 &lt;code&gt;acapp&lt;/code&gt; 里，每个应用是一个小窗口，鼠标点击位置的参数应当是 &lt;strong&gt;相对于整个游戏窗口的位置参数&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;所有会导致出现，点击的位置与移动的位置不同，这里需要做出小优化&lt;/p&gt;
&lt;p&gt;优化的逻辑 :&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;$clientX−窗口左侧到浏览器左侧的距离=玩家的目标X$&lt;/li&gt;
&lt;li&gt;$clientY−窗口上侧到浏览器上侧的距离=玩家的目标Y$
这就要用到一个 &lt;code&gt;js&lt;/code&gt; 的 &lt;code&gt;API&lt;/code&gt; 了 : &lt;code&gt;getBoundingClientRect()&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rectObject = object.getBoundingClientRect();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rectObject.top : 元素上边到视窗上边的距离;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rectObject.right : 元素右边到视窗左边的距离;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rectObject.bottom : 元素下边到视窗上边的距离;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rectObject.left : 元素左边到视窗左边的距离;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rectObject.width : 是元素自身的宽
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rectObject.height : 是元素自身的高
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; add_listening_events() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.game_map.$canvas.mousedown(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 创建 rect 对象
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;const&lt;/span&gt; rect = outer.ctx.canvas.getBoundingClientRect();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (e.which === &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#007f7f&#34;&gt;// 调整偏移量
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;            outer.move_to(e.clientX - rect.left, e.clientY - rect.top);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (e.which === &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (outer.cur_skill === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;fireball&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#007f7f&#34;&gt;// 调整偏移量
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;                outer.shoot_fireball(e.clientX - rect.left, e.clientY - rect.top);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;将菜单界面重新设为主界面&#34;&gt;将菜单界面重新设为主界面&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;js/zbase.js&lt;/code&gt; 的注释取消，使之创建出 &lt;strong&gt;menu&lt;/strong&gt; 对象&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/playground/zbase.js&lt;/code&gt; 的注释取消，并设置逻辑，让 &lt;strong&gt;playground&lt;/strong&gt; 打开后，才进行游戏界面初始化&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGamePlayground {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.root = root;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground = $(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;`&amp;lt;div class=&amp;#34;ac-game-playground&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;`&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.hide();    &lt;span style=&#34;color:#007f7f&#34;&gt;// 初始时隐藏
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 游戏界面生成代码在下面展示 playground 时执行
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.start();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    show() {    &lt;span style=&#34;color:#007f7f&#34;&gt;// 打开 playground 界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground.show();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 开始生成游戏界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.root.$ac_game.append(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground.width();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground.height();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.game_map = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; GameMap(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players = [];  &lt;span style=&#34;color:#007f7f&#34;&gt;// 存放当前游戏中的所有玩家
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 将玩家加入游戏中
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Player(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;true&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007f7f&#34;&gt;// 创建好 5 个人机
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Player(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.get_random_color(), &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;调整-css-文件适应窗口&#34;&gt;调整 css 文件，适应窗口&lt;/h3&gt;
&lt;p&gt;在设置 &lt;code&gt;web&lt;/code&gt; 网页的时候，有些设置了绝对值，可能对于窗口化的 &lt;code&gt;acapp&lt;/code&gt; 显示效果差&lt;/p&gt;
&lt;p&gt;将他们修改成相对数值&lt;/p&gt;
&lt;p&gt;&lt;code&gt;game.css&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-menu-field {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    top: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;40&lt;/span&gt;%;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    left: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;20&lt;/span&gt;%;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-menu-field-item {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    height: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;6&lt;/span&gt;vh;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    font-size: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt;vh;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;创建账号系统&#34;&gt;创建账号系统&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/3294700/&#34;&gt;6. 创建账号系统 | 讲义&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;用户名密码登录&#34;&gt;用户名密码登录&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/blog/content/12373/&#34;&gt;6.1 用户名密码登录 | 讲义&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/79314/&#34;&gt;6.1 上课笔记 | Andrew1729&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/75831/&#34;&gt;6.1 上课笔记 | 吃饱喝足不学习&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;客户端请求与django响应流程&#34;&gt;客户端请求与Django响应流程&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;用户在客户端通过&lt;code&gt;$.ajax&lt;/code&gt;发送请求，根据&lt;code&gt;urls&lt;/code&gt;路由到对应的&lt;code&gt;views&lt;/code&gt;中的函数，处理&lt;code&gt;request&lt;/code&gt;后返回&lt;code&gt;JsonResponse&lt;/code&gt; 至客户端&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;前期准备工作&#34;&gt;前期准备工作&lt;/h3&gt;
&lt;p&gt;做开发，先开启调试模式，如果不开启，服务器一旦运行错误，就只返回 &lt;code&gt;Error&lt;/code&gt; 报错
&lt;code&gt;settings.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DEBUG = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;True&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;不过 &lt;code&gt;django&lt;/code&gt; 自带的 &lt;code&gt;User&lt;/code&gt; 表并不能满足我们的需求，因此我们需要自己额外建表&lt;/p&gt;
&lt;h3 id=&#34;创建用户表&#34;&gt;创建用户表&lt;/h3&gt;
&lt;p&gt;所有的数据表都存在 &lt;code&gt;models&lt;/code&gt; 里&lt;/p&gt;
&lt;p&gt;我们在 &lt;code&gt;models&lt;/code&gt; 里创建一个 &lt;code&gt;player&lt;/code&gt; 文件夹，用于存储所有的 &lt;code&gt;player&lt;/code&gt; 相关的表&lt;/p&gt;
&lt;p&gt;然后对文件夹初始化 &lt;code&gt;__init__.py&lt;/code&gt;，接着扩充成一个我们需要的数据表&lt;/p&gt;
&lt;p&gt;&lt;code&gt;game/models/player/player.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.db &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; models
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.contrib.auth.models &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; User
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Player(models.Model): &lt;span style=&#34;color:#007f7f&#34;&gt;# Player 类继承自 Model 类&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    user = models.OneToOneField(User, on_delete=models.CASCADE)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;# 说明Player是从User表扩充过来的，每一个player都与一个user是一一对应关联关系&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;# 后一个参数是指，当user被删除后，对应的player也要被删除&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;# （感觉就是外键的意思）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    photo = models.URLField(max_length=&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;256&lt;/span&gt;, blank=&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;# 用于存储用户的头像的url&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;# 指定每个player数据展示在前台的数据&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;def&lt;/span&gt; __str__(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;str&lt;/span&gt;(self.user)    &lt;span style=&#34;color:#007f7f&#34;&gt;# 展示用户的用户名&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;将定义的表，注册到后台 &lt;code&gt;admin&lt;/code&gt; 页面中&lt;/p&gt;
&lt;p&gt;&lt;code&gt;game/admin.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; game.models.player.player &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; Player
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;admin.site.register(Player)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后将创建的数据表更新到 &lt;code&gt;django&lt;/code&gt; 的数据库中去&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f00&#34;&gt;$&lt;/span&gt; python3 manage.py makemigrations
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt; Migrations &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;game&amp;#39;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;   game/migrations/&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0001&lt;/span&gt;_initial.py
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;     - Create model Player
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f00&#34;&gt;$&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f00&#34;&gt;$&lt;/span&gt; python3 manage.py migrate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt; Operations to perform:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;   Apply &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;all&lt;/span&gt; migrations: admin, auth, contenttypes, game, sessions
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt; Running migrations:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;   Applying game&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;.0001&lt;/span&gt;_initial... OK
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后重启一下服务，就可以在管理员页面看到新建的数据库了&lt;/p&gt;
&lt;h3 id=&#34;实现客户端的类型判别acapp-or-web&#34;&gt;实现客户端的类型判别（ACAPP or WEB）&lt;/h3&gt;
&lt;p&gt;由于我们实现的项目是前后端分离类型，因此对于不同的客户端，前端要控制生成不同的页面&lt;/p&gt;
&lt;p&gt;为了增强扩展性，故这里要实现客户端类型的判别&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;y总&lt;/strong&gt; 已经提前写好了 &lt;strong&gt;ACAPP&lt;/strong&gt; 的接口，如果用户用的是 &lt;strong&gt;ACAPP&lt;/strong&gt; 访问，则在新建对象 &lt;strong&gt;ac_game&lt;/strong&gt; 时，会额外传递一个参数&lt;/p&gt;
&lt;p&gt;我们只需按照这个接口去完成扩充即可&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;之后写小程序之类的同理，额外传一个接口&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;js/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;export&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGame {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(id, AcWingOS) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.id = id;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$ac_game = $(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;#&amp;#39;&lt;/span&gt; + id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.AcWingOS = AcWingOS;   &lt;span style=&#34;color:#007f7f&#34;&gt;//如果是acapp端，该变量就会带着一系列y总提供的接口
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.menu = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; AcGameMenu(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; AcGamePlayground(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.start();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;构建登录功能框架&#34;&gt;构建登录功能框架&lt;/h3&gt;
&lt;p&gt;基本逻辑 : 用户访问页面 -&amp;gt; 进入登录页面 -&amp;gt; 提交登录信息 -&amp;gt; 核对登录信息 -&amp;gt; 返回登陆结果和其他信息&lt;/p&gt;
&lt;p&gt;每实现一个函数，就需要实现三个部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;views&lt;/code&gt; : 实现具体的调用数据库的逻辑&lt;/li&gt;
&lt;li&gt;&lt;code&gt;urls&lt;/code&gt; : 实现一个路由&lt;/li&gt;
&lt;li&gt;&lt;code&gt;js&lt;/code&gt; : 前端实现GET上述接口的过程&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;欲实现流程 :&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用户访问网站，通过先前完成的路由，访问到 &lt;code&gt;web.html &lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;web.html&lt;/code&gt; 中的 &lt;code&gt;js&lt;/code&gt; 部分创建了一个 &lt;code&gt;AcGame&lt;/code&gt; 对象&lt;/li&gt;
&lt;li&gt;&lt;code&gt;AcGame&lt;/code&gt; 对象创建的过程中，生成了 &lt;code&gt;Settings&lt;/code&gt; 对象&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Settings&lt;/code&gt; 对象创建完成后，调用 &lt;code&gt;Settings.start()&lt;/code&gt; 函数&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Settings.start()&lt;/code&gt; 函数调用了 &lt;code&gt;Settings.getinfo()&lt;/code&gt; 函数&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Settings.getinfo()&lt;/code&gt; 函数中执行了 &lt;code&gt;ajax&lt;/code&gt; 向 &lt;code&gt;getinfo&lt;/code&gt; 接口发起一个含参数 &lt;code&gt;platform&lt;/code&gt; 的 &lt;code&gt;GET&lt;/code&gt; 请求&lt;/li&gt;
&lt;li&gt;通过 &lt;code&gt;urls&lt;/code&gt; 路由的实现，最终定位到 &lt;code&gt;views/settings/getinfo.py&lt;/code&gt; 文件的 &lt;code&gt;getinfo(request)&lt;/code&gt; 函数&lt;/li&gt;
&lt;li&gt;根据传递过来的 &lt;code&gt;platform&lt;/code&gt; 函数，实现不同的 &lt;code&gt;JsonResponse&lt;/code&gt; 返回&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Settings.getinfo()&lt;/code&gt; 接受到了 &lt;code&gt;response&lt;/code&gt; 完成上述基本逻辑&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;views&#34;&gt;views&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;views/settings/getinfo.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.http &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; JsonResponse
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; game.models.player.player &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; Player
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;def&lt;/span&gt; getinfo_acapp(request):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    player = Player.objects.all()[&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;]    &lt;span style=&#34;color:#007f7f&#34;&gt;# 取出数据库中第一个用户(调试该功能)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;username&amp;#39;&lt;/span&gt;: player.user.username,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;photo&amp;#39;&lt;/span&gt;: player.photo,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;def&lt;/span&gt; getinfo_web(request):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    player = Player.objects.all()[&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;]    &lt;span style=&#34;color:#007f7f&#34;&gt;# 取出数据库中第一个用户(调试该功能)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;username&amp;#39;&lt;/span&gt;: player.user.username,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;photo&amp;#39;&lt;/span&gt;: player.photo,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;def&lt;/span&gt; getinfo(request):   &lt;span style=&#34;color:#007f7f&#34;&gt;# 处理请求&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    platform = request.GET.get(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;platform&amp;#39;&lt;/span&gt;)  &lt;span style=&#34;color:#007f7f&#34;&gt;# 根据请求的平台不同，进行不同返回处理&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; platform == &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;ACAPP&amp;#34;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; getinfo_acapp(request)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;elif&lt;/span&gt; platform == &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;WEB&amp;#34;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; getinfo_web(request)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;urls&#34;&gt;urls&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;urls/settings/index.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.urls &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; path
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; game.views.settings.getinfo &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; getinfo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;urlpatterns = [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    path(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;getinfo/&amp;#34;&lt;/span&gt;, getinfo, name=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;settings_getinfo&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;路由建立好以后，访问 &lt;code&gt;xxxx/settings/getinfo&lt;/code&gt;，可以看到 &lt;code&gt;getinfo.py&lt;/code&gt; 返回的 &lt;code&gt;JSON&lt;/code&gt; 类型的 &lt;code&gt;JSONResponse&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;js&#34;&gt;js&lt;/h4&gt;
&lt;p&gt;网页刚访问时，应先将 &lt;code&gt;menu&lt;/code&gt; 关闭，然后打开登录界面，随意先修改一个让 &lt;code&gt;menu&lt;/code&gt; 初始关闭&lt;/p&gt;
&lt;p&gt;&lt;code&gt;static/js/src/menu/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGameMenu {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$menu.hide();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;static/js/src/settings/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Settings {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.root = root;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.platform = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;WEB&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.root.AcWingOS) &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.platform = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;ACAPP&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.start();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.getinfo();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    register() {    &lt;span style=&#34;color:#007f7f&#34;&gt;// 打开注册界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    login() {       &lt;span style=&#34;color:#007f7f&#34;&gt;// 打开登录界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    getinfo() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $.ajax({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            url: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;https://app1117.acapp.acwing.com.cn/settings/getinfo/&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            type: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                platform: outer.platform,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            success: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(resp) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                console.log(resp);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (resp.result === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;) {    &lt;span style=&#34;color:#007f7f&#34;&gt;// 登录成功，关闭登录界面，打开主菜单
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;                    outer.hide();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    outer.root.menu.show();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    outer.login();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    hide() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    show() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后不要忘记在 &lt;code&gt;根js&lt;/code&gt; 下创建对象&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;export&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGame {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(id, AcWingOS) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.settings = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Settings(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样基本框架就完成了&lt;/p&gt;
&lt;h4 id=&#34;完善-http-请求的函数&#34;&gt;完善 HTTP 请求的函数&lt;/h4&gt;
&lt;p&gt;如果用户未登录，返回信息 &amp;ldquo;not login&amp;rdquo;&lt;/p&gt;
&lt;p&gt;如果用户登录，返回信息 &amp;ldquo;success&amp;rdquo; 以及用户名和头像&lt;/p&gt;
&lt;p&gt;&lt;code&gt;views/setting/getinfo.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;def&lt;/span&gt; getinfo_web(request):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    user = request.user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; not user.is_authenticated:   &lt;span style=&#34;color:#007f7f&#34;&gt;# 未登录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;not login&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt;:                           &lt;span style=&#34;color:#007f7f&#34;&gt;# 已登录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        player = Player.objects.get(user=user)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;username&amp;#39;&lt;/span&gt;: player.user.username,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;photo&amp;#39;&lt;/span&gt;: player.photo,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意前后台是一个登录系统，因此要先退掉后台，再测试&lt;/p&gt;
&lt;h3 id=&#34;将用户头像渲染到玩家上&#34;&gt;将用户头像渲染到玩家上&lt;/h3&gt;
&lt;p&gt;将返回的 &lt;code&gt;JsonResponse&lt;/code&gt; 存到 &lt;code&gt;Settings&lt;/code&gt; 类的变量中
&lt;code&gt;settings/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Settings {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.username = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.photo = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    getinfo() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $.ajax({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            success: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(resp) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (resp.result === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    outer.username = resp.username;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    outer.photo = resp.photo;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                ..
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后在 &lt;code&gt;Player&lt;/code&gt; 里把用户的头像渲染到对应的玩家上&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Player {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(...) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.img = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Image();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.img.src = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.root.settings.photo;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    render() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.save();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.beginPath();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.arc(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.PI * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.stroke();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.clip();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.drawImage(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.img, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius, 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.restore();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.beginPath();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.arc(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.PI, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillStyle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fill();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;实现登录界面的前端&#34;&gt;实现登录界面的前端&lt;/h3&gt;
&lt;p&gt;先完成登录界面显示的逻辑&lt;/p&gt;
&lt;p&gt;&lt;code&gt;settings/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Settings {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    register() {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 打开注册界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login.hide();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register.show();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    login() {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 打开登录界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register.hide();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login.show();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    hide() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$settings.hide();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    show() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$settings.show();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;实现前端的基础框架&#34;&gt;实现前端的基础框架&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;settings/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Settings {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$settings = $(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;`
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;lt;div class=&amp;#34;ac-game-settings&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;    &amp;lt;div class=&amp;#34;ac-game-settings-login&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-title&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            登录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-username&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;div class=&amp;#34;ac-game-settings-item&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;                &amp;lt;input type=&amp;#34;text&amp;#34; placeholder=&amp;#34;用户名&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-password&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;div class=&amp;#34;ac-game-settings-item&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;                &amp;lt;input type=&amp;#34;password&amp;#34; placeholder=&amp;#34;密码&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-submit&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;div class=&amp;#34;ac-game-settings-item&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;                &amp;lt;button&amp;gt;登录&amp;lt;/button&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-error-message&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-option&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            注册
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;br&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-acwing&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;img width=&amp;#34;30&amp;#34; src=&amp;#34;https://app165.acapp.acwing.com.cn/static/image/settings/acwing_logo.png&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;br&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;                AcWing一键登录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;    &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;    &amp;lt;div class=&amp;#34;ac-game-settings-register&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-title&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            注册
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-username&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;div class=&amp;#34;ac-game-settings-item&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;                &amp;lt;input type=&amp;#34;text&amp;#34; placeholder=&amp;#34;用户名&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-password ac-game-settings-password-first&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;div class=&amp;#34;ac-game-settings-item&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;                &amp;lt;input type=&amp;#34;password&amp;#34; placeholder=&amp;#34;密码&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-password ac-game-settings-password-second&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;div class=&amp;#34;ac-game-settings-item&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;                &amp;lt;input type=&amp;#34;password&amp;#34; placeholder=&amp;#34;确认密码&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-submit&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;div class=&amp;#34;ac-game-settings-item&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;                &amp;lt;button&amp;gt;注册&amp;lt;/button&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-error-message&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-option&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            登录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;br&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;div class=&amp;#34;ac-game-settings-acwing&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;img width=&amp;#34;30&amp;#34; src=&amp;#34;https://app165.acapp.acwing.com.cn/static/image/settings/acwing_logo.png&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;br&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;                AcWing一键登录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;            &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;        &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;    &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;`&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$settings.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-login&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_username = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-username input&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_password = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-password input&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_submit = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-submit button&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_error_message = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-error-message&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_register = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-option&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login.hide();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$settings.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-register&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_username = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-username input&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_password = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-password-first input&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_password_confirm = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-password-second input&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_submit = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-submit button&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_error_message = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-error-message&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_login = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register.find(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;.ac-game-settings-option&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register.hide();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.root.$ac_game.append(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$settings);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;对应的 &lt;code&gt;css&lt;/code&gt; 文件部分：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;css/game.css&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-css&#34; data-lang=&#34;css&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;width&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;background-image&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;url&lt;/span&gt;(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;/static/image/menu/background.gif&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;background-size&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;user-select&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;none&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-login {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;41&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;width&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;20&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vw&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;position&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;relative&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;top&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;left&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;transform&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;translate&lt;/span&gt;(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;background-color&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;rgba&lt;/span&gt;(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.7&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;border-radius&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;px&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-title {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;color&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;white&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;font-size&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;text-align&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;center&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;padding-top&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;margin-bottom&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-username {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;display&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;block&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-password {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;display&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;block&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-submit {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;display&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;block&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-acwing {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;display&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;block&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-item {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;width&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-item &amp;gt; &lt;span style=&#34;font-weight:bold&#34;&gt;input&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;width&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;90&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;line-height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;position&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;relative&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;top&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;left&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;transform&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;translate&lt;/span&gt;(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-item &amp;gt; &lt;span style=&#34;font-weight:bold&#34;&gt;button&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;color&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;white&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;width&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;90&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;line-height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;position&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;relative&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;top&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;left&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;transform&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;translate&lt;/span&gt;(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;background-color&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;#4CAF50&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;border-radius&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;px&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-error-message {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;color&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;red&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;font-size&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.8&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;display&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;inline&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;float&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;left&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;padding-left&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vw&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-option {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;color&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;white&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;font-size&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;display&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;inline&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;float&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;right&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;padding-right&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vw&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;cursor&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;pointer&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-acwing &amp;gt; &lt;span style=&#34;font-weight:bold&#34;&gt;img&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;position&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;relative&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;top&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;left&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;transform&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;translate&lt;/span&gt;(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;cursor&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;pointer&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;display&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;block&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-acwing &amp;gt; &lt;span style=&#34;font-weight:bold&#34;&gt;div&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;color&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;white&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;font-size&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1.5&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;text-align&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;center&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;display&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;block&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-settings-register {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;height&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vh&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;width&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;20&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;vw&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;position&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;relative&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;top&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;left&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;transform&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;translate&lt;/span&gt;(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;background-color&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;rgba&lt;/span&gt;(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.7&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;border-radius&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;px&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;实现登录注册的相互切换&#34;&gt;实现登录/注册的相互切换&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Settings {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.getinfo();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.add_listening_events();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    add_listening_events() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.add_listening_events_login();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.add_listening_events_register();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    add_listening_events_login() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_register.click(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.register();   &lt;span style=&#34;color:#007f7f&#34;&gt;// 跳到注册界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    add_listening_events_register() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_login.click(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.login();      &lt;span style=&#34;color:#007f7f&#34;&gt;// 跳到登录界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;实现登录功能&#34;&gt;实现登录功能&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;views/settings/login.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.http &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; JsonResponse
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.contrib.auth &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; authenticate, login
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;def&lt;/span&gt; signin(request):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    data = request.GET
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    username = data.get(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;username&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    password = data.get(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;password&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    user = authenticate(username=username, password=password)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; not user:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;用户名或密码不正确&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    login(request, user)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;urls/settings/index.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.urls &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; path
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; game.views.settings.getinfo &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; getinfo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; game.views.settings.login &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; signin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;urlpatterns = [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    path(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;getinfo/&amp;#34;&lt;/span&gt;, getinfo, name=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;settings_getinfo&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    path(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;login/&amp;#34;&lt;/span&gt;, signin, name=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;settings_login&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;settings/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Settings{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    add_listening_events_login() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_submit.click(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.login_on_remote();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    login_on_remote() {     &lt;span style=&#34;color:#007f7f&#34;&gt;// 在远程服务器上登录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; username = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_username.val();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; password = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_password.val();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_error_message.empty();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $.ajax({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            url: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;https://app1117.acapp.acwing.com.cn/settings/login/&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            type: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                username: username,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                password: password,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            success: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(resp) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                console.log(resp);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (resp.result === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    location.reload();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    outer.$login_error_message.html(resp.result);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;实现登出功能&#34;&gt;实现登出功能&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;views/settings/logout.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.http &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; JsonResponse
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.contrib.auth &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; logout
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;def&lt;/span&gt; signout(request):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    user = request.user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; not user.is_authenticated:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    logout(request)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;urls/settings/index.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; game.views.settings.logout &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; signout
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;urlpatterns = [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    path(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;logout/&amp;#34;&lt;/span&gt;, signout, name=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;settings_logout&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;settings/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;login_on_remote() {     &lt;span style=&#34;color:#007f7f&#34;&gt;// 在远程服务器上登录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; username = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_username.val();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; password = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_password.val();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$login_error_message.empty();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    $.ajax({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        url: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;https://app1117.acapp.acwing.com.cn/settings/login/&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        type: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        data: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            username: username,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            password: password,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        success: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(resp) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            console.log(resp);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (resp.result === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                location.reload();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                outer.$login_error_message.html(resp.result);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;再顺便将 &lt;code&gt;menu&lt;/code&gt; 菜单页面里的 &lt;code&gt;设置&lt;/code&gt; 按钮也绑定上登出功能&lt;/p&gt;
&lt;p&gt;&lt;code&gt;menu/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;add_listening_events() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$settings_mode.click(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        outer.root.settings.logout_on_remote();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;实现注册功能&#34;&gt;实现注册功能&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;views/settings/register.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.http &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; JsonResponse
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.contrib.auth &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; login
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; django.contrib.auth.models &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; User
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; game.models.player.player &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; Player
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;def&lt;/span&gt; register(request):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    data = request.GET
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    username = data.get(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;username&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;).strip()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    password = data.get(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;password&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;).strip()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    password_confirm = data.get(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;password_confirm&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;).strip()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; not username or not password:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;用户名或密码不能为空&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; password != password_confirm:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;两个密码不一致&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; User.objects.filter(username=username).exists():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;用户名已存在&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    user = User(username=username)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    user.set_password(password)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    user.save()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Player.objects.create(user=user, photo=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;https://cdn.acwing.com/media/user/profile/photo/42832_lg_f999efc3c8.png&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    login(request, user)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; JsonResponse({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;urls/settings/index.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;from&lt;/span&gt; game.views.settings.register &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;import&lt;/span&gt; register
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;urlpatterns = [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    path(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;register/&amp;#34;&lt;/span&gt;, register, name=&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;settings_register&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;settings/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;add_listening_events_register() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_submit.click(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        outer.register_on_remote();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;register_on_remote() {  &lt;span style=&#34;color:#007f7f&#34;&gt;// 在远程服务器上注册
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; username = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_username.val();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; password = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_password.val();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; password_confirm = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_password_confirm.val();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$register_error_message.empty();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    $.ajax({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        url: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;https://app1117.acapp.acwing.com.cn/settings/register/&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        type: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        data: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            username: username,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            password: password,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            password_confirm: password_confirm,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        success: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(resp) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            console.log(resp);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (resp.result === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;success&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                location.reload();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                outer.$register_error_message.html(resp.result);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;redisஐ&#34;&gt;Redisஐ&lt;/h2&gt;
&lt;h3 id=&#34;redis是什么&#34;&gt;Redis是什么？&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Redis&lt;/code&gt; 是一款内存高速缓存数据库&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;为什么要使用redis&#34;&gt;为什么要使用Redis?&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;我们目前用的是&lt;code&gt;Django&lt;/code&gt;自带的数据库&lt;code&gt;Sqlite&lt;/code&gt;。&lt;code&gt;Django&lt;/code&gt;是很容易将数据库迁移到&lt;code&gt;mySQL&lt;/code&gt;的。但是存储效率不如&lt;code&gt;redis&lt;/code&gt;，因为&lt;code&gt;redis&lt;/code&gt;是内存数据库，所以调用东西都非常快，存的是一个一个的&lt;code&gt;&amp;lt;key, value&amp;gt;&lt;/code&gt;，而且是单线程的&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;在django中集成redis&#34;&gt;在Django中集成Redis&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;安装 &lt;code&gt;django_redis&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip install django_redis
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;配置 &lt;code&gt;settings.py&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;CACHES = { 
    &amp;#39;default&amp;#39;: {
        &amp;#39;BACKEND&amp;#39;: &amp;#39;django_redis.cache.RedisCache&amp;#39;,
        &amp;#39;LOCATION&amp;#39;: &amp;#39;redis://127.0.0.1:6379/1&amp;#39;,
        &amp;#34;OPTIONS&amp;#34;: {
            &amp;#34;CLIENT_CLASS&amp;#34;: &amp;#34;django_redis.client.DefaultClient&amp;#34;,
        },  
    },  
}
USER_AGENTS_CACHE = &amp;#39;default&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;启动 &lt;code&gt;redis-server&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo redis-server /etc/redis/redis.conf
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;在-django-后台里操纵-redis&#34;&gt;在 Django 后台里操纵 Redis&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ python3 manage.py shell&amp;#39;

In [1]: from django.core.cache import cache # 引入redis

In [2]: cache.keys(&amp;#39;*&amp;#39;)                     # 查询redis里所有的关键字
Out[2]: []

In [3]: cache.set(&amp;#39;yxc&amp;#39;, 1, 5)              # 插入一个key-val，存在 5 s
Out[3]: True

In [4]: cache.keys(&amp;#39;*&amp;#39;)                     # 查询redis里所有的关键字
Out[4]: [&amp;#39;yxc&amp;#39;]

In [5]: cache.set(&amp;#39;yxc&amp;#39;, 2, None)           # 插入一个key-val，不会过期
Out[5]: True

In [6]: cache.set(&amp;#39;abc&amp;#39;, 3, None)
Out[6]: True

In [7]: cache.keys(&amp;#39;y*&amp;#39;)
Out[7]: [&amp;#39;yxc&amp;#39;]

In [8]: cache.has_key(&amp;#39;abc&amp;#39;)
Out[8]: True

In [9]: cache.has_key(&amp;#39;abcd&amp;#39;)
Out[9]: False

In [10]: cache.get(&amp;#39;yxc&amp;#39;)
Out[10]: 2

In [11]: cache.delete(&amp;#39;yxc&amp;#39;)
Out[11]: True

In [12]: cache.keys(&amp;#39;*&amp;#39;)
Out[12]: [&amp;#39;abc&amp;#39;]

In [13]:
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;web端acwing一键登录ஐ&#34;&gt;Web端AcWing一键登录ஐ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/blog/content/12466/&#34;&gt;6.2 Web端AcWing一键登录 | 讲义&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/79354/&#34;&gt;6.2 上课笔记 | Andrew1729&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/video/3565/&#34;&gt;6.2 Web端AcWing一键登录 | Vedio&lt;/a&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Oauth2一键授权登录的基本原理&lt;/strong&gt;：$17m30s——29m15s——32m51s$&lt;/li&gt;
&lt;li&gt;数据表添加&lt;code&gt;openid&lt;/code&gt;信息：$33m20s——34m47s$&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Oauth2一键授权登录的代码实现&lt;/strong&gt;：$35m20s——1h25s——1h27m20s$&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;用户点击&lt;code&gt;AcWing一键登录&lt;/code&gt;，通过&lt;code&gt;urls &amp;amp; views&lt;/code&gt;调用&lt;code&gt;apply_code&lt;/code&gt;函数，将&lt;code&gt;state&lt;/code&gt;放到&lt;code&gt;redis&lt;/code&gt;中，将&lt;code&gt;appid &amp;amp; redirect_uri &amp;amp; scope &amp;amp; state&lt;/code&gt; 传入&lt;code&gt;apply_code_url&lt;/code&gt;链接，返回并重定向至&lt;code&gt;apply_code_url&lt;/code&gt;向用户询问是否授权&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;用户点击&lt;code&gt;同意&lt;/code&gt;后，重定向至&lt;code&gt;redirect_uri&lt;/code&gt;链接，返回参数为&lt;code&gt;code&lt;/code&gt;和&lt;code&gt;state&lt;/code&gt;，通过&lt;code&gt;urls &amp;amp; views&lt;/code&gt;调用&lt;code&gt;receive_code&lt;/code&gt;函数&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;若验证&lt;code&gt;state&lt;/code&gt;失败，直接重定向至初始界面&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;若验证&lt;code&gt;state&lt;/code&gt;成功，将&lt;code&gt;appid &amp;amp; code &amp;amp; secret&lt;/code&gt;发送至&lt;code&gt;AcWing服务器&lt;/code&gt;，申请授权令牌&lt;code&gt;access_token&lt;/code&gt;和用户的&lt;code&gt;openid&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;若申请令牌成功，将&lt;code&gt;access_token &amp;amp; openid&lt;/code&gt;发送至&lt;code&gt;AcWing服务器&lt;/code&gt;，得到用户信息，创建并登录用户，最后重定向至初始界面&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;acapp端acwing一键登录ஐ&#34;&gt;AcApp端AcWing一键登录ஐ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/blog/content/12467/&#34;&gt;6.3 AcApp端AcWing一键登录 | 讲义&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/79365/&#34;&gt;6.3 上课笔记 | Andrew1729&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/video/3566/&#34;&gt;6.3 Acapp端AcWing一键登录 | Vedio&lt;/a&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Oauth2一键授权登录的基本原理&lt;/strong&gt;：$10m——12m20s——16m35s——18m$&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Oauth2一键授权登录的代码实现&lt;/strong&gt;：$19m25s——21m——23m25s——34m29s——42m10s$&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;实现联机对战ஐ&#34;&gt;实现联机对战ஐ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/3357332/&#34;&gt;7. 实现联机对战 | 讲义&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/89506/&#34;&gt;7.1 上课笔记 | 大菜狗&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/88801/&#34;&gt;7.2 上课笔记 | 菊花&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;统一长度单位&#34;&gt;统一长度单位&lt;/h2&gt;
&lt;p&gt;由于联机对战的时候，每个用户的客户端长宽不一样&lt;/p&gt;
&lt;p&gt;在之前完成的游戏界面里，我们会根据当前客户端的大小，进行渲染&lt;/p&gt;
&lt;p&gt;但是在联机对战的时候，应当让所有玩家的游戏界面保持同步才可以&lt;/p&gt;
&lt;p&gt;所有，就引入了 &lt;strong&gt;统一长度单位&lt;/strong&gt; 的目标&lt;/p&gt;
&lt;h3 id=&#34;地图渲染&#34;&gt;地图渲染&lt;/h3&gt;
&lt;h4 id=&#34;地图-169-等比例缩放&#34;&gt;地图 16:9 等比例缩放&lt;/h4&gt;
&lt;p&gt;实现逻辑：根据当前用户的客户端大小，统一渲染成 &lt;strong&gt;16:9&lt;/strong&gt; 的游戏界面，且随着用户调整窗口大小，也动态调整&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGamePlayground {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(root) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.root.$ac_game.append(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground);&lt;span style=&#34;color:#007f7f&#34;&gt;// 未来可能会多次 show 因此把创建场景挪到这里
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;window&lt;/span&gt;).resize(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.resize();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resize() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground.width();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground.height();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; unit = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.min(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;16&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;9&lt;/span&gt;);  &lt;span style=&#34;color:#007f7f&#34;&gt;// 以最小的作为基准，渲染
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width = unit * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;16&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height = unit * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;9&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.resize();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.scale = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.height;   &lt;span style=&#34;color:#007f7f&#34;&gt;// resize时，其他元素的渲染大小都以当前渲染的高度为基准，存为 scale 变量
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.game_map) &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.game_map.resize();  &lt;span style=&#34;color:#007f7f&#34;&gt;//如果此时地图已创建，则resize一下
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    show() {    &lt;span style=&#34;color:#007f7f&#34;&gt;// 打开 playground 界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$playground.show();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.resize();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;js/src/playground/game_map/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; GameMap &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;extends&lt;/span&gt; AcGameObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resize() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.width = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.width;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.height = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;地图居中&#34;&gt;地图居中&lt;/h4&gt;
&lt;p&gt;直接把 &lt;code&gt;canvas&lt;/code&gt; 元素，用相对位置居中即可&lt;/p&gt;
&lt;p&gt;&lt;code&gt;css/game.css&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-css&#34; data-lang=&#34;css&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-playground {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f00&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;background-color&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;grey&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.ac-game-playground &amp;gt; &lt;span style=&#34;font-weight:bold&#34;&gt;canvas&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;position&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;relative&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;top&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;left&lt;/span&gt;: &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;transform&lt;/span&gt;: &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;translate&lt;/span&gt;(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;-50&lt;/span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;%&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;解决地图-resize-时会出现渐变成黑色的情况&#34;&gt;解决地图 resize 时，会出现渐变成黑色的情况&lt;/h4&gt;
&lt;p&gt;原由是因为我们的实现逻辑是：每帧会渲染一层半透明的黑色背景&lt;/p&gt;
&lt;p&gt;也就造就了一开始会出现灰屏的情况，解决方法很简单，直接 resize 完，强制涂一层不透明的黑色即可&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/game_map/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; GameMap &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;extends&lt;/span&gt; AcGameObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resize() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.width = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.width;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.height = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillStyle = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;rgba(0, 0, 0, 1)&amp;#34;&lt;/span&gt;;    &lt;span style=&#34;color:#007f7f&#34;&gt;// resize 完，涂一层不透明的即可
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillRect(&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.width, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.canvas.height);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;元素渲染&#34;&gt;元素渲染&lt;/h3&gt;
&lt;p&gt;地图随着尺寸等比例放大缩小的同时，地图内的其他元素也应与背景一同等比例放大缩小&lt;/p&gt;
&lt;p&gt;因此，我们只需把元素全部设为相对大小即可，用我们先前设置的 playground.scale 值即可&lt;/p&gt;
&lt;h4 id=&#34;玩家-player&#34;&gt;玩家 Player&lt;/h4&gt;
&lt;p&gt;初始化的时候，转为传递 &lt;strong&gt;scale&lt;/strong&gt; 的比例值&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGamePlayground {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    show() {    &lt;span style=&#34;color:#007f7f&#34;&gt;// 打开 playground 界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Player(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; / &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.scale, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;true&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Player(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; / &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.scale, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.get_random_color(), &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;js/src/playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Player {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; tx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.width / &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.scale;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; ty = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height / &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.scale;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    add_listening_events() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.game_map.$canvas.mousedown(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (e.which === &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;3&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                outer.move_to((e.clientX - rect.left) / outer.playground.scale, (e.clientY - rect.top) / outer.playground.scale);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (e.which === &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (outer.cur_skill === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;fireball&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    outer.shoot_fireball((e.clientX - rect.left) / outer.playground.scale, (e.clientY - rect.top) / outer.playground.scale);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    shoot_fireball(tx, ty) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; x = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x, y = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; radius = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.01&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; angle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.atan2(ty - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y, tx - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; vx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.cos(angle), vy = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.sin(angle);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; color = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;orange&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; speed = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.5&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; move_length = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1.0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; damage = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.01&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; FireBall(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, x, y, radius, vx, vy, color, speed, move_length, damage);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    update() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.update_move();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.render();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    update_move() { &lt;span style=&#34;color:#007f7f&#34;&gt;// 更新玩家移动
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (!&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me &amp;amp;&amp;amp; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.spent_time &amp;gt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;4&lt;/span&gt; &amp;amp;&amp;amp; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;180&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.damage_speed &amp;gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.eps) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.move_length &amp;lt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.eps) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (!&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; tx = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.width / &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.scale;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; ty = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.height / &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.scale;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    render() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; scale = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.scale;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.is_me) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.arc(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius * scale, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.PI * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.drawImage(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.img, (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius) * scale, (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y - &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius) * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * scale);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.arc(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius * scale, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.PI, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;火球-fireball&#34;&gt;火球 Fireball&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/skill/fireball/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Fireball {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    render() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; scale = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.scale;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.beginPath();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.arc(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius * scale, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.PI, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillStyle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fill();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;粒子-particle&#34;&gt;粒子 Particle&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/particle/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Particle {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    render() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; scale = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.playground.scale;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.beginPath();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.arc(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.x * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.y * scale, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.radius * scale, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; * &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.PI, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fillStyle = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.color;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ctx.fill();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;增加联机对战模式&#34;&gt;增加“联机对战”模式&lt;/h2&gt;
&lt;p&gt;为了区分：用户自己，机器人，联机玩家&lt;/p&gt;
&lt;p&gt;需要把 &lt;code&gt;is_me&lt;/code&gt; 改成字符串，用以表示不同 &lt;strong&gt;Player&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;menu/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGameMenu{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    add_listening_events() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$single_mode.click(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;(){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.hide();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.root.playground.show(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;single mode&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.$multi_mode.click(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.hide();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            outer.root.playground.show(&lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;multi mode&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Playground {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    show(mode) {    &lt;span style=&#34;color:#007f7f&#34;&gt;// 打开 playground 界面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Player(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; / &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.scale, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;me&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.root.settings.username, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.root.settings.photo)));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (mode === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;single mode&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;5&lt;/span&gt;; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players.push(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Player(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.width / &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;2&lt;/span&gt; / &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.scale, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.get_random_color(), &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0.15&lt;/span&gt;, &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;robot&amp;#34;&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (mode === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;multi mode&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; Player &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;extends&lt;/span&gt; AcGameObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor(playground, x, y, radius, color, speed, character, username, photo) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.character = character;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.username = username;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.photo = photo;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.character !== &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;robot&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.img = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; Image();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.img.src = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.photo;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007f7f&#34;&gt;// 同理，根据对应的逻辑，修改后面所有的 is_me 为 character
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;django_channels&#34;&gt;Django_channels&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/bcefda55bce4&#34;&gt;谈谈Websocket &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/dreamroute/p/6247726.html&#34;&gt;HTTP/TCP&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;django_channels是什么&#34;&gt;Django_channels是什么？&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Django_Channels 是一个为Django 提供异步扩展的库，通常主要用来提供WebSocket 支持和后台任务&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;WSS&lt;/code&gt; 是 &lt;code&gt;Web Socket&lt;/code&gt; 协议的安全模式，支持 &lt;code&gt;C/S&lt;/code&gt; 下的双向通信（HTTP协议只支持单向通信）&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;配置django_channels&#34;&gt;配置Django_channels&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;安装 &lt;code&gt;channels_redis&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip install channels_redis
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;配置 &lt;code&gt;acapp/asgi.py&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import os

from channels.auth import AuthMiddlewareStack
from channels.routing import ProtocolTypeRouter, URLRouter
from django.core.asgi import get_asgi_application
from game.routing import websocket_urlpatterns

os.environ.setdefault(&amp;#39;DJANGO_SETTINGS_MODULE&amp;#39;, &amp;#39;acapp.settings&amp;#39;)

application = ProtocolTypeRouter({
    &amp;#34;http&amp;#34;: get_asgi_application(),
    &amp;#34;websocket&amp;#34;: AuthMiddlewareStack(URLRouter(websocket_urlpatterns))
})
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;配置 &lt;code&gt;acapp/settings.py&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在 &lt;code&gt;INSTALLED_APPS&lt;/code&gt; 中添加 &lt;code&gt;channels&lt;/code&gt; ，添加后如下所示：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;INSTALLED_APPS = [ 
    &amp;#39;channels&amp;#39;,
    &amp;#39;game.apps.GameConfig&amp;#39;,
    &amp;#39;django.contrib.admin&amp;#39;,
    &amp;#39;django.contrib.auth&amp;#39;,
    &amp;#39;django.contrib.contenttypes&amp;#39;,
    &amp;#39;django.contrib.sessions&amp;#39;,
    &amp;#39;django.contrib.messages&amp;#39;,
    &amp;#39;django.contrib.staticfiles&amp;#39;,
]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后在文件末尾添加：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ASGI_APPLICATION = &amp;#39;acapp.asgi.application&amp;#39;
CHANNEL_LAYERS = {
    &amp;#34;default&amp;#34;: {
        &amp;#34;BACKEND&amp;#34;: &amp;#34;channels_redis.core.RedisChannelLayer&amp;#34;,
        &amp;#34;CONFIG&amp;#34;: {
            &amp;#34;hosts&amp;#34;: [(&amp;#34;127.0.0.1&amp;#34;, 6379)],
        },
    },
}
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;配置 &lt;code&gt;game/routing.py&lt;/code&gt;
这一部分的作用相当于 &lt;code&gt;http&lt;/code&gt; 的 &lt;code&gt;urls&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;内容如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.urls import path

websocket_urlpatterns = [
]
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;编写 &lt;code&gt;game/consumers&lt;/code&gt;
这一部分的作用相当于 &lt;code&gt;http&lt;/code&gt; 的 &lt;code&gt;views&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;参考示例：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;consumers/multiplayer/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from channels.generic.websocket import AsyncWebsocketConsumer
import json

class MultiPlayer(AsyncWebsocketConsumer):
    async def connect(self):
        await self.accept()
        print(&amp;#39;accept&amp;#39;)

        self.room_name = &amp;#34;room&amp;#34;
        await self.channel_layer.group_add(self.room_name, self.channel_name)

    async def disconnect(self, close_code):
        print(&amp;#39;disconnect&amp;#39;)
        await self.channel_layer.group_discard(self.room_name, self.channel_name);


    async def receive(self, text_data):
        data = json.loads(text_data)
        print(data)
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;启动 &lt;code&gt;django_channels&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在 &lt;code&gt;~/acapp&lt;/code&gt; 目录下执行：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;daphne -b 0.0.0.0 -p 5015 acapp.asgi:application
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;建立 &lt;strong&gt;WSS&lt;/strong&gt; 连接&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;game/routing.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.urls import path
from game.consumers.multiplayer.index import MultiPlayer

websocket_urlpatterns = [
    path(&amp;#34;wss/multiplayer/&amp;#34;, MultiPlayer.as_asgi(), name=&amp;#34;wss_multiplayer&amp;#34;),
]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGamePlayground {
    ...
    show(mode) {    // 打开 playground 界面
        ...
        if (mode === &amp;#34;single mode&amp;#34;) {
            ...
        } else if (mode === &amp;#34;multi mode&amp;#34;) {
            this.mps = new MultiPlayerSocket(this);
            this.mps.ws.onopen = function() {
                outer.mps.send_create_player();
            };
        }

    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;playground/socket/multiplayer/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class MultiPlayerSocket {
    constructor(playground) {
        this.playground = playground;
        this.ws = new WebSocket(&amp;#34;wss://app1117.acapp.acwing.com.cn/wss/multiplayer/&amp;#34;);
        this.start();
    }
    start() {
    }
    send_create_player() {
        this.ws.send(JSON.stringify({
            &amp;#39;message&amp;#39;: &amp;#39;hello acapp server&amp;#39;,
        }));
    }
    receive_create_player() {
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;编写同步函数&#34;&gt;编写同步函数&lt;/h2&gt;
&lt;p&gt;一共需要完成四个通信：&lt;/p&gt;
&lt;p&gt;（通信的逻辑基本都是先在本地完成，然后将结果返回给服务器，服务器再分发给其他客户端，达成同步）&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;create-player&lt;/strong&gt; : 在所有玩家的游戏界面，创建一个新加入的玩家&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;move-to&lt;/strong&gt; : 在所有玩家的游戏界面，将一个角色移动到一个位置&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;shoot-fireball&lt;/strong&gt; : 在所有玩家的游戏界面，让一个角色发射一个火球&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;attack&lt;/strong&gt; : 在所有玩家的游戏界面，让一个角色被攻击&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;一场游戏里，所有的元素（玩家，火球等）都需要唯一的标识，来方便同步&lt;/p&gt;
&lt;p&gt;为此，我们可以直接修改一下游戏引擎，对于每个元素都创建我们需要的唯一标识&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/ac-game-object/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGameObject {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    constructor() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.uuid = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.create_uuid();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    create_uuid() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; res = &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; i = &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;8&lt;/span&gt;; i ++ ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; x = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;parseInt&lt;/span&gt;(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.floor(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;Math&lt;/span&gt;.random() * &lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;10&lt;/span&gt;));   &lt;span style=&#34;color:#007f7f&#34;&gt;// [0, 10)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;&lt;/span&gt;            res += x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;return&lt;/span&gt; res;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; AcGamePlayground {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    show(mode) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (mode === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;single mode&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;if&lt;/span&gt; (mode === &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#34;multi mode&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.mps = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;new&lt;/span&gt; MultiPlayerSocket(&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.mps.uuid = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.players[&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0&lt;/span&gt;].uuid;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.mps.ws.onopen = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;function&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                outer.mps.send_create_player();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;playground/socket/multiplayer/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;class&lt;/span&gt; MultiPlayerSocket {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    send_create_player() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;let&lt;/span&gt; outer = &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;this&lt;/span&gt;.ws.send(JSON.stringify({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;event&amp;#39;&lt;/span&gt;: &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;create_player&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;uuid&amp;#39;&lt;/span&gt;: outer.uuid,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;接着，利用通信的方式，使得每个窗口内，逻辑上相同的元素，其 &lt;code&gt;uid&lt;/code&gt; 也相同即可&lt;/p&gt;
&lt;p&gt;原则是：哪个窗口创建的元素，就用他创建时的 &lt;code&gt;uid&lt;/code&gt; 作为整个项目运行时的 &lt;code&gt;uid&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后，我们打算用 &lt;strong&gt;redis&lt;/strong&gt; 来实现存储每个游戏房间，以及元素，并初始默认设定每个房间上限 3 人&lt;/p&gt;
&lt;h3 id=&#34;create-player&#34;&gt;create-player&lt;/h3&gt;
&lt;h4 id=&#34;前端&#34;&gt;前端&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;game/static/js/src/playground/socket/multiplayer/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class MultiPlayerSocket {
    constructor(playground) {
        this.playground = playground;

        this.ws = new WebSocket(&amp;#34;wss://app1117.acapp.acwing.com.cn/wss/multiplayer/&amp;#34;);

        this.start();
    }
    start() {
        this.receive();
    }
    receive() {
        let outer = this;
        this.ws.onmessage = function(e) {
            let data = JSON.parse(e.data);
            let uuid = data.uuid;
            if (uuid === outer.uuid) return false;

            let event = data.event;
            if (event === &amp;#34;create_player&amp;#34;) {
                outer.receive_create_player(uuid, data.username, data.photo);
            }
        };
    }
    send_create_player(username, photo) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &amp;#39;event&amp;#39;: &amp;#39;create_player&amp;#39;,
            &amp;#39;uuid&amp;#39;: outer.uuid,
            &amp;#39;username&amp;#39;: username,
            &amp;#39;photo&amp;#39;: photo,
        }));
    }
    receive_create_player(uuid, username, photo) {
        let player = new Player(
            this.playground,
            this.playground.width / 2 / this.playground.scale,
            0.5,
            0.05,
            &amp;#34;white&amp;#34;,
            0.15,
            &amp;#34;enemy&amp;#34;,
            username,
            photo,
        );
        player.uuid = uuid;
        this.playground.players.push(player);
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;后端&#34;&gt;后端&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;settings.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
ROOM_CAPACITY = 3
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;consumers/multiplayer/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from channels.generic.websocket import AsyncWebsocketConsumer
import json
from django.conf import settings
from django.core.cache import cache

class MultiPlayer(AsyncWebsocketConsumer):
    async def connect(self):
        self.room_name = None
        for i in range(1000):   # 上限 1k 个房间
            name = &amp;#34;room-%d&amp;#34; % (i)
            # 当前房间为空，或房间内玩家人数不到 ROOM_CAPACITY
            if not cache.has_key(name) or len(cache.get(name)) &amp;lt; settings.ROOM_CAPACITY:
                self.room_name = name
                break
        if not self.room_name:
            return

        await self.accept()

        if not cache.has_key(self.room_name):   # 如果房间不存在，则新建房间
            cache.set(self.room_name, [], 3600) # 有效期 1 小时

        for player in cache.get(self.room_name):    # 对该房间已存在的用户，创建到新加入的用户的游戏界面中
            await self.send(text_data=json.dumps({
                &amp;#39;event&amp;#39;: &amp;#34;create_player&amp;#34;,
                &amp;#39;uuid&amp;#39;: player[&amp;#39;uuid&amp;#39;],
                &amp;#39;username&amp;#39;: player[&amp;#39;username&amp;#39;],
                &amp;#39;photo&amp;#39;: player[&amp;#39;photo&amp;#39;],
            }))
        await self.channel_layer.group_add(self.room_name, self.channel_name)

    async def disconnect(self, close_code):
        print(&amp;#39;disconnect&amp;#39;)
        await self.channel_layer.group_discard(self.room_name, self.channel_name);

    async def create_player(self, data):
        players = cache.get(self.room_name)
        players.append({
            &amp;#39;uuid&amp;#39;: data[&amp;#39;uuid&amp;#39;],
            &amp;#39;username&amp;#39;: data[&amp;#39;username&amp;#39;],
            &amp;#39;photo&amp;#39;: data[&amp;#39;photo&amp;#39;],
        })
        cache.set(self.room_name, players, 3600) # 更新房间存在时间为 1 小时（最后一次加入一名玩家时）
        # 群发消息更新
        await self.channel_layer.group_send(
            self.room_name,
            {
                &amp;#39;type&amp;#39;: &amp;#34;group_create_player&amp;#34;,  # 群发该消息后，作为客户端接受者，所接受用的函数名
                &amp;#39;event&amp;#39;: &amp;#34;create_player&amp;#34;,
                &amp;#39;uuid&amp;#39;: data[&amp;#39;uuid&amp;#39;],
                &amp;#39;username&amp;#39;: data[&amp;#39;username&amp;#39;],
                &amp;#39;photo&amp;#39;: data[&amp;#39;photo&amp;#39;],
            }
        )
    async def group_create_player(self, data):
        await self.send(text_data=json.dumps(data))

    async def receive(self, text_data):
        data = json.loads(text_data)
        event = data[&amp;#39;event&amp;#39;]
        if event == &amp;#34;create_player&amp;#34;:
            await self.create_player(data)
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;redis-调试语句&#34;&gt;redis 调试语句&lt;/h4&gt;
&lt;p&gt;打开 shell 交互&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;python3 manage.py shell
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后用 py3 交互进行 cache 调试&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.core.cache import cache

def clear():
    for key in cache.keys(&amp;#39;*&amp;#39;):
        cache.delete(key)

cache.keys(&amp;#39;*&amp;#39;) # 查询当前 redis 中所有 key

cache.get(&amp;#39;room-1&amp;#39;) # 查询当前 redis 中 key 为 room-1 的值
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;到目前为止，便可以在不同的窗口渲染同一批玩家了&lt;/p&gt;
&lt;h3 id=&#34;move-to&#34;&gt;move-to&lt;/h3&gt;
&lt;h4 id=&#34;前端-1&#34;&gt;前端&lt;/h4&gt;
&lt;p&gt;客户端的通信的发出和接受函数&lt;/p&gt;
&lt;p&gt;&lt;code&gt;game/static/js/src/playground/socket/multiplayer/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class MultiPlayerSocket {
    ...
    receive() {
        let outer = this;
        this.ws.onmessage = function(e) {
            ...
            else if (event === &amp;#34;move_to&amp;#34;) {
                outer.receive_move_to(uuid, data.tx, data.ty);
            }
        };
    }
    send_move_to(tx, ty) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &amp;#39;event&amp;#39;: &amp;#39;move_to&amp;#39;,
            &amp;#39;uuid&amp;#39;: outer.uuid,
            &amp;#39;tx&amp;#39;: tx,
            &amp;#39;ty&amp;#39;: ty,
        }));
    }
    get_player(uuid) {
        let players = this.playground.players;
        for (let i = 0; i &amp;lt; players.length; i ++ ) {
            let player = players[i];
            if (player.uuid === uuid) {
                return player;
            }
        }
        return null;
    }
    receive_move_to(uuid, tx, ty) {
        let player = this.get_player(uuid);
        if (player) {
            player.move_to(tx, ty);
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;为了让游戏界面中对于要移动的元素做出移动动作，需要对 &lt;code&gt;move_to&lt;/code&gt; 函数做出一些修改&lt;/p&gt;
&lt;p&gt;首先要标识出当前为多人模式，然后模式为多人模式时，每次移动都会触发一次通信&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGamePlayground {
    ...
    show(mode) {
        ...
        this.mode = mode;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    ...
    add_listening_events() {
      ...
       this.playground.game_map.$canvas.mousedown(function(e) {
           ...
           if (e.which === 3) {
               let tx = (e.clientX - rect.left) / outer.playground.scale;
               let ty = (e.clientY - rect.top) / outer.playground.scale;
               outer.move_to(tx, ty);
               if (outer.playground.mode === &amp;#34;multi mode&amp;#34;) {
                   outer.playground.mps.send_move_to(tx, ty);
               }
           }
           ...
   }
   ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;后端-1&#34;&gt;后端&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;consumers/multiplayer/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;async def move_to(self, data):
    await self.channel_layer.group_send(
        self.room_name,
        {
            &amp;#39;type&amp;#39;: &amp;#34;group_send_event&amp;#34;,
            &amp;#39;event&amp;#39;: &amp;#34;move_to&amp;#34;,
            &amp;#39;uuid&amp;#39;: data[&amp;#39;uuid&amp;#39;],
            &amp;#39;tx&amp;#39;: data[&amp;#39;tx&amp;#39;],
            &amp;#39;ty&amp;#39;: data[&amp;#39;ty&amp;#39;],
        }
    )

async def group_send_event(self, data):
    await self.send(text_data=json.dumps(data))

async def receive(self, text_data):
    data = json.loads(text_data)
    event = data[&amp;#39;event&amp;#39;]
    if event == &amp;#34;create_player&amp;#34;:
        await self.create_player(data)
    elif event == &amp;#34;move_to&amp;#34;:
        await self.move_to(data)
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;shoot-fireball&#34;&gt;shoot-fireball&lt;/h3&gt;
&lt;h4 id=&#34;前端-2&#34;&gt;前端&lt;/h4&gt;
&lt;p&gt;用一个数组来存一个玩家发射的所有火球，以便于子弹消失时，将他们找出并对应删掉&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    constructor(playground, x, y, radius, color, speed, character, username, photo) {
        ...
        this.fireballs = [];    // 存该用户发射的所有火球
    }
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.mousedown(function(e) {
            ...
            else if (e.which === 1) {
                let tx = (e.clientX - rect.left) / outer.playground.scale;
                let ty = (e.clientY - rect.top) / outer.playground.scale;
                if (outer.cur_skill === &amp;#34;fireball&amp;#34;) {
                    let fireball = outer.shoot_fireball(tx, ty);
                    if (outer.playground.mode === &amp;#34;multi mode&amp;#34;) {
                        outer.playground.mps.send_shoot_fireball(tx, ty, fireball.uuid);
                    }
                }
            }
            ...
        });
        $(window).keydown(function(e) {
            if (e.which === 81) {           // 键盘按下q事件
                outer.cur_skill = &amp;#34;fireball&amp;#34;;
                return false;
            }
        });
    }
    ...
    shoot_fireball(tx, ty) {
        ...

        let fireball = new FireBall(this.playground, this, x, y, radius, vx, vy, color, speed, move_length, damage);
        this.fireballs.push(fireball);
        return fireball;
    }
    destroy_fireball(uuid) {
        for (let i = 0; i &amp;lt; this.fireballs.length; i ++ ) {
            let fireball = this.fireballs[i];
            if (fireball.uuid == uuid) {
                fireball.destroy();
                break;
            }
        }
    }
    ...
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;playground/skill/fireball/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class FireBall extends AcGameObject {
    ...
    on_destory() {
        let fireballs = this.player.fireballs;
        for (let i = 0; i &amp;lt; fireballs.length; i ++ ) {
            if (fireballs[i] === this) {
                fireballs.splice(i, 1);
                break;
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;game/static/js/src/playground/socket/multiplayer/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class MultiPlayerSocket {
    ...
    send_shoot_fireball(tx, ty, ball_uuid) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &amp;#39;event&amp;#39;: &amp;#39;move_to&amp;#39;,
            &amp;#39;uuid&amp;#39;: outer.uuid,
            &amp;#39;tx&amp;#39;: tx,
            &amp;#39;ty&amp;#39;: ty,
            &amp;#39;ball_uuid&amp;#39;: ball_uuid;
        }));
    }
    receive_shoot_fireball(uuid, tx, ty, ball_uuid) {
        let player = this.get_player(uuid);
        if (player) {
            let fireball = player.shoot_fireball(tx, ty);
            fireball.uuid = ball_uuid;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;后端-2&#34;&gt;后端&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;consumers/multiplayer/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def shoot_fireball(self, data):
        await self.channel_layer.group_send(
            self.room_name,
            {
                &amp;#39;type&amp;#39;: &amp;#34;group_send_event&amp;#34;,
                &amp;#39;event&amp;#39;: &amp;#34;shoot_fireball&amp;#34;,
                &amp;#39;uuid&amp;#39;: data[&amp;#39;uuid&amp;#39;],
                &amp;#39;tx&amp;#39;: data[&amp;#39;tx&amp;#39;],
                &amp;#39;ty&amp;#39;: data[&amp;#39;ty&amp;#39;],
                &amp;#39;ball_uuid&amp;#39;: data[&amp;#39;ball_uuid&amp;#39;],
            }
        )
    async def receive(self, text_data):
        ...
        elif event == &amp;#34;shoot_fireball&amp;#34;:
            await self.shoot_fireball(data)
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;attack&#34;&gt;attack&lt;/h3&gt;
&lt;p&gt;为了只让一个客户端进行攻击命中的判断，因此只有发出方的火球才做碰撞检测&lt;/p&gt;
&lt;p&gt;其他客户端对于该火球只有动画效果&lt;/p&gt;
&lt;p&gt;又由于碰撞检测是在一台客户端上进行的，因此多端之间可能会存在同步上的延迟&lt;/p&gt;
&lt;p&gt;为此的解决方法是：碰撞检测成功时，强制把被击中玩家移动到发起方客户端中的位置，以避免击中延迟上发生的事情&lt;/p&gt;
&lt;h4 id=&#34;前端-3&#34;&gt;前端&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;playground/skill/fireball/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class FireBall extends AcGameObject {
    update() {
        if (this.move_length &amp;lt; this.eps) {
            this.destroy();
            return false;
        }
        this.update_move();

        if (this.player.character !== &amp;#34;enemy&amp;#34;) {
            this.update_attack();
        }
        this.render();
    }
    attack(player) {
        ...
        if (this.playground.mode === &amp;#34;multi mode&amp;#34;) {
            this.playground.mps.send_attack(player.uuid, player.x, player.y, angle, this.damage, this.uuid);
        }
        ...
    }
    ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    ...
    receive_attack(x, y, angle, damage, ball_uuid, attacker) {
        attacker.destroy_fireball(ball_uuid);
        this.x = x;
        this.y = y;
        this.is_attacked(angle, damage);
    }
    ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;game/static/js/src/playground/socket/multiplayer/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class MultiPlayerSocket {
    ...
    send_attack(attackee_uuid, x, y, angle, damage, ball_uuid) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &amp;#39;event&amp;#39;: &amp;#34;attack&amp;#34;,
            &amp;#39;uuid&amp;#39;: outer.uuid,
            &amp;#39;attackee_uuid&amp;#39;: attackee_uuid,
            &amp;#39;x&amp;#39;: x,
            &amp;#39;y&amp;#39;: y,
            &amp;#39;angle&amp;#39;: angle,
            &amp;#39;damage&amp;#39;: damage,
            &amp;#39;ball_uuid&amp;#39;: ball_uuid,
        }));
    }
    receive_attack(uuid, attackee_uuid, x, y, angle, damage, ball_uuid) {
        let attacker = this.get_player(uuid);
        let attackee = this.get_player(attackee_uuid);
        if (attacker &amp;amp;&amp;amp; attackee) {
            attackee.receive_attack(x, y, angle, damage, ball_uuid, attacker);
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;后端-3&#34;&gt;后端&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;consumers/multiplayer/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def attack(self, data):
        await self.channel_layer.group_send(
            self.room_name,
            {
                &amp;#39;type&amp;#39;: &amp;#34;group_send_event&amp;#34;,
                &amp;#39;event&amp;#39;: &amp;#34;attack&amp;#34;,
                &amp;#39;uuid&amp;#39;: data[&amp;#39;uuid&amp;#39;],
                &amp;#39;x&amp;#39;: data[&amp;#39;x&amp;#39;],
                &amp;#39;y&amp;#39;: data[&amp;#39;y&amp;#39;],
                &amp;#39;angle&amp;#39;: data[&amp;#39;angle&amp;#39;],
                &amp;#39;damage&amp;#39;: data[&amp;#39;damage&amp;#39;],
                &amp;#39;ball_uuid&amp;#39;: data[&amp;#39;ball_uuid&amp;#39;],
            }
        )
    ...
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;游戏的小优化&#34;&gt;游戏的小优化&lt;/h2&gt;
&lt;h3 id=&#34;多人模式下游戏没有开始前玩家不可以移动&#34;&gt;多人模式下游戏没有开始前，玩家不可以移动&lt;/h3&gt;
&lt;p&gt;为此我们先引入一个状态机：&lt;code&gt;&#39;waiting&#39; -&amp;gt; &#39;fighting&#39; -&amp;gt; &#39;over&#39;&lt;/code&gt; 来标识当前游戏进行的状态&lt;/p&gt;
&lt;p&gt;然后用一个 &lt;code&gt;notice_board&lt;/code&gt; 计分板在前端显示出来&lt;/p&gt;
&lt;p&gt;实现的逻辑就是：游戏初始时为 &lt;code&gt;waiting&lt;/code&gt; 状态，房间内人数满 3 人时，才会进入 &lt;code&gt;fighting&lt;/code&gt;，角色死亡时为 &lt;code&gt;over&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;且发射火球，移动等行为，当且仅当玩家状态为 &lt;code&gt;fighting&lt;/code&gt; 时，才可以做&lt;/p&gt;
&lt;p&gt;然后设定火球技能的 cd 为 3 秒，且在游戏进入 &lt;code&gt;fighting&lt;/code&gt; 时，先自动进入 cd 状态&lt;/p&gt;
&lt;p&gt;这样就实现了初始 3 秒内，任何玩家不可攻击&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/notice_board/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class NoticeBoard extends AcGameObject {
    constructor(playground) {
        super();

        this.playground = playground;
        this.ctx = this.playground.game_map.ctx;
        this.text = &amp;#34;已就绪：0人&amp;#34;;
    }
    start() {
    }

    write(text) {
        this.text = text;
    }

    update() {
        this.render();
    }

    render() {
        this.ctx.font = &amp;#34;20px serif&amp;#34;;
        this.ctx.fillStyle = &amp;#34;white&amp;#34;;
        this.ctx.textAlign = &amp;#34;center&amp;#34;;
        this.ctx.fillText(this.text, this.playground.width / 2, 20);
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;js/src/playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGamePlayground {
    ...
    show(mode) {
        ...
        this.state = &amp;#34;waiting&amp;#34;;     // waiting -&amp;gt; fighting -&amp;gt; over
        this.notice_board = new NoticeBoard(this);
        this.player_count = 0;
        ...
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;js/src/playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    ...
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.mousedown(function(e) {
            if (outer.playground.state !== &amp;#34;fighting&amp;#34;)
                return false;
            ...
        }
        $(window).keydown(function(e) {
            if (outer.playground.state !== &amp;#34;fighting&amp;#34;)
                return false;
            ...
        });
    }
    start() {
        this.playground.player_count ++ ;
        this.playground.notice_board.write(&amp;#34;已就绪：&amp;#34; + this.playground.player_count + &amp;#34;人&amp;#34;);
        if (this.playground.player_count &amp;gt;= 3) {
            this.playground.state = &amp;#34;fighting&amp;#34;;
            this.playground.notice_board.write(&amp;#34;Fighting&amp;#34;);
        }
        ...
    }
    ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;技能cd&#34;&gt;技能CD&lt;/h3&gt;
&lt;p&gt;给火球技能设置 3s 的 cd，实现逻辑很简单，设定一个 cool_time 变量，每次渲染的时候减去上次渲染的时间间隔&lt;/p&gt;
&lt;p&gt;然后 cool_time 为 0 时，技能才可以成功释放&lt;/p&gt;
&lt;p&gt;另外修改冷却时间，只用修改自己的即可&lt;/p&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    constructor(...) {
        ...
        if (this.character === &amp;#34;me&amp;#34;) {
            this.fireball_coldtime = 3; // 单位：s
        }
    }
    ...
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.mousedown(function(e) {
            ...
            else if (e.which === 1) {
                ...
                if (outer.cur_skill === &amp;#34;fireball&amp;#34;) {
                    ...
                    if (outer.playground.mode === &amp;#34;multi mode&amp;#34;) {
                        outer.playground.mps.send_shoot_fireball(tx, ty, fireball.uuid);
                    }
                    outer.fireball_coldtime = 3;
                }
            }
            ...
        });
        $(window).keydown(function(e) {
            ...
            if (outer.fireball_coldtime &amp;gt;= outer.eps)
                return false;
            ...
        });
    }
    update() {
        ...
        if (this.character === &amp;#34;me&amp;#34; &amp;amp;&amp;amp; this.playground.state === &amp;#34;fighting&amp;#34;) {
            this.update_coldtime();
        }
        ...
    }
    update_coldtime() {
        this.fireball_coldtime -= this.timedelta / 1000;
        this.fireball_coldtime = Math.max(0, this.fireball_coldtime);
    }
    ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;用图片来渲染技能cd&#34;&gt;用图片来渲染技能CD&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    constructor(...) {
        ...
        if (this.character === &amp;#34;me&amp;#34;) {
            this.fireball_coldtime = 3; // 单位：s
            this.fireball_img = new Image();
            this.fireball_img.src = &amp;#34;https://cdn.acwing.com/media/article/image/2021/12/02/1_9340c86053-fireball.png&amp;#34;;
        }
    }
    ...
    render() {
        ...
        if (this.character === &amp;#34;me&amp;#34; &amp;amp;&amp;amp; this.playground.state === &amp;#34;fighting&amp;#34;) {
            this.render_skill_coldtime();
        }
    }
     render_skill_coldtime() {
        let scale = this.playground.scale;
        let x = 1.5, y = 0.9, r = 0.04;

        // 渲染技能图标
        this.ctx.save();
        this.ctx.beginPath();
        this.ctx.arc(x * scale, y * scale, r * scale, 0, Math.PI * 2, false);
        this.ctx.stroke();
        this.ctx.clip();
        this.ctx.drawImage(this.fireball_img, (x - r) * scale, (y - r) * scale, r * 2 * scale, r * 2 * scale);
        this.ctx.restore();

        // 渲染冷却指示
        if (this.fireball_coldtime &amp;gt;= this.eps){
            this.ctx.beginPath();
            this.ctx.moveTo(x * scale, y * scale);
            this.ctx.arc(x * scale, y * scale, r * scale, 0 - Math.PI / 2, Math.PI * 2 * (1 - this.fireball_coldtime / 3) - Math.PI / 2, true);
            this.ctx.lineTo(x * scale, y * scale);
            this.ctx.fillStyle = &amp;#34;rgba(0, 0, 255, 0.6)&amp;#34;;
            this.ctx.fill();
        }
    }
    ...
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;添加一个闪现技能&#34;&gt;添加一个闪现技能&lt;/h3&gt;
&lt;h4 id=&#34;单机部分&#34;&gt;单机部分&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;js/src/playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    constructor(...) {
        ...
        if (this.character === &amp;#34;me&amp;#34;) {
            ...
            this.blink_coldtime = 5;
            this.blink_img = new Image();
            this.blink_img.src = &amp;#34;https://cdn.acwing.com/media/article/image/2021/12/02/1_daccabdc53-blink.png&amp;#34;;
        }
    }
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.mousedown(function(e) {
            ...
            else if (e.which === 1) {
                ...
                else if (outer.cur_skill === &amp;#34;blink&amp;#34;) {
                    outer.blink(tx, ty);
                    // 同步函数
                    if (outer.playground.mode === &amp;#34;multi mode&amp;#34;) {
                        outer.playground.mps.send_blink(tx, ty);
                    }
                    outer.blink_coldtime = 5;
                }
            }
            outer.cur_skill = null; // 清空当前技能
        });
        $(window).keydown(function(e) {
            ...
            else if (e.which === 70) {    // f键
                if (outer.blink_coldtime &amp;gt;= outer.eps) return true;
                outer.cur_skill = &amp;#34;blink&amp;#34;;
                return false;
            }
        });
    }
    ...
    blink(tx, ty) {
        let d = this.get_dist(this.x, this.y, tx, ty);
        d = Math.min(d, 0.5);
        let angle = Math.atan2(ty - this.y, tx - this.x);
        this.x += d * Math.cos(angle);
        this.y += d * Math.sin(angle);

        this.move_length = 0;   // 闪现完停下来
    }
    ...
    render_skill_coldtime() {
        ...
        x = 1.62, y = 0.9, r = 0.04;
        // 闪现技能
        // 渲染技能图标
        this.ctx.save();
        this.ctx.beginPath();
        this.ctx.arc(x * scale, y * scale, r * scale, 0, Math.PI * 2, false);
        this.ctx.stroke();
        this.ctx.clip();
        this.ctx.drawImage(this.blink_img, (x - r) * scale, (y - r) * scale, r * 2 * scale, r * 2 * scale);
        this.ctx.restore();

        // 渲染冷却指示
        if (this.blink_coldtime &amp;gt;= this.eps){
            this.ctx.beginPath();
            this.ctx.moveTo(x * scale, y * scale);
            this.ctx.arc(x * scale, y * scale, r * scale, 0 - Math.PI / 2, Math.PI * 2 * (1 - this.blink_coldtime / 5) - Math.PI / 2, true);
            this.ctx.lineTo(x * scale, y * scale);
            this.ctx.fillStyle = &amp;#34;rgba(0, 0, 255, 0.6)&amp;#34;;
            this.ctx.fill();
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;联机部分&#34;&gt;联机部分&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;game/static/js/src/playground/socket/multiplayer/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class MultiPlayerSocket {
    ...
    send_blink(tx, ty) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &amp;#39;event&amp;#39;: &amp;#34;blink&amp;#34;,
            &amp;#39;uuid&amp;#39;: outer.uuid,
            &amp;#39;tx&amp;#39;: tx,
            &amp;#39;ty&amp;#39;: ty,
        }));
    }
    receive_blink(uuid, tx, ty) {
        let player = this.get_player(uuid);
        if (player) {
            player.blink(tx, ty);
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;consumers/multiplayer/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def blink(self, data):
        await self.channel_layer.group_send(
            self.room_name,
            {
                &amp;#39;type&amp;#39;: &amp;#34;group_send_event&amp;#34;,
                &amp;#39;event&amp;#39;: &amp;#34;blink&amp;#34;,
                &amp;#39;uuid&amp;#39;: data[&amp;#39;uuid&amp;#39;],
                &amp;#39;tx&amp;#39;: data[&amp;#39;tx&amp;#39;],
                &amp;#39;ty&amp;#39;: data[&amp;#39;ty&amp;#39;],
            }
        )
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;实现聊天系统ஐ&#34;&gt;实现聊天系统ஐ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/solution/content/89508/&#34;&gt;8.1 上课笔记 | 大菜狗&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;优化键盘绑定事件&#34;&gt;优化键盘绑定事件&lt;/h2&gt;
&lt;p&gt;这部分算是之前的遗留问题，先前的 &lt;code&gt;keydown&lt;/code&gt; 监听事件绑定在了 &lt;code&gt;window&lt;/code&gt; 上会出现一个问题&lt;/p&gt;
&lt;p&gt;如果在一个浏览器内打开多个 &lt;code&gt;ACAPP&lt;/code&gt;，此时按下键位触发 &lt;code&gt;keydown&lt;/code&gt; 事件，会被浏览器内所有的 &lt;code&gt;ACAPP&lt;/code&gt; 都捕获到&lt;/p&gt;
&lt;p&gt;之前影响不大，但对此次要实现的聊天系统就有着致命的影响，即打开一个 &lt;code&gt;ACAPP&lt;/code&gt; 的聊天栏，其他都会被打开&lt;/p&gt;
&lt;p&gt;所有我们要将 &lt;code&gt;keydown&lt;/code&gt; 监听事件绑定到 &lt;code&gt;canvas&lt;/code&gt; 上&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    ...
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.keydown(function(e) {
            if (outer.playground.state !== &amp;#34;fighting&amp;#34;)
                return true;
            if (e.which === 81) {           // 键盘按下q事件
                if (outer.fireball_coldtime &amp;gt;= outer.eps) return true;
                outer.cur_skill = &amp;#34;fireball&amp;#34;;
                return false;
            } else if (e.which === 70) {    // f键
                if (outer.blink_coldtime &amp;gt;= outer.eps) return true;
                outer.cur_skill = &amp;#34;blink&amp;#34;;
                return false;
            }
        });
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;playground/game-map/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class GameMap extends AcGameObject {
    constructor(playground) {
        ...
        this.$canvas = $(`&amp;lt;canvas tabindex=0&amp;gt;&amp;lt;/canvas&amp;gt;`);
        ...
    }
    start() {
        this.$canvas.focus();
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;本地前端&#34;&gt;本地前端&lt;/h2&gt;
&lt;p&gt;要实现两个部分： 1. 文本输入框（让用户输入要发送的信息） 2. 历史记录显示框（之前用户发送的信息的显示框）&lt;/p&gt;
&lt;p&gt;欲实现逻辑：用户按下 &lt;code&gt;&amp;lt;Enter&amp;gt;&lt;/code&gt; 后，游戏界面弹出文本输入框，然后聚焦于文本输入框，且同时弹出历史记录显示框 3 秒&lt;/p&gt;
&lt;p&gt;然后用户输入信息后，按下 &lt;code&gt;&amp;lt;Enter&amp;gt;&lt;/code&gt; 后发出信息，接着信息会显示在历史记录显示框最下方，并弹出历史记录显示框 3 秒&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/chat_field/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;chat field&lt;/code&gt; 负责管理 文本输入框 和 历史记录显示框&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class ChatField {
    constructor(playground) {
        this.playground = playground;

        this.$history = $(`&amp;lt;div class=&amp;#34;ac-game-chat-field-history&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;`);
        this.$input = $(`&amp;lt;input type=&amp;#34;text&amp;#34; class=&amp;#34;ac-game-chat-field-input&amp;#34;&amp;gt;`);

        this.$history.hide();
        this.$input.hide();

        this.func_id = null;

        this.playground.$playground.append(this.$history);
        this.playground.$playground.append(this.$input);

        this.start();
    }

    start() {
        this.add_listening_events();
    }
    add_listening_events() {
        let outer = this;
        this.$input.keydown(function(e) {
            if (e.which === 27) {   //ESC
                outer.hide_input();
                return false;
            } else if (e.which === 13) {
                let username = outer.playground.root.settings.username;
                let text = outer.$input.val();
                if (text) {
                    outer.$input.val(&amp;#34;&amp;#34;);
                    outer.add_message(username, text);
                }
                return false;
            }
        });
    }
    show_history() {
        let outer = this;
        this.$history.fadeIn();
        if (this.func_id) clearTimeout(this.func_id);
        this.func_id = setTimeout(function() {
            outer.$history.fadeOut();
            outer.func_id = null;
        }, 3000);
    }
    render_message(message) {
        return $(`&amp;lt;div&amp;gt;${message}&amp;lt;/div&amp;gt;`);
    }
    add_message(username, text) {
        this.show_history();
        let message = `[${username}] ${text}`;
        this.$history.append(this.render_message(message));
        this.$history.scrollTop(this.$history[0].scrollHeight);
    }
    show_input() {
        this.show_history();
        this.$input.show();
        this.$input.focus();    // 输入时，聚焦于输入框
    }
    hide_input() {
        this.$input.hide();
        this.playground.game_map.$canvas.focus();   // 退出时，聚焦回游戏界面
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;把它创建出来&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGamePlayground {
    ...
    show(mode) {    //打开 playground 界面
        ...
        else if (mode === &amp;#34;multi mode&amp;#34;) {
            this.chat_field = new ChatField(this);
            ...
        }

    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;添加监听事件&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    ...
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.keydown(function(e) {
            if (e.which === 13) {   // enter (显示对话框)
                if (outer.playground.mode === &amp;#34;multi mode&amp;#34;) {
                    outer.playground.chat_field.show_input();
                    return false;
                }
            } else if (e.which === 27) {    // esc（关闭对话框）
                if (outer.playground.mode === &amp;#34;multi mode&amp;#34;) {
                    outer.playground.char_field.hide_input();
                    return false;
                }
            }
            ...
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;game.css&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
.ac-game-chat-field-history {
    position: absolute;
    top: 66%;
    left: 20%;
    transform: translate(-50%, -50%);
    width: 20%;
    height: 32%;
    color: white;
    font-size: 2vh;
    padding: 5px;
    overflow: auto;
}

.ac-game-chat-field-history::-webkit-scrollbar {
    width: 0;
}

.ac-game-chat-field-input {
    position: absolute;
    top: 86%;
    left: 20%;
    transform: translate(-50%, -50%);
    width: 20%;
    height: 3vh;
    color: white;
    font-size: 2vh;
    background-color: rgba(222,225,230, 0.2);
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;联机聊天窗&#34;&gt;联机聊天窗&lt;/h2&gt;
&lt;h3 id=&#34;前端-4&#34;&gt;前端&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;playground/chat_field/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class ChatField {
    ...
    add_listening_events() {
        ...
        this.$input.keydown(function(e) {
            ...
            else if (e.which === 13) {
                ...
                if (text) {
                    ...
                    outer.playground.mps.send_message(text);
                }
                ...
            }
        });
    }
    ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;js/src/playground/socket/multiplayer/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class MultiPlayerSocket {
    ...
    send_message(text) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &amp;#39;event&amp;#39;: &amp;#34;message&amp;#34;,
            &amp;#39;uuid&amp;#39;: outer.uuid,
            &amp;#39;username&amp;#39;: outer.playground.root.settings.username,
            &amp;#39;text&amp;#39;: text,
        }));
    }
    receive_message(username, text) {
        this.playground.chat_field.add_message(username, text);
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;后端-4&#34;&gt;后端&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;consumers/multiplayer/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def message(self, data):
        await self.channel_layer.group_send(
            self.room_name,
            {
                &amp;#39;type&amp;#39;: &amp;#34;group_send_event&amp;#34;,
                &amp;#39;event&amp;#39;: &amp;#34;message&amp;#34;,
                &amp;#39;uuid&amp;#39;: data[&amp;#39;uuid&amp;#39;],
                &amp;#39;username&amp;#39;: data[&amp;#39;username&amp;#39;],
                &amp;#39;text&amp;#39;: data[&amp;#39;text&amp;#39;],
            }
        )
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;实现匹配系统ஐ&#34;&gt;实现匹配系统ஐ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/3435229/&#34;&gt;9. 实现匹配系统 | 讲义&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/activity/content/code/content/2360556/&#34;&gt;9.1 上课笔记 | 一只野生彩色铅笔&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;本章节内容是利用 &lt;code&gt;thrift&lt;/code&gt; 创建客户端-服务端交互的接口&lt;/p&gt;
&lt;p&gt;然后利用该接口完成一个匹配系统&lt;/p&gt;
&lt;p&gt;匹配系统由一个消息队列 + 生产者-消费者模型 + 匹配池 完成&lt;/p&gt;
&lt;p&gt;基本与 Linux基础课 里的部分完全一致&lt;/p&gt;
&lt;p&gt;当时我们是拿 cpp 来写的，写了差不多 200 行&lt;/p&gt;
&lt;p&gt;本节会拿 py 来实现，差不多 140 行即可&lt;/p&gt;
&lt;p&gt;&lt;code&gt;thrift&lt;/code&gt; 接口文件&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;namespace py match_service

service Match {
    i32 add_player(1: i32 score, 2: string uuid, 3: string username, 4: string photo, 5: string channel_name),
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后用该源文件生成接口文件&lt;/p&gt;
&lt;h2 id=&#34;服务端&#34;&gt;服务端&lt;/h2&gt;
&lt;p&gt;配置 &lt;code&gt;asgi.py&lt;/code&gt; 让服务端进程可以调用客户端进程里的函数&lt;/p&gt;
&lt;p&gt;&lt;code&gt;acapp/acapp/asgi.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import os

import django
os.environ.setdefault(&amp;#39;DJANGO_SETTINGS_MODULE&amp;#39;, &amp;#39;acapp.settings&amp;#39;)
django.setup()
...
from channels.layers import get_channel_layer
channel_layer = get_channel_layer()
...
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;acapp/match_system/src/main.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#! /usr/bin/env python3

import glob
import sys
sys.path.insert(0, glob.glob(&amp;#39;../../&amp;#39;)[0])

from match_server.match_service import Match

from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol
from thrift.server import TServer

from queue import Queue
from time import sleep
from threading import Thread

from acapp.asgi import channel_layer
from asgiref.sync import async_to_sync
from django.core.cache import cache

queue = Queue()  # 消息队列

class Player:
    def __init__(self, score, uuid, username, photo, channel_name):
        self.score = score
        self.uuid = uuid
        self.username = username
        self.photo = photo
        self.channel_name = channel_name
        self.waiting_time = 0  # 等待时间


class Pool:
    def __init__(self):
        self.players = []

    def add_player(self, player):
        self.players.append(player)

    def check_match(self, a, b):
        dt = abs(a.score - b.score)
        a_max_dif = a.waiting_time * 50
        b_max_dif = b.waiting_time * 50
        return dt &amp;lt;= a_max_dif and dt &amp;lt;= b_max_dif

    def match_success(self, ps):
        print(&amp;#34;Match Success: %s %s %s&amp;#34; % (ps[0].username, ps[1].username, ps[2].username))
        room_name = &amp;#34;room-%s-%s-%s&amp;#34; % (ps[0].uuid, ps[1].uuid, ps[2].uuid)
        players = []
        for p in ps:
            async_to_sync(channel_layer.group_add)(room_name, p.channel_name)
            players.append({
                &amp;#39;uuid&amp;#39;: p.uuid,
                &amp;#39;username&amp;#39;: p.username,
                &amp;#39;photo&amp;#39;: p.photo,
                &amp;#39;hp&amp;#39;: 100,
            })
        cache.set(room_name, players, 3600)  # 有效时间：1小时
        for p in ps:
            async_to_sync(channel_layer.group_send)(
                room_name,
                {
                    &amp;#39;type&amp;#39;: &amp;#34;group_send_event&amp;#34;,
                    &amp;#39;event&amp;#39;: &amp;#34;create_player&amp;#34;,
                    &amp;#39;uuid&amp;#39;: p.uuid,
                    &amp;#39;username&amp;#39;: p.username,
                    &amp;#39;photo&amp;#39;: p.photo,
                }
            )

    def increase_waiting_time(self):
        for player in self.players:
            player.waiting_time += 1

    def match(self):
        while len(self.players) &amp;gt;= 3:
            self.players = sorted(self.players, key=lambda p: p.score)
            flag = False
            for i in range(len(self.players) - 2):
                a, b, c = self.players[i], self.players[i + 1], self.players[i + 2]
                if self.check_match(a, b) and self.check_match(a, c) and self.check_match(b, c):
                    self.match_success([a, b, c])
                    self.players = self.players[:i] + self.players[i + 3:]
                    flag = True
                    break
            if not flag:
                break

        self.increase_waiting_time()



class MatchHandler:
    def add_player(self, score, uuid, username, photo, channel_name):
        print(&amp;#34;Add Player: %s %d&amp;#34; % (username, score))
        player = Player(score, uuid, username, photo, channel_name)
        queue.put(player)
        return 0


def get_player_from_queue():
    try:
        return queue.get_nowait()
    except:
        return None


def worker():
    pool = Pool()
    while True:
        player = get_player_from_queue()
        if player:
            pool.add_player(player)
        else:
            pool.match()
            sleep(1)



if __name__ == &amp;#39;__main__&amp;#39;:
    handler = MatchHandler()
    processor = Match.Processor(handler)
    transport = TSocket.TServerSocket(host=&amp;#39;127.0.0.1&amp;#39;, port=9090)
    tfactory = TTransport.TBufferedTransportFactory()
    pfactory = TBinaryProtocol.TBinaryProtocolFactory()

    server = TServer.TThreadedServer(
        processor, transport, tfactory, pfactory)

    Thread(target=worker, daemon=True).start()

    print(&amp;#39;Starting the server...&amp;#39;)
    server.serve()
    print(&amp;#39;done.&amp;#39;)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;客户端&#34;&gt;客户端&lt;/h2&gt;
&lt;p&gt;扩展数据库表，让其可以存放 rank分 的信息&lt;/p&gt;
&lt;p&gt;&lt;code&gt;game/models/player/player.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
class Player(models.Model):
    ...
    score = models.IntegerField(default=1500)
    ...
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;consumers/multiplayer/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from channels.generic.websocket import AsyncWebsocketConsumer
import json
from django.conf import settings
from django.core.cache import cache

from thrift import Thrift
from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol

from match_system.src.match_server.match_service import Match
from game.models.player.player import Player
from channels.db import database_sync_to_async

class MultiPlayer(AsyncWebsocketConsumer):
    async def connect(self):
        await self.accept()

    async def disconnect(self, close_code):
        if self.room_name:
            await self.channel_layer.group_discard(self.room_name, self.channel_name)

    async def create_player(self, data):
        self.room_name = None
        self.uuid = data[&amp;#39;uuid&amp;#39;]
        # Make socket
        transport = TSocket.TSocket(&amp;#39;127.0.0.1&amp;#39;, 9090)
        # Buffering is critical. Raw sockets are very slow
        transport = TTransport.TBufferedTransport(transport)

        # Wrap in a protocol
        protocol = TBinaryProtocol.TBinaryProtocol(transport)

        # Create a client to use the protocol encoder
        client = Match.Client(protocol)

        def db_get_player():
            return Player.objects.get(user__username=data[&amp;#39;username&amp;#39;])

        player = await database_sync_to_async(db_get_player)()

        # Connect!
        transport.open()

        client.add_player(player.score, data[&amp;#39;uuid&amp;#39;], data[&amp;#39;username&amp;#39;], data[&amp;#39;photo&amp;#39;], self.channel_name)

        # Close!
        transport.close()
    
    async def group_send_event(self, data):
        if not self.room_name:
            keys = cache.keys(&amp;#39;*%s*&amp;#39; % (self.uuid))
            if keys:
                self.room_name = keys[0]
        await self.send(text_data=json.dumps(data))
    ...
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;项目收尾ஐ&#34;&gt;项目收尾ஐ&lt;/h1&gt;
&lt;h2 id=&#34;加密压缩js代码&#34;&gt;加密、压缩js代码&lt;/h2&gt;
&lt;p&gt;安装 &lt;code&gt;terser&lt;/code&gt; :&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt-get update
sudo apt-get install npm
sudo npm install terser -g
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;terser&lt;/code&gt; 不仅支持文件输入，也支持标准输入。结果会输出到标准输出中。&lt;/p&gt;
&lt;p&gt;使用方式：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;terser xxx.js -c -m
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们将整合 &lt;code&gt;js&lt;/code&gt; 文件的脚本修改一下即可：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;scripts/compress_game_js.sh&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#! /bin/bash

JS_PATH=/home/acs/acapp/game/static/js/
JS_PATH_DIST=${JS_PATH}dist/
JS_PATH_SRC=${JS_PATH}src/

find $JS_PATH_SRC -type f -name &amp;#39;*.js&amp;#39; | sort | xargs cat | terser -c -m &amp;gt; ${JS_PATH_DIST}game.js

echo &amp;#34;yes&amp;#34; | python3 manage.py collectstatic
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;清理监听函数&#34;&gt;清理监听函数&lt;/h2&gt;
&lt;p&gt;在AcAPP关闭之前触发的事件可以通过如下api添加：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;AcWingOS.api.window.on_close(func);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;注意：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;同一个页面中，多个 &lt;code&gt;acapp&lt;/code&gt; 引入的 &lt;code&gt;js&lt;/code&gt; 代码只会加载一次，因此 &lt;code&gt;AC_GAME_OBJECTS&lt;/code&gt; 等全局变量是同一个页面、同一个 &lt;code&gt;acapp&lt;/code&gt; 的所有窗口共用的&lt;/li&gt;
&lt;li&gt;各自创建的局部变量是独立的，比如 &lt;code&gt;new AcGame()&lt;/code&gt; 创建出的对象各个窗口是独立的&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们给每一个窗口创建一个 &lt;code&gt;uid&lt;/code&gt; 然后根据不同的 &lt;code&gt;uid&lt;/code&gt; 进行事件解绑&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGamePlayground {
    ...
    create_uuid() {
        let res = &amp;#34;&amp;#34;;
        for (let i = 0; i &amp;lt; 8; i ++ ) {
            let x = parseInt(Math.floor(Math.random() * 10));   //[0, 10)
            res += x;
        }
        return res;
    }
    start() {
        let outer = this;
        let uuid = this.create_uuid();
        $(window).on(`resize.${uuid}`, function() {
            outer.resize();
        });

        if (this.root.AcWingOS) {
            outer.root.AcWingOS.api.window.on_close(function() {
                $(window).off(`resize.${uuid}`);
            });
        }
    }
    ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;编写每局游戏的结束界面&#34;&gt;编写每局游戏的结束界面&lt;/h2&gt;
&lt;p&gt;单独创建一个结束界面，然后游戏结束的时候渲染出该结束界面即可&lt;/p&gt;
&lt;p&gt;因为结束界面要覆盖在游戏界面之上，因此我们需要先修改一下游戏引擎，添加一个 &lt;code&gt;late_update&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在每一帧渲染的内容最后再渲染，从而实现结束界面叠加在游戏界面之上的效果&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ac_game_object/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
class AcGameObject {
    ...
    late_update() { // 每一帧均会执行一次，且在所有 update 执行完后才执行

    }
    ...
}
...
let AC_GAME_ANIMATION = function(timestamp) {
    ...
    for (let i = 0; i &amp;lt; AC_GAME_OBJECTS.length; i ++ ) {
        let obj = AC_GAME_OBJECTS[i];
        obj.late_update();
    }
    ...
}
...
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后我们做一个渲染出结束界面的类&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/score_board/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class ScoreBoard extends AcGameObject {
    constructor(playground) {
        super();
        this.playground = playground;
        this.ctx = this.playground.game_map.ctx;

        this.state = null;  // win-胜利；lose-失败

        this.win_img = new Image();
        this.win_img.src = &amp;#34;https://cdn.acwing.com/media/article/image/2021/12/17/1_8f58341a5e-win.png&amp;#34;;

        this.lose_img = new Image();
        this.lose_img.src = &amp;#34;https://cdn.acwing.com/media/article/image/2021/12/17/1_9254b5f95e-lose.png&amp;#34;;
    }
    start() {
    }

    add_listening_events() {    // 点击后，返回主页面
        let outer = this;
        let $canvas = this.playground.game_map.$canvas;

        $canvas.on(&amp;#39;click&amp;#39;, function() {
            outer.playground.hide();
            outer.playground.root.menu.show();
        });
    }

    win() {
        this.state = &amp;#34;win&amp;#34;;
        let outer = this;
        setTimeout(function() {
            outer.add_listening_events();
        }, 1000);   // 1秒后监听点击事件
    }

    lose() {
        this.state = &amp;#34;lose&amp;#34;;
        let outer = this;
        setTimeout(function() {
            outer.add_listening_events();
        }, 1000);   // 1秒后监听点击事件
    }

    late_update() {
        this.render();  // 渲染在图层最上方
    }
    render() {
        let len = this.playground.height / 2;
        if (this.state === &amp;#34;win&amp;#34;) {
            this.ctx.drawImage(this.win_img, this.playground.width / 2 - len / 2, this.playground.height / 2 - len / 2, len, len);
        } else if (this.state === &amp;#34;lose&amp;#34;) {
            this.ctx.drawImage(this.lose_img, this.playground.width / 2 - len / 2, this.playground.height / 2 - len / 2, len, len);
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;通过游戏结束的逻辑判断，渲染结束界面，同时在结束并返回主菜单的时候，重置游戏元素&lt;/p&gt;
&lt;p&gt;游戏元素重置&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class AcGamePlayground {
    ...
    show(mode) {    // 打开 playground 界面
        ...
        this.score_board = new ScoreBoard(this);
        ...
    }
    ...
    hide() {
        // 清空所有游戏元素
        while (this.players &amp;amp;&amp;amp; this.players.length &amp;gt; 0) {
            this.players[0].destroy();
        }
        if (this.game_map) {
            this.game_map.destroy();
            this.game_map = null;
        }
        if (this.notice_board) {
            this.notice_board.destroy();
            this.notice_board = null;
        }
        if (this.score_board) {
            this.score_board.destroy();
            this.score_board = null;
        }
        this.$playground.empty();   // 清空所有html标签
        this.$playground.hide();
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;游戏结束的逻辑判断&lt;/p&gt;
&lt;p&gt;&lt;code&gt;playground/player/zbase.js&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class Player extends AcGameObject {
    ...
    update() {
        ...
        this.update_win();
        ...
    }
    update_win() {
        // 竞赛状态，且只有一名玩家，且改名玩家就是我，则胜利
        if (this.playground.state === &amp;#34;fighting&amp;#34; &amp;amp;&amp;amp; this.character === &amp;#34;me&amp;#34; &amp;amp;&amp;amp; this.playground.players.length === 1) {
            this.playground.state = &amp;#34;over&amp;#34;;
            this.playground.score_board.win();
        }
    }
    ...
    on_destroy() {
        // 我死亡，且游戏处于竞赛状态，则失败
        if (this.character === &amp;#34;me&amp;#34; &amp;amp;&amp;amp; this.playground.state === &amp;#34;fighting&amp;#34;) {
            this.playground.state = &amp;#34;over&amp;#34;
            this.playground.score_board.lose();
        }
        ...
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;更新战绩&#34;&gt;更新战绩&lt;/h2&gt;
&lt;p&gt;这里我们完全交给后端来判断&lt;/p&gt;
&lt;p&gt;在处理广播的 &lt;code&gt;attack&lt;/code&gt; 信息的时候，先前我们额外留了一个参数 &lt;code&gt;hp&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;围绕该 &lt;code&gt;hp&lt;/code&gt; 进行续写，若当前房间内 &lt;code&gt;hp&lt;/code&gt; 大于 0 的玩家少于等于 1 个&lt;/p&gt;
&lt;p&gt;则对于所有 &lt;code&gt;hp&lt;/code&gt; 为 0 的玩家减 &lt;code&gt;rank&lt;/code&gt; 分，大于 0 的玩家加 &lt;code&gt;rank&lt;/code&gt; 分&lt;/p&gt;
&lt;p&gt;&lt;code&gt;consumers/multiplayer/index.py&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def attack(self, data):
        if not self.room_name:
            return
        players = cache.get(self.room_name)

        if not players:
            return

        for player in players:
            if player[&amp;#39;uuid&amp;#39;] == data[&amp;#39;attackee_uuid&amp;#39;]:
                player[&amp;#39;hp&amp;#39;] -= 25

        remain_cnt = 0
        for player in players:
            if player[&amp;#39;hp&amp;#39;] &amp;gt; 0:
                remain_cnt += 1

        if remain_cnt &amp;gt; 1:  # 继续进行游戏
            if self.room_name:
                cache.set(self.room_name, players, 3600)
        else:   # 结算 
            def db_update_player_score(username, score):
                player = Player.objects.get(user__username=username)
                player.score += score
                player.save()
            for player in players:
                if player[&amp;#39;hp&amp;#39;] &amp;lt;= 0:
                    await database_sync_to_async(db_update_player_score)(player[&amp;#39;username&amp;#39;], -5)
                else:
                    await database_sync_to_async(db_update_player_score)(player[&amp;#39;username&amp;#39;], 10)
        ...
    ...
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;添加faviconico&#34;&gt;添加favicon.ico&lt;/h2&gt;
&lt;p&gt;这是修正一个小 BUG，之前 web 端一直没有网页显示图标，这里给他加上去&lt;/p&gt;
&lt;p&gt;&lt;code&gt;game/templates/multiends/web.html&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...
&amp;lt;head&amp;gt;
    ...
    &amp;lt;link rel=&amp;#34;icon&amp;#34; href=&amp;#34;https://cdn.acwing.com/media/article/image/2021/12/17/1_be4c11ce5f-acapp.png&amp;#34;&amp;gt;
&amp;lt;/head&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;各种环境命令&#34;&gt;各种环境命令&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;启动&lt;code&gt;django&lt;/code&gt;项目，在&lt;code&gt;~/acapp&lt;/code&gt;目录下执行：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;python3 manage.py runserver 0.0.0.0:8000
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;每次修改好 &lt;code&gt;game/static&lt;/code&gt;  下的文件后，需要在&lt;code&gt;~/acapp&lt;/code&gt;目录下运行打包文件：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;./scripts/compress_game_js.sh
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;在定义完一个数据表之后，需要将创建的数据表更新到 &lt;code&gt;django&lt;/code&gt; 的数据库中去：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f00&#34;&gt;$&lt;/span&gt; python3 manage.py makemigrations
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt; Migrations &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#0ff;font-weight:bold&#34;&gt;&amp;#39;game&amp;#39;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;   game/migrations/&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;0001&lt;/span&gt;_initial.py
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;     - Create model Player
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f00&#34;&gt;$&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f00&#34;&gt;$&lt;/span&gt; python3 manage.py migrate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt; Operations to perform:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;   Apply &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;all&lt;/span&gt; migrations: admin, auth, contenttypes, game, sessions
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt; Running migrations:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;   Applying game&lt;span style=&#34;color:#ff0;font-weight:bold&#34;&gt;.0001&lt;/span&gt;_initial... OK
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;启动&lt;code&gt;nginx&lt;/code&gt;服务，用于域名访问：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo /etc/init.d/nginx start
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;启动&lt;code&gt;uwsgi&lt;/code&gt;服务，用于域名访问：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;uwsgi --ini scripts/uwsgi.ini
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;关闭&lt;code&gt;uwsgi&lt;/code&gt;服务：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo pkill -f uwsgi -9
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;启动 &lt;code&gt;redis-server&lt;/code&gt;，用于一键登录：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo redis-server /etc/redis/redis.conf
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;启动 &lt;code&gt;Django_channels&lt;/code&gt;，用于联机对战，在&lt;code&gt;~/acapp&lt;/code&gt;目录下执行：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;daphne -b 0.0.0.0 -p 5015 acapp.asgi:application
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;启动&lt;code&gt;thrift&lt;/code&gt;服务，用于匹配系统，在&lt;code&gt;~/acapp/match_system/src/&lt;/code&gt;目录下执行：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;./main.py
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;10&#34;&gt;
&lt;li&gt;版本更新，在&lt;a href=&#34;https://www.acwing.com/user/myspace/application/update/2433/&#34;&gt;术士之战&lt;/a&gt;中将 &lt;code&gt;js地址&lt;/code&gt; 一栏更新为：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// 本地文件夹中对应的文件也需要更改名字
https://app2433.acapp.acwing.com.cn/static/js/dist/game-版本号.js
&lt;/code&gt;&lt;/pre&gt;</description>
      <content:encoded><![CDATA[<ul>
<li><a href="https://www.colopen-blog.com/Engineer/acw_django/">AcWing Django 框架课 | Colopen&rsquo;s blog</a></li>
<li><a href="https://www.acwing.com/activity/content/punch_the_clock/72/">AcWing Django 框架课</a></li>
</ul>
<hr>
<h1 id="django-项目创建">Django 项目创建</h1>
<ul>
<li><a href="https://www.acwing.com/solution/content/72577/">2.1上课笔记 | 栎</a></li>
<li><a href="https://www.acwing.com/solution/content/73097/">2.1上课笔记 | Andrew1729</a></li>
</ul>
<hr>
<h2 id="启动初始项目">启动初始项目</h2>
<ol>
<li><code>django-admin startproject acapp</code>：在当前目录下创建名为<code>acapp</code>的<code>django</code>项目</li>
<li><code>python3 manage.py runserver 0.0.0.0:8000</code>：启动项目
<ol>
<li>打开<code>settings.py</code>，找到<code>ALLOWED_HOSTS=[]</code>，修改成<code>ALLOWED_HOSTS=[&quot;自己的服务器的公网IP&quot;]</code></li>
<li>通过<code>自己的服务器公网IP:8000</code> 打开Django页面</li>
</ol>
</li>
</ol>
<h2 id="创建管理员登录页面">创建管理员登录页面</h2>
<ol>
<li>在一级<code>acapp</code>文件夹下，<code>python3 manage.py startapp XXX</code>，<code>XXX</code>是可以自定义的app名，这里用<code>game</code>示例，这时候会多一个文件夹<code>game</code>，树形结构如图：</li>
</ol>
<pre tabindex="0"><code>|-- game
|   |-- __init__.py
|   |-- admin.py          # 管理员页面
|   |-- apps.py           # 用的不多
|   |-- migrations        # 存储数据库
|   |   `-- __init__.py
|   |-- models.py         # 定义网站里的数据库表
|   |-- tests.py
|   `-- views.py          # 视图，即函数
</code></pre><ol start="2">
<li><code>python3 manage.py migrate</code>：将所有修改更新进数据库</li>
<li>创建一个 <strong>管理员用户</strong>：</li>
</ol>
<pre tabindex="0"><code>$ python3 manage.py createsuperuser
&gt; Username (leave blank to use &#39;acs&#39;): admin
&gt; Email address: 
&gt; Password: 123456
&gt; Password (again): 123456
&gt; Superuser created successfully.
</code></pre><p>然后利用该 <strong>管理员用户</strong> 登录 <code>admin</code> 页面，即可成功登陆</p>
<h2 id="创建用户登录页面">创建用户登录页面</h2>
<h3 id="game-下的各个文件作用"><code>game</code> 下的各个文件作用</h3>
<ol>
<li><code>templates</code>目录：管理 <code>html</code>  文件</li>
<li><code>urls</code>目录：管理路由，即链接与函数的对应关系 (接收链接，调用相对应的函数)</li>
<li><code>views</code>目录：管理 <code>http</code> 函数（接收浏览器请求，返回字符串至浏览器）</li>
<li><code>models</code>目录：管理数据库数据</li>
<li><code>static</code>目录：管理静态文件</li>
<li><code>consumers</code>目录：管理<code>websocket</code>函数</li>
</ol>
<h3 id="实现一个路由重定向">实现一个路由重定向</h3>
<ul>
<li><code>url</code> 输入网址 -&gt; <code>acapp.urls</code> -&gt; <code>game.urls</code> -&gt; <code>game.views.index</code> -&gt; 展示页面</li>
</ul>
<p><strong>game.views</strong></p>
<p>这其中，<code>HttpResponse()</code>内部使用<code>html</code>的语法，返回的响应就直接用这个字符串作为页面，转换成<code>html</code></p>
<pre tabindex="0"><code>from django.http import HttpResponse

def index(request):
    line1 = &#39;&lt;h1 style=&#34;text-align: center&#34;&gt; 第一个网页 &lt;/h1&gt;&#39;
    return HttpResponse(line1)
</code></pre><p><strong>game.urls</strong></p>
<p>这其中，<code>path('PATH', function, name)</code>的含义是，在用户访问网站的时候，如果是<code>网站/game/PATH</code>，就会调用<code>function</code>，名字为<code>name</code>，这是在<code>/game/</code>目录下的调用，所以这个<code>PATH</code>是在<code>/game/</code>的基础上的<strong>相对路径</strong>，所以他的<strong>绝对路径</strong>是<code>网站/game/PATH</code></p>
<pre tabindex="0"><code>from django.urls import path
from game.views import index

urlpatterns = [ 
    path(&#34;&#34;, index, name=&#34;index&#34;),
]
</code></pre><p><strong>acapp.urls</strong></p>
<p>这其中，<code>path('PATH', include('game.urls'))</code>的含义是：在用户访问网站的时候，如果是<code>网站/PATH</code>，就会走到<code>/game/urls</code>，并根据<code>/game/urls.py</code>来跑路由，就是说，用户在访问<code>网站/</code>的时候，由于此时调用的函数是<code>include('game.urls')</code>，所以访问<code>网站/</code>相当于根据<code>game/urls</code>访问</p>
<pre tabindex="0"><code>from django.contrib import admin
from django.urls import path, include

urlpatterns = [ 
    path(&#39;&#39;, include(&#39;game.urls&#39;)),
    path(&#39;admin/&#39;, admin.site.urls),
] 
</code></pre><p>然后直接打开 <code>ip:socket</code> 可以直接显示 <code>index</code> 返回的网页</p>
<h1 id="创建菜单界面">创建菜单界面</h1>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/3199626/">3. 创建菜单界面 | 讲义</a></li>
<li><a href="https://www.acwing.com/solution/content/73121/">3.1 上课笔记 | 大家好今天是</a></li>
<li><a href="https://www.acwing.com/solution/content/73707/">3.1 上课笔记 | 栎</a></li>
</ul>
<hr>
<h2 id="构建项目框架">构建项目框架</h2>
<h3 id="项目系统设计">项目系统设计</h3>
<ul>
<li><code>menu</code>：菜单页面</li>
<li><code>playground</code>：游戏界面</li>
<li><code>settings</code>：设置界面</li>
</ul>
<h3 id="项目文件结构">项目文件结构</h3>
<pre tabindex="0"><code>.
|-- README.md
|-- acapp
|   |-- __init__.py    # 文件夹在加上 __init__.py 文件后，python 便可以通过 import 来引用该文件夹
|   |-- asgi.py
|   |-- settings.py
|   |-- urls.py
|   `-- wsgi.py
|-- db.sqlite3
|-- game
|   |-- __init__.py
|   |-- admin.py
|   |-- apps.py
|   |-- migrations
|   |   `-- __init__.py
|   |-- models
|   |   `-- __init__.py
|   |-- static
|   |   |-- css
|   |   |   `-- game.css    # 一般一个工程，只有一个 css 文件就足够了
|   |   |-- image
|   |   |   `-- menu
|   |   |       `-- background.gif
|   |   `-- js
|   |       |-- dist
|   |       |   `-- game.js
|   |       `-- src
|   |           `-- zbase.js    # 总的 js 文件，命名以 z 开头会自动在字典序最后
|   |-- templates
|   |   `-- multiends
|   |       `-- web.html
|   |-- tests.py
|   |-- urls
|   |   |-- __init__.py
|   |   |-- index.py
|   |   |-- menu
|   |   |   |-- __init__.py
|   |   |   `-- index.py
|   |   |-- playground
|   |   |   |-- __init__.py
|   |   |   `-- index.py
|   |   `-- settings
|   |       |-- __init__.py
|   |       `-- index.py
|   `-- views
|       |-- __init__.py
|       |-- index.py
|       |-- menu
|       |   `-- __init__.py
|       |-- playground
|       |   `-- __init__.py
|       `-- settings
|           `-- __init__.py
|-- manage.py
`-- scripts
    `-- compress_game_js.sh
</code></pre><h4 id="js-文件管理"><code>js</code> 文件管理</h4>
<p>一般一个工程会有很多个 <code>.js</code> 源文件，为了加快网络的传输，也为了每次写新的 <code>.js</code> 文件不用每个 <code>html</code> 都额外引入一次</p>
<p>考虑用一个 <code>src</code> 源文件夹来存储所有的 <code>.js</code> 源文件</p>
<p>然后用 <code>dist</code> 文件夹来存放由 <code>src</code> 下所有源文件整合生成的一个目标 <code>.js</code> 文件</p>
<p>这样既实现了快速传输的好处，也方便了后续编写 <code>html</code> 文件时，引入 <code>.js</code> 的便利</p>
<p>创建一个脚本实现上述 <strong>整合</strong> 的功能
<code>~/acapp/scripts/compress_game_js.sh</code></p>
<pre tabindex="0"><code>#! /bin/bash

JS_PATH=/home/acs/acapp/game/static/js/
JS_PATH_DIST=${JS_PATH}dist/
JS_PATH_SRC=${JS_PATH}src/

find $JS_PATH_SRC -type f -name &#39;*.js&#39; | sort | xargs cat &gt; ${JS_PATH_DIST}game.js
</code></pre><h4 id="html-文件管理"><code>html</code> 文件管理</h4>
<p>在 <code>templates</code> 文件夹下创建 <code>menu</code>、<code>playground</code>、<code>settings</code>、<code>multiends</code> 四个文件夹，用于存储三个模块和终端的 <code>html</code> 文件</p>
<p>在 <code>multiends</code> 下创建 <code>web.html</code> 文件</p>
<pre tabindex="0"><code>{% load static %}
&lt;!-- Django 中引入全局setting里的变量 static 的语法--&gt;
&lt;head&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;https://cdn.acwing.com/static/jquery-ui-dist/jquery-ui.min.css&#34;&gt;
    &lt;script src=&#34;https://cdn.acwing.com/static/jquery/js/jquery-3.3.1.min.js&#34;&gt;&lt;/script&gt;
    &lt;!-- 上述两句引入 jQuery 库 --&gt;
    &lt;!-- 使用引入的变量 static 的语法如下 --&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;{% static &#39;css/game.css&#39; %}&#34;&gt;
    &lt;script src=&#34;{% static &#39;js/dist/game.js&#39; %}&#34;&gt;&lt;/script&gt;
    &lt;!-- 分别引入 css 文件和总的 js 文件 --&gt;
&lt;/head&gt;

&lt;body style=&#34;margin: 0&#34;&gt;
    &lt;div id=&#34;ac_game_12345678&#34;&gt;&lt;/div&gt;
    &lt;script&gt;
        $(document).ready(function(){
            let ac_game = new AcGame(&#34;ac_game_12345678&#34;)
        })
    &lt;/script&gt;
&lt;/body&gt;
</code></pre><h4 id="views-视图管理"><code>views</code> 视图管理</h4>
<p>在 <code>views</code> 文件夹下新建三个模块的视图文件夹</p>
<p>写一个 <code>index.py</code> 文件，目的是在 <code>web</code> 端被访问时，返回上面写的 <code>web.html</code> 文件</p>
<pre tabindex="0"><code>from django.shortcuts import render

def index(request):
  return render(request, &#34;multiends/web.html&#34;)
</code></pre><h4 id="urls-路由管理"><code>urls</code> 路由管理</h4>
<pre tabindex="0"><code>                                     /-- &#34;&#34; -- index
                                    / -- &#34;menu/&#34; -- menu.index
             / &#34;&#34; --&gt; &#34;game.url&#34; --&gt; 
            /                       \ -- &#34;playground/&#34; -- playground.index
id:scoket -&gt;                         \-- &#34;settings/&#34; -- settings.index
            \
             \ &#34;/admin&#34; -- 到达管理员页面
</code></pre><p><code>~/acapp/acapp/urls.py</code></p>
<pre tabindex="0"><code>from django.contrib import admin
from django.urls import path, include

urlpatterns = [
  path(&#39;&#39;, include(&#39;game.urls.index&#39;)),
  path(&#39;admin/&#39;, admin.site.urls),
]
</code></pre><p><code>~/acapp/game/urls/index.py</code></p>
<pre tabindex="0"><code>from django.urls import path, include
from game.views.index import index

urlpatterns = [ 
    path(&#34;&#34;, index, name=&#34;index&#34;),
    path(&#34;menu/&#34;, include(&#34;game.urls.menu.index&#34;)),
    path(&#34;playground/&#34;, include(&#34;game.urls.playground.index&#34;)),
    path(&#34;settings/&#34;, include(&#34;game.urls.settings.index&#34;))
]
</code></pre><h4 id="网页渲染流程">网页渲染流程</h4>
<p>根据用户的链接，首先进入<code>acapp/urls.py</code>，根据<code>path</code>再进入<code>game/urls/index.py</code>，再根据<code>path</code>进入下一层<code>url</code>或调用相对应的<code>views</code>中的<code>index.py</code>函数，函数接收参数，在网页端渲染<code>templates/multiends</code>下的<code>web.html</code>，<code>html</code>中有<code>JS</code>执行</p>
<p>注意：本项目为前后端分离，即通过<code>JS</code>在<code>client</code>中渲染项目(动态生成页面)，而不是在<code>server</code>渲染项目</p>
<h3 id="修改全局配置">修改全局配置</h3>
<h4 id="设置时区">设置时区</h4>
<p>修改项目的 <strong>UTC</strong> 时间为 <strong>CN</strong> 时间</p>
<pre tabindex="0"><code>$ vim /acapp/settings.py

******
TIME_ZONE = &#39;Asia/Shanghai&#39; # 原来默认是 UTC
******
</code></pre><h4 id="添加配置文件">添加配置文件</h4>
<p>将新创建的 <code>game</code> 下的 <code>apps.py</code> 中的 <code>GameConfig</code> 加到 <code>settings.py</code> 下</p>
<pre tabindex="0"><code>$ vim /acapp/settings.py

******
INSTALLED_APPS = [
  &#39;game.apps.GameConfig&#39;,
  ......
]
******
</code></pre><p>声明将静态文件路径 <code>STATIC_ROOT</code> 和 <code>MEDIA_ROOT</code></p>
<pre tabindex="0"><code>$ vim /acapp/settings.py

******
import os

......

STATIC_ROOT = os.path.join(BASE_DIR, &#39;static&#39;)
STATIC_URL = &#39;/static/&#39;

MEDIA_ROOT = os.path.join(BASE_DIR, &#39;media&#39;)
MEDIA_URL = &#39;/media/&#39;
******
</code></pre><h2 id="创建菜单-menu-界面">创建菜单 <code>menu</code> 界面</h2>
<h3 id="搭建菜单-menu-界面的框架">搭建菜单 <code>menu</code> 界面的框架</h3>
<p>我们采用的 <strong>前后端分离式</strong> 开发，所有的 <strong>html</strong> 渲染都要求在前端完成</p>
<p>开发流程就是，先在 <strong>html</strong> 里创建好一个有 <strong>id</strong> 的 <strong>div</strong></p>
<p>然后利用 <strong>js</strong> 文件，捕获到该 <strong>div</strong>，并进行 <strong>渲染</strong></p>
<p><code>/templates/multiends/web.html</code></p>
<pre tabindex="0"><code>...
    &lt;div id=&#34;ac_game_12345678&#34;&gt;&lt;/div&gt;
    &lt;script&gt;
        $(document).ready(function(){
            let ac_game = new AcGame(&#34;ac_game_12345678&#34;)
        })
    &lt;/script&gt;
...
</code></pre><p><code>js/src/zbase.js</code></p>
<pre tabindex="0"><code>class AcGame {
    constructor(id) {
        this.id = id; 
        this.$ac_game = $(&#39;#&#39; + id);
        this.menu = new AcGameMenu(this);
    }   
}
</code></pre><p><code>js/src/menu/zbase.js</code></p>
<pre tabindex="0"><code>class AcGameMenu {
    constructor(root) {
        this.root = root;
        this.$menu = $(` 
&lt;div class=&#34;ac-game-menu&#34;&gt;
&lt;/div&gt;
`);
        this.root.$ac_game.append(this.$menu); 
}
</code></pre><p><code>css/game.css</code></p>
<pre tabindex="0"><code>.ac-game-menu {
    width: 100%;
    height: 100%;
    background-image: url(&#39;/static/image/menu/background.gif&#39;);
    background-size: 100% 100%;
    user-select: none;
}
</code></pre><p>这里的 <strong>代码逻辑</strong> 如下：</p>
<ol>
<li><code>html</code> 页面执行到 <code>js</code> 代码，利用 <code>AcGame类</code> 创建对象 <code>ac_game</code> 同时传递参数 <code>div</code> 的 <code>id</code></li>
<li><code>AcGame</code> 开始执行构造函数，在构造函数中，捕获 <code>html</code> 标签，并利用 <code>AcGameMenu类</code> 创建对象 <code>menu</code>，并将整个对象作为参数下传</li>
<li><code>AcGameMenu</code> 开始执行构造函数，然后创建 <code>html</code> 代码，加到捕获到的 <code>html</code> 代码下</li>
<li>最终成功渲染出背景图片</li>
</ol>
<h3 id="设置菜单-menu-页面的内容">设置菜单 <code>menu</code> 页面的内容</h3>
<p>主要内容就是在主页面中，显示：单人模式、多人模式、设置，三个按钮的选项
<code>js/src/menu/zbase.js</code></p>
<pre tabindex="0"><code>class AcGameMenu {
    constructor(root) {
        this.root = root;
        this.$menu = $(`
&lt;div class=&#34;ac-game-menu&#34;&gt;
    &lt;div class=&#34;ac-game-menu-field&#34;&gt;
        &lt;div class=&#34;ac-game-menu-field-item ac-game-menu-field-item-single-mode&#34;&gt;
            单人模式
        &lt;/div&gt;
        &lt;div class=&#34;ac-game-menu-field-item ac-game-menu-field-item-multi-mode&#34;&gt;
            多人模式
        &lt;/div&gt;
        &lt;div class=&#34;ac-game-menu-field-item ac-game-menu-field-item-settings-mode&#34;&gt;
            设置
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
`);
        this.root.$ac_game.append(this.$menu);
        this.$single_mode = this.$menu.find(&#39;.ac-game-menu-field-item-single-mode&#39;);
        this.$multi_mode = this.$menu.find(&#39;.ac-game-menu-field-item-multi-mode&#39;);
        this.$settings_mode = this.$menu.find(&#39;.ac-game-menu-field-item-settings-mode&#39;);
    }
}
</code></pre><p><code>css/game.css</code></p>
<pre tabindex="0"><code>.ac-game-menu {
    width: 100%;
    height: 100%;
    background-image: url(&#39;/static/image/menu/background.gif&#39;);
    background-size: 100% 100%;
    user-select: none;
}
.ac-game-menu-field {
    width: 20vw;
    position: relative;
    top: 40vh;
    left: 19vh;
}
.ac-game-menu-field-item {
    height: 7vh;
    width: 18vw;
    color: white;
    font-size: 6vh;
    font-style: italic;
    padding: 2vh;
    margin: 1vh 0;
    cursor: pointer;
    text-align: center;
    background-color: rgba(39, 21, 28, 0.6);
    border-radius: 10px;
    letter-spacing: 0.5vw;
}
.ac-game-menu-field-item:hover {
    transform: scale(1.2);
    transition: 100ms;
}
</code></pre><h3 id="添加-单人模式-监听函数--打开游戏界面-功能">添加 &lsquo;单人模式&rsquo; 监听函数 —— 打开游戏界面 功能</h3>
<p>这里要实现的 <strong>逻辑</strong>：</p>
<ol>
<li>点击 &lsquo;单人模式&rsquo; 按钮触发 <code>click</code> 事件，随即触发监听函数，开始执行</li>
<li>关闭 <code>menu</code> 页面</li>
<li>打开 <code>playground</code> 页面</li>
</ol>
<p>因此，我们先简易的实现一个 <code>playground</code> 页面，方便调试该功能
<code>js/src/playground/zbase.js</code></p>
<pre tabindex="0"><code>class AcGamePlayground {
    constructor(root) {
        this.root = root;
        this.$playground = $(`&lt;div&gt;游戏界面&lt;/div&gt;`);

        this.hide();
        this.root.$ac_game.append(this.$playground);

        this.start();
    }
    start() {

    }
    show() {    //打开 playground 界面
        this.$playground.show();
    }
    hide() {    //关闭 playground 界面
        this.$playground.hide();
    }

}
</code></pre><p>在实现监听函数功能之前，先在 <code>/src/zbase.js</code> 即主 <code>js</code> 文件下，利用 <code>AcGamePlayground</code> 类创建好 <code>playground</code> 对象</p>
<p>这样我们就能在前端，渲染出两个界面了，分别是：<code>menu</code> 和 <code>playground</code></p>
<p><code>js/src/zbase.js</code></p>
<pre tabindex="0"><code>class AcGame {
    constructor(id) {
        this.id = id;
        this.$ac_game = $(&#39;#&#39; + id);
        this.menu = new AcGameMenu(this);
        // 把 playground 对象也建好，这样我们就同时有两个界面了
        this.playground = new AcGamePlayground(this);

        this.start();
    }                    
    start() {

    }
}
</code></pre><p>然后，我们开始实现 <code>ac-game-menu-field-item-single-mode</code> 标签的 <code>click</code> 事件的监听函数</p>
<p>其功能之前讲过了，就是关闭 <code>menu</code> 页面，打开 <code>playground</code> 页面</p>
<p><code>js/src/menu/zbase.js</code></p>
<pre tabindex="0"><code>class AcGameMenu {
    constructor(root) {
        this.root = root;
        this.$menu = $(`
&lt;div class=&#34;ac-game-menu&#34;&gt;
    &lt;div class=&#34;ac-game-menu-field&#34;&gt;
        &lt;div class=&#34;ac-game-menu-field-item ac-game-menu-field-item-single-mode&#34;&gt;
            单人模式
        &lt;/div&gt;
        &lt;div class=&#34;ac-game-menu-field-item ac-game-menu-field-item-multi-mode&#34;&gt;
            多人模式
        &lt;/div&gt;
        &lt;div class=&#34;ac-game-menu-field-item ac-game-menu-field-item-settings-mode&#34;&gt;
            设置
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
`);
        this.root.$ac_game.append(this.$menu);
        this.$single_mode = this.$menu.find(&#39;.ac-game-menu-field-item-single-mode&#39;);
        this.$multi_mode = this.$menu.find(&#39;.ac-game-menu-field-item-multi-mode&#39;);
        this.$settings_mode = this.$menu.find(&#39;.ac-game-menu-field-item-settings-mode&#39;);

        this.start();
    }
    start() {
        this.add_listening_events();
    }
    add_listening_events() {
        let outer = this;
        this.$single_mode.click(function(){
            outer.hide();   // 关闭主页面
            outer.root.playground.show();   // 打开游戏界面
        });
    }

    show() {    //显示menu界面
        this.$menu.show();
    }
    hide() {    //隐藏menu界面
        this.$menu.hide();
    }
}
</code></pre><h1 id="创建游戏界面">创建游戏界面</h1>
<ul>
<li><a href="https://www.acwing.com/solution/content/79181/">4.1 上课笔记 | Andrew1729</a></li>
</ul>
<hr>
<blockquote>
<p><strong>若修改<code>static文件夹</code>下的相关文件，需在<code>~/acapp</code>下执行<code>./scripts/compress_game_js.sh</code>来打包文件</strong></p>
</blockquote>
<h2 id="前端的模块化引入">前端的模块化引入</h2>
<p>由于在 <code>html</code> 代码部分，是将整个 <code>game.js</code> 文件引入</p>
<p>这样会导致在 <code>game.js</code> 中定义的变量，会变成整个网页的 <strong>全局变量</strong>（之后可能会引起变量重名的诸多问题）</p>
<p>因此，我们考虑使用 <strong>模块化引入</strong> 的功能，让网页只引入在 <code>html</code> 中需要的部分</p>
<p>修改 <code>web.html</code></p>
<pre tabindex="0"><code>&lt;!-- 首先，先删掉上面整个引入 game.js 的部分 --&gt;
&lt;!-- 然后，下方创建对象的部分，先使用模块化引入 --&gt;
......
    &lt;script type=&#34;module&#34;&gt;
        import {AcGame} from &#34;{% static &#39;js/dist/game.js&#39; %}&#34;
        $(document).ready(function(){
            let ac_game = new AcGame(&#34;ac_game_12345678&#34;)
        })
    &lt;/script&gt;
......
</code></pre><p>此外，还有修改引入的类，在前面加上 <code>export</code>，如下修改 <code>js/src/zbase.js</code></p>
<pre tabindex="0"><code>export class AcGame {
    ......
}
</code></pre><p>这样，在全局中，只会出现引入的模块，其他的 <code>.js</code> 代码不会出现在全局中</p>
<h2 id="构建游戏界面框架">构建游戏界面框架</h2>
<p><code>static/js/src/playground/zbase.js</code></p>
<pre tabindex="0"><code>......
    this.$playground = $(`&lt;div class=&#34;ac-game-playground&#34;&gt;&lt;/div&gt;`);
......
</code></pre><p><code>game.css</code></p>
<pre tabindex="0"><code>......
.ac-game-playground {
    height: 100%;
    width: 100%;
    user-select: none;  // 禁用右键弹菜单
} 
</code></pre><h2 id="实现游戏引擎框架">实现游戏引擎框架</h2>
<p>游戏中，物体在移动，其实现原理是：每一个动作都会渲染多张图片出来，然后图片快速的切换，从而实现动的过程</p>
<p>因此，需要先实现一个游戏引擎的基类 <code>AcGameObject</code> ，使得每帧能渲染一张图片出来</p>
<p>该基类需要具备的功能有：</p>
<ol>
<li><code>start()</code> 在游戏开始的第一帧时需要执行的任务（一般是创建对象）</li>
<li><code>update()</code> 在游戏开始后的每一帧均会执行的任务（一般是渲染当前对象的各种状态）</li>
<li><code>on_destroy()</code> 删掉该物体前需要执行的任务（一般是删掉动画，或者给对手加分）</li>
<li><code>destroy()</code> 删掉该物体</li>
</ol>
<p>根据上述逻辑，我们就可以基本搭建出来一个游戏引擎的基类了，具体如下：
<code>/static/js/playground/ac_game_object/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">let</span> AC_GAME_OBJECTS = [];   <span style="color:#007f7f">// 用于记录当前画布中，需要渲染的对象有哪些
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGameObject {
</span></span><span style="display:flex;"><span>    constructor() {
</span></span><span style="display:flex;"><span>        AC_GAME_OBJECTS.push(<span style="color:#fff;font-weight:bold">this</span>);  <span style="color:#007f7f">// 将当前新建的对象，加入到全局的画布中去，参与渲染
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.has_called_start = <span style="color:#fff;font-weight:bold">false</span>;  <span style="color:#007f7f">// 是否执行过 start 函数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.timedelta = <span style="color:#ff0;font-weight:bold">0</span>;             <span style="color:#007f7f">// 当前帧距离上一帧的时间间隔
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// 该数据记录是为了后续计算速度等参数的
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    }
</span></span><span style="display:flex;"><span>    start() {   <span style="color:#007f7f">// 只会在第一帧执行一次
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    update() {  <span style="color:#007f7f">// 每一帧均会执行一次
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    on_destroy() {  <span style="color:#007f7f">// 在被销毁前执行一次
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    destroy() { <span style="color:#007f7f">// 删掉该物体
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.on_destroy();  <span style="color:#007f7f">//删掉该物体前，执行删前的操作
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 在全局渲染物体中，找到该物体，并将其删掉
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; AC_GAME_OBJECTS.length; i ++ ) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (AC_GAME_OBJECTS[i] === <span style="color:#fff;font-weight:bold">this</span>) {  <span style="color:#007f7f">// 三等号，在js里额外加了一层类型相等约束
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                AC_GAME_OBJECTS.splice(i, <span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">let</span> last_timestamp;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">let</span> AC_GAME_ANIMATION = <span style="color:#fff;font-weight:bold">function</span>(timestamp) {  <span style="color:#007f7f">// 回调函数，实现：每一帧重绘时，都会执行一遍
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; AC_GAME_OBJECTS.length; i ++ ) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> obj = AC_GAME_OBJECTS[i];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!obj.has_called_start) { <span style="color:#007f7f">// 如果还未执行初始帧动作，就先执行
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            obj.start();
</span></span><span style="display:flex;"><span>            obj.has_called_start = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {  <span style="color:#007f7f">// 执行过初始帧，就执行每一帧的任务
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            obj.timedelta = timestamp - last_timestamp;
</span></span><span style="display:flex;"><span>            obj.update();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    last_timestamp = timestamp; <span style="color:#007f7f">// 更新最后一次时间戳
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    requestAnimationFrame(AC_GAME_ANIMATION);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>requestAnimationFrame(AC_GAME_ANIMATION);   <span style="color:#007f7f">// JS的API，可以调用1帧里面的函数。(有些浏览器的一秒帧数不一定相等)
</span></span></span></code></pre></div><blockquote>
<p><strong>接下来所有的一切游戏，都是基于这个引擎的基类完成的</strong></p>
</blockquote>
<h2 id="实现游戏地图功能">实现游戏地图功能</h2>
<p>目标：实现一个每一秒都在渲染的纯黑背景</p>
<p>虽然现阶段要实现的地图较为简单，但为了后期的拓展性，故还是考虑新建一个文件夹来完成</p>
<p>然后在 <code>js</code> 中，已经封装好了一个 <code>canvas</code> 的 <code>api</code> 来帮助实现背景画布，直接调用即可</p>
<p>先铺开画布，然后设置为黑色</p>
<p><code>static/js/playground/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGamePlayground {
</span></span><span style="display:flex;"><span>    constructor(root) {
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// $(&#39;.playground&#39;)对象已经在 css 文件里渲染出高宽了
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// 现在把他的高宽存下来，往下传递
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.width = <span style="color:#fff;font-weight:bold">this</span>.$playground.width();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.height = <span style="color:#fff;font-weight:bold">this</span>.$playground.height();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.game_map = <span style="color:#fff;font-weight:bold">new</span> GameMap(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    .....
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>static/js/playground/game-map/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> GameMap <span style="color:#fff;font-weight:bold">extends</span> AcGameObject {    <span style="color:#007f7f">// 继承自游戏引擎基类
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    constructor(playground) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>();    <span style="color:#007f7f">// 自函数功能：调用基类的构造函数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.playground = playground;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$canvas = $(<span style="color:#0ff;font-weight:bold">`&lt;canvas&gt;&lt;/canvas&gt;`</span>); <span style="color:#007f7f">// 创建一个canvas的jQuery对象，就是我们要实现的画布
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.ctx = <span style="color:#fff;font-weight:bold">this</span>.$canvas[<span style="color:#ff0;font-weight:bold">0</span>].getContext(<span style="color:#0ff;font-weight:bold">&#39;2d&#39;</span>); <span style="color:#007f7f">// jQuery对象是一个数组，第一个索引是html对象
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// 设置画布的宽高
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.width = <span style="color:#fff;font-weight:bold">this</span>.playground.width;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.height = <span style="color:#fff;font-weight:bold">this</span>.playground.height;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.playground.$playground.append(<span style="color:#fff;font-weight:bold">this</span>.$canvas);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    start() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    update() {  <span style="color:#007f7f">// 游戏地图每帧都要渲染
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.render();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    render() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fillStyle = <span style="color:#0ff;font-weight:bold">&#34;rgba(0, 0, 0, 0.2)&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fillRect(<span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.width, <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.height);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><h2 id="实现玩家显示功能">实现玩家显示功能</h2>
<p>毛坯版玩家显示，每个玩家定义成一个圆，然后渲染在前端</p>
<p>需要对于玩家类定义多个参数，以方便日后拓展：</p>
<ol>
<li><code>x</code> 当前位置的横坐标</li>
<li><code>y</code> 当前位置的纵坐标</li>
<li><code>radius</code> 当前的半径</li>
<li><code>speed</code> 当前的速度</li>
<li><code>is_me</code> 该对象是否是当前玩家操控的对象（一是区别于 bot，二是区别于 日后联机的其他玩家）</li>
</ol>
<p><code>static/js/playground/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGamePlayground {
</span></span><span style="display:flex;"><span>    constructor(root) {
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.players = [];  <span style="color:#007f7f">// 存放当前游戏中的所有玩家
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// 将玩家加入游戏中
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.players.push(<span style="color:#fff;font-weight:bold">new</span> Player(<span style="color:#fff;font-weight:bold">this</span>, <span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.05</span>, <span style="color:#0ff;font-weight:bold">&#34;white&#34;</span>, <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.15</span>, <span style="color:#fff;font-weight:bold">true</span>));
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    .....
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>static/js/playground/player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Player <span style="color:#fff;font-weight:bold">extends</span> AcGameObject {
</span></span><span style="display:flex;"><span>    constructor(playground, x, y, radius, color, speed, is_me) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 把信息都存下来
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.playground = playground;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx = <span style="color:#fff;font-weight:bold">this</span>.playground.game_map.ctx;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.x = x;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.y = y;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.color = color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.speed = speed;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.radius = radius;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.is_me = is_me;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 用于浮点数运算
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.eps = <span style="color:#ff0;font-weight:bold">0.1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    start() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    update() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.render();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    render() {  <span style="color:#007f7f">// 渲染一个圆
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.beginPath();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.arc(<span style="color:#fff;font-weight:bold">this</span>.x, <span style="color:#fff;font-weight:bold">this</span>.y, <span style="color:#fff;font-weight:bold">this</span>.radius, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">2</span> * <span style="color:#fff;font-weight:bold">Math</span>.PI, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fillStyle = <span style="color:#fff;font-weight:bold">this</span>.color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fill();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    on_destroy() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="实现玩家移动功能">实现玩家移动功能</h2>
<p>移动的实现逻辑很简单，就是让每帧渲染的圆的位置发生移动即可</p>
<p>上述简单逻辑的实现如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Player <span style="color:#fff;font-weight:bold">extends</span> AcGameObject {
</span></span><span style="display:flex;"><span>    constructor(....)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.vx = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.vy = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    update() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.x += x;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.y += y;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.render();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>然后我们来实现一个向鼠标点击位置移动的功能</p>
<p>这就需要设置一个 <code>click</code> 事件的监听函数，分别传递：</p>
<ol>
<li>鼠标点击事件</li>
<li>鼠标点击位置的横坐标</li>
<li>鼠标点击位置的纵坐标</li>
</ol>
<p>然后开始让圆的位置逐步向鼠标点击位置进行移动</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>start() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.is_me) {   <span style="color:#007f7f">// 对于用户玩家，加上监听函数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.add_listening_events();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>add_listening_events() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 把鼠标右键调出菜单栏的功能关掉
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.playground.game_map.$canvas.on(<span style="color:#0ff;font-weight:bold">&#34;contextmenu&#34;</span>, <span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 把右键控制移动功能加上
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.playground.game_map.$canvas.mousedown(<span style="color:#fff;font-weight:bold">function</span>(e) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 左键:1 中键:2 右键:3
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (e.which === <span style="color:#ff0;font-weight:bold">3</span>) {
</span></span><span style="display:flex;"><span>            outer.move_to(e.clientX, e.clientY);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>然后，我们来实现移动功能的函数 <code>move_to(tx, ty)</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>constructor(...){
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.vx = <span style="color:#ff0;font-weight:bold">0</span>;    <span style="color:#007f7f">// x方向上的移动速度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.vy = <span style="color:#ff0;font-weight:bold">0</span>;    <span style="color:#007f7f">// y方向上的移动速度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.move_length = <span style="color:#ff0;font-weight:bold">0</span>;   <span style="color:#007f7f">// 剩余移动距离
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>get_dist (x1, y1, x2, y2) { <span style="color:#007f7f">// 求两点的欧几里得距离
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">let</span> dx = x2 - x1;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> dy = y2 - y1;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">Math</span>.sqrt(dx * dx + dy * dy);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>move_to(tx, ty) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 计算移动距离
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.move_length = <span style="color:#fff;font-weight:bold">this</span>.get_dist(<span style="color:#fff;font-weight:bold">this</span>.x, <span style="color:#fff;font-weight:bold">this</span>.y, tx, ty);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 计算移动角度，api接口：atan2(dy, dx)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">let</span> angle = <span style="color:#fff;font-weight:bold">Math</span>.atan2(ty - <span style="color:#fff;font-weight:bold">this</span>.y, tx - <span style="color:#fff;font-weight:bold">this</span>.x);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 位移 1 个单位长度（向着矢量方向移动到单位圆上）
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.vx = <span style="color:#fff;font-weight:bold">Math</span>.cos(angle);  <span style="color:#007f7f">// 极直互化
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.vy = <span style="color:#fff;font-weight:bold">Math</span>.sin(angle);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>update() {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 浮点数精度运算
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.move_length &lt; <span style="color:#fff;font-weight:bold">this</span>.eps) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.move_length = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.vx = <span style="color:#fff;font-weight:bold">this</span>.vy = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 计算单位帧里的移动距离
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">let</span> moved = <span style="color:#fff;font-weight:bold">Math</span>.min(<span style="color:#fff;font-weight:bold">this</span>.move_length, <span style="color:#fff;font-weight:bold">this</span>.speed * <span style="color:#fff;font-weight:bold">this</span>.timedelta / <span style="color:#ff0;font-weight:bold">1000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.x += <span style="color:#fff;font-weight:bold">this</span>.vx * moved;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.y += <span style="color:#fff;font-weight:bold">this</span>.vy * moved;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 还要减掉移动的距离
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.move_length -= moved;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.render();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>这样就实现了玩家的移动功能了，可以登录 <code>id:socket</code> 调试该功能</p>
<h2 id="实现火球技能的功能">实现火球技能的功能</h2>
<p>火球对象的建立与玩家基本一致，直接照搬，在从细节上改改即可</p>
<p><code>js/src/playground/skill/fireball/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> FireBall <span style="color:#fff;font-weight:bold">extends</span> AcGameObject {
</span></span><span style="display:flex;"><span>    constructor(playground, player, x, y, radius, vx, vy, color, speed, move_length, damage) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.playground = playground;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx = <span style="color:#fff;font-weight:bold">this</span>.playground.game_map.ctx;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.player = player;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.x = x;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.y = y;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.vx = vx;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.vy = vy;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.radius = radius;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.color = color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.speed = speed;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.move_length = move.length;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.damage = damage;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.eps = <span style="color:#ff0;font-weight:bold">0.1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    start() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    update() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.move_length &lt; <span style="color:#fff;font-weight:bold">this</span>.eps) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.destroy();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">let</span> moved = <span style="color:#fff;font-weight:bold">Math</span>.min(<span style="color:#fff;font-weight:bold">this</span>.move_length, <span style="color:#fff;font-weight:bold">this</span>.speed * <span style="color:#fff;font-weight:bold">this</span>.timedelta / <span style="color:#ff0;font-weight:bold">1000</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.x += <span style="color:#fff;font-weight:bold">this</span>.vx * moved;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.y += <span style="color:#fff;font-weight:bold">this</span>.vy * moved;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.move_length -= moved;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.render();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    render() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.beginPath();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.arc(<span style="color:#fff;font-weight:bold">this</span>.x, <span style="color:#fff;font-weight:bold">this</span>.y, <span style="color:#fff;font-weight:bold">this</span>.radius, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">2</span> * <span style="color:#fff;font-weight:bold">Math</span> * Pi, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fillStyle = <span style="color:#fff;font-weight:bold">this</span>.color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fill();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><p>然后在玩家身上实现发火球的功能</p>
<p>基本实现逻辑：当前选中了火球技能，鼠标左键点击一处，向该处发射一个火球</p>
<p>因此，为了知道用户是否选择了技能，需要加一个键盘触发事件监听函数，然后加一个鼠标左键触发事件监听函数</p>
<p>然后发射一个火球即可</p>
<p><code>js/src/playground/player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>constructor(...) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.cur_skill = <span style="color:#fff;font-weight:bold">null</span>;  <span style="color:#007f7f">// 记录当前选择的技能
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>add_listening_events() {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.playground.game_map.$canvas.mousedown(<span style="color:#fff;font-weight:bold">function</span>(e) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 左键:1 中键:2 右键:3
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (e.which === <span style="color:#ff0;font-weight:bold">3</span>) {
</span></span><span style="display:flex;"><span>            outer.move_to(e.clientX, e.clientY);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (e.which === <span style="color:#ff0;font-weight:bold">1</span>) {     <span style="color:#007f7f">// 鼠标左键事件
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (outer.cur_skill === <span style="color:#0ff;font-weight:bold">&#34;fireball&#34;</span>) {   <span style="color:#007f7f">// 当前已经选中火球技能
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                outer.shoot_fireball(e.clientX, e.clientY);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        outer.cur_skill = <span style="color:#fff;font-weight:bold">null</span>; <span style="color:#007f7f">// 清空当前技能
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    });
</span></span><span style="display:flex;"><span>    $(<span style="color:#fff;font-weight:bold">window</span>).keydown(<span style="color:#fff;font-weight:bold">function</span>(e) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (e.which === <span style="color:#ff0;font-weight:bold">81</span>) {       <span style="color:#007f7f">// 键盘按下事件
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            outer.cur_skill = <span style="color:#0ff;font-weight:bold">&#34;fireball&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>shoot_fireball(tx, ty) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 确定火球的参数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">let</span> x = <span style="color:#fff;font-weight:bold">this</span>.x, y = <span style="color:#fff;font-weight:bold">this</span>.y; <span style="color:#007f7f">// 火球发射点就是当前玩家的位置
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">let</span> radius = <span style="color:#fff;font-weight:bold">this</span>.playground.height * <span style="color:#ff0;font-weight:bold">0.01</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> angle = <span style="color:#fff;font-weight:bold">Math</span>.atan2(ty - <span style="color:#fff;font-weight:bold">this</span>.y, tx - <span style="color:#fff;font-weight:bold">this</span>.x);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> vx = <span style="color:#fff;font-weight:bold">Math</span>.cos(angle), vy = <span style="color:#fff;font-weight:bold">Math</span>.sin(angle);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> color = <span style="color:#0ff;font-weight:bold">&#34;orange&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> speed = <span style="color:#fff;font-weight:bold">this</span>.playground.height * <span style="color:#ff0;font-weight:bold">0.5</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> move_length = <span style="color:#fff;font-weight:bold">this</span>.playground.height * <span style="color:#ff0;font-weight:bold">1.0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> damage = <span style="color:#fff;font-weight:bold">this</span>.playground.height * <span style="color:#ff0;font-weight:bold">0.01</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> FireBall(<span style="color:#fff;font-weight:bold">this</span>.playground, <span style="color:#fff;font-weight:bold">this</span>, x, y, radius, vx, vy, color, speed, move_length, damage);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这样就成功实现了玩家发射火球的功能了</p>
<h2 id="实现单人模式下的人机功能">实现单人模式下的人机功能</h2>
<p>先创建好 5 个人机
<code>playground/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//创建好 5 个人机
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">for</span> (len i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">5</span>; i ++ ) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.players.push(<span style="color:#fff;font-weight:bold">new</span> Player(<span style="color:#fff;font-weight:bold">this</span>, <span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.05</span>, <span style="color:#0ff;font-weight:bold">&#34;blue&#34;</span>, <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.15</span>, <span style="color:#fff;font-weight:bold">false</span>));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>这样创建出来的 5 个人机是不会行动的</p>
<p>我们写一个简易的 AI 程序，让他们也会移动</p>
<p>这里实现的逻辑是：每次随机一个目的地，向目的地移动，然后再随机一个目的地，循环下去</p>
<p>根据该逻辑，修改两个函数即可</p>
<p><code>playground/player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>start() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.is_me) {   <span style="color:#007f7f">// 对于用户玩家，加上监听函数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.add_listening_events();
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> tx = <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#fff;font-weight:bold">this</span>.playground.width;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> ty = <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#fff;font-weight:bold">this</span>.playground.height;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.move_to(tx, ty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span> update() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.move_length &lt; <span style="color:#fff;font-weight:bold">this</span>.eps) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.move_length = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.vx = <span style="color:#fff;font-weight:bold">this</span>.vy = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!<span style="color:#fff;font-weight:bold">this</span>.is_me) {   <span style="color:#007f7f">// 如果是人机，停下来时再随机一个方向前进
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">let</span> tx = <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#fff;font-weight:bold">this</span>.playground.width;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">let</span> ty = <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#fff;font-weight:bold">this</span>.playground.height;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.move_to(tx, ty);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>on_destroy() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#fff;font-weight:bold">this</span>.playground.players.length; i ++ ) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.playground.players[i] === <span style="color:#fff;font-weight:bold">this</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.playground.players.splice(i, <span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="实现技能命中效果碰撞检测功能">实现技能命中效果（碰撞检测功能）</h2>
<p>实现逻辑：检测两个圆的中心距离是否小于两个圆的半径之和</p>
<p>小于等于时，代表发生碰撞，开始执行命中效果：</p>
<ol>
<li>被击中用户掉血</li>
<li>被击中用户收到向后击退效果</li>
</ol>
<p>碰撞检测写在火球类里，击退效果写在玩家类里</p>
<p><code>fireball/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>update() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (...) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 碰撞检测
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#fff;font-weight:bold">this</span>.playground.players.length; i ++ ) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">let</span> player = <span style="color:#fff;font-weight:bold">this</span>.playground.players[i];
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.player !== player &amp;&amp; <span style="color:#fff;font-weight:bold">this</span>.is_collision(player)) {  <span style="color:#007f7f">// 碰撞发生一定是在非施法者身上
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">this</span>.attack(player);    <span style="color:#007f7f">// 火球命中，目标玩家执行击退效果
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.render();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>get_dist(x1, y1, x2, y2) {  <span style="color:#007f7f">// 获得两点的欧几里得距离
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">let</span> dx = x2 - x1;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> dy = y2 - y1;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">Math</span>.sqrt(dx * dx + dy * dy);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>is_collision(player) {  <span style="color:#007f7f">// 检测两个圆的中心距离是否小于两个圆的半径之和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">let</span> distance = <span style="color:#fff;font-weight:bold">this</span>.get_dist(<span style="color:#fff;font-weight:bold">this</span>.x, <span style="color:#fff;font-weight:bold">this</span>.y, player.x, player.y);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (distance &lt; (<span style="color:#fff;font-weight:bold">this</span>.radius + player.radius))
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>attack(player) {    <span style="color:#007f7f">// 火球命中，目标玩家执行击退效果
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">let</span> angle = <span style="color:#fff;font-weight:bold">Math</span>.atan2(player.y - <span style="color:#fff;font-weight:bold">this</span>.y, player.x - <span style="color:#fff;font-weight:bold">this</span>.x);   <span style="color:#007f7f">// 计算角度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    player.is_attacked(angle, <span style="color:#fff;font-weight:bold">this</span>.damage); <span style="color:#007f7f">// 火球命中，目标玩家执行击退效果
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.destroy(); <span style="color:#007f7f">// 火球命中后，自然消失
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span></code></pre></div><p><strong>被击退的时候，原来的移动速度应该置为 0，当前的移动应该转为向被击中方向上的移动</strong>
<code>player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>is_attacked(angle, damage) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.radius -= damage;  <span style="color:#007f7f">// 受伤，半径减少
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.radius &lt; <span style="color:#ff0;font-weight:bold">10</span>) { <span style="color:#007f7f">// 当半径小于10像素时，代表死亡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.destroy();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 开始执行击退效果
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.damage_vx = <span style="color:#fff;font-weight:bold">Math</span>.cos(angle);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.damage_vy = <span style="color:#fff;font-weight:bold">Math</span>.sin(angle);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.damage_speed = damage * <span style="color:#ff0;font-weight:bold">100</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.speed *= <span style="color:#ff0;font-weight:bold">0.5</span>;  <span style="color:#007f7f">// 被击中以后移动速度减半
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span><span style="display:flex;"><span>update() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.damage_speed &gt; <span style="color:#fff;font-weight:bold">this</span>.eps) {   <span style="color:#007f7f">// 当前仍处于击退效果中
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.vx = <span style="color:#fff;font-weight:bold">this</span>.vy = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.move_length = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.x += <span style="color:#fff;font-weight:bold">this</span>.damage_vx * <span style="color:#fff;font-weight:bold">this</span>.damage_speed * <span style="color:#fff;font-weight:bold">this</span>.timedelta / <span style="color:#ff0;font-weight:bold">1000</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.y += <span style="color:#fff;font-weight:bold">this</span>.damage_vy * <span style="color:#fff;font-weight:bold">this</span>.damage_speed * <span style="color:#fff;font-weight:bold">this</span>.timedelta / <span style="color:#ff0;font-weight:bold">1000</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.damage_speed *= <span style="color:#fff;font-weight:bold">this</span>.friction; <span style="color:#007f7f">// 击退速度乘以摩擦系数，已达到削减的目的
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="被击中以后的粒子效果特效">被击中以后的粒子效果特效</h2>
<p>实现逻辑：被击中以后，在玩家附近随机生成一些粒子小球</p>
<p>因此我们要先实现 粒子小球 对象</p>
<p><code>static/js/src/playground/particle/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Particle <span style="color:#fff;font-weight:bold">extends</span> AcGameObject {
</span></span><span style="display:flex;"><span>    constructor(playground, x, y, radius, vx, vy, color, speed) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.playground = playground;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx = <span style="color:#fff;font-weight:bold">this</span>.playground.game_map.ctx;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.x = x;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.y = y;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.radius = radius;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.vx = vx;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.vy = vy;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.color = color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.speed = speed;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.friction = <span style="color:#ff0;font-weight:bold">0.9</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    start() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    update() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.speed &lt; <span style="color:#fff;font-weight:bold">this</span>.eps) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.destroy;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.x += <span style="color:#fff;font-weight:bold">this</span>.vx * <span style="color:#fff;font-weight:bold">this</span>.speed * <span style="color:#fff;font-weight:bold">this</span>.timedelta / <span style="color:#ff0;font-weight:bold">1000</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.y += <span style="color:#fff;font-weight:bold">this</span>.vy * <span style="color:#fff;font-weight:bold">this</span>.speed * <span style="color:#fff;font-weight:bold">this</span>.timedelta / <span style="color:#ff0;font-weight:bold">1000</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.speed *= <span style="color:#fff;font-weight:bold">this</span>.friction;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.render();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    render() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.beginPath();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.arc(<span style="color:#fff;font-weight:bold">this</span>.x, <span style="color:#fff;font-weight:bold">this</span>.y, <span style="color:#fff;font-weight:bold">this</span>.radius, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">2</span> * <span style="color:#fff;font-weight:bold">Math</span>.PI, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fillStyle = <span style="color:#fff;font-weight:bold">this</span>.color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fill();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><p>然后我们在被击退功能模块，实现生成粒子小球的效果</p>
<ul>
<li>粒子小球释放弧度为 $[0,2π)$ 的随机数
<ul>
<li>粒子小球的 x, y 分量比率根据弧度来设定</li>
</ul>
</li>
<li>粒子小球的起始坐标应与玩家的坐标相同</li>
<li>粒子小球的颜色与玩家颜色相同</li>
<li>粒子小球的速度为玩家移动速度的 $10$ 倍</li>
</ul>
<p><code>js/src/playground/player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>is_attacked(angle, damage) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 粒子小球效果
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">10</span> + <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#ff0;font-weight:bold">5</span>; i ++ ) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> x = <span style="color:#fff;font-weight:bold">this</span>.x, y = <span style="color:#fff;font-weight:bold">this</span>.y;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> radius = <span style="color:#fff;font-weight:bold">this</span>.radius * <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#ff0;font-weight:bold">0.1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> angle = <span style="color:#ff0;font-weight:bold">2</span> * <span style="color:#fff;font-weight:bold">Math</span>.PI * <span style="color:#fff;font-weight:bold">Math</span>.random();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> vx = <span style="color:#fff;font-weight:bold">Math</span>.cos(angle), vy = <span style="color:#fff;font-weight:bold">Math</span>.sin(angle);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> color = <span style="color:#fff;font-weight:bold">this</span>.color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> speed = <span style="color:#fff;font-weight:bold">this</span>.speed * <span style="color:#ff0;font-weight:bold">10</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Particle(<span style="color:#fff;font-weight:bold">this</span>.playground, x, y, radius, vx, vy, color, speed);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="一些小优化">一些小优化</h2>
<h3 id="人机随机颜色">人机随机颜色</h3>
<p><code>js/src/playground/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>constructor(root) {
</span></span><span style="display:flex;"><span>    ......
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 创建好 5 个人机
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">5</span>; i ++ ) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.players.push(<span style="color:#fff;font-weight:bold">new</span> Player(<span style="color:#fff;font-weight:bold">this</span>, <span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.05</span>, <span style="color:#fff;font-weight:bold">this</span>.get_random_color(), <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.15</span>, <span style="color:#fff;font-weight:bold">false</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ......
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>get_random_color() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> colors = [<span style="color:#0ff;font-weight:bold">&#34;blue&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;red&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;pink&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;grey&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;green&#34;</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> colors[<span style="color:#fff;font-weight:bold">Math</span>.floor(<span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#ff0;font-weight:bold">5</span>)];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="人机ai随机攻击操作">人机AI随机攻击操作</h3>
<p><code>js/src/playground/player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>constructor (...) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.spent_time = <span style="color:#ff0;font-weight:bold">0</span>;    <span style="color:#007f7f">// 初始人机冷却攻击时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>update() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.spent_time += <span style="color:#fff;font-weight:bold">this</span>.timedelta / <span style="color:#ff0;font-weight:bold">1000</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (!<span style="color:#fff;font-weight:bold">this</span>.is_me &amp;&amp; <span style="color:#fff;font-weight:bold">this</span>.spent_time &gt; <span style="color:#ff0;font-weight:bold">4</span> &amp;&amp; <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#ff0;font-weight:bold">180</span> &lt; <span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> player = <span style="color:#fff;font-weight:bold">this</span>.playground.players[<span style="color:#fff;font-weight:bold">Math</span>.floor(<span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#fff;font-weight:bold">this</span>.playground.players.length)];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.shoot_fireball(player.x, player.y);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="部署nginx与对接acappஐ">部署nginx与对接acappஐ</h1>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/3257028/">5. 部署nginx与对接acapp | 讲义</a></li>
<li><a href="https://www.acwing.com/solution/content/79244/">5.1 上课笔记 | Andrew1729</a></li>
<li><a href="https://www.acwing.com/solution/content/78903/">5.1. 上课笔记 | 菊花</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/364622127">Ngnix 介绍</a></li>
<li><a href="https://www.jianshu.com/p/36187963b553">nginx 和uwsgi的区别与作用</a></li>
</ul>
<hr>
<h2 id="nginx是什么">Nginx是什么？</h2>
<blockquote>
<p><strong>Nginx是一款自由的、开源的、高性能的HTTP服务器和反向代理服务器</strong></p>
<p><strong>Nginx可以作为一个HTTP服务器进行网站的发布处理，另外Nginx可以作为反向代理进行负载均衡的实现</strong></p>
<p><strong>Nginx中HttpUwsgiModule的作用是与uWSGI服务器进行交换</strong></p>
</blockquote>
<h2 id="uwsgi是什么">uWSGI是什么？</h2>
<blockquote>
<p><strong>uWSGI是一个全功能的HTTP服务器，实现了WSGI、uwsgi、http等协议</strong></p>
<p><strong>它要做的就是把HTTP协议转化成语言支持的网络协议。比如把HTTP协议转化成WSGI协议，让Python可以直接使用</strong></p>
<p><strong>WSGI协议是Python 语言定义的 Web 服务器和 Web 应用程序或框架之间的一种简单而通用的接口</strong></p>
<p><strong>简单来说uWSGI就是用来沟通nginx和django的一座桥梁</strong></p>
</blockquote>
<h2 id="nginxuwsgidiango-工作流程">Nginx+uWSGI+Diango 工作流程</h2>
<blockquote>
<p><strong><code>nginx</code> 是对外的服务接口，外部浏览器通过<code>url</code>访问<code>nginx</code></strong></p>
<p><strong><code>nginx</code> 接收到浏览器发送过来的<code>http</code>请求，将包进行解析</strong></p>
<p><strong>分析<code>url</code>，如果是静态文件请求就直接访问用户给<code>nginx</code>配置的静态文件目录，直接返回用户请求的静态文件</strong></p>
<p><strong>如果不是静态文件，而是一个动态的请求，那么<code>nginx</code>就将请求转发给<code>uwsgi</code>，<code>uwsgi</code> 接收到请求之后将包进行处理，处理成<code>wsgi</code>可以接受的格式，并发给<code>wsgi</code>，<code>wsgi</code> 根据请求调用应用程序的某个文件，某个文件的某个函数，最后处理完将返回值再次交给<code>wsgi</code>，<code>wsgi</code>将返回值进行打包，打包成<code>uwsgi</code>能够接收的格式，<code>uwsgi</code>接收<code>wsgi</code> 发送的请求，并转发给<code>nginx</code>, <code>nginx</code>最终将返回值返回给浏览器</strong></p>
</blockquote>
<h2 id="uwsgi服务的开启关闭">uwsgi服务的开启&amp;&amp;关闭</h2>
<ul>
<li>在<code>~/acapp</code>启动uwsgi服务：<strong><code>uwsgi --ini scripts/uwsgi.ini</code></strong></li>
<li>关闭uwsgi服务：<code>sudo pkill -f uwsgi -9</code></li>
</ul>
<h2 id="针对-acapp-的优化">针对 acapp 的优化</h2>
<h3 id="打包脚本优化">打包脚本优化</h3>
<p>由于现在 <strong>发布版本的脚本文件</strong> 用的是打包在根目录里的 <strong>static</strong> 文件夹</p>
<p>每次修改好 <strong>static</strong> 文件夹后，不仅需要对 <strong>js</strong> 文件打包，还需要对 <strong>static</strong> 文件夹打包</p>
<p>不放把 &ldquo;将static文件夹打包&rdquo; 的 <strong>shell</strong> 代码一起加入 <strong>js</strong> 打包脚本中，从而实现一键打包</p>
<p><code>scripts/compress_game_js.sh</code></p>
<pre tabindex="0"><code>#! /bin/bash

JS_PATH=/home/acs/acapp/game/static/js/
JS_PATH_DIST=${JS_PATH}dist/
JS_PATH_SRC=${JS_PATH}src/

find $JS_PATH_SRC -type f -name &#39;*.js&#39; | sort | xargs cat &gt; ${JS_PATH_DIST}game.js

echo &#34;yes&#34; | python3 manage.py collectstatic
</code></pre><h3 id="鼠标点击事件的相对偏移">鼠标点击事件的相对偏移</h3>
<p>由于写游戏界面的时候，玩家移动是按照鼠标相对于当前整个浏览器取的位置参数 <code>e.clientX</code></p>
<p>而 <code>acapp</code> 里，每个应用是一个小窗口，鼠标点击位置的参数应当是 <strong>相对于整个游戏窗口的位置参数</strong></p>
<p>所有会导致出现，点击的位置与移动的位置不同，这里需要做出小优化</p>
<p>优化的逻辑 :</p>
<ol>
<li>$clientX−窗口左侧到浏览器左侧的距离=玩家的目标X$</li>
<li>$clientY−窗口上侧到浏览器上侧的距离=玩家的目标Y$
这就要用到一个 <code>js</code> 的 <code>API</code> 了 : <code>getBoundingClientRect()</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>rectObject = object.getBoundingClientRect();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>rectObject.top : 元素上边到视窗上边的距离;
</span></span><span style="display:flex;"><span>rectObject.right : 元素右边到视窗左边的距离;
</span></span><span style="display:flex;"><span>rectObject.bottom : 元素下边到视窗上边的距离;
</span></span><span style="display:flex;"><span>rectObject.left : 元素左边到视窗左边的距离;
</span></span><span style="display:flex;"><span>rectObject.width : 是元素自身的宽
</span></span><span style="display:flex;"><span>rectObject.height : 是元素自身的高
</span></span></code></pre></div><p><code>player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span> add_listening_events() {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.playground.game_map.$canvas.mousedown(<span style="color:#fff;font-weight:bold">function</span>(e) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 创建 rect 对象
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">const</span> rect = outer.ctx.canvas.getBoundingClientRect();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (e.which === <span style="color:#ff0;font-weight:bold">3</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 调整偏移量
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            outer.move_to(e.clientX - rect.left, e.clientY - rect.top);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (e.which === <span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (outer.cur_skill === <span style="color:#0ff;font-weight:bold">&#34;fireball&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 调整偏移量
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                outer.shoot_fireball(e.clientX - rect.left, e.clientY - rect.top);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h3 id="将菜单界面重新设为主界面">将菜单界面重新设为主界面</h3>
<p><code>js/zbase.js</code> 的注释取消，使之创建出 <strong>menu</strong> 对象</p>
<p><code>js/playground/zbase.js</code> 的注释取消，并设置逻辑，让 <strong>playground</strong> 打开后，才进行游戏界面初始化</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGamePlayground {
</span></span><span style="display:flex;"><span>    constructor(root) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.root = root;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$playground = $(<span style="color:#0ff;font-weight:bold">`&lt;div class=&#34;ac-game-playground&#34;&gt;&lt;/div&gt;`</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.hide();    <span style="color:#007f7f">// 初始时隐藏
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// 游戏界面生成代码在下面展示 playground 时执行
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.start();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    show() {    <span style="color:#007f7f">// 打开 playground 界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.$playground.show();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 开始生成游戏界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.root.$ac_game.append(<span style="color:#fff;font-weight:bold">this</span>.$playground);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.width = <span style="color:#fff;font-weight:bold">this</span>.$playground.width();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.height = <span style="color:#fff;font-weight:bold">this</span>.$playground.height();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.game_map = <span style="color:#fff;font-weight:bold">new</span> GameMap(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.players = [];  <span style="color:#007f7f">// 存放当前游戏中的所有玩家
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// 将玩家加入游戏中
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.players.push(<span style="color:#fff;font-weight:bold">new</span> Player(<span style="color:#fff;font-weight:bold">this</span>, <span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.05</span>, <span style="color:#0ff;font-weight:bold">&#34;white&#34;</span>, <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.15</span>, <span style="color:#fff;font-weight:bold">true</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 创建好 5 个人机
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">5</span>; i ++ ) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.players.push(<span style="color:#fff;font-weight:bold">new</span> Player(<span style="color:#fff;font-weight:bold">this</span>, <span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height / <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.05</span>, <span style="color:#fff;font-weight:bold">this</span>.get_random_color(), <span style="color:#fff;font-weight:bold">this</span>.height * <span style="color:#ff0;font-weight:bold">0.15</span>, <span style="color:#fff;font-weight:bold">false</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="调整-css-文件适应窗口">调整 css 文件，适应窗口</h3>
<p>在设置 <code>web</code> 网页的时候，有些设置了绝对值，可能对于窗口化的 <code>acapp</code> 显示效果差</p>
<p>将他们修改成相对数值</p>
<p><code>game.css</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>.ac-game-menu-field {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    top: <span style="color:#ff0;font-weight:bold">40</span>%;
</span></span><span style="display:flex;"><span>    left: <span style="color:#ff0;font-weight:bold">20</span>%;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.ac-game-menu-field-item {
</span></span><span style="display:flex;"><span>    height: <span style="color:#ff0;font-weight:bold">6</span>vh;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    font-size: <span style="color:#ff0;font-weight:bold">4</span>vh;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h1 id="创建账号系统">创建账号系统</h1>
<p><a href="https://www.acwing.com/file_system/file/content/whole/index/content/3294700/">6. 创建账号系统 | 讲义</a></p>
<hr>
<h2 id="用户名密码登录">用户名密码登录</h2>
<ul>
<li><a href="https://www.acwing.com/blog/content/12373/">6.1 用户名密码登录 | 讲义</a></li>
<li><a href="https://www.acwing.com/solution/content/79314/">6.1 上课笔记 | Andrew1729</a></li>
<li><a href="https://www.acwing.com/solution/content/75831/">6.1 上课笔记 | 吃饱喝足不学习</a></li>
</ul>
<hr>
<h3 id="客户端请求与django响应流程">客户端请求与Django响应流程</h3>
<blockquote>
<p><strong>用户在客户端通过<code>$.ajax</code>发送请求，根据<code>urls</code>路由到对应的<code>views</code>中的函数，处理<code>request</code>后返回<code>JsonResponse</code> 至客户端</strong></p>
</blockquote>
<h3 id="前期准备工作">前期准备工作</h3>
<p>做开发，先开启调试模式，如果不开启，服务器一旦运行错误，就只返回 <code>Error</code> 报错
<code>settings.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>DEBUG = <span style="color:#fff;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>不过 <code>django</code> 自带的 <code>User</code> 表并不能满足我们的需求，因此我们需要自己额外建表</p>
<h3 id="创建用户表">创建用户表</h3>
<p>所有的数据表都存在 <code>models</code> 里</p>
<p>我们在 <code>models</code> 里创建一个 <code>player</code> 文件夹，用于存储所有的 <code>player</code> 相关的表</p>
<p>然后对文件夹初始化 <code>__init__.py</code>，接着扩充成一个我们需要的数据表</p>
<p><code>game/models/player/player.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.db <span style="color:#fff;font-weight:bold">import</span> models
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.contrib.auth.models <span style="color:#fff;font-weight:bold">import</span> User
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Player(models.Model): <span style="color:#007f7f"># Player 类继承自 Model 类</span>
</span></span><span style="display:flex;"><span>    user = models.OneToOneField(User, on_delete=models.CASCADE)
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># 说明Player是从User表扩充过来的，每一个player都与一个user是一一对应关联关系</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># 后一个参数是指，当user被删除后，对应的player也要被删除</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># （感觉就是外键的意思）</span>
</span></span><span style="display:flex;"><span>    photo = models.URLField(max_length=<span style="color:#ff0;font-weight:bold">256</span>, blank=<span style="color:#fff;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># 用于存储用户的头像的url</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># 指定每个player数据展示在前台的数据</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __str__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">str</span>(self.user)    <span style="color:#007f7f"># 展示用户的用户名</span>
</span></span></code></pre></div><p>将定义的表，注册到后台 <code>admin</code> 页面中</p>
<p><code>game/admin.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> game.models.player.player <span style="color:#fff;font-weight:bold">import</span> Player
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>admin.site.register(Player)
</span></span></code></pre></div><p>然后将创建的数据表更新到 <code>django</code> 的数据库中去</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f00">$</span> python3 manage.py makemigrations
</span></span><span style="display:flex;"><span>&gt; Migrations <span style="color:#fff;font-weight:bold">for</span> <span style="color:#0ff;font-weight:bold">&#39;game&#39;</span>:
</span></span><span style="display:flex;"><span>&gt;   game/migrations/<span style="color:#ff0;font-weight:bold">0001</span>_initial.py
</span></span><span style="display:flex;"><span>&gt;     - Create model Player
</span></span><span style="display:flex;"><span><span style="color:#f00">$</span> 
</span></span><span style="display:flex;"><span><span style="color:#f00">$</span> python3 manage.py migrate
</span></span><span style="display:flex;"><span>&gt; Operations to perform:
</span></span><span style="display:flex;"><span>&gt;   Apply <span style="color:#fff;font-weight:bold">all</span> migrations: admin, auth, contenttypes, game, sessions
</span></span><span style="display:flex;"><span>&gt; Running migrations:
</span></span><span style="display:flex;"><span>&gt;   Applying game<span style="color:#ff0;font-weight:bold">.0001</span>_initial... OK
</span></span></code></pre></div><p>然后重启一下服务，就可以在管理员页面看到新建的数据库了</p>
<h3 id="实现客户端的类型判别acapp-or-web">实现客户端的类型判别（ACAPP or WEB）</h3>
<p>由于我们实现的项目是前后端分离类型，因此对于不同的客户端，前端要控制生成不同的页面</p>
<p>为了增强扩展性，故这里要实现客户端类型的判别</p>
<p><strong>y总</strong> 已经提前写好了 <strong>ACAPP</strong> 的接口，如果用户用的是 <strong>ACAPP</strong> 访问，则在新建对象 <strong>ac_game</strong> 时，会额外传递一个参数</p>
<p>我们只需按照这个接口去完成扩充即可</p>
<blockquote>
<p><strong>之后写小程序之类的同理，额外传一个接口</strong></p>
</blockquote>
<p><code>js/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">export</span> <span style="color:#fff;font-weight:bold">class</span> AcGame {
</span></span><span style="display:flex;"><span>    constructor(id, AcWingOS) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.id = id;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$ac_game = $(<span style="color:#0ff;font-weight:bold">&#39;#&#39;</span> + id);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.AcWingOS = AcWingOS;   <span style="color:#007f7f">//如果是acapp端，该变量就会带着一系列y总提供的接口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.menu = <span style="color:#fff;font-weight:bold">new</span> AcGameMenu(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.playground = <span style="color:#fff;font-weight:bold">new</span> AcGamePlayground(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.start();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    start() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="构建登录功能框架">构建登录功能框架</h3>
<p>基本逻辑 : 用户访问页面 -&gt; 进入登录页面 -&gt; 提交登录信息 -&gt; 核对登录信息 -&gt; 返回登陆结果和其他信息</p>
<p>每实现一个函数，就需要实现三个部分：</p>
<ol>
<li><code>views</code> : 实现具体的调用数据库的逻辑</li>
<li><code>urls</code> : 实现一个路由</li>
<li><code>js</code> : 前端实现GET上述接口的过程</li>
</ol>
<p>欲实现流程 :</p>
<ol>
<li>用户访问网站，通过先前完成的路由，访问到 <code>web.html </code></li>
<li><code>web.html</code> 中的 <code>js</code> 部分创建了一个 <code>AcGame</code> 对象</li>
<li><code>AcGame</code> 对象创建的过程中，生成了 <code>Settings</code> 对象</li>
<li><code>Settings</code> 对象创建完成后，调用 <code>Settings.start()</code> 函数</li>
<li><code>Settings.start()</code> 函数调用了 <code>Settings.getinfo()</code> 函数</li>
<li><code>Settings.getinfo()</code> 函数中执行了 <code>ajax</code> 向 <code>getinfo</code> 接口发起一个含参数 <code>platform</code> 的 <code>GET</code> 请求</li>
<li>通过 <code>urls</code> 路由的实现，最终定位到 <code>views/settings/getinfo.py</code> 文件的 <code>getinfo(request)</code> 函数</li>
<li>根据传递过来的 <code>platform</code> 函数，实现不同的 <code>JsonResponse</code> 返回</li>
<li><code>Settings.getinfo()</code> 接受到了 <code>response</code> 完成上述基本逻辑</li>
</ol>
<h4 id="views">views</h4>
<p><code>views/settings/getinfo.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.http <span style="color:#fff;font-weight:bold">import</span> JsonResponse
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> game.models.player.player <span style="color:#fff;font-weight:bold">import</span> Player
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> getinfo_acapp(request):
</span></span><span style="display:flex;"><span>    player = Player.objects.all()[<span style="color:#ff0;font-weight:bold">0</span>]    <span style="color:#007f7f"># 取出数据库中第一个用户(调试该功能)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;username&#39;</span>: player.user.username,
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;photo&#39;</span>: player.photo,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> getinfo_web(request):
</span></span><span style="display:flex;"><span>    player = Player.objects.all()[<span style="color:#ff0;font-weight:bold">0</span>]    <span style="color:#007f7f"># 取出数据库中第一个用户(调试该功能)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;username&#39;</span>: player.user.username,
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;photo&#39;</span>: player.photo,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> getinfo(request):   <span style="color:#007f7f"># 处理请求</span>
</span></span><span style="display:flex;"><span>    platform = request.GET.get(<span style="color:#0ff;font-weight:bold">&#39;platform&#39;</span>)  <span style="color:#007f7f"># 根据请求的平台不同，进行不同返回处理</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> platform == <span style="color:#0ff;font-weight:bold">&#34;ACAPP&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getinfo_acapp(request)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">elif</span> platform == <span style="color:#0ff;font-weight:bold">&#34;WEB&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getinfo_web(request)
</span></span></code></pre></div><h4 id="urls">urls</h4>
<p><code>urls/settings/index.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.urls <span style="color:#fff;font-weight:bold">import</span> path
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> game.views.settings.getinfo <span style="color:#fff;font-weight:bold">import</span> getinfo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urlpatterns = [
</span></span><span style="display:flex;"><span>    path(<span style="color:#0ff;font-weight:bold">&#34;getinfo/&#34;</span>, getinfo, name=<span style="color:#0ff;font-weight:bold">&#34;settings_getinfo&#34;</span>),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>路由建立好以后，访问 <code>xxxx/settings/getinfo</code>，可以看到 <code>getinfo.py</code> 返回的 <code>JSON</code> 类型的 <code>JSONResponse</code></p>
<h4 id="js">js</h4>
<p>网页刚访问时，应先将 <code>menu</code> 关闭，然后打开登录界面，随意先修改一个让 <code>menu</code> 初始关闭</p>
<p><code>static/js/src/menu/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGameMenu {
</span></span><span style="display:flex;"><span>    constructor(root) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$menu.hide();
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><p><code>static/js/src/settings/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Settings {
</span></span><span style="display:flex;"><span>    constructor(root) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.root = root;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.platform = <span style="color:#0ff;font-weight:bold">&#34;WEB&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.root.AcWingOS) <span style="color:#fff;font-weight:bold">this</span>.platform = <span style="color:#0ff;font-weight:bold">&#34;ACAPP&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.start();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    start() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.getinfo();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    register() {    <span style="color:#007f7f">// 打开注册界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    }
</span></span><span style="display:flex;"><span>    login() {       <span style="color:#007f7f">// 打开登录界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    }
</span></span><span style="display:flex;"><span>    getinfo() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>        $.ajax({
</span></span><span style="display:flex;"><span>            url: <span style="color:#0ff;font-weight:bold">&#34;https://app1117.acapp.acwing.com.cn/settings/getinfo/&#34;</span>,
</span></span><span style="display:flex;"><span>            type: <span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>,
</span></span><span style="display:flex;"><span>            data: {
</span></span><span style="display:flex;"><span>                platform: outer.platform,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            success: <span style="color:#fff;font-weight:bold">function</span>(resp) {
</span></span><span style="display:flex;"><span>                console.log(resp);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (resp.result === <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>) {    <span style="color:#007f7f">// 登录成功，关闭登录界面，打开主菜单
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                    outer.hide();
</span></span><span style="display:flex;"><span>                    outer.root.menu.show();
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                    outer.login();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    hide() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    show() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>然后不要忘记在 <code>根js</code> 下创建对象</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">export</span> <span style="color:#fff;font-weight:bold">class</span> AcGame {
</span></span><span style="display:flex;"><span>    constructor(id, AcWingOS) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.settings = <span style="color:#fff;font-weight:bold">new</span> Settings(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这样基本框架就完成了</p>
<h4 id="完善-http-请求的函数">完善 HTTP 请求的函数</h4>
<p>如果用户未登录，返回信息 &ldquo;not login&rdquo;</p>
<p>如果用户登录，返回信息 &ldquo;success&rdquo; 以及用户名和头像</p>
<p><code>views/setting/getinfo.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> getinfo_web(request):
</span></span><span style="display:flex;"><span>    user = request.user
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> not user.is_authenticated:   <span style="color:#007f7f"># 未登录</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;not login&#34;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span>:                           <span style="color:#007f7f"># 已登录</span>
</span></span><span style="display:flex;"><span>        player = Player.objects.get(user=user)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;username&#39;</span>: player.user.username,
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;photo&#39;</span>: player.photo,
</span></span><span style="display:flex;"><span>        })
</span></span></code></pre></div><p>注意前后台是一个登录系统，因此要先退掉后台，再测试</p>
<h3 id="将用户头像渲染到玩家上">将用户头像渲染到玩家上</h3>
<p>将返回的 <code>JsonResponse</code> 存到 <code>Settings</code> 类的变量中
<code>settings/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Settings {
</span></span><span style="display:flex;"><span>    constructor(root) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.username = <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.photo = <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    getinfo() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>        $.ajax({
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>            success: <span style="color:#fff;font-weight:bold">function</span>(resp) {
</span></span><span style="display:flex;"><span>                ...
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (resp.result === <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>) {
</span></span><span style="display:flex;"><span>                    outer.username = resp.username;
</span></span><span style="display:flex;"><span>                    outer.photo = resp.photo;
</span></span><span style="display:flex;"><span>                    ...
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                ..
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>然后在 <code>Player</code> 里把用户的头像渲染到对应的玩家上</p>
<p><code>playground/player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Player {
</span></span><span style="display:flex;"><span>    constructor(...) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.img = <span style="color:#fff;font-weight:bold">new</span> Image();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.img.src = <span style="color:#fff;font-weight:bold">this</span>.playground.root.settings.photo;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    render() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.is_me) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.save();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.beginPath();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.arc(<span style="color:#fff;font-weight:bold">this</span>.x, <span style="color:#fff;font-weight:bold">this</span>.y, <span style="color:#fff;font-weight:bold">this</span>.radius, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#fff;font-weight:bold">Math</span>.PI * <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.stroke();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.clip();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.drawImage(<span style="color:#fff;font-weight:bold">this</span>.img, <span style="color:#fff;font-weight:bold">this</span>.x - <span style="color:#fff;font-weight:bold">this</span>.radius, <span style="color:#fff;font-weight:bold">this</span>.y - <span style="color:#fff;font-weight:bold">this</span>.radius, 
</span></span><span style="display:flex;"><span>                               <span style="color:#fff;font-weight:bold">this</span>.radius * <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">this</span>.radius * <span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.restore();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.beginPath();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.arc(<span style="color:#fff;font-weight:bold">this</span>.x, <span style="color:#fff;font-weight:bold">this</span>.y, <span style="color:#fff;font-weight:bold">this</span>.radius, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">2</span> * <span style="color:#fff;font-weight:bold">Math</span>.PI, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.fillStyle = <span style="color:#fff;font-weight:bold">this</span>.color;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.fill();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="实现登录界面的前端">实现登录界面的前端</h3>
<p>先完成登录界面显示的逻辑</p>
<p><code>settings/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Settings {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    register() {  <span style="color:#007f7f">// 打开注册界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.$login.hide();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register.show();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    login() {  <span style="color:#007f7f">// 打开登录界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.$register.hide();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login.show();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    hide() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$settings.hide();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    show() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$settings.show();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="实现前端的基础框架">实现前端的基础框架</h4>
<p><code>settings/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Settings {
</span></span><span style="display:flex;"><span>    constructor(root) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$settings = $(<span style="color:#0ff;font-weight:bold">`
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&lt;div class=&#34;ac-game-settings&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">    &lt;div class=&#34;ac-game-settings-login&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-title&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            登录
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-username&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;div class=&#34;ac-game-settings-item&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">                &lt;input type=&#34;text&#34; placeholder=&#34;用户名&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-password&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;div class=&#34;ac-game-settings-item&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">                &lt;input type=&#34;password&#34; placeholder=&#34;密码&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-submit&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;div class=&#34;ac-game-settings-item&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">                &lt;button&gt;登录&lt;/button&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-error-message&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-option&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            注册
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-acwing&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;img width=&#34;30&#34; src=&#34;https://app165.acapp.acwing.com.cn/static/image/settings/acwing_logo.png&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">                AcWing一键登录
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">    &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">    &lt;div class=&#34;ac-game-settings-register&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-title&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            注册
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-username&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;div class=&#34;ac-game-settings-item&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">                &lt;input type=&#34;text&#34; placeholder=&#34;用户名&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-password ac-game-settings-password-first&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;div class=&#34;ac-game-settings-item&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">                &lt;input type=&#34;password&#34; placeholder=&#34;密码&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-password ac-game-settings-password-second&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;div class=&#34;ac-game-settings-item&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">                &lt;input type=&#34;password&#34; placeholder=&#34;确认密码&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-submit&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;div class=&#34;ac-game-settings-item&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">                &lt;button&gt;注册&lt;/button&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-error-message&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-option&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            登录
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;div class=&#34;ac-game-settings-acwing&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;img width=&#34;30&#34; src=&#34;https://app165.acapp.acwing.com.cn/static/image/settings/acwing_logo.png&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">                AcWing一键登录
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">    &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">`</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login = <span style="color:#fff;font-weight:bold">this</span>.$settings.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-login&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login_username = <span style="color:#fff;font-weight:bold">this</span>.$login.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-username input&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login_password = <span style="color:#fff;font-weight:bold">this</span>.$login.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-password input&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login_submit = <span style="color:#fff;font-weight:bold">this</span>.$login.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-submit button&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login_error_message = <span style="color:#fff;font-weight:bold">this</span>.$login.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-error-message&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login_register = <span style="color:#fff;font-weight:bold">this</span>.$login.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-option&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login.hide();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register = <span style="color:#fff;font-weight:bold">this</span>.$settings.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-register&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register_username = <span style="color:#fff;font-weight:bold">this</span>.$register.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-username input&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register_password = <span style="color:#fff;font-weight:bold">this</span>.$register.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-password-first input&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register_password_confirm = <span style="color:#fff;font-weight:bold">this</span>.$register.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-password-second input&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register_submit = <span style="color:#fff;font-weight:bold">this</span>.$register.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-submit button&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register_error_message = <span style="color:#fff;font-weight:bold">this</span>.$register.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-error-message&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register_login = <span style="color:#fff;font-weight:bold">this</span>.$register.find(<span style="color:#0ff;font-weight:bold">&#34;.ac-game-settings-option&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register.hide();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.root.$ac_game.append(<span style="color:#fff;font-weight:bold">this</span>.$settings);
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>对应的 <code>css</code> 文件部分：</p>
<p><code>css/game.css</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>.ac-game-settings {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">width</span>: <span style="color:#ff0;font-weight:bold">100</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">height</span>: <span style="color:#ff0;font-weight:bold">100</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">background-image</span>: <span style="color:#fff;font-weight:bold">url</span>(<span style="color:#0ff;font-weight:bold">&#34;/static/image/menu/background.gif&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">background-size</span>: <span style="color:#ff0;font-weight:bold">100</span><span style="color:#fff;font-weight:bold">%</span> <span style="color:#ff0;font-weight:bold">100</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">user-select</span>: <span style="color:#fff;font-weight:bold">none</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-login {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">height</span>: <span style="color:#ff0;font-weight:bold">41</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">width</span>: <span style="color:#ff0;font-weight:bold">20</span><span style="color:#fff;font-weight:bold">vw</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">position</span>: <span style="color:#fff;font-weight:bold">relative</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">top</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">left</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">transform</span>: <span style="color:#fff;font-weight:bold">translate</span>(<span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>, <span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">background-color</span>: <span style="color:#fff;font-weight:bold">rgba</span>(<span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0.7</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">border-radius</span>: <span style="color:#ff0;font-weight:bold">5</span><span style="color:#fff;font-weight:bold">px</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-title {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">color</span>: <span style="color:#fff;font-weight:bold">white</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">font-size</span>: <span style="color:#ff0;font-weight:bold">3</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">text-align</span>: <span style="color:#fff;font-weight:bold">center</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">padding-top</span>: <span style="color:#ff0;font-weight:bold">2</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">margin-bottom</span>: <span style="color:#ff0;font-weight:bold">2</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-username {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">block</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">height</span>: <span style="color:#ff0;font-weight:bold">7</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-password {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">block</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">height</span>: <span style="color:#ff0;font-weight:bold">7</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-submit {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">block</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">height</span>: <span style="color:#ff0;font-weight:bold">7</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-acwing {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">block</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">height</span>: <span style="color:#ff0;font-weight:bold">7</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-item {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">width</span>: <span style="color:#ff0;font-weight:bold">100</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">height</span>: <span style="color:#ff0;font-weight:bold">100</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-item &gt; <span style="font-weight:bold">input</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">width</span>: <span style="color:#ff0;font-weight:bold">90</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">line-height</span>: <span style="color:#ff0;font-weight:bold">3</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">position</span>: <span style="color:#fff;font-weight:bold">relative</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">top</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">left</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">transform</span>: <span style="color:#fff;font-weight:bold">translate</span>(<span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>, <span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-item &gt; <span style="font-weight:bold">button</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">color</span>: <span style="color:#fff;font-weight:bold">white</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">width</span>: <span style="color:#ff0;font-weight:bold">90</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">line-height</span>: <span style="color:#ff0;font-weight:bold">3</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">position</span>: <span style="color:#fff;font-weight:bold">relative</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">top</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">left</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">transform</span>: <span style="color:#fff;font-weight:bold">translate</span>(<span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>, <span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">background-color</span>: <span style="color:#ff0;font-weight:bold">#4CAF50</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">border-radius</span>: <span style="color:#ff0;font-weight:bold">5</span><span style="color:#fff;font-weight:bold">px</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-error-message {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">color</span>: <span style="color:#fff;font-weight:bold">red</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">font-size</span>: <span style="color:#ff0;font-weight:bold">0.8</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">inline</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">float</span>: <span style="color:#fff;font-weight:bold">left</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">padding-left</span>: <span style="color:#ff0;font-weight:bold">1</span><span style="color:#fff;font-weight:bold">vw</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-option {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">color</span>: <span style="color:#fff;font-weight:bold">white</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">font-size</span>: <span style="color:#ff0;font-weight:bold">2</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">inline</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">float</span>: <span style="color:#fff;font-weight:bold">right</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">padding-right</span>: <span style="color:#ff0;font-weight:bold">1</span><span style="color:#fff;font-weight:bold">vw</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">cursor</span>: <span style="color:#fff;font-weight:bold">pointer</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-acwing &gt; <span style="font-weight:bold">img</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">position</span>: <span style="color:#fff;font-weight:bold">relative</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">top</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">left</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">transform</span>: <span style="color:#fff;font-weight:bold">translate</span>(<span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>, <span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">cursor</span>: <span style="color:#fff;font-weight:bold">pointer</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">block</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-acwing &gt; <span style="font-weight:bold">div</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">color</span>: <span style="color:#fff;font-weight:bold">white</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">font-size</span>: <span style="color:#ff0;font-weight:bold">1.5</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">text-align</span>: <span style="color:#fff;font-weight:bold">center</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">block</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.ac-game-settings-register {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">height</span>: <span style="color:#ff0;font-weight:bold">49</span><span style="color:#fff;font-weight:bold">vh</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">width</span>: <span style="color:#ff0;font-weight:bold">20</span><span style="color:#fff;font-weight:bold">vw</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">position</span>: <span style="color:#fff;font-weight:bold">relative</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">top</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">left</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">transform</span>: <span style="color:#fff;font-weight:bold">translate</span>(<span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>, <span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">background-color</span>: <span style="color:#fff;font-weight:bold">rgba</span>(<span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0.7</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">border-radius</span>: <span style="color:#ff0;font-weight:bold">5</span><span style="color:#fff;font-weight:bold">px</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="实现登录注册的相互切换">实现登录/注册的相互切换</h4>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Settings {
</span></span><span style="display:flex;"><span>    constructor(root) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    start() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.getinfo();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.add_listening_events();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    add_listening_events() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.add_listening_events_login();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.add_listening_events_register();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    add_listening_events_login() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login_register.click(<span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>            outer.register();   <span style="color:#007f7f">// 跳到注册界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    add_listening_events_register() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$register_login.click(<span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>            outer.login();      <span style="color:#007f7f">// 跳到登录界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="实现登录功能">实现登录功能</h3>
<p><code>views/settings/login.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.http <span style="color:#fff;font-weight:bold">import</span> JsonResponse
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.contrib.auth <span style="color:#fff;font-weight:bold">import</span> authenticate, login
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> signin(request):
</span></span><span style="display:flex;"><span>    data = request.GET
</span></span><span style="display:flex;"><span>    username = data.get(<span style="color:#0ff;font-weight:bold">&#39;username&#39;</span>)
</span></span><span style="display:flex;"><span>    password = data.get(<span style="color:#0ff;font-weight:bold">&#39;password&#39;</span>)
</span></span><span style="display:flex;"><span>    user = authenticate(username=username, password=password)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> not user:
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;用户名或密码不正确&#34;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    login(request, user)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>
</span></span><span style="display:flex;"><span>    })
</span></span></code></pre></div><p><code>urls/settings/index.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.urls <span style="color:#fff;font-weight:bold">import</span> path
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> game.views.settings.getinfo <span style="color:#fff;font-weight:bold">import</span> getinfo
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> game.views.settings.login <span style="color:#fff;font-weight:bold">import</span> signin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urlpatterns = [
</span></span><span style="display:flex;"><span>    path(<span style="color:#0ff;font-weight:bold">&#34;getinfo/&#34;</span>, getinfo, name=<span style="color:#0ff;font-weight:bold">&#34;settings_getinfo&#34;</span>),
</span></span><span style="display:flex;"><span>    path(<span style="color:#0ff;font-weight:bold">&#34;login/&#34;</span>, signin, name=<span style="color:#0ff;font-weight:bold">&#34;settings_login&#34;</span>),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p><code>settings/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Settings{
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    add_listening_events_login() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login_submit.click(<span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>            outer.login_on_remote();
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    login_on_remote() {     <span style="color:#007f7f">// 在远程服务器上登录
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> username = <span style="color:#fff;font-weight:bold">this</span>.$login_username.val();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> password = <span style="color:#fff;font-weight:bold">this</span>.$login_password.val();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$login_error_message.empty();
</span></span><span style="display:flex;"><span>        $.ajax({
</span></span><span style="display:flex;"><span>            url: <span style="color:#0ff;font-weight:bold">&#34;https://app1117.acapp.acwing.com.cn/settings/login/&#34;</span>,
</span></span><span style="display:flex;"><span>            type: <span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>,
</span></span><span style="display:flex;"><span>            data: {
</span></span><span style="display:flex;"><span>                username: username,
</span></span><span style="display:flex;"><span>                password: password,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            success: <span style="color:#fff;font-weight:bold">function</span>(resp) {
</span></span><span style="display:flex;"><span>                console.log(resp);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (resp.result === <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>) {
</span></span><span style="display:flex;"><span>                    location.reload();
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                    outer.$login_error_message.html(resp.result);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="实现登出功能">实现登出功能</h3>
<p><code>views/settings/logout.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.http <span style="color:#fff;font-weight:bold">import</span> JsonResponse
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.contrib.auth <span style="color:#fff;font-weight:bold">import</span> logout
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> signout(request):
</span></span><span style="display:flex;"><span>    user = request.user
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> not user.is_authenticated:
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>,
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    logout(request)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>,
</span></span><span style="display:flex;"><span>    })
</span></span></code></pre></div><p><code>urls/settings/index.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> game.views.settings.logout <span style="color:#fff;font-weight:bold">import</span> signout
</span></span><span style="display:flex;"><span>urlpatterns = [
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    path(<span style="color:#0ff;font-weight:bold">&#34;logout/&#34;</span>, signout, name=<span style="color:#0ff;font-weight:bold">&#34;settings_logout&#34;</span>),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p><code>settings/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>login_on_remote() {     <span style="color:#007f7f">// 在远程服务器上登录
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> username = <span style="color:#fff;font-weight:bold">this</span>.$login_username.val();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> password = <span style="color:#fff;font-weight:bold">this</span>.$login_password.val();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.$login_error_message.empty();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $.ajax({
</span></span><span style="display:flex;"><span>        url: <span style="color:#0ff;font-weight:bold">&#34;https://app1117.acapp.acwing.com.cn/settings/login/&#34;</span>,
</span></span><span style="display:flex;"><span>        type: <span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>,
</span></span><span style="display:flex;"><span>        data: {
</span></span><span style="display:flex;"><span>            username: username,
</span></span><span style="display:flex;"><span>            password: password,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        success: <span style="color:#fff;font-weight:bold">function</span>(resp) {
</span></span><span style="display:flex;"><span>            console.log(resp);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (resp.result === <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>) {
</span></span><span style="display:flex;"><span>                location.reload();
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                outer.$login_error_message.html(resp.result);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>再顺便将 <code>menu</code> 菜单页面里的 <code>设置</code> 按钮也绑定上登出功能</p>
<p><code>menu/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>add_listening_events() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.$settings_mode.click(<span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        outer.root.settings.logout_on_remote();
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="实现注册功能">实现注册功能</h3>
<p><code>views/settings/register.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.http <span style="color:#fff;font-weight:bold">import</span> JsonResponse
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.contrib.auth <span style="color:#fff;font-weight:bold">import</span> login
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> django.contrib.auth.models <span style="color:#fff;font-weight:bold">import</span> User
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> game.models.player.player <span style="color:#fff;font-weight:bold">import</span> Player
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> register(request):
</span></span><span style="display:flex;"><span>    data = request.GET
</span></span><span style="display:flex;"><span>    username = data.get(<span style="color:#0ff;font-weight:bold">&#34;username&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>).strip()
</span></span><span style="display:flex;"><span>    password = data.get(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>).strip()
</span></span><span style="display:flex;"><span>    password_confirm = data.get(<span style="color:#0ff;font-weight:bold">&#34;password_confirm&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>).strip()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> not username or not password:
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;用户名或密码不能为空&#34;</span>,
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> password != password_confirm:
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;两个密码不一致&#34;</span>,
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> User.objects.filter(username=username).exists():
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;用户名已存在&#34;</span>,
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    user = User(username=username)
</span></span><span style="display:flex;"><span>    user.set_password(password)
</span></span><span style="display:flex;"><span>    user.save()
</span></span><span style="display:flex;"><span>    Player.objects.create(user=user, photo=<span style="color:#0ff;font-weight:bold">&#34;https://cdn.acwing.com/media/user/profile/photo/42832_lg_f999efc3c8.png&#34;</span>)
</span></span><span style="display:flex;"><span>    login(request, user)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> JsonResponse({
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;result&#39;</span>: <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>,
</span></span><span style="display:flex;"><span>    })
</span></span></code></pre></div><p><code>urls/settings/index.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> game.views.settings.register <span style="color:#fff;font-weight:bold">import</span> register
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>urlpatterns = [
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    path(<span style="color:#0ff;font-weight:bold">&#34;register/&#34;</span>, register, name=<span style="color:#0ff;font-weight:bold">&#34;settings_register&#34;</span>),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p><code>settings/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>add_listening_events_register() {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.$register_submit.click(<span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>        outer.register_on_remote();
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>register_on_remote() {  <span style="color:#007f7f">// 在远程服务器上注册
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> username = <span style="color:#fff;font-weight:bold">this</span>.$register_username.val();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> password = <span style="color:#fff;font-weight:bold">this</span>.$register_password.val();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">let</span> password_confirm = <span style="color:#fff;font-weight:bold">this</span>.$register_password_confirm.val();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.$register_error_message.empty();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $.ajax({
</span></span><span style="display:flex;"><span>        url: <span style="color:#0ff;font-weight:bold">&#34;https://app1117.acapp.acwing.com.cn/settings/register/&#34;</span>,
</span></span><span style="display:flex;"><span>        type: <span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>,
</span></span><span style="display:flex;"><span>        data: {
</span></span><span style="display:flex;"><span>            username: username,
</span></span><span style="display:flex;"><span>            password: password,
</span></span><span style="display:flex;"><span>            password_confirm: password_confirm,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        success: <span style="color:#fff;font-weight:bold">function</span>(resp) {
</span></span><span style="display:flex;"><span>            console.log(resp);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (resp.result === <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>) {
</span></span><span style="display:flex;"><span>                location.reload();
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                outer.$register_error_message.html(resp.result);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h2 id="redisஐ">Redisஐ</h2>
<h3 id="redis是什么">Redis是什么？</h3>
<blockquote>
<p><strong><code>Redis</code> 是一款内存高速缓存数据库</strong></p>
</blockquote>
<h3 id="为什么要使用redis">为什么要使用Redis?</h3>
<blockquote>
<p><strong>我们目前用的是<code>Django</code>自带的数据库<code>Sqlite</code>。<code>Django</code>是很容易将数据库迁移到<code>mySQL</code>的。但是存储效率不如<code>redis</code>，因为<code>redis</code>是内存数据库，所以调用东西都非常快，存的是一个一个的<code>&lt;key, value&gt;</code>，而且是单线程的</strong></p>
</blockquote>
<h3 id="在django中集成redis">在Django中集成Redis</h3>
<ol>
<li>安装 <code>django_redis</code></li>
</ol>
<pre tabindex="0"><code>pip install django_redis
</code></pre><ol start="2">
<li>配置 <code>settings.py</code></li>
</ol>
<pre tabindex="0"><code>CACHES = { 
    &#39;default&#39;: {
        &#39;BACKEND&#39;: &#39;django_redis.cache.RedisCache&#39;,
        &#39;LOCATION&#39;: &#39;redis://127.0.0.1:6379/1&#39;,
        &#34;OPTIONS&#34;: {
            &#34;CLIENT_CLASS&#34;: &#34;django_redis.client.DefaultClient&#34;,
        },  
    },  
}
USER_AGENTS_CACHE = &#39;default&#39;
</code></pre><ol start="3">
<li>启动 <code>redis-server</code></li>
</ol>
<pre tabindex="0"><code>sudo redis-server /etc/redis/redis.conf
</code></pre><h3 id="在-django-后台里操纵-redis">在 Django 后台里操纵 Redis</h3>
<pre tabindex="0"><code>$ python3 manage.py shell&#39;

In [1]: from django.core.cache import cache # 引入redis

In [2]: cache.keys(&#39;*&#39;)                     # 查询redis里所有的关键字
Out[2]: []

In [3]: cache.set(&#39;yxc&#39;, 1, 5)              # 插入一个key-val，存在 5 s
Out[3]: True

In [4]: cache.keys(&#39;*&#39;)                     # 查询redis里所有的关键字
Out[4]: [&#39;yxc&#39;]

In [5]: cache.set(&#39;yxc&#39;, 2, None)           # 插入一个key-val，不会过期
Out[5]: True

In [6]: cache.set(&#39;abc&#39;, 3, None)
Out[6]: True

In [7]: cache.keys(&#39;y*&#39;)
Out[7]: [&#39;yxc&#39;]

In [8]: cache.has_key(&#39;abc&#39;)
Out[8]: True

In [9]: cache.has_key(&#39;abcd&#39;)
Out[9]: False

In [10]: cache.get(&#39;yxc&#39;)
Out[10]: 2

In [11]: cache.delete(&#39;yxc&#39;)
Out[11]: True

In [12]: cache.keys(&#39;*&#39;)
Out[12]: [&#39;abc&#39;]

In [13]:
</code></pre><h2 id="web端acwing一键登录ஐ">Web端AcWing一键登录ஐ</h2>
<ul>
<li><a href="https://www.acwing.com/blog/content/12466/">6.2 Web端AcWing一键登录 | 讲义</a></li>
<li><a href="https://www.acwing.com/solution/content/79354/">6.2 上课笔记 | Andrew1729</a></li>
<li><a href="https://www.acwing.com/video/3565/">6.2 Web端AcWing一键登录 | Vedio</a>
<ol>
<li><strong>Oauth2一键授权登录的基本原理</strong>：$17m30s——29m15s——32m51s$</li>
<li>数据表添加<code>openid</code>信息：$33m20s——34m47s$</li>
<li><strong>Oauth2一键授权登录的代码实现</strong>：$35m20s——1h25s——1h27m20s$</li>
</ol>
</li>
</ul>
<hr>
<blockquote>
<p><strong>用户点击<code>AcWing一键登录</code>，通过<code>urls &amp; views</code>调用<code>apply_code</code>函数，将<code>state</code>放到<code>redis</code>中，将<code>appid &amp; redirect_uri &amp; scope &amp; state</code> 传入<code>apply_code_url</code>链接，返回并重定向至<code>apply_code_url</code>向用户询问是否授权</strong></p>
<p><strong>用户点击<code>同意</code>后，重定向至<code>redirect_uri</code>链接，返回参数为<code>code</code>和<code>state</code>，通过<code>urls &amp; views</code>调用<code>receive_code</code>函数</strong></p>
<p><strong>若验证<code>state</code>失败，直接重定向至初始界面</strong></p>
<p><strong>若验证<code>state</code>成功，将<code>appid &amp; code &amp; secret</code>发送至<code>AcWing服务器</code>，申请授权令牌<code>access_token</code>和用户的<code>openid</code></strong></p>
<p><strong>若申请令牌成功，将<code>access_token &amp; openid</code>发送至<code>AcWing服务器</code>，得到用户信息，创建并登录用户，最后重定向至初始界面</strong></p>
</blockquote>
<h2 id="acapp端acwing一键登录ஐ">AcApp端AcWing一键登录ஐ</h2>
<ul>
<li><a href="https://www.acwing.com/blog/content/12467/">6.3 AcApp端AcWing一键登录 | 讲义</a></li>
<li><a href="https://www.acwing.com/solution/content/79365/">6.3 上课笔记 | Andrew1729</a></li>
<li><a href="https://www.acwing.com/video/3566/">6.3 Acapp端AcWing一键登录 | Vedio</a>
<ol>
<li><strong>Oauth2一键授权登录的基本原理</strong>：$10m——12m20s——16m35s——18m$</li>
<li><strong>Oauth2一键授权登录的代码实现</strong>：$19m25s——21m——23m25s——34m29s——42m10s$</li>
</ol>
</li>
</ul>
<hr>
<h1 id="实现联机对战ஐ">实现联机对战ஐ</h1>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/3357332/">7. 实现联机对战 | 讲义</a></li>
<li><a href="https://www.acwing.com/solution/content/89506/">7.1 上课笔记 | 大菜狗</a></li>
<li><a href="https://www.acwing.com/solution/content/88801/">7.2 上课笔记 | 菊花</a></li>
</ul>
<hr>
<h2 id="统一长度单位">统一长度单位</h2>
<p>由于联机对战的时候，每个用户的客户端长宽不一样</p>
<p>在之前完成的游戏界面里，我们会根据当前客户端的大小，进行渲染</p>
<p>但是在联机对战的时候，应当让所有玩家的游戏界面保持同步才可以</p>
<p>所有，就引入了 <strong>统一长度单位</strong> 的目标</p>
<h3 id="地图渲染">地图渲染</h3>
<h4 id="地图-169-等比例缩放">地图 16:9 等比例缩放</h4>
<p>实现逻辑：根据当前用户的客户端大小，统一渲染成 <strong>16:9</strong> 的游戏界面，且随着用户调整窗口大小，也动态调整</p>
<p><code>js/src/playground/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGamePlayground {
</span></span><span style="display:flex;"><span>    constructor(root) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.root.$ac_game.append(<span style="color:#fff;font-weight:bold">this</span>.$playground);<span style="color:#007f7f">// 未来可能会多次 show 因此把创建场景挪到这里
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    start() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>        $(<span style="color:#fff;font-weight:bold">window</span>).resize(<span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>            outer.resize();
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    resize() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.width = <span style="color:#fff;font-weight:bold">this</span>.$playground.width();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.height = <span style="color:#fff;font-weight:bold">this</span>.$playground.height();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> unit = <span style="color:#fff;font-weight:bold">Math</span>.min(<span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">16</span>, <span style="color:#fff;font-weight:bold">this</span>.height / <span style="color:#ff0;font-weight:bold">9</span>);  <span style="color:#007f7f">// 以最小的作为基准，渲染
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.width = unit * <span style="color:#ff0;font-weight:bold">16</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.height = unit * <span style="color:#ff0;font-weight:bold">9</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.resize();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.scale = <span style="color:#fff;font-weight:bold">this</span>.height;   <span style="color:#007f7f">// resize时，其他元素的渲染大小都以当前渲染的高度为基准，存为 scale 变量
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.game_map) <span style="color:#fff;font-weight:bold">this</span>.game_map.resize();  <span style="color:#007f7f">//如果此时地图已创建，则resize一下
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    }
</span></span><span style="display:flex;"><span>    show() {    <span style="color:#007f7f">// 打开 playground 界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.$playground.show();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.resize();
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>js/src/playground/game_map/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> GameMap <span style="color:#fff;font-weight:bold">extends</span> AcGameObject {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    resize() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.width = <span style="color:#fff;font-weight:bold">this</span>.playground.width;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.height = <span style="color:#fff;font-weight:bold">this</span>.playground.height;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="地图居中">地图居中</h4>
<p>直接把 <code>canvas</code> 元素，用相对位置居中即可</p>
<p><code>css/game.css</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>.ac-game-playground {
</span></span><span style="display:flex;"><span>    <span style="color:#f00">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">background-color</span>: <span style="color:#fff;font-weight:bold">grey</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.ac-game-playground &gt; <span style="font-weight:bold">canvas</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">position</span>: <span style="color:#fff;font-weight:bold">relative</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">top</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">left</span>: <span style="color:#ff0;font-weight:bold">50</span><span style="color:#fff;font-weight:bold">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">transform</span>: <span style="color:#fff;font-weight:bold">translate</span>(<span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>, <span style="color:#ff0;font-weight:bold">-50</span><span style="color:#fff;font-weight:bold">%</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="解决地图-resize-时会出现渐变成黑色的情况">解决地图 resize 时，会出现渐变成黑色的情况</h4>
<p>原由是因为我们的实现逻辑是：每帧会渲染一层半透明的黑色背景</p>
<p>也就造就了一开始会出现灰屏的情况，解决方法很简单，直接 resize 完，强制涂一层不透明的黑色即可</p>
<p><code>js/src/playground/game_map/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> GameMap <span style="color:#fff;font-weight:bold">extends</span> AcGameObject {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    resize() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.width = <span style="color:#fff;font-weight:bold">this</span>.playground.width;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.height = <span style="color:#fff;font-weight:bold">this</span>.playground.height;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fillStyle = <span style="color:#0ff;font-weight:bold">&#34;rgba(0, 0, 0, 1)&#34;</span>;    <span style="color:#007f7f">// resize 完，涂一层不透明的即可
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fillRect(<span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.width, <span style="color:#fff;font-weight:bold">this</span>.ctx.canvas.height);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="元素渲染">元素渲染</h3>
<p>地图随着尺寸等比例放大缩小的同时，地图内的其他元素也应与背景一同等比例放大缩小</p>
<p>因此，我们只需把元素全部设为相对大小即可，用我们先前设置的 playground.scale 值即可</p>
<h4 id="玩家-player">玩家 Player</h4>
<p>初始化的时候，转为传递 <strong>scale</strong> 的比例值</p>
<p><code>js/src/playground/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGamePlayground {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    show() {    <span style="color:#007f7f">// 打开 playground 界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.players.push(<span style="color:#fff;font-weight:bold">new</span> Player(<span style="color:#fff;font-weight:bold">this</span>, <span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">2</span> / <span style="color:#fff;font-weight:bold">this</span>.scale, <span style="color:#ff0;font-weight:bold">0.5</span>, <span style="color:#ff0;font-weight:bold">0.05</span>, <span style="color:#0ff;font-weight:bold">&#34;white&#34;</span>, <span style="color:#ff0;font-weight:bold">0.15</span>, <span style="color:#fff;font-weight:bold">true</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">5</span>; i ++ ) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.players.push(<span style="color:#fff;font-weight:bold">new</span> Player(<span style="color:#fff;font-weight:bold">this</span>, <span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">2</span> / <span style="color:#fff;font-weight:bold">this</span>.scale, <span style="color:#ff0;font-weight:bold">0.5</span>, <span style="color:#ff0;font-weight:bold">0.05</span>, <span style="color:#fff;font-weight:bold">this</span>.get_random_color(), <span style="color:#ff0;font-weight:bold">0.15</span>, <span style="color:#fff;font-weight:bold">false</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>js/src/playground/player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Player {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    start() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.is_me) {
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">let</span> tx = <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#fff;font-weight:bold">this</span>.playground.width / <span style="color:#fff;font-weight:bold">this</span>.playground.scale;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">let</span> ty = <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#fff;font-weight:bold">this</span>.playground.height / <span style="color:#fff;font-weight:bold">this</span>.playground.scale;
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    add_listening_events() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.playground.game_map.$canvas.mousedown(<span style="color:#fff;font-weight:bold">function</span>(e) {
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (e.which === <span style="color:#ff0;font-weight:bold">3</span>) {
</span></span><span style="display:flex;"><span>                outer.move_to((e.clientX - rect.left) / outer.playground.scale, (e.clientY - rect.top) / outer.playground.scale);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (e.which === <span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (outer.cur_skill === <span style="color:#0ff;font-weight:bold">&#34;fireball&#34;</span>) {
</span></span><span style="display:flex;"><span>                    outer.shoot_fireball((e.clientX - rect.left) / outer.playground.scale, (e.clientY - rect.top) / outer.playground.scale);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    shoot_fireball(tx, ty) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> x = <span style="color:#fff;font-weight:bold">this</span>.x, y = <span style="color:#fff;font-weight:bold">this</span>.y;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> radius = <span style="color:#ff0;font-weight:bold">0.01</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> angle = <span style="color:#fff;font-weight:bold">Math</span>.atan2(ty - <span style="color:#fff;font-weight:bold">this</span>.y, tx - <span style="color:#fff;font-weight:bold">this</span>.x);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> vx = <span style="color:#fff;font-weight:bold">Math</span>.cos(angle), vy = <span style="color:#fff;font-weight:bold">Math</span>.sin(angle);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> color = <span style="color:#0ff;font-weight:bold">&#34;orange&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> speed = <span style="color:#ff0;font-weight:bold">0.5</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> move_length = <span style="color:#ff0;font-weight:bold">1.0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> damage = <span style="color:#ff0;font-weight:bold">0.01</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> FireBall(<span style="color:#fff;font-weight:bold">this</span>.playground, <span style="color:#fff;font-weight:bold">this</span>, x, y, radius, vx, vy, color, speed, move_length, damage);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    update() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.update_move();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.render();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    update_move() { <span style="color:#007f7f">// 更新玩家移动
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!<span style="color:#fff;font-weight:bold">this</span>.is_me &amp;&amp; <span style="color:#fff;font-weight:bold">this</span>.spent_time &gt; <span style="color:#ff0;font-weight:bold">4</span> &amp;&amp; <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#ff0;font-weight:bold">180</span> &lt; <span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.damage_speed &gt; <span style="color:#fff;font-weight:bold">this</span>.eps) {
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.move_length &lt; <span style="color:#fff;font-weight:bold">this</span>.eps) {
</span></span><span style="display:flex;"><span>                ...
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (!<span style="color:#fff;font-weight:bold">this</span>.is_me) {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">let</span> tx = <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#fff;font-weight:bold">this</span>.playground.width / <span style="color:#fff;font-weight:bold">this</span>.playground.scale;
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">let</span> ty = <span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#fff;font-weight:bold">this</span>.playground.height / <span style="color:#fff;font-weight:bold">this</span>.playground.scale;
</span></span><span style="display:flex;"><span>                    ...
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                ...
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    render() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> scale = <span style="color:#fff;font-weight:bold">this</span>.playground.scale;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.is_me) {
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.arc(<span style="color:#fff;font-weight:bold">this</span>.x * scale, <span style="color:#fff;font-weight:bold">this</span>.y * scale, <span style="color:#fff;font-weight:bold">this</span>.radius * scale, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#fff;font-weight:bold">Math</span>.PI * <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.drawImage(<span style="color:#fff;font-weight:bold">this</span>.img, (<span style="color:#fff;font-weight:bold">this</span>.x - <span style="color:#fff;font-weight:bold">this</span>.radius) * scale, (<span style="color:#fff;font-weight:bold">this</span>.y - <span style="color:#fff;font-weight:bold">this</span>.radius) * scale, <span style="color:#fff;font-weight:bold">this</span>.radius * <span style="color:#ff0;font-weight:bold">2</span> * scale, <span style="color:#fff;font-weight:bold">this</span>.radius * <span style="color:#ff0;font-weight:bold">2</span> * scale);
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.ctx.arc(<span style="color:#fff;font-weight:bold">this</span>.x * scale, <span style="color:#fff;font-weight:bold">this</span>.y * scale, <span style="color:#fff;font-weight:bold">this</span>.radius * scale, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">2</span> * <span style="color:#fff;font-weight:bold">Math</span>.PI, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="火球-fireball">火球 Fireball</h4>
<p><code>js/src/playground/skill/fireball/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Fireball {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    render() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> scale = <span style="color:#fff;font-weight:bold">this</span>.playground.scale;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.beginPath();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.arc(<span style="color:#fff;font-weight:bold">this</span>.x * scale, <span style="color:#fff;font-weight:bold">this</span>.y * scale, <span style="color:#fff;font-weight:bold">this</span>.radius * scale, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">2</span> * <span style="color:#fff;font-weight:bold">Math</span>.PI, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fillStyle = <span style="color:#fff;font-weight:bold">this</span>.color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fill();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="粒子-particle">粒子 Particle</h4>
<p><code>js/src/playground/particle/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Particle {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    render() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> scale = <span style="color:#fff;font-weight:bold">this</span>.playground.scale;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.beginPath();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.arc(<span style="color:#fff;font-weight:bold">this</span>.x * scale, <span style="color:#fff;font-weight:bold">this</span>.y * scale, <span style="color:#fff;font-weight:bold">this</span>.radius * scale, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">2</span> * <span style="color:#fff;font-weight:bold">Math</span>.PI, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fillStyle = <span style="color:#fff;font-weight:bold">this</span>.color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ctx.fill();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="增加联机对战模式">增加“联机对战”模式</h2>
<p>为了区分：用户自己，机器人，联机玩家</p>
<p>需要把 <code>is_me</code> 改成字符串，用以表示不同 <strong>Player</strong></p>
<p><code>menu/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGameMenu{
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    add_listening_events() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$single_mode.click(<span style="color:#fff;font-weight:bold">function</span>(){
</span></span><span style="display:flex;"><span>            outer.hide();
</span></span><span style="display:flex;"><span>            outer.root.playground.show(<span style="color:#0ff;font-weight:bold">&#34;single mode&#34;</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.$multi_mode.click(<span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>            outer.hide();
</span></span><span style="display:flex;"><span>            outer.root.playground.show(<span style="color:#0ff;font-weight:bold">&#34;multi mode&#34;</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>playground/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Playground {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    show(mode) {    <span style="color:#007f7f">// 打开 playground 界面
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.players.push(<span style="color:#fff;font-weight:bold">new</span> Player(<span style="color:#fff;font-weight:bold">this</span>, <span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">2</span> / <span style="color:#fff;font-weight:bold">this</span>.scale, <span style="color:#ff0;font-weight:bold">0.5</span>, <span style="color:#ff0;font-weight:bold">0.05</span>, <span style="color:#0ff;font-weight:bold">&#34;white&#34;</span>, <span style="color:#ff0;font-weight:bold">0.15</span>, <span style="color:#0ff;font-weight:bold">&#34;me&#34;</span>, <span style="color:#fff;font-weight:bold">this</span>.root.settings.username, <span style="color:#fff;font-weight:bold">this</span>.root.settings.photo)));
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (mode === <span style="color:#0ff;font-weight:bold">&#34;single mode&#34;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">5</span>; i ++ ) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.players.push(<span style="color:#fff;font-weight:bold">new</span> Player(<span style="color:#fff;font-weight:bold">this</span>, <span style="color:#fff;font-weight:bold">this</span>.width / <span style="color:#ff0;font-weight:bold">2</span> / <span style="color:#fff;font-weight:bold">this</span>.scale, <span style="color:#ff0;font-weight:bold">0.5</span>, <span style="color:#ff0;font-weight:bold">0.05</span>, <span style="color:#fff;font-weight:bold">this</span>.get_random_color(), <span style="color:#ff0;font-weight:bold">0.15</span>, <span style="color:#0ff;font-weight:bold">&#34;robot&#34;</span>));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (mode === <span style="color:#0ff;font-weight:bold">&#34;multi mode&#34;</span>) {
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>playground/player/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Player <span style="color:#fff;font-weight:bold">extends</span> AcGameObject {
</span></span><span style="display:flex;"><span>    constructor(playground, x, y, radius, color, speed, character, username, photo) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.character = character;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.username = username;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.photo = photo;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.character !== <span style="color:#0ff;font-weight:bold">&#34;robot&#34;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.img = <span style="color:#fff;font-weight:bold">new</span> Image();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.img.src = <span style="color:#fff;font-weight:bold">this</span>.photo;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 同理，根据对应的逻辑，修改后面所有的 is_me 为 character
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span></code></pre></div><h2 id="django_channels">Django_channels</h2>
<ul>
<li><a href="https://www.jianshu.com/p/bcefda55bce4">谈谈Websocket </a></li>
<li><a href="https://www.cnblogs.com/dreamroute/p/6247726.html">HTTP/TCP</a></li>
</ul>
<hr>
<h3 id="django_channels是什么">Django_channels是什么？</h3>
<blockquote>
<p><strong>Django_Channels 是一个为Django 提供异步扩展的库，通常主要用来提供WebSocket 支持和后台任务</strong></p>
<p><strong><code>WSS</code> 是 <code>Web Socket</code> 协议的安全模式，支持 <code>C/S</code> 下的双向通信（HTTP协议只支持单向通信）</strong></p>
</blockquote>
<h3 id="配置django_channels">配置Django_channels</h3>
<ol>
<li>安装 <code>channels_redis</code></li>
</ol>
<pre tabindex="0"><code>pip install channels_redis
</code></pre><ol start="2">
<li>配置 <code>acapp/asgi.py</code></li>
</ol>
<pre tabindex="0"><code>import os

from channels.auth import AuthMiddlewareStack
from channels.routing import ProtocolTypeRouter, URLRouter
from django.core.asgi import get_asgi_application
from game.routing import websocket_urlpatterns

os.environ.setdefault(&#39;DJANGO_SETTINGS_MODULE&#39;, &#39;acapp.settings&#39;)

application = ProtocolTypeRouter({
    &#34;http&#34;: get_asgi_application(),
    &#34;websocket&#34;: AuthMiddlewareStack(URLRouter(websocket_urlpatterns))
})
</code></pre><ol start="3">
<li>配置 <code>acapp/settings.py</code></li>
</ol>
<p>在 <code>INSTALLED_APPS</code> 中添加 <code>channels</code> ，添加后如下所示：</p>
<pre tabindex="0"><code>INSTALLED_APPS = [ 
    &#39;channels&#39;,
    &#39;game.apps.GameConfig&#39;,
    &#39;django.contrib.admin&#39;,
    &#39;django.contrib.auth&#39;,
    &#39;django.contrib.contenttypes&#39;,
    &#39;django.contrib.sessions&#39;,
    &#39;django.contrib.messages&#39;,
    &#39;django.contrib.staticfiles&#39;,
]
</code></pre><p>然后在文件末尾添加：</p>
<pre tabindex="0"><code>ASGI_APPLICATION = &#39;acapp.asgi.application&#39;
CHANNEL_LAYERS = {
    &#34;default&#34;: {
        &#34;BACKEND&#34;: &#34;channels_redis.core.RedisChannelLayer&#34;,
        &#34;CONFIG&#34;: {
            &#34;hosts&#34;: [(&#34;127.0.0.1&#34;, 6379)],
        },
    },
}
</code></pre><ol start="4">
<li>配置 <code>game/routing.py</code>
这一部分的作用相当于 <code>http</code> 的 <code>urls</code></li>
</ol>
<p>内容如下：</p>
<pre tabindex="0"><code>from django.urls import path

websocket_urlpatterns = [
]
</code></pre><ol start="5">
<li>编写 <code>game/consumers</code>
这一部分的作用相当于 <code>http</code> 的 <code>views</code></li>
</ol>
<p>参考示例：</p>
<p><code>consumers/multiplayer/index.py</code></p>
<pre tabindex="0"><code>from channels.generic.websocket import AsyncWebsocketConsumer
import json

class MultiPlayer(AsyncWebsocketConsumer):
    async def connect(self):
        await self.accept()
        print(&#39;accept&#39;)

        self.room_name = &#34;room&#34;
        await self.channel_layer.group_add(self.room_name, self.channel_name)

    async def disconnect(self, close_code):
        print(&#39;disconnect&#39;)
        await self.channel_layer.group_discard(self.room_name, self.channel_name);


    async def receive(self, text_data):
        data = json.loads(text_data)
        print(data)
</code></pre><ol start="6">
<li>启动 <code>django_channels</code></li>
</ol>
<p>在 <code>~/acapp</code> 目录下执行：</p>
<pre tabindex="0"><code>daphne -b 0.0.0.0 -p 5015 acapp.asgi:application
</code></pre><ol start="7">
<li>建立 <strong>WSS</strong> 连接</li>
</ol>
<p><code>game/routing.py</code></p>
<pre tabindex="0"><code>from django.urls import path
from game.consumers.multiplayer.index import MultiPlayer

websocket_urlpatterns = [
    path(&#34;wss/multiplayer/&#34;, MultiPlayer.as_asgi(), name=&#34;wss_multiplayer&#34;),
]
</code></pre><p><code>playground/zbase.js</code></p>
<pre tabindex="0"><code>class AcGamePlayground {
    ...
    show(mode) {    // 打开 playground 界面
        ...
        if (mode === &#34;single mode&#34;) {
            ...
        } else if (mode === &#34;multi mode&#34;) {
            this.mps = new MultiPlayerSocket(this);
            this.mps.ws.onopen = function() {
                outer.mps.send_create_player();
            };
        }

    }
}
</code></pre><p><code>playground/socket/multiplayer/zbase.js</code></p>
<pre tabindex="0"><code>class MultiPlayerSocket {
    constructor(playground) {
        this.playground = playground;
        this.ws = new WebSocket(&#34;wss://app1117.acapp.acwing.com.cn/wss/multiplayer/&#34;);
        this.start();
    }
    start() {
    }
    send_create_player() {
        this.ws.send(JSON.stringify({
            &#39;message&#39;: &#39;hello acapp server&#39;,
        }));
    }
    receive_create_player() {
    }
}
</code></pre><h2 id="编写同步函数">编写同步函数</h2>
<p>一共需要完成四个通信：</p>
<p>（通信的逻辑基本都是先在本地完成，然后将结果返回给服务器，服务器再分发给其他客户端，达成同步）</p>
<ol>
<li><strong>create-player</strong> : 在所有玩家的游戏界面，创建一个新加入的玩家</li>
<li><strong>move-to</strong> : 在所有玩家的游戏界面，将一个角色移动到一个位置</li>
<li><strong>shoot-fireball</strong> : 在所有玩家的游戏界面，让一个角色发射一个火球</li>
<li><strong>attack</strong> : 在所有玩家的游戏界面，让一个角色被攻击</li>
</ol>
<p>一场游戏里，所有的元素（玩家，火球等）都需要唯一的标识，来方便同步</p>
<p>为此，我们可以直接修改一下游戏引擎，对于每个元素都创建我们需要的唯一标识</p>
<p><code>playground/ac-game-object/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGameObject {
</span></span><span style="display:flex;"><span>    constructor() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.uuid = <span style="color:#fff;font-weight:bold">this</span>.create_uuid();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    create_uuid() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> res = <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">let</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">8</span>; i ++ ) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">let</span> x = <span style="color:#fff;font-weight:bold">parseInt</span>(<span style="color:#fff;font-weight:bold">Math</span>.floor(<span style="color:#fff;font-weight:bold">Math</span>.random() * <span style="color:#ff0;font-weight:bold">10</span>));   <span style="color:#007f7f">// [0, 10)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            res += x;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> res;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>playground/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AcGamePlayground {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    show(mode) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (mode === <span style="color:#0ff;font-weight:bold">&#34;single mode&#34;</span>) {
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (mode === <span style="color:#0ff;font-weight:bold">&#34;multi mode&#34;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.mps = <span style="color:#fff;font-weight:bold">new</span> MultiPlayerSocket(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.mps.uuid = <span style="color:#fff;font-weight:bold">this</span>.players[<span style="color:#ff0;font-weight:bold">0</span>].uuid;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.mps.ws.onopen = <span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>                outer.mps.send_create_player();
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>playground/socket/multiplayer/zbase.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MultiPlayerSocket {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    send_create_player() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">let</span> outer = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.ws.send(JSON.stringify({
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;event&#39;</span>: <span style="color:#0ff;font-weight:bold">&#39;create_player&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#39;uuid&#39;</span>: outer.uuid,
</span></span><span style="display:flex;"><span>        }));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>接着，利用通信的方式，使得每个窗口内，逻辑上相同的元素，其 <code>uid</code> 也相同即可</p>
<p>原则是：哪个窗口创建的元素，就用他创建时的 <code>uid</code> 作为整个项目运行时的 <code>uid</code></p>
<p>然后，我们打算用 <strong>redis</strong> 来实现存储每个游戏房间，以及元素，并初始默认设定每个房间上限 3 人</p>
<h3 id="create-player">create-player</h3>
<h4 id="前端">前端</h4>
<p><code>game/static/js/src/playground/socket/multiplayer/zbase.js</code></p>
<pre tabindex="0"><code>class MultiPlayerSocket {
    constructor(playground) {
        this.playground = playground;

        this.ws = new WebSocket(&#34;wss://app1117.acapp.acwing.com.cn/wss/multiplayer/&#34;);

        this.start();
    }
    start() {
        this.receive();
    }
    receive() {
        let outer = this;
        this.ws.onmessage = function(e) {
            let data = JSON.parse(e.data);
            let uuid = data.uuid;
            if (uuid === outer.uuid) return false;

            let event = data.event;
            if (event === &#34;create_player&#34;) {
                outer.receive_create_player(uuid, data.username, data.photo);
            }
        };
    }
    send_create_player(username, photo) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &#39;event&#39;: &#39;create_player&#39;,
            &#39;uuid&#39;: outer.uuid,
            &#39;username&#39;: username,
            &#39;photo&#39;: photo,
        }));
    }
    receive_create_player(uuid, username, photo) {
        let player = new Player(
            this.playground,
            this.playground.width / 2 / this.playground.scale,
            0.5,
            0.05,
            &#34;white&#34;,
            0.15,
            &#34;enemy&#34;,
            username,
            photo,
        );
        player.uuid = uuid;
        this.playground.players.push(player);
    }
}
</code></pre><h4 id="后端">后端</h4>
<p><code>settings.py</code></p>
<pre tabindex="0"><code>...
ROOM_CAPACITY = 3
</code></pre><p><code>consumers/multiplayer/index.py</code></p>
<pre tabindex="0"><code>from channels.generic.websocket import AsyncWebsocketConsumer
import json
from django.conf import settings
from django.core.cache import cache

class MultiPlayer(AsyncWebsocketConsumer):
    async def connect(self):
        self.room_name = None
        for i in range(1000):   # 上限 1k 个房间
            name = &#34;room-%d&#34; % (i)
            # 当前房间为空，或房间内玩家人数不到 ROOM_CAPACITY
            if not cache.has_key(name) or len(cache.get(name)) &lt; settings.ROOM_CAPACITY:
                self.room_name = name
                break
        if not self.room_name:
            return

        await self.accept()

        if not cache.has_key(self.room_name):   # 如果房间不存在，则新建房间
            cache.set(self.room_name, [], 3600) # 有效期 1 小时

        for player in cache.get(self.room_name):    # 对该房间已存在的用户，创建到新加入的用户的游戏界面中
            await self.send(text_data=json.dumps({
                &#39;event&#39;: &#34;create_player&#34;,
                &#39;uuid&#39;: player[&#39;uuid&#39;],
                &#39;username&#39;: player[&#39;username&#39;],
                &#39;photo&#39;: player[&#39;photo&#39;],
            }))
        await self.channel_layer.group_add(self.room_name, self.channel_name)

    async def disconnect(self, close_code):
        print(&#39;disconnect&#39;)
        await self.channel_layer.group_discard(self.room_name, self.channel_name);

    async def create_player(self, data):
        players = cache.get(self.room_name)
        players.append({
            &#39;uuid&#39;: data[&#39;uuid&#39;],
            &#39;username&#39;: data[&#39;username&#39;],
            &#39;photo&#39;: data[&#39;photo&#39;],
        })
        cache.set(self.room_name, players, 3600) # 更新房间存在时间为 1 小时（最后一次加入一名玩家时）
        # 群发消息更新
        await self.channel_layer.group_send(
            self.room_name,
            {
                &#39;type&#39;: &#34;group_create_player&#34;,  # 群发该消息后，作为客户端接受者，所接受用的函数名
                &#39;event&#39;: &#34;create_player&#34;,
                &#39;uuid&#39;: data[&#39;uuid&#39;],
                &#39;username&#39;: data[&#39;username&#39;],
                &#39;photo&#39;: data[&#39;photo&#39;],
            }
        )
    async def group_create_player(self, data):
        await self.send(text_data=json.dumps(data))

    async def receive(self, text_data):
        data = json.loads(text_data)
        event = data[&#39;event&#39;]
        if event == &#34;create_player&#34;:
            await self.create_player(data)
</code></pre><h4 id="redis-调试语句">redis 调试语句</h4>
<p>打开 shell 交互</p>
<pre tabindex="0"><code>python3 manage.py shell
</code></pre><p>然后用 py3 交互进行 cache 调试</p>
<pre tabindex="0"><code>from django.core.cache import cache

def clear():
    for key in cache.keys(&#39;*&#39;):
        cache.delete(key)

cache.keys(&#39;*&#39;) # 查询当前 redis 中所有 key

cache.get(&#39;room-1&#39;) # 查询当前 redis 中 key 为 room-1 的值
</code></pre><p>到目前为止，便可以在不同的窗口渲染同一批玩家了</p>
<h3 id="move-to">move-to</h3>
<h4 id="前端-1">前端</h4>
<p>客户端的通信的发出和接受函数</p>
<p><code>game/static/js/src/playground/socket/multiplayer/zbase.js</code></p>
<pre tabindex="0"><code>class MultiPlayerSocket {
    ...
    receive() {
        let outer = this;
        this.ws.onmessage = function(e) {
            ...
            else if (event === &#34;move_to&#34;) {
                outer.receive_move_to(uuid, data.tx, data.ty);
            }
        };
    }
    send_move_to(tx, ty) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &#39;event&#39;: &#39;move_to&#39;,
            &#39;uuid&#39;: outer.uuid,
            &#39;tx&#39;: tx,
            &#39;ty&#39;: ty,
        }));
    }
    get_player(uuid) {
        let players = this.playground.players;
        for (let i = 0; i &lt; players.length; i ++ ) {
            let player = players[i];
            if (player.uuid === uuid) {
                return player;
            }
        }
        return null;
    }
    receive_move_to(uuid, tx, ty) {
        let player = this.get_player(uuid);
        if (player) {
            player.move_to(tx, ty);
        }
    }
}
</code></pre><p>为了让游戏界面中对于要移动的元素做出移动动作，需要对 <code>move_to</code> 函数做出一些修改</p>
<p>首先要标识出当前为多人模式，然后模式为多人模式时，每次移动都会触发一次通信</p>
<p><code>playground/zbase.js</code></p>
<pre tabindex="0"><code>class AcGamePlayground {
    ...
    show(mode) {
        ...
        this.mode = mode;
    }
}
</code></pre><p><code>playground/player/zbase.js</code></p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    ...
    add_listening_events() {
      ...
       this.playground.game_map.$canvas.mousedown(function(e) {
           ...
           if (e.which === 3) {
               let tx = (e.clientX - rect.left) / outer.playground.scale;
               let ty = (e.clientY - rect.top) / outer.playground.scale;
               outer.move_to(tx, ty);
               if (outer.playground.mode === &#34;multi mode&#34;) {
                   outer.playground.mps.send_move_to(tx, ty);
               }
           }
           ...
   }
   ...
}
</code></pre><h4 id="后端-1">后端</h4>
<p><code>consumers/multiplayer/index.py</code></p>
<pre tabindex="0"><code>async def move_to(self, data):
    await self.channel_layer.group_send(
        self.room_name,
        {
            &#39;type&#39;: &#34;group_send_event&#34;,
            &#39;event&#39;: &#34;move_to&#34;,
            &#39;uuid&#39;: data[&#39;uuid&#39;],
            &#39;tx&#39;: data[&#39;tx&#39;],
            &#39;ty&#39;: data[&#39;ty&#39;],
        }
    )

async def group_send_event(self, data):
    await self.send(text_data=json.dumps(data))

async def receive(self, text_data):
    data = json.loads(text_data)
    event = data[&#39;event&#39;]
    if event == &#34;create_player&#34;:
        await self.create_player(data)
    elif event == &#34;move_to&#34;:
        await self.move_to(data)
</code></pre><h3 id="shoot-fireball">shoot-fireball</h3>
<h4 id="前端-2">前端</h4>
<p>用一个数组来存一个玩家发射的所有火球，以便于子弹消失时，将他们找出并对应删掉</p>
<p><code>playground/player/zbase.js</code></p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    constructor(playground, x, y, radius, color, speed, character, username, photo) {
        ...
        this.fireballs = [];    // 存该用户发射的所有火球
    }
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.mousedown(function(e) {
            ...
            else if (e.which === 1) {
                let tx = (e.clientX - rect.left) / outer.playground.scale;
                let ty = (e.clientY - rect.top) / outer.playground.scale;
                if (outer.cur_skill === &#34;fireball&#34;) {
                    let fireball = outer.shoot_fireball(tx, ty);
                    if (outer.playground.mode === &#34;multi mode&#34;) {
                        outer.playground.mps.send_shoot_fireball(tx, ty, fireball.uuid);
                    }
                }
            }
            ...
        });
        $(window).keydown(function(e) {
            if (e.which === 81) {           // 键盘按下q事件
                outer.cur_skill = &#34;fireball&#34;;
                return false;
            }
        });
    }
    ...
    shoot_fireball(tx, ty) {
        ...

        let fireball = new FireBall(this.playground, this, x, y, radius, vx, vy, color, speed, move_length, damage);
        this.fireballs.push(fireball);
        return fireball;
    }
    destroy_fireball(uuid) {
        for (let i = 0; i &lt; this.fireballs.length; i ++ ) {
            let fireball = this.fireballs[i];
            if (fireball.uuid == uuid) {
                fireball.destroy();
                break;
            }
        }
    }
    ...
</code></pre><p><code>playground/skill/fireball/zbase.js</code></p>
<pre tabindex="0"><code>class FireBall extends AcGameObject {
    ...
    on_destory() {
        let fireballs = this.player.fireballs;
        for (let i = 0; i &lt; fireballs.length; i ++ ) {
            if (fireballs[i] === this) {
                fireballs.splice(i, 1);
                break;
            }
        }
    }
}
</code></pre><p><code>game/static/js/src/playground/socket/multiplayer/zbase.js</code></p>
<pre tabindex="0"><code>class MultiPlayerSocket {
    ...
    send_shoot_fireball(tx, ty, ball_uuid) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &#39;event&#39;: &#39;move_to&#39;,
            &#39;uuid&#39;: outer.uuid,
            &#39;tx&#39;: tx,
            &#39;ty&#39;: ty,
            &#39;ball_uuid&#39;: ball_uuid;
        }));
    }
    receive_shoot_fireball(uuid, tx, ty, ball_uuid) {
        let player = this.get_player(uuid);
        if (player) {
            let fireball = player.shoot_fireball(tx, ty);
            fireball.uuid = ball_uuid;
        }
    }
}
</code></pre><h4 id="后端-2">后端</h4>
<p><code>consumers/multiplayer/index.py</code></p>
<pre tabindex="0"><code>...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def shoot_fireball(self, data):
        await self.channel_layer.group_send(
            self.room_name,
            {
                &#39;type&#39;: &#34;group_send_event&#34;,
                &#39;event&#39;: &#34;shoot_fireball&#34;,
                &#39;uuid&#39;: data[&#39;uuid&#39;],
                &#39;tx&#39;: data[&#39;tx&#39;],
                &#39;ty&#39;: data[&#39;ty&#39;],
                &#39;ball_uuid&#39;: data[&#39;ball_uuid&#39;],
            }
        )
    async def receive(self, text_data):
        ...
        elif event == &#34;shoot_fireball&#34;:
            await self.shoot_fireball(data)
</code></pre><h3 id="attack">attack</h3>
<p>为了只让一个客户端进行攻击命中的判断，因此只有发出方的火球才做碰撞检测</p>
<p>其他客户端对于该火球只有动画效果</p>
<p>又由于碰撞检测是在一台客户端上进行的，因此多端之间可能会存在同步上的延迟</p>
<p>为此的解决方法是：碰撞检测成功时，强制把被击中玩家移动到发起方客户端中的位置，以避免击中延迟上发生的事情</p>
<h4 id="前端-3">前端</h4>
<p><code>playground/skill/fireball/zbase.js</code></p>
<pre tabindex="0"><code>class FireBall extends AcGameObject {
    update() {
        if (this.move_length &lt; this.eps) {
            this.destroy();
            return false;
        }
        this.update_move();

        if (this.player.character !== &#34;enemy&#34;) {
            this.update_attack();
        }
        this.render();
    }
    attack(player) {
        ...
        if (this.playground.mode === &#34;multi mode&#34;) {
            this.playground.mps.send_attack(player.uuid, player.x, player.y, angle, this.damage, this.uuid);
        }
        ...
    }
    ...
}
</code></pre><p><code>playground/player/zbase.js</code></p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    ...
    receive_attack(x, y, angle, damage, ball_uuid, attacker) {
        attacker.destroy_fireball(ball_uuid);
        this.x = x;
        this.y = y;
        this.is_attacked(angle, damage);
    }
    ...
}
</code></pre><p><code>game/static/js/src/playground/socket/multiplayer/zbase.js</code></p>
<pre tabindex="0"><code>class MultiPlayerSocket {
    ...
    send_attack(attackee_uuid, x, y, angle, damage, ball_uuid) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &#39;event&#39;: &#34;attack&#34;,
            &#39;uuid&#39;: outer.uuid,
            &#39;attackee_uuid&#39;: attackee_uuid,
            &#39;x&#39;: x,
            &#39;y&#39;: y,
            &#39;angle&#39;: angle,
            &#39;damage&#39;: damage,
            &#39;ball_uuid&#39;: ball_uuid,
        }));
    }
    receive_attack(uuid, attackee_uuid, x, y, angle, damage, ball_uuid) {
        let attacker = this.get_player(uuid);
        let attackee = this.get_player(attackee_uuid);
        if (attacker &amp;&amp; attackee) {
            attackee.receive_attack(x, y, angle, damage, ball_uuid, attacker);
        }
    }
}
</code></pre><h4 id="后端-3">后端</h4>
<p><code>consumers/multiplayer/index.py</code></p>
<pre tabindex="0"><code>...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def attack(self, data):
        await self.channel_layer.group_send(
            self.room_name,
            {
                &#39;type&#39;: &#34;group_send_event&#34;,
                &#39;event&#39;: &#34;attack&#34;,
                &#39;uuid&#39;: data[&#39;uuid&#39;],
                &#39;x&#39;: data[&#39;x&#39;],
                &#39;y&#39;: data[&#39;y&#39;],
                &#39;angle&#39;: data[&#39;angle&#39;],
                &#39;damage&#39;: data[&#39;damage&#39;],
                &#39;ball_uuid&#39;: data[&#39;ball_uuid&#39;],
            }
        )
    ...
</code></pre><h2 id="游戏的小优化">游戏的小优化</h2>
<h3 id="多人模式下游戏没有开始前玩家不可以移动">多人模式下游戏没有开始前，玩家不可以移动</h3>
<p>为此我们先引入一个状态机：<code>'waiting' -&gt; 'fighting' -&gt; 'over'</code> 来标识当前游戏进行的状态</p>
<p>然后用一个 <code>notice_board</code> 计分板在前端显示出来</p>
<p>实现的逻辑就是：游戏初始时为 <code>waiting</code> 状态，房间内人数满 3 人时，才会进入 <code>fighting</code>，角色死亡时为 <code>over</code></p>
<p>且发射火球，移动等行为，当且仅当玩家状态为 <code>fighting</code> 时，才可以做</p>
<p>然后设定火球技能的 cd 为 3 秒，且在游戏进入 <code>fighting</code> 时，先自动进入 cd 状态</p>
<p>这样就实现了初始 3 秒内，任何玩家不可攻击</p>
<p><code>js/src/playground/notice_board/zbase.js</code></p>
<pre tabindex="0"><code>class NoticeBoard extends AcGameObject {
    constructor(playground) {
        super();

        this.playground = playground;
        this.ctx = this.playground.game_map.ctx;
        this.text = &#34;已就绪：0人&#34;;
    }
    start() {
    }

    write(text) {
        this.text = text;
    }

    update() {
        this.render();
    }

    render() {
        this.ctx.font = &#34;20px serif&#34;;
        this.ctx.fillStyle = &#34;white&#34;;
        this.ctx.textAlign = &#34;center&#34;;
        this.ctx.fillText(this.text, this.playground.width / 2, 20);
    }
}
</code></pre><p><code>js/src/playground/zbase.js</code></p>
<pre tabindex="0"><code>class AcGamePlayground {
    ...
    show(mode) {
        ...
        this.state = &#34;waiting&#34;;     // waiting -&gt; fighting -&gt; over
        this.notice_board = new NoticeBoard(this);
        this.player_count = 0;
        ...
    }
}
</code></pre><p><code>js/src/playground/player/zbase.js</code></p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    ...
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.mousedown(function(e) {
            if (outer.playground.state !== &#34;fighting&#34;)
                return false;
            ...
        }
        $(window).keydown(function(e) {
            if (outer.playground.state !== &#34;fighting&#34;)
                return false;
            ...
        });
    }
    start() {
        this.playground.player_count ++ ;
        this.playground.notice_board.write(&#34;已就绪：&#34; + this.playground.player_count + &#34;人&#34;);
        if (this.playground.player_count &gt;= 3) {
            this.playground.state = &#34;fighting&#34;;
            this.playground.notice_board.write(&#34;Fighting&#34;);
        }
        ...
    }
    ...
}
</code></pre><h3 id="技能cd">技能CD</h3>
<p>给火球技能设置 3s 的 cd，实现逻辑很简单，设定一个 cool_time 变量，每次渲染的时候减去上次渲染的时间间隔</p>
<p>然后 cool_time 为 0 时，技能才可以成功释放</p>
<p>另外修改冷却时间，只用修改自己的即可</p>
<p><code>js/src/playground/player/zbase.js</code></p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    constructor(...) {
        ...
        if (this.character === &#34;me&#34;) {
            this.fireball_coldtime = 3; // 单位：s
        }
    }
    ...
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.mousedown(function(e) {
            ...
            else if (e.which === 1) {
                ...
                if (outer.cur_skill === &#34;fireball&#34;) {
                    ...
                    if (outer.playground.mode === &#34;multi mode&#34;) {
                        outer.playground.mps.send_shoot_fireball(tx, ty, fireball.uuid);
                    }
                    outer.fireball_coldtime = 3;
                }
            }
            ...
        });
        $(window).keydown(function(e) {
            ...
            if (outer.fireball_coldtime &gt;= outer.eps)
                return false;
            ...
        });
    }
    update() {
        ...
        if (this.character === &#34;me&#34; &amp;&amp; this.playground.state === &#34;fighting&#34;) {
            this.update_coldtime();
        }
        ...
    }
    update_coldtime() {
        this.fireball_coldtime -= this.timedelta / 1000;
        this.fireball_coldtime = Math.max(0, this.fireball_coldtime);
    }
    ...
}
</code></pre><h3 id="用图片来渲染技能cd">用图片来渲染技能CD</h3>
<p><code>js/src/playground/player/zbase.js</code></p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    constructor(...) {
        ...
        if (this.character === &#34;me&#34;) {
            this.fireball_coldtime = 3; // 单位：s
            this.fireball_img = new Image();
            this.fireball_img.src = &#34;https://cdn.acwing.com/media/article/image/2021/12/02/1_9340c86053-fireball.png&#34;;
        }
    }
    ...
    render() {
        ...
        if (this.character === &#34;me&#34; &amp;&amp; this.playground.state === &#34;fighting&#34;) {
            this.render_skill_coldtime();
        }
    }
     render_skill_coldtime() {
        let scale = this.playground.scale;
        let x = 1.5, y = 0.9, r = 0.04;

        // 渲染技能图标
        this.ctx.save();
        this.ctx.beginPath();
        this.ctx.arc(x * scale, y * scale, r * scale, 0, Math.PI * 2, false);
        this.ctx.stroke();
        this.ctx.clip();
        this.ctx.drawImage(this.fireball_img, (x - r) * scale, (y - r) * scale, r * 2 * scale, r * 2 * scale);
        this.ctx.restore();

        // 渲染冷却指示
        if (this.fireball_coldtime &gt;= this.eps){
            this.ctx.beginPath();
            this.ctx.moveTo(x * scale, y * scale);
            this.ctx.arc(x * scale, y * scale, r * scale, 0 - Math.PI / 2, Math.PI * 2 * (1 - this.fireball_coldtime / 3) - Math.PI / 2, true);
            this.ctx.lineTo(x * scale, y * scale);
            this.ctx.fillStyle = &#34;rgba(0, 0, 255, 0.6)&#34;;
            this.ctx.fill();
        }
    }
    ...
</code></pre><h3 id="添加一个闪现技能">添加一个闪现技能</h3>
<h4 id="单机部分">单机部分</h4>
<p><code>js/src/playground/player/zbase.js</code></p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    constructor(...) {
        ...
        if (this.character === &#34;me&#34;) {
            ...
            this.blink_coldtime = 5;
            this.blink_img = new Image();
            this.blink_img.src = &#34;https://cdn.acwing.com/media/article/image/2021/12/02/1_daccabdc53-blink.png&#34;;
        }
    }
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.mousedown(function(e) {
            ...
            else if (e.which === 1) {
                ...
                else if (outer.cur_skill === &#34;blink&#34;) {
                    outer.blink(tx, ty);
                    // 同步函数
                    if (outer.playground.mode === &#34;multi mode&#34;) {
                        outer.playground.mps.send_blink(tx, ty);
                    }
                    outer.blink_coldtime = 5;
                }
            }
            outer.cur_skill = null; // 清空当前技能
        });
        $(window).keydown(function(e) {
            ...
            else if (e.which === 70) {    // f键
                if (outer.blink_coldtime &gt;= outer.eps) return true;
                outer.cur_skill = &#34;blink&#34;;
                return false;
            }
        });
    }
    ...
    blink(tx, ty) {
        let d = this.get_dist(this.x, this.y, tx, ty);
        d = Math.min(d, 0.5);
        let angle = Math.atan2(ty - this.y, tx - this.x);
        this.x += d * Math.cos(angle);
        this.y += d * Math.sin(angle);

        this.move_length = 0;   // 闪现完停下来
    }
    ...
    render_skill_coldtime() {
        ...
        x = 1.62, y = 0.9, r = 0.04;
        // 闪现技能
        // 渲染技能图标
        this.ctx.save();
        this.ctx.beginPath();
        this.ctx.arc(x * scale, y * scale, r * scale, 0, Math.PI * 2, false);
        this.ctx.stroke();
        this.ctx.clip();
        this.ctx.drawImage(this.blink_img, (x - r) * scale, (y - r) * scale, r * 2 * scale, r * 2 * scale);
        this.ctx.restore();

        // 渲染冷却指示
        if (this.blink_coldtime &gt;= this.eps){
            this.ctx.beginPath();
            this.ctx.moveTo(x * scale, y * scale);
            this.ctx.arc(x * scale, y * scale, r * scale, 0 - Math.PI / 2, Math.PI * 2 * (1 - this.blink_coldtime / 5) - Math.PI / 2, true);
            this.ctx.lineTo(x * scale, y * scale);
            this.ctx.fillStyle = &#34;rgba(0, 0, 255, 0.6)&#34;;
            this.ctx.fill();
        }
    }
}
</code></pre><h4 id="联机部分">联机部分</h4>
<p><code>game/static/js/src/playground/socket/multiplayer/zbase.js</code></p>
<pre tabindex="0"><code>class MultiPlayerSocket {
    ...
    send_blink(tx, ty) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &#39;event&#39;: &#34;blink&#34;,
            &#39;uuid&#39;: outer.uuid,
            &#39;tx&#39;: tx,
            &#39;ty&#39;: ty,
        }));
    }
    receive_blink(uuid, tx, ty) {
        let player = this.get_player(uuid);
        if (player) {
            player.blink(tx, ty);
        }
    }
}
</code></pre><p><code>consumers/multiplayer/index.py</code></p>
<pre tabindex="0"><code>...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def blink(self, data):
        await self.channel_layer.group_send(
            self.room_name,
            {
                &#39;type&#39;: &#34;group_send_event&#34;,
                &#39;event&#39;: &#34;blink&#34;,
                &#39;uuid&#39;: data[&#39;uuid&#39;],
                &#39;tx&#39;: data[&#39;tx&#39;],
                &#39;ty&#39;: data[&#39;ty&#39;],
            }
        )
</code></pre><h1 id="实现聊天系统ஐ">实现聊天系统ஐ</h1>
<ul>
<li><a href="https://www.acwing.com/solution/content/89508/">8.1 上课笔记 | 大菜狗</a></li>
</ul>
<hr>
<h2 id="优化键盘绑定事件">优化键盘绑定事件</h2>
<p>这部分算是之前的遗留问题，先前的 <code>keydown</code> 监听事件绑定在了 <code>window</code> 上会出现一个问题</p>
<p>如果在一个浏览器内打开多个 <code>ACAPP</code>，此时按下键位触发 <code>keydown</code> 事件，会被浏览器内所有的 <code>ACAPP</code> 都捕获到</p>
<p>之前影响不大，但对此次要实现的聊天系统就有着致命的影响，即打开一个 <code>ACAPP</code> 的聊天栏，其他都会被打开</p>
<p>所有我们要将 <code>keydown</code> 监听事件绑定到 <code>canvas</code> 上</p>
<p><code>playground/player/zbase.js</code></p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    ...
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.keydown(function(e) {
            if (outer.playground.state !== &#34;fighting&#34;)
                return true;
            if (e.which === 81) {           // 键盘按下q事件
                if (outer.fireball_coldtime &gt;= outer.eps) return true;
                outer.cur_skill = &#34;fireball&#34;;
                return false;
            } else if (e.which === 70) {    // f键
                if (outer.blink_coldtime &gt;= outer.eps) return true;
                outer.cur_skill = &#34;blink&#34;;
                return false;
            }
        });
    }
}
</code></pre><p><code>playground/game-map/zbase.js</code></p>
<pre tabindex="0"><code>class GameMap extends AcGameObject {
    constructor(playground) {
        ...
        this.$canvas = $(`&lt;canvas tabindex=0&gt;&lt;/canvas&gt;`);
        ...
    }
    start() {
        this.$canvas.focus();
    }
}
</code></pre><h2 id="本地前端">本地前端</h2>
<p>要实现两个部分： 1. 文本输入框（让用户输入要发送的信息） 2. 历史记录显示框（之前用户发送的信息的显示框）</p>
<p>欲实现逻辑：用户按下 <code>&lt;Enter&gt;</code> 后，游戏界面弹出文本输入框，然后聚焦于文本输入框，且同时弹出历史记录显示框 3 秒</p>
<p>然后用户输入信息后，按下 <code>&lt;Enter&gt;</code> 后发出信息，接着信息会显示在历史记录显示框最下方，并弹出历史记录显示框 3 秒</p>
<p><code>playground/chat_field/zbase.js</code></p>
<p><code>chat field</code> 负责管理 文本输入框 和 历史记录显示框</p>
<pre tabindex="0"><code>class ChatField {
    constructor(playground) {
        this.playground = playground;

        this.$history = $(`&lt;div class=&#34;ac-game-chat-field-history&#34;&gt;&lt;/div&gt;`);
        this.$input = $(`&lt;input type=&#34;text&#34; class=&#34;ac-game-chat-field-input&#34;&gt;`);

        this.$history.hide();
        this.$input.hide();

        this.func_id = null;

        this.playground.$playground.append(this.$history);
        this.playground.$playground.append(this.$input);

        this.start();
    }

    start() {
        this.add_listening_events();
    }
    add_listening_events() {
        let outer = this;
        this.$input.keydown(function(e) {
            if (e.which === 27) {   //ESC
                outer.hide_input();
                return false;
            } else if (e.which === 13) {
                let username = outer.playground.root.settings.username;
                let text = outer.$input.val();
                if (text) {
                    outer.$input.val(&#34;&#34;);
                    outer.add_message(username, text);
                }
                return false;
            }
        });
    }
    show_history() {
        let outer = this;
        this.$history.fadeIn();
        if (this.func_id) clearTimeout(this.func_id);
        this.func_id = setTimeout(function() {
            outer.$history.fadeOut();
            outer.func_id = null;
        }, 3000);
    }
    render_message(message) {
        return $(`&lt;div&gt;${message}&lt;/div&gt;`);
    }
    add_message(username, text) {
        this.show_history();
        let message = `[${username}] ${text}`;
        this.$history.append(this.render_message(message));
        this.$history.scrollTop(this.$history[0].scrollHeight);
    }
    show_input() {
        this.show_history();
        this.$input.show();
        this.$input.focus();    // 输入时，聚焦于输入框
    }
    hide_input() {
        this.$input.hide();
        this.playground.game_map.$canvas.focus();   // 退出时，聚焦回游戏界面
    }
}
</code></pre><p><code>playground/zbase.js</code></p>
<p>把它创建出来</p>
<pre tabindex="0"><code>class AcGamePlayground {
    ...
    show(mode) {    //打开 playground 界面
        ...
        else if (mode === &#34;multi mode&#34;) {
            this.chat_field = new ChatField(this);
            ...
        }

    }
}
</code></pre><p><code>playground/player/zbase.js</code></p>
<p>添加监听事件</p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    ...
    add_listening_events() {
        ...
        this.playground.game_map.$canvas.keydown(function(e) {
            if (e.which === 13) {   // enter (显示对话框)
                if (outer.playground.mode === &#34;multi mode&#34;) {
                    outer.playground.chat_field.show_input();
                    return false;
                }
            } else if (e.which === 27) {    // esc（关闭对话框）
                if (outer.playground.mode === &#34;multi mode&#34;) {
                    outer.playground.char_field.hide_input();
                    return false;
                }
            }
            ...
        }
    }
}
</code></pre><p><code>game.css</code></p>
<pre tabindex="0"><code>...
.ac-game-chat-field-history {
    position: absolute;
    top: 66%;
    left: 20%;
    transform: translate(-50%, -50%);
    width: 20%;
    height: 32%;
    color: white;
    font-size: 2vh;
    padding: 5px;
    overflow: auto;
}

.ac-game-chat-field-history::-webkit-scrollbar {
    width: 0;
}

.ac-game-chat-field-input {
    position: absolute;
    top: 86%;
    left: 20%;
    transform: translate(-50%, -50%);
    width: 20%;
    height: 3vh;
    color: white;
    font-size: 2vh;
    background-color: rgba(222,225,230, 0.2);
}
</code></pre><h2 id="联机聊天窗">联机聊天窗</h2>
<h3 id="前端-4">前端</h3>
<p><code>playground/chat_field/zbase.js</code></p>
<pre tabindex="0"><code>class ChatField {
    ...
    add_listening_events() {
        ...
        this.$input.keydown(function(e) {
            ...
            else if (e.which === 13) {
                ...
                if (text) {
                    ...
                    outer.playground.mps.send_message(text);
                }
                ...
            }
        });
    }
    ...
}
</code></pre><p><code>js/src/playground/socket/multiplayer/zbase.js</code></p>
<pre tabindex="0"><code>class MultiPlayerSocket {
    ...
    send_message(text) {
        let outer = this;
        this.ws.send(JSON.stringify({
            &#39;event&#39;: &#34;message&#34;,
            &#39;uuid&#39;: outer.uuid,
            &#39;username&#39;: outer.playground.root.settings.username,
            &#39;text&#39;: text,
        }));
    }
    receive_message(username, text) {
        this.playground.chat_field.add_message(username, text);
    }
}
</code></pre><h3 id="后端-4">后端</h3>
<p><code>consumers/multiplayer/index.py</code></p>
<pre tabindex="0"><code>...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def message(self, data):
        await self.channel_layer.group_send(
            self.room_name,
            {
                &#39;type&#39;: &#34;group_send_event&#34;,
                &#39;event&#39;: &#34;message&#34;,
                &#39;uuid&#39;: data[&#39;uuid&#39;],
                &#39;username&#39;: data[&#39;username&#39;],
                &#39;text&#39;: data[&#39;text&#39;],
            }
        )
</code></pre><h1 id="实现匹配系统ஐ">实现匹配系统ஐ</h1>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/3435229/">9. 实现匹配系统 | 讲义</a></li>
<li><a href="https://www.acwing.com/activity/content/code/content/2360556/">9.1 上课笔记 | 一只野生彩色铅笔</a></li>
</ul>
<hr>
<p>本章节内容是利用 <code>thrift</code> 创建客户端-服务端交互的接口</p>
<p>然后利用该接口完成一个匹配系统</p>
<p>匹配系统由一个消息队列 + 生产者-消费者模型 + 匹配池 完成</p>
<p>基本与 Linux基础课 里的部分完全一致</p>
<p>当时我们是拿 cpp 来写的，写了差不多 200 行</p>
<p>本节会拿 py 来实现，差不多 140 行即可</p>
<p><code>thrift</code> 接口文件</p>
<pre tabindex="0"><code>namespace py match_service

service Match {
    i32 add_player(1: i32 score, 2: string uuid, 3: string username, 4: string photo, 5: string channel_name),
}
</code></pre><p>然后用该源文件生成接口文件</p>
<h2 id="服务端">服务端</h2>
<p>配置 <code>asgi.py</code> 让服务端进程可以调用客户端进程里的函数</p>
<p><code>acapp/acapp/asgi.py</code></p>
<pre tabindex="0"><code>import os

import django
os.environ.setdefault(&#39;DJANGO_SETTINGS_MODULE&#39;, &#39;acapp.settings&#39;)
django.setup()
...
from channels.layers import get_channel_layer
channel_layer = get_channel_layer()
...
</code></pre><p><code>acapp/match_system/src/main.py</code></p>
<pre tabindex="0"><code>#! /usr/bin/env python3

import glob
import sys
sys.path.insert(0, glob.glob(&#39;../../&#39;)[0])

from match_server.match_service import Match

from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol
from thrift.server import TServer

from queue import Queue
from time import sleep
from threading import Thread

from acapp.asgi import channel_layer
from asgiref.sync import async_to_sync
from django.core.cache import cache

queue = Queue()  # 消息队列

class Player:
    def __init__(self, score, uuid, username, photo, channel_name):
        self.score = score
        self.uuid = uuid
        self.username = username
        self.photo = photo
        self.channel_name = channel_name
        self.waiting_time = 0  # 等待时间


class Pool:
    def __init__(self):
        self.players = []

    def add_player(self, player):
        self.players.append(player)

    def check_match(self, a, b):
        dt = abs(a.score - b.score)
        a_max_dif = a.waiting_time * 50
        b_max_dif = b.waiting_time * 50
        return dt &lt;= a_max_dif and dt &lt;= b_max_dif

    def match_success(self, ps):
        print(&#34;Match Success: %s %s %s&#34; % (ps[0].username, ps[1].username, ps[2].username))
        room_name = &#34;room-%s-%s-%s&#34; % (ps[0].uuid, ps[1].uuid, ps[2].uuid)
        players = []
        for p in ps:
            async_to_sync(channel_layer.group_add)(room_name, p.channel_name)
            players.append({
                &#39;uuid&#39;: p.uuid,
                &#39;username&#39;: p.username,
                &#39;photo&#39;: p.photo,
                &#39;hp&#39;: 100,
            })
        cache.set(room_name, players, 3600)  # 有效时间：1小时
        for p in ps:
            async_to_sync(channel_layer.group_send)(
                room_name,
                {
                    &#39;type&#39;: &#34;group_send_event&#34;,
                    &#39;event&#39;: &#34;create_player&#34;,
                    &#39;uuid&#39;: p.uuid,
                    &#39;username&#39;: p.username,
                    &#39;photo&#39;: p.photo,
                }
            )

    def increase_waiting_time(self):
        for player in self.players:
            player.waiting_time += 1

    def match(self):
        while len(self.players) &gt;= 3:
            self.players = sorted(self.players, key=lambda p: p.score)
            flag = False
            for i in range(len(self.players) - 2):
                a, b, c = self.players[i], self.players[i + 1], self.players[i + 2]
                if self.check_match(a, b) and self.check_match(a, c) and self.check_match(b, c):
                    self.match_success([a, b, c])
                    self.players = self.players[:i] + self.players[i + 3:]
                    flag = True
                    break
            if not flag:
                break

        self.increase_waiting_time()



class MatchHandler:
    def add_player(self, score, uuid, username, photo, channel_name):
        print(&#34;Add Player: %s %d&#34; % (username, score))
        player = Player(score, uuid, username, photo, channel_name)
        queue.put(player)
        return 0


def get_player_from_queue():
    try:
        return queue.get_nowait()
    except:
        return None


def worker():
    pool = Pool()
    while True:
        player = get_player_from_queue()
        if player:
            pool.add_player(player)
        else:
            pool.match()
            sleep(1)



if __name__ == &#39;__main__&#39;:
    handler = MatchHandler()
    processor = Match.Processor(handler)
    transport = TSocket.TServerSocket(host=&#39;127.0.0.1&#39;, port=9090)
    tfactory = TTransport.TBufferedTransportFactory()
    pfactory = TBinaryProtocol.TBinaryProtocolFactory()

    server = TServer.TThreadedServer(
        processor, transport, tfactory, pfactory)

    Thread(target=worker, daemon=True).start()

    print(&#39;Starting the server...&#39;)
    server.serve()
    print(&#39;done.&#39;)
</code></pre><h2 id="客户端">客户端</h2>
<p>扩展数据库表，让其可以存放 rank分 的信息</p>
<p><code>game/models/player/player.py</code></p>
<pre tabindex="0"><code>...
class Player(models.Model):
    ...
    score = models.IntegerField(default=1500)
    ...
</code></pre><p><code>consumers/multiplayer/index.py</code></p>
<pre tabindex="0"><code>from channels.generic.websocket import AsyncWebsocketConsumer
import json
from django.conf import settings
from django.core.cache import cache

from thrift import Thrift
from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol

from match_system.src.match_server.match_service import Match
from game.models.player.player import Player
from channels.db import database_sync_to_async

class MultiPlayer(AsyncWebsocketConsumer):
    async def connect(self):
        await self.accept()

    async def disconnect(self, close_code):
        if self.room_name:
            await self.channel_layer.group_discard(self.room_name, self.channel_name)

    async def create_player(self, data):
        self.room_name = None
        self.uuid = data[&#39;uuid&#39;]
        # Make socket
        transport = TSocket.TSocket(&#39;127.0.0.1&#39;, 9090)
        # Buffering is critical. Raw sockets are very slow
        transport = TTransport.TBufferedTransport(transport)

        # Wrap in a protocol
        protocol = TBinaryProtocol.TBinaryProtocol(transport)

        # Create a client to use the protocol encoder
        client = Match.Client(protocol)

        def db_get_player():
            return Player.objects.get(user__username=data[&#39;username&#39;])

        player = await database_sync_to_async(db_get_player)()

        # Connect!
        transport.open()

        client.add_player(player.score, data[&#39;uuid&#39;], data[&#39;username&#39;], data[&#39;photo&#39;], self.channel_name)

        # Close!
        transport.close()
    
    async def group_send_event(self, data):
        if not self.room_name:
            keys = cache.keys(&#39;*%s*&#39; % (self.uuid))
            if keys:
                self.room_name = keys[0]
        await self.send(text_data=json.dumps(data))
    ...
</code></pre><h1 id="项目收尾ஐ">项目收尾ஐ</h1>
<h2 id="加密压缩js代码">加密、压缩js代码</h2>
<p>安装 <code>terser</code> :</p>
<pre tabindex="0"><code>sudo apt-get update
sudo apt-get install npm
sudo npm install terser -g
</code></pre><p><code>terser</code> 不仅支持文件输入，也支持标准输入。结果会输出到标准输出中。</p>
<p>使用方式：</p>
<pre tabindex="0"><code>terser xxx.js -c -m
</code></pre><p>我们将整合 <code>js</code> 文件的脚本修改一下即可：</p>
<p><code>scripts/compress_game_js.sh</code></p>
<pre tabindex="0"><code>#! /bin/bash

JS_PATH=/home/acs/acapp/game/static/js/
JS_PATH_DIST=${JS_PATH}dist/
JS_PATH_SRC=${JS_PATH}src/

find $JS_PATH_SRC -type f -name &#39;*.js&#39; | sort | xargs cat | terser -c -m &gt; ${JS_PATH_DIST}game.js

echo &#34;yes&#34; | python3 manage.py collectstatic
</code></pre><h2 id="清理监听函数">清理监听函数</h2>
<p>在AcAPP关闭之前触发的事件可以通过如下api添加：</p>
<pre tabindex="0"><code>AcWingOS.api.window.on_close(func);
</code></pre><p>注意：</p>
<ul>
<li>同一个页面中，多个 <code>acapp</code> 引入的 <code>js</code> 代码只会加载一次，因此 <code>AC_GAME_OBJECTS</code> 等全局变量是同一个页面、同一个 <code>acapp</code> 的所有窗口共用的</li>
<li>各自创建的局部变量是独立的，比如 <code>new AcGame()</code> 创建出的对象各个窗口是独立的</li>
</ul>
<p>我们给每一个窗口创建一个 <code>uid</code> 然后根据不同的 <code>uid</code> 进行事件解绑</p>
<p><code>playground/zbase.js</code></p>
<pre tabindex="0"><code>class AcGamePlayground {
    ...
    create_uuid() {
        let res = &#34;&#34;;
        for (let i = 0; i &lt; 8; i ++ ) {
            let x = parseInt(Math.floor(Math.random() * 10));   //[0, 10)
            res += x;
        }
        return res;
    }
    start() {
        let outer = this;
        let uuid = this.create_uuid();
        $(window).on(`resize.${uuid}`, function() {
            outer.resize();
        });

        if (this.root.AcWingOS) {
            outer.root.AcWingOS.api.window.on_close(function() {
                $(window).off(`resize.${uuid}`);
            });
        }
    }
    ...
}
</code></pre><h2 id="编写每局游戏的结束界面">编写每局游戏的结束界面</h2>
<p>单独创建一个结束界面，然后游戏结束的时候渲染出该结束界面即可</p>
<p>因为结束界面要覆盖在游戏界面之上，因此我们需要先修改一下游戏引擎，添加一个 <code>late_update</code></p>
<p>在每一帧渲染的内容最后再渲染，从而实现结束界面叠加在游戏界面之上的效果</p>
<p><code>ac_game_object/zbase.js</code></p>
<pre tabindex="0"><code>...
class AcGameObject {
    ...
    late_update() { // 每一帧均会执行一次，且在所有 update 执行完后才执行

    }
    ...
}
...
let AC_GAME_ANIMATION = function(timestamp) {
    ...
    for (let i = 0; i &lt; AC_GAME_OBJECTS.length; i ++ ) {
        let obj = AC_GAME_OBJECTS[i];
        obj.late_update();
    }
    ...
}
...
</code></pre><p>然后我们做一个渲染出结束界面的类</p>
<p><code>playground/score_board/zbase.js</code></p>
<pre tabindex="0"><code>class ScoreBoard extends AcGameObject {
    constructor(playground) {
        super();
        this.playground = playground;
        this.ctx = this.playground.game_map.ctx;

        this.state = null;  // win-胜利；lose-失败

        this.win_img = new Image();
        this.win_img.src = &#34;https://cdn.acwing.com/media/article/image/2021/12/17/1_8f58341a5e-win.png&#34;;

        this.lose_img = new Image();
        this.lose_img.src = &#34;https://cdn.acwing.com/media/article/image/2021/12/17/1_9254b5f95e-lose.png&#34;;
    }
    start() {
    }

    add_listening_events() {    // 点击后，返回主页面
        let outer = this;
        let $canvas = this.playground.game_map.$canvas;

        $canvas.on(&#39;click&#39;, function() {
            outer.playground.hide();
            outer.playground.root.menu.show();
        });
    }

    win() {
        this.state = &#34;win&#34;;
        let outer = this;
        setTimeout(function() {
            outer.add_listening_events();
        }, 1000);   // 1秒后监听点击事件
    }

    lose() {
        this.state = &#34;lose&#34;;
        let outer = this;
        setTimeout(function() {
            outer.add_listening_events();
        }, 1000);   // 1秒后监听点击事件
    }

    late_update() {
        this.render();  // 渲染在图层最上方
    }
    render() {
        let len = this.playground.height / 2;
        if (this.state === &#34;win&#34;) {
            this.ctx.drawImage(this.win_img, this.playground.width / 2 - len / 2, this.playground.height / 2 - len / 2, len, len);
        } else if (this.state === &#34;lose&#34;) {
            this.ctx.drawImage(this.lose_img, this.playground.width / 2 - len / 2, this.playground.height / 2 - len / 2, len, len);
        }
    }
}
</code></pre><p>通过游戏结束的逻辑判断，渲染结束界面，同时在结束并返回主菜单的时候，重置游戏元素</p>
<p>游戏元素重置</p>
<p><code>playground/zbase.js</code></p>
<pre tabindex="0"><code>class AcGamePlayground {
    ...
    show(mode) {    // 打开 playground 界面
        ...
        this.score_board = new ScoreBoard(this);
        ...
    }
    ...
    hide() {
        // 清空所有游戏元素
        while (this.players &amp;&amp; this.players.length &gt; 0) {
            this.players[0].destroy();
        }
        if (this.game_map) {
            this.game_map.destroy();
            this.game_map = null;
        }
        if (this.notice_board) {
            this.notice_board.destroy();
            this.notice_board = null;
        }
        if (this.score_board) {
            this.score_board.destroy();
            this.score_board = null;
        }
        this.$playground.empty();   // 清空所有html标签
        this.$playground.hide();
    }
}
</code></pre><p>游戏结束的逻辑判断</p>
<p><code>playground/player/zbase.js</code></p>
<pre tabindex="0"><code>class Player extends AcGameObject {
    ...
    update() {
        ...
        this.update_win();
        ...
    }
    update_win() {
        // 竞赛状态，且只有一名玩家，且改名玩家就是我，则胜利
        if (this.playground.state === &#34;fighting&#34; &amp;&amp; this.character === &#34;me&#34; &amp;&amp; this.playground.players.length === 1) {
            this.playground.state = &#34;over&#34;;
            this.playground.score_board.win();
        }
    }
    ...
    on_destroy() {
        // 我死亡，且游戏处于竞赛状态，则失败
        if (this.character === &#34;me&#34; &amp;&amp; this.playground.state === &#34;fighting&#34;) {
            this.playground.state = &#34;over&#34;
            this.playground.score_board.lose();
        }
        ...
    }
}
</code></pre><h2 id="更新战绩">更新战绩</h2>
<p>这里我们完全交给后端来判断</p>
<p>在处理广播的 <code>attack</code> 信息的时候，先前我们额外留了一个参数 <code>hp</code></p>
<p>围绕该 <code>hp</code> 进行续写，若当前房间内 <code>hp</code> 大于 0 的玩家少于等于 1 个</p>
<p>则对于所有 <code>hp</code> 为 0 的玩家减 <code>rank</code> 分，大于 0 的玩家加 <code>rank</code> 分</p>
<p><code>consumers/multiplayer/index.py</code></p>
<pre tabindex="0"><code>...
class MultiPlayer(AsyncWebsocketConsumer):
    ...
    async def attack(self, data):
        if not self.room_name:
            return
        players = cache.get(self.room_name)

        if not players:
            return

        for player in players:
            if player[&#39;uuid&#39;] == data[&#39;attackee_uuid&#39;]:
                player[&#39;hp&#39;] -= 25

        remain_cnt = 0
        for player in players:
            if player[&#39;hp&#39;] &gt; 0:
                remain_cnt += 1

        if remain_cnt &gt; 1:  # 继续进行游戏
            if self.room_name:
                cache.set(self.room_name, players, 3600)
        else:   # 结算 
            def db_update_player_score(username, score):
                player = Player.objects.get(user__username=username)
                player.score += score
                player.save()
            for player in players:
                if player[&#39;hp&#39;] &lt;= 0:
                    await database_sync_to_async(db_update_player_score)(player[&#39;username&#39;], -5)
                else:
                    await database_sync_to_async(db_update_player_score)(player[&#39;username&#39;], 10)
        ...
    ...
</code></pre><h2 id="添加faviconico">添加favicon.ico</h2>
<p>这是修正一个小 BUG，之前 web 端一直没有网页显示图标，这里给他加上去</p>
<p><code>game/templates/multiends/web.html</code></p>
<pre tabindex="0"><code>...
&lt;head&gt;
    ...
    &lt;link rel=&#34;icon&#34; href=&#34;https://cdn.acwing.com/media/article/image/2021/12/17/1_be4c11ce5f-acapp.png&#34;&gt;
&lt;/head&gt;
...
</code></pre><h1 id="各种环境命令">各种环境命令</h1>
<ol>
<li>启动<code>django</code>项目，在<code>~/acapp</code>目录下执行：</li>
</ol>
<pre tabindex="0"><code>python3 manage.py runserver 0.0.0.0:8000
</code></pre><ol start="2">
<li>每次修改好 <code>game/static</code>  下的文件后，需要在<code>~/acapp</code>目录下运行打包文件：</li>
</ol>
<pre tabindex="0"><code>./scripts/compress_game_js.sh
</code></pre><ol start="3">
<li>在定义完一个数据表之后，需要将创建的数据表更新到 <code>django</code> 的数据库中去：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f00">$</span> python3 manage.py makemigrations
</span></span><span style="display:flex;"><span>&gt; Migrations <span style="color:#fff;font-weight:bold">for</span> <span style="color:#0ff;font-weight:bold">&#39;game&#39;</span>:
</span></span><span style="display:flex;"><span>&gt;   game/migrations/<span style="color:#ff0;font-weight:bold">0001</span>_initial.py
</span></span><span style="display:flex;"><span>&gt;     - Create model Player
</span></span><span style="display:flex;"><span><span style="color:#f00">$</span> 
</span></span><span style="display:flex;"><span><span style="color:#f00">$</span> python3 manage.py migrate
</span></span><span style="display:flex;"><span>&gt; Operations to perform:
</span></span><span style="display:flex;"><span>&gt;   Apply <span style="color:#fff;font-weight:bold">all</span> migrations: admin, auth, contenttypes, game, sessions
</span></span><span style="display:flex;"><span>&gt; Running migrations:
</span></span><span style="display:flex;"><span>&gt;   Applying game<span style="color:#ff0;font-weight:bold">.0001</span>_initial... OK
</span></span></code></pre></div><ol start="4">
<li>启动<code>nginx</code>服务，用于域名访问：</li>
</ol>
<pre tabindex="0"><code>sudo /etc/init.d/nginx start
</code></pre><ol start="5">
<li>启动<code>uwsgi</code>服务，用于域名访问：</li>
</ol>
<pre tabindex="0"><code>uwsgi --ini scripts/uwsgi.ini
</code></pre><ol start="6">
<li>关闭<code>uwsgi</code>服务：</li>
</ol>
<pre tabindex="0"><code>sudo pkill -f uwsgi -9
</code></pre><ol start="7">
<li>启动 <code>redis-server</code>，用于一键登录：</li>
</ol>
<pre tabindex="0"><code>sudo redis-server /etc/redis/redis.conf
</code></pre><ol start="8">
<li>启动 <code>Django_channels</code>，用于联机对战，在<code>~/acapp</code>目录下执行：</li>
</ol>
<pre tabindex="0"><code>daphne -b 0.0.0.0 -p 5015 acapp.asgi:application
</code></pre><ol start="9">
<li>启动<code>thrift</code>服务，用于匹配系统，在<code>~/acapp/match_system/src/</code>目录下执行：</li>
</ol>
<pre tabindex="0"><code>./main.py
</code></pre><ol start="10">
<li>版本更新，在<a href="https://www.acwing.com/user/myspace/application/update/2433/">术士之战</a>中将 <code>js地址</code> 一栏更新为：</li>
</ol>
<pre tabindex="0"><code>// 本地文件夹中对应的文件也需要更改名字
https://app2433.acapp.acwing.com.cn/static/js/dist/game-版本号.js
</code></pre>]]></content:encoded>
    </item>
    
    <item>
      <title>计算机网络</title>
      <link>https://xancoding.cn/posts/computer-network/</link>
      <pubDate>Tue, 18 Oct 2022 18:34:30 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/computer-network/</guid>
      <description>&lt;h1 id=&#34;osi模型每层的数据单元名称&#34;&gt;OSI模型每层的数据单元名称&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;第一层：物理层；二进制比特流传输；bit（比特流）&lt;/li&gt;
&lt;li&gt;第二层：数据链路层；介质访问控制；frame（帧）&lt;/li&gt;
&lt;li&gt;第三层：网络层；确定地址和路由选择；packet（包），又叫做分组&lt;/li&gt;
&lt;li&gt;第四层：传输层；端到端连接；也叫作数据包。TCP的数据单元叫数据段，segment（段），而UDP协议的数据单元称为数据报（datagram）&lt;/li&gt;
&lt;li&gt;每层有特殊叫法，这种叫法是PDU（Protocol Data Unit 协议数据单元）。物理层的PDU叫做比特流，数据链路层的-PDU叫做帧；网络层的PDU叫做包；传输层的PDU叫做段，高层的PDU叫做数据（Data）&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;数据链路层&#34;&gt;数据链路层&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;以太网有一个重要的参数 $a$，它必须保持为很小的数值。这里 t 是以太网单程端到端时延， T&lt;sub&gt;0&lt;/sub&gt; 是帧的发送时间。我们知道， T&lt;sub&gt;0&lt;/sub&gt; 是帧长与发送速率之比，可见为了保持参数 a 不变，可以使t 与发送速率的乘积不变。在帧长一定的条件下，若数据率提高到 10 倍，可把网络电缆长度（因而使 t ）减小到原有数值的十分之一

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/12/24/63a624f89ab66.jpg&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/12/24/63a624f89ab66.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;以太网帧的最小长度 64 Byte 是由 CSMA/CD 限制所致
&lt;ol&gt;
&lt;li&gt;最早的以太网工作方式：载波多路复用/冲突检测（CSMA/CD），因为网络是共享的，即任何一个节点发送数据之前，先要侦听线路上是否有数据在传输，如果有，需要等待，如果线路可用，才可以发送。&lt;/li&gt;
&lt;li&gt;假设A发出第一个bit位，到达B，而B也正在传输第一个bit位，于是产生冲突，冲突信号得让A在完成最后一个bit位之前到达A。规定以太网中这个一来一回的时间间隙 slot time 是51.2μs（争用期）&lt;/li&gt;
&lt;li&gt;信号在以太网上传播信号大概是 1km 需要 5μs，以太网最大端到端时延必须小于争用期的一半（25.6μs）,这相当于以太网最大端到端长度为 5km，实际上以太网覆盖范围没有这么大&lt;/li&gt;
&lt;li&gt;在10Mbps（指的是&lt;strong&gt;传输速率&lt;/strong&gt;）的网络中，要求以太网帧最小长度为512个bits，从而&lt;strong&gt;让最极端的碰撞都能够被检测到&lt;/strong&gt;。换算一下就是 64 Byte，以太网帧的最小长度为 64 Byte。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;以太网帧的最大长度 1518 Byte 是为了传输效率
&lt;ol&gt;
&lt;li&gt;由于线路质量差而引起的丢包，发生在大包的概率也比小包概率大得多，所以大包在丢包率较高的线路上不是一个好的选择。&lt;/li&gt;
&lt;li&gt;但是如果选择一个比较小的长度，传输效率又不高，拿TCP应用来说，如果选择以太网长度为 218 Byte，TCP payload = 218 - Ethernet Header - IP Header - TCP Header = 218 - 18 - 20 - 20 = 160 Byte。那有效传输效率 = 160 / 218= &lt;strong&gt;73%&lt;/strong&gt;。而如果以太网长度为 1518 ，那有效传输效率 = 1460 / 1518 = &lt;strong&gt;96%&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;通过比较，选择较大的帧长度，有效传输效率更高，而更大的帧长度同时也会造成上述的问题，于是最终选择一个折衷的长度：1518 Byte 对应的 IP packet 就是 1500 Byte，这就是 &lt;strong&gt;最大传输单元MTU&lt;/strong&gt; 的由来。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;以太网的 MAC 帧格式

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/12/24/63a62682b54e3.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/12/24/63a62682b54e3.png&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;网络层&#34;&gt;网络层&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;一个链路层帧能承载的最大数据量叫作 &lt;strong&gt;最大传输单元MTU&lt;/strong&gt;，即 IP 数据报总长度（首部 + 数据部分）&lt;/li&gt;
&lt;li&gt;数据报的分片重新组装工作在 &lt;strong&gt;端系统&lt;/strong&gt;，而不是网络路由器&lt;/li&gt;
&lt;li&gt;IP 数据报分片，其中 &lt;strong&gt;标识&lt;/strong&gt; 字段标识号相同的分片属于同一数据报；最后一个片 &lt;strong&gt;标志&lt;/strong&gt; 字段置0，其余片置1；&lt;strong&gt;偏移&lt;/strong&gt; 字段指定该片应放在初始数据报的哪个位置，以 8 个字节为单位&lt;/li&gt;
&lt;li&gt;IP 数据报格式：
&lt;ol&gt;
&lt;li&gt;首部长度（以4字节为单位）：因为IP数据报包含一些可变数量的选项，所以该字段用以确认IP数据报中载荷（如被封装的运输层报文段）实际开始的地方。一般的IP数据包具有 20 字节的首部（不包含选项）&lt;/li&gt;
&lt;li&gt;数据报长度（以1字节为单位）：首部加上数据。16比特，理论上最大长度为65535字节。然而，数据报很少有超过 1500 字节的。&lt;/li&gt;
&lt;li&gt;协议：指示该数据报的数据部分应交给哪个特定的传输层协议&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;首部校验和&lt;/strong&gt;：帮助路由器检测收到的IP数据报中的比特错误。注意在每台路由器上必须重新计算校验和，因为TTL字段会变。
&lt;ul&gt;
&lt;li&gt;计算方法：在发送方，先把IP数据报首部划分成许多16位字的序列，并把检验和字段置零。用反码算术运算把所有的 16 位字相加后，将得到的和的反码写入检验和字段。接收方收到数据报后，把首部的所有 16 位字在使用反码算术想加一次，将得到的和取反码得到结果。若此结果为 0 ，说明首部未发生任何变化。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/12/24/63a6283aa07fa.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/12/24/63a6283aa07fa.png&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;IP 广播地址：255.255.255.255，会转发给同一网络中的所有主机。路由器也会有选择地向临近的子网转发该报文（虽然它们通常不这样做）&lt;/li&gt;
&lt;li&gt;IP 数据包越短，路由器转发越快。协议 IP 规定，在互联网中所有的主机和路由器必须能够接受长度不超过 576 字节的数据报。这是规定上层交下来的数据长度有 512 字节（合理的长度），加上最长的 IP 首部 60 字节，再加上 4 字节的富余量，得到 576 字节&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;运输层&#34;&gt;运输层&lt;/h1&gt;
&lt;h2 id=&#34;udp&#34;&gt;UDP&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;UDP报文段格式（UDP首部只有四个字段，每个字段由2个字节构成）（首部固定 8 个字节）：
&lt;ol&gt;
&lt;li&gt;长度：UDP报文段中的字节数（首部 + 数据），以 字节 为单位&lt;/li&gt;
&lt;li&gt;检验和：UDP计算检验和的方法和计算IP数据报首部检验和的方法相似。
&lt;ol&gt;
&lt;li&gt;在发送方，首先是先把全零放入检验和字段，再把伪首部（12个字节）以及UDP数据报看成是由许多 16 位的字串接起来的。若UDP数据部分不是偶数个字节，则要填入全零字节（但此字节不发送）。然后按二进制反码计算出这些 16 位字的和，将此和的二进制反码写入检验和字段。&lt;/li&gt;
&lt;li&gt;在接受方，把收到的UDP用户数据报连同伪首部（以及可能的填充全零字节）一起按二进制反码求这些 16 位字的和。若结果全 1，说明无差错。&lt;/li&gt;
&lt;li&gt;伪首部（12 字节）：
&lt;ol&gt;
&lt;li&gt;4 字节的 源IP地址 字段&lt;/li&gt;
&lt;li&gt;4 字节的 目的IP地址 字段&lt;/li&gt;
&lt;li&gt;1 字节的 全0 字段&lt;/li&gt;
&lt;li&gt;1 字节的 IP首部中的协议（如UDP） 字段&lt;/li&gt;
&lt;li&gt;2字节的 IP首部中的数据长度（IP首部 + IP数据） 字段&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/12/24/63a62b099ce33.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/12/24/63a62b099ce33.png&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h2 id=&#34;tcp&#34;&gt;TCP&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;MSS&lt;/strong&gt; 是 TCP 报文段中的 &lt;strong&gt;数据字段&lt;/strong&gt; 的最大长度，数据字段 + TCP 首部 = TCP 报文段
&lt;ol&gt;
&lt;li&gt;由于 IP 数据报所经历的路径是动态变化的，因此在某条路径上不需要分片的 MSS，如果是另一条路径，将可能需要分片。因此最佳 MSS 难以确定。&lt;/li&gt;
&lt;li&gt;在连接建立的过程中，双方都把自己能够支持的 MSS 写入TCP MSS 可选字段，以后就按照该数值传送数据，两个传送方向可以由不同的 MSS 值&lt;/li&gt;
&lt;li&gt;若主机未填写这一项，默认值为 536 字节 （576 字节的 IP数据报 - 20 字节 IP固定首部 - 20 字节 TCP固定首部）&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;TCP 的有限状态机
&lt;ol&gt;
&lt;li&gt;粗实线箭头表示对客户进程的正常变迁&lt;/li&gt;
&lt;li&gt;粗虚线箭头表示对服务器进程的正常变迁&lt;/li&gt;
&lt;li&gt;细线箭头表示异常变迁&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/12/24/63a62dc1498b9.jpg&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/12/24/63a62dc1498b9.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;TCP 报文段格式
&lt;ol&gt;
&lt;li&gt;数据偏移：单位为 4 字节，它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/12/24/63a63fe7455be.jpg&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/12/24/63a63fe7455be.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


4. TCP 拥塞控制

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/12/24/63a62e5505ea2.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/12/24/63a62e5505ea2.png&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


5. 三次握手

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637052e140268.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637052e140268.png&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


6. 四次挥手

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/13/637055a33c4fe.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/13/637055a33c4fe.png&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h1 id=&#34;推荐阅读&#34;&gt;推荐阅读&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1FS4y1Y7Qe?p=1&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;【哈工大】计算机网络 李全龙（全59讲）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1JV411t7ow/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=ae16ff6478eb15c1b87880540263910b&#34;&gt;【中科大】郑烇、杨坚《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/386387918&#34;&gt;计算机网络（谢希仁版）第七版答案&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://xiaolincoding.com/network/&#34;&gt;图解网络 | 小林coding&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://vixbob.moe/25.html&#34;&gt;Stanford CS144 Lab Assignment 学习笔记 | ViXbob的博客&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/26941639/&#34;&gt;《网络是怎样连接的》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/25863515/&#34;&gt;《图解 HTTP》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/24737674/&#34;&gt;《图解TCP/IP（第5版）》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/35498120/&#34;&gt;《计算机网络（第8版）》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/30280001/&#34;&gt;《计算机网络：自顶向下方法》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/1088054/&#34;&gt;《TCP/IP详解 卷1：协议》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/26268767/&#34;&gt;《Wireshark网络分析就这么简单》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/26710788/&#34;&gt;《Wireshark网络分析的艺术》&lt;/a&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/26941639/&#34; urlstring=&#34;https://book.douban.com/subject/26941639/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/25863515/&#34; urlstring=&#34;https://book.douban.com/subject/25863515/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/24737674/&#34; urlstring=&#34;https://book.douban.com/subject/24737674/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/35498120/&#34; urlstring=&#34;https://book.douban.com/subject/35498120/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/30280001/&#34; urlstring=&#34;https://book.douban.com/subject/30280001/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/1088054/&#34; urlstring=&#34;https://book.douban.com/subject/1088054/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/26268767/&#34; urlstring=&#34;https://book.douban.com/subject/26268767/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/26710788/&#34; urlstring=&#34;https://book.douban.com/subject/26710788/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<h1 id="osi模型每层的数据单元名称">OSI模型每层的数据单元名称</h1>
<ol>
<li>第一层：物理层；二进制比特流传输；bit（比特流）</li>
<li>第二层：数据链路层；介质访问控制；frame（帧）</li>
<li>第三层：网络层；确定地址和路由选择；packet（包），又叫做分组</li>
<li>第四层：传输层；端到端连接；也叫作数据包。TCP的数据单元叫数据段，segment（段），而UDP协议的数据单元称为数据报（datagram）</li>
<li>每层有特殊叫法，这种叫法是PDU（Protocol Data Unit 协议数据单元）。物理层的PDU叫做比特流，数据链路层的-PDU叫做帧；网络层的PDU叫做包；传输层的PDU叫做段，高层的PDU叫做数据（Data）</li>
</ol>
<h1 id="数据链路层">数据链路层</h1>
<ol>
<li>以太网有一个重要的参数 $a$，它必须保持为很小的数值。这里 t 是以太网单程端到端时延， T<sub>0</sub> 是帧的发送时间。我们知道， T<sub>0</sub> 是帧长与发送速率之比，可见为了保持参数 a 不变，可以使t 与发送速率的乘积不变。在帧长一定的条件下，若数据率提高到 10 倍，可把网络电缆长度（因而使 t ）减小到原有数值的十分之一

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/12/24/63a624f89ab66.jpg">
<img src="https://bu.dusays.com/2022/12/24/63a624f89ab66.jpg" alt=""  />
</a>
</div>

</li>
<li>以太网帧的最小长度 64 Byte 是由 CSMA/CD 限制所致
<ol>
<li>最早的以太网工作方式：载波多路复用/冲突检测（CSMA/CD），因为网络是共享的，即任何一个节点发送数据之前，先要侦听线路上是否有数据在传输，如果有，需要等待，如果线路可用，才可以发送。</li>
<li>假设A发出第一个bit位，到达B，而B也正在传输第一个bit位，于是产生冲突，冲突信号得让A在完成最后一个bit位之前到达A。规定以太网中这个一来一回的时间间隙 slot time 是51.2μs（争用期）</li>
<li>信号在以太网上传播信号大概是 1km 需要 5μs，以太网最大端到端时延必须小于争用期的一半（25.6μs）,这相当于以太网最大端到端长度为 5km，实际上以太网覆盖范围没有这么大</li>
<li>在10Mbps（指的是<strong>传输速率</strong>）的网络中，要求以太网帧最小长度为512个bits，从而<strong>让最极端的碰撞都能够被检测到</strong>。换算一下就是 64 Byte，以太网帧的最小长度为 64 Byte。</li>
</ol>
</li>
<li>以太网帧的最大长度 1518 Byte 是为了传输效率
<ol>
<li>由于线路质量差而引起的丢包，发生在大包的概率也比小包概率大得多，所以大包在丢包率较高的线路上不是一个好的选择。</li>
<li>但是如果选择一个比较小的长度，传输效率又不高，拿TCP应用来说，如果选择以太网长度为 218 Byte，TCP payload = 218 - Ethernet Header - IP Header - TCP Header = 218 - 18 - 20 - 20 = 160 Byte。那有效传输效率 = 160 / 218= <strong>73%</strong>。而如果以太网长度为 1518 ，那有效传输效率 = 1460 / 1518 = <strong>96%</strong></li>
<li>通过比较，选择较大的帧长度，有效传输效率更高，而更大的帧长度同时也会造成上述的问题，于是最终选择一个折衷的长度：1518 Byte 对应的 IP packet 就是 1500 Byte，这就是 <strong>最大传输单元MTU</strong> 的由来。</li>
</ol>
</li>
<li>以太网的 MAC 帧格式

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/12/24/63a62682b54e3.png">
<img src="https://bu.dusays.com/2022/12/24/63a62682b54e3.png" alt=""  />
</a>
</div>

</li>
</ol>
<h1 id="网络层">网络层</h1>
<ol>
<li>一个链路层帧能承载的最大数据量叫作 <strong>最大传输单元MTU</strong>，即 IP 数据报总长度（首部 + 数据部分）</li>
<li>数据报的分片重新组装工作在 <strong>端系统</strong>，而不是网络路由器</li>
<li>IP 数据报分片，其中 <strong>标识</strong> 字段标识号相同的分片属于同一数据报；最后一个片 <strong>标志</strong> 字段置0，其余片置1；<strong>偏移</strong> 字段指定该片应放在初始数据报的哪个位置，以 8 个字节为单位</li>
<li>IP 数据报格式：
<ol>
<li>首部长度（以4字节为单位）：因为IP数据报包含一些可变数量的选项，所以该字段用以确认IP数据报中载荷（如被封装的运输层报文段）实际开始的地方。一般的IP数据包具有 20 字节的首部（不包含选项）</li>
<li>数据报长度（以1字节为单位）：首部加上数据。16比特，理论上最大长度为65535字节。然而，数据报很少有超过 1500 字节的。</li>
<li>协议：指示该数据报的数据部分应交给哪个特定的传输层协议</li>
<li><strong>首部校验和</strong>：帮助路由器检测收到的IP数据报中的比特错误。注意在每台路由器上必须重新计算校验和，因为TTL字段会变。
<ul>
<li>计算方法：在发送方，先把IP数据报首部划分成许多16位字的序列，并把检验和字段置零。用反码算术运算把所有的 16 位字相加后，将得到的和的反码写入检验和字段。接收方收到数据报后，把首部的所有 16 位字在使用反码算术想加一次，将得到的和取反码得到结果。若此结果为 0 ，说明首部未发生任何变化。</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/12/24/63a6283aa07fa.png">
<img src="https://bu.dusays.com/2022/12/24/63a6283aa07fa.png" alt=""  />
</a>
</div>

</p>
<ol start="5">
<li>IP 广播地址：255.255.255.255，会转发给同一网络中的所有主机。路由器也会有选择地向临近的子网转发该报文（虽然它们通常不这样做）</li>
<li>IP 数据包越短，路由器转发越快。协议 IP 规定，在互联网中所有的主机和路由器必须能够接受长度不超过 576 字节的数据报。这是规定上层交下来的数据长度有 512 字节（合理的长度），加上最长的 IP 首部 60 字节，再加上 4 字节的富余量，得到 576 字节</li>
</ol>
<h1 id="运输层">运输层</h1>
<h2 id="udp">UDP</h2>
<ol>
<li>UDP报文段格式（UDP首部只有四个字段，每个字段由2个字节构成）（首部固定 8 个字节）：
<ol>
<li>长度：UDP报文段中的字节数（首部 + 数据），以 字节 为单位</li>
<li>检验和：UDP计算检验和的方法和计算IP数据报首部检验和的方法相似。
<ol>
<li>在发送方，首先是先把全零放入检验和字段，再把伪首部（12个字节）以及UDP数据报看成是由许多 16 位的字串接起来的。若UDP数据部分不是偶数个字节，则要填入全零字节（但此字节不发送）。然后按二进制反码计算出这些 16 位字的和，将此和的二进制反码写入检验和字段。</li>
<li>在接受方，把收到的UDP用户数据报连同伪首部（以及可能的填充全零字节）一起按二进制反码求这些 16 位字的和。若结果全 1，说明无差错。</li>
<li>伪首部（12 字节）：
<ol>
<li>4 字节的 源IP地址 字段</li>
<li>4 字节的 目的IP地址 字段</li>
<li>1 字节的 全0 字段</li>
<li>1 字节的 IP首部中的协议（如UDP） 字段</li>
<li>2字节的 IP首部中的数据长度（IP首部 + IP数据） 字段</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/12/24/63a62b099ce33.png">
<img src="https://bu.dusays.com/2022/12/24/63a62b099ce33.png" alt=""  />
</a>
</div>

</p>
<h2 id="tcp">TCP</h2>
<ol>
<li><strong>MSS</strong> 是 TCP 报文段中的 <strong>数据字段</strong> 的最大长度，数据字段 + TCP 首部 = TCP 报文段
<ol>
<li>由于 IP 数据报所经历的路径是动态变化的，因此在某条路径上不需要分片的 MSS，如果是另一条路径，将可能需要分片。因此最佳 MSS 难以确定。</li>
<li>在连接建立的过程中，双方都把自己能够支持的 MSS 写入TCP MSS 可选字段，以后就按照该数值传送数据，两个传送方向可以由不同的 MSS 值</li>
<li>若主机未填写这一项，默认值为 536 字节 （576 字节的 IP数据报 - 20 字节 IP固定首部 - 20 字节 TCP固定首部）</li>
</ol>
</li>
<li>TCP 的有限状态机
<ol>
<li>粗实线箭头表示对客户进程的正常变迁</li>
<li>粗虚线箭头表示对服务器进程的正常变迁</li>
<li>细线箭头表示异常变迁</li>
</ol>
</li>
</ol>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/12/24/63a62dc1498b9.jpg">
<img src="https://bu.dusays.com/2022/12/24/63a62dc1498b9.jpg" alt=""  />
</a>
</div>

</p>
<ol start="3">
<li>TCP 报文段格式
<ol>
<li>数据偏移：单位为 4 字节，它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远</li>
</ol>
</li>
</ol>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/12/24/63a63fe7455be.jpg">
<img src="https://bu.dusays.com/2022/12/24/63a63fe7455be.jpg" alt=""  />
</a>
</div>


4. TCP 拥塞控制

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/12/24/63a62e5505ea2.png">
<img src="https://bu.dusays.com/2022/12/24/63a62e5505ea2.png" alt=""  />
</a>
</div>


5. 三次握手

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637052e140268.png">
<img src="https://bu.dusays.com/2022/11/13/637052e140268.png" alt=""  />
</a>
</div>


6. 四次挥手

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/13/637055a33c4fe.png">
<img src="https://bu.dusays.com/2022/11/13/637055a33c4fe.png" alt=""  />
</a>
</div>

</p>
<h1 id="推荐阅读">推荐阅读</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1FS4y1Y7Qe?p=1&amp;vd_source=ae16ff6478eb15c1b87880540263910b">【哈工大】计算机网络 李全龙（全59讲）</a></li>
<li><a href="https://www.bilibili.com/video/BV1JV411t7ow/?spm_id_from=333.337.search-card.all.click&amp;vd_source=ae16ff6478eb15c1b87880540263910b">【中科大】郑烇、杨坚《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》</a></li>
</ul>
<hr>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/386387918">计算机网络（谢希仁版）第七版答案</a></li>
<li><a href="https://xiaolincoding.com/network/">图解网络 | 小林coding</a></li>
<li><strong><a href="https://vixbob.moe/25.html">Stanford CS144 Lab Assignment 学习笔记 | ViXbob的博客</a></strong></li>
</ul>
<hr>
<ul>
<li><a href="https://book.douban.com/subject/26941639/">《网络是怎样连接的》</a></li>
<li><a href="https://book.douban.com/subject/25863515/">《图解 HTTP》</a></li>
<li><a href="https://book.douban.com/subject/24737674/">《图解TCP/IP（第5版）》</a></li>
<li><a href="https://book.douban.com/subject/35498120/">《计算机网络（第8版）》</a></li>
<li><a href="https://book.douban.com/subject/30280001/">《计算机网络：自顶向下方法》</a></li>
<li><a href="https://book.douban.com/subject/1088054/">《TCP/IP详解 卷1：协议》</a></li>
<li><a href="https://book.douban.com/subject/26268767/">《Wireshark网络分析就这么简单》</a></li>
<li><a href="https://book.douban.com/subject/26710788/">《Wireshark网络分析的艺术》</a>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26941639/" urlstring="https://book.douban.com/subject/26941639/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/25863515/" urlstring="https://book.douban.com/subject/25863515/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/24737674/" urlstring="https://book.douban.com/subject/24737674/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/35498120/" urlstring="https://book.douban.com/subject/35498120/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/30280001/" urlstring="https://book.douban.com/subject/30280001/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/1088054/" urlstring="https://book.douban.com/subject/1088054/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26268767/" urlstring="https://book.douban.com/subject/26268767/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26710788/" urlstring="https://book.douban.com/subject/26710788/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>数据结构与算法</title>
      <link>https://xancoding.cn/posts/data-structures-and-algorithms/</link>
      <pubDate>Tue, 18 Oct 2022 17:16:53 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/data-structures-and-algorithms/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Xancoding/Data-Structures-and-Algorithms&#34;&gt;数据结构与算法 | 我的笔记&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.programmercarl.com/&#34;&gt;代码随想录 x 数据结构与算法&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/activity/content/11/&#34;&gt;AcWing 算法基础课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/activity/content/16/&#34;&gt;AcWing 算法提高课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/activity/content/32/&#34;&gt;AcWing 算法进阶课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://oi-wiki.org/&#34;&gt;OI Wiki&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cp-wiki.vercel.app/&#34;&gt;CP Wiki&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://leetcode.cn/&#34;&gt;LeetCode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/&#34;&gt;AcWing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.luogu.com.cn/&#34;&gt;Luogo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://codeforces.com/&#34;&gt;Codeforces&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/6424904/&#34;&gt;《大话数据结构》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/35252621/&#34;&gt;《labuladong的算法小抄》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/30136932/&#34;&gt;《算法竞赛进阶指南》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/19952400/&#34;&gt;《算法（第4版）》&lt;/a&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/6424904/&#34; urlstring=&#34;https://book.douban.com/subject/6424904/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/35252621/&#34; urlstring=&#34;https://book.douban.com/subject/35252621/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/30136932/&#34; urlstring=&#34;https://book.douban.com/subject/30136932/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;style&gt;
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    &lt;/style&gt;
    &lt;script src=&#34;https://code.jquery.com/jquery-1.12.4.min.js&#34;
            integrity=&#34;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34;&gt;
        $(document).ready(function () {
            $(&#39;.douban_item&#39;).each(function () {
                var _this = $(this);
                var strs = _this.attr(&#39;urlstring&#39;).toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, &#34;$1&#34;);
                    var db_id = strs.replace(db_reg, &#34;$2&#34;).toString();
                    var db_api = &#34;https://douban.edui.fun/&#34;;
                    if (db_type === &#39;movie&#39;) {
                        var ls_item = &#39;movie&#39; + db_id;
                        var url = db_api + &#34;movies/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#34;json&#34;, success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === &#39;book&#39;) {
                        var ls_item = &#39;book&#39; + db_id;
                        var url = db_api + &#34;v2/book/id/&#34; + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === &#39;undefined&#39;) {
                            $.ajax({
                                url: url, type: &#39;GET&#39;, dataType: &#39;json&#39;, success: function (data) {
                                    localStorage.setItem(&#39;book&#39; + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.name + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;导演：&#34; + data.director + &#34; / 类型：&#34; + data.genre + &#34; / &#34; + data.year + &#34;&lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.intro.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.img + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $(&#34;&lt;div class=&#39;post-preview&#39;&gt;&lt;div class=&#39;post-preview--meta&#39;&gt;&lt;div class=&#39;post-preview--middle&#39;&gt;&lt;div class=&#39;post-preview--title&#39;&gt;&lt;a target=&#39;_blank&#39; style=&#39;box-shadow: none; font-weight: bolder;&#39; href=&#39;&#34; + str + &#34;&#39;&gt;&#34; + data.title + &#34;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#39;rating&#39;&gt;&lt;div class=&#39;rating-star allstar&#34; + db_star + &#34;&#39;&gt;&lt;/div&gt;&lt;div class=&#39;rating-average&#39;&gt;&#34; + data.rating.average + &#34;&lt;/div&gt;&lt;/div&gt;&lt;time class=&#39;post-preview--date&#39;&gt;&#34; + data.author + &#34; / &#34;+ data.publisher +&#34; / &#34;+ data.pubdate +&#34; &lt;/time&gt;&lt;section style=&#39;max-height:75px;overflow:hidden;&#39; class=&#39;post-preview--excerpt&#39;&gt;&#34; + data.summary.replace(/\s*/g, &#34;&#34;) + &#34;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;&lt;img referrerpolicy=&#39;no-referrer&#39; loading=&#39;lazy&#39; class=&#39;post-preview--image&#39; src=&#34; + data.images.medium + &#34;&gt;&lt;/div&gt;&#34;).replaceAll(_this)
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&#34;douban_show&#34;&gt;
    &lt;div id=&#34;dbhttps://book.douban.com/subject/19952400/&#34; urlstring=&#34;https://book.douban.com/subject/19952400/&#34; class=&#34;douban_item post-preview&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<ul>
<li><a href="https://github.com/Xancoding/Data-Structures-and-Algorithms">数据结构与算法 | 我的笔记</a></li>
</ul>
<hr>
<ul>
<li><a href="https://www.programmercarl.com/">代码随想录 x 数据结构与算法</a></li>
<li><a href="https://www.acwing.com/activity/content/11/">AcWing 算法基础课</a></li>
<li><a href="https://www.acwing.com/activity/content/16/">AcWing 算法提高课</a></li>
<li><a href="https://www.acwing.com/activity/content/32/">AcWing 算法进阶课</a></li>
<li><a href="https://oi-wiki.org/">OI Wiki</a></li>
<li><a href="https://cp-wiki.vercel.app/">CP Wiki</a></li>
</ul>
<hr>
<ul>
<li><a href="https://leetcode.cn/">LeetCode</a></li>
<li><a href="https://www.acwing.com/">AcWing</a></li>
<li><a href="https://www.luogu.com.cn/">Luogo</a></li>
<li><a href="https://codeforces.com/">Codeforces</a></li>
</ul>
<hr>
<ul>
<li><a href="https://book.douban.com/subject/6424904/">《大话数据结构》</a></li>
<li><a href="https://book.douban.com/subject/35252621/">《labuladong的算法小抄》</a></li>
<li><a href="https://book.douban.com/subject/30136932/">《算法竞赛进阶指南》</a></li>
<li><a href="https://book.douban.com/subject/19952400/">《算法（第4版）》</a>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/6424904/" urlstring="https://book.douban.com/subject/6424904/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/35252621/" urlstring="https://book.douban.com/subject/35252621/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/30136932/" urlstring="https://book.douban.com/subject/30136932/" class="douban_item post-preview"></div>
</div>
</body>
</html>


<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>" + data.author + " / "+ data.publisher +" / "+ data.pubdate +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/19952400/" urlstring="https://book.douban.com/subject/19952400/" class="douban_item post-preview"></div>
</div>
</body>
</html>

</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>AcWing Linux 基础课</title>
      <link>https://xancoding.cn/posts/acw-linux/</link>
      <pubDate>Sun, 16 Oct 2022 14:23:58 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/acw-linux/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.colopen-blog.com/Engineer/acw_linux/&#34;&gt;AcWing Linux 基础课 | Colopen&amp;rsquo;s blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/activity/content/57/&#34;&gt;AcWing Linux 基础课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/jlevy/the-art-of-command-line/blob/master/README-zh.md&#34;&gt;命令行的艺术 &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://missing-semester-cn.github.io/&#34;&gt;The Missing Semester of Your CS Education&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;terminal&#34;&gt;Terminal&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;终端，一个程序，是界面上打开的黑框框本身，&lt;code&gt;shell&lt;/code&gt; 运行于其中&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;shell&#34;&gt;Shell&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/2855530/&#34;&gt;常用文件管理命令 | AcWing Linux 基础课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/2855883/&#34;&gt;Shell 语法 | AcWing Linux 基础课&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/3030391/&#34;&gt;管道、环境变量与常用命令  | AcWing Linux 基础课&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/3030414/&#34;&gt;常用命令  | AcWing Linux 基础课&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wangdoc.com/bash/&#34;&gt;《Bash 脚本教程》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://missing-semester-cn.github.io/2020/course-shell/&#34;&gt;第 1 讲 - 课程概览与 Shell | The missing semester of your CS education&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://missing-semester-cn.github.io/2020/shell-tools/&#34;&gt;第 2 讲 - Shell 工具和脚本 | The missing semester of your CS education&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/19556676&#34;&gt;终极 Shell——ZSH&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ohmyzsh/ohmyzsh&#34;&gt;快速入门 zsh&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;shell是什么&#34;&gt;Shell是什么？&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Shell&lt;/code&gt; 是我们通过命令行与操作系统沟通的 &lt;code&gt;程序&lt;/code&gt;，是个 &lt;code&gt;命令行解释器&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Shell&lt;/code&gt; 脚本可以直接在命令行中执行，也可以将一套逻辑组织成一个文件，方便复用&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Shell&lt;/code&gt; 负责外界与 &lt;code&gt;Linux 内核&lt;/code&gt; 的交互，接收用户或其他应用程序的命令，然后把这些命令转化成内核能理解的语言，传给内核，内核是真正干活的，干完之后再把结果返回用户或应用程序&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Shell&lt;/code&gt;解释器有 &lt;code&gt;sh&lt;/code&gt;、&lt;code&gt;bash&lt;/code&gt;、&lt;code&gt;zsh...&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;shell常用命令&#34;&gt;Shell常用命令&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;ag xxx&lt;/code&gt;：搜索当前目录下的所有文件，&lt;strong&gt;检索&lt;code&gt;xxx&lt;/code&gt;字符串&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find /path/to/directory/ -name &#39;*.py&#39;&lt;/code&gt;：&lt;strong&gt;搜索&lt;/strong&gt;某个文件路径下的所有&lt;code&gt;*.py&lt;/code&gt;&lt;strong&gt;文件&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;history&lt;/code&gt;：展示当前用户的历史操作。内容存放在&lt;code&gt;~/.bash_history&lt;/code&gt;中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;grep xxx&lt;/code&gt;：从&lt;code&gt;stdin&lt;/code&gt;中读入若干行数据，如果某行中包含&lt;code&gt;xxx&lt;/code&gt;，则输出该行；否则忽略该行，&lt;strong&gt;用于查找文件里符合条件的字符串&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;tmux--vim&#34;&gt;Tmux &amp;amp;&amp;amp; Vim&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/2855620/&#34;&gt;Tmux和Vim | AcWing Linux 基础课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ruanyifeng.com/blog/2019/10/tmux.html&#34;&gt;Tmux 使用教程 | 阮一峰的网络日志&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://kuanghy.github.io/2016/09/29/tmux&#34;&gt;Tmux 简介与使用 | Huoty&amp;rsquo;s Blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://coolshell.cn/articles/5426.html#comments&#34;&gt;简明 VIM 练级攻略 | 酷壳&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://missing-semester-cn.github.io/2020/editors/&#34;&gt;第 3 讲 - 编辑器 (Vim) | The missing semester of your CS education&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://vim-adventures.com/&#34;&gt;VIM 大冒险 - Game&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;tmux-是什么&#34;&gt;Tmux 是什么？&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Tmux&lt;/code&gt; 是一个用于在终端窗口中运行多个终端会话的工具，即终端复用软件（terminal multiplexer）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;远程 &lt;code&gt;SSH&lt;/code&gt; 访问服务器进行工作时。即使非正常掉线，它能保存当前工作状态，并保证当前任务继续运行。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;tmux--session--window--pane&#34;&gt;Tmux &amp;amp;&amp;amp; Session &amp;amp;&amp;amp; Window &amp;amp;&amp;amp; Pane&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;一个&lt;code&gt;tmux &lt;/code&gt;可以有好多个&lt;code&gt;session&lt;/code&gt;(会话)&lt;/li&gt;
&lt;li&gt;一个&lt;code&gt;session&lt;/code&gt;可以有好多个&lt;code&gt;window&lt;/code&gt;(窗口)&lt;/li&gt;
&lt;li&gt;一个&lt;code&gt;window&lt;/code&gt;可以有好多个&lt;code&gt;pane&lt;/code&gt;(面板)&lt;/li&gt;
&lt;li&gt;一个&lt;code&gt;session&lt;/code&gt;里不超过10个&lt;code&gt;window&lt;/code&gt;是最方便的：可以用0到9迅速切换&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;tmux常用命令&#34;&gt;Tmux常用命令&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Ac-Terminal 下前缀键被修改成了 Ctrl + a，一般的默认情况下是 Ctrl + b&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;tmux new -s &amp;lt;session-name&amp;gt;&lt;/code&gt;：新建会话&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tmux detach&lt;/code&gt; $or$ &lt;code&gt;Ctrl + a d&lt;/code&gt;：分离会话，退出当前 Tmux 窗口，但是会话和里面的进程仍然在后台运行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tmux attach -t &amp;lt;session-name&amp;gt;&lt;/code&gt;：重新接入某个已存在的会话&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tmux kill-session -t &amp;lt;session-name&amp;gt;&lt;/code&gt;：杀死某个会话&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tmux switch -t &amp;lt;session-name&amp;gt;&lt;/code&gt;：切换会话&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tmux rename-session -t &amp;lt;old-name&amp;gt; &amp;lt;new-name&amp;gt;&lt;/code&gt;：重命名会话&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tmux ls&lt;/code&gt; $or$ &lt;code&gt;Ctrl + a s&lt;/code&gt;：查看当前所有的 Tmux 会话&lt;/li&gt;
&lt;li&gt;在&lt;code&gt;tmux&lt;/code&gt;中选中文本时，需要按住 &lt;code&gt;shift&lt;/code&gt; 键&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tmux&lt;/code&gt;中复制/粘贴文本：
&lt;ol&gt;
&lt;li&gt;按下 &lt;code&gt;Ctrl + a&lt;/code&gt; 后松开手指，然后按 &lt;code&gt;[&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;用鼠标选中文本，被选中的文本会被自动复制到tmux的剪贴板&lt;/li&gt;
&lt;li&gt;按下 &lt;code&gt;Ctrl + a&lt;/code&gt; 后松开手指，然后按 &lt;code&gt;]&lt;/code&gt; ，会将剪贴板中的内容粘贴到光标处&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;vim-是什么&#34;&gt;Vim 是什么？&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;VIM 是 Linux 系统上一款文本编辑器，它是操作 Linux 的一款利器。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;vim常用命令&#34;&gt;Vim常用命令&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;一般模式切换到编辑模式（常用）
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;i&lt;/code&gt; : 在光标所处位置 &lt;strong&gt;直接&lt;/strong&gt; 开始&lt;/li&gt;
&lt;li&gt;&lt;code&gt;a&lt;/code&gt; : 在光标所处位置的 &lt;strong&gt;下一个字符&lt;/strong&gt; 开始&lt;/li&gt;
&lt;li&gt;&lt;code&gt;o&lt;/code&gt; : 在光标所处位置的 &lt;strong&gt;下一行&lt;/strong&gt; 开始&lt;/li&gt;
&lt;li&gt;&lt;code&gt;r&lt;/code&gt; : 取代当前光标处的字符，然后开始&lt;/li&gt;
&lt;li&gt;&lt;code&gt;[ESC]&lt;/code&gt; : 退出编辑模式，回到一般模式&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;光标移动操作
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;n&amp;lt;Space&amp;gt;&lt;/code&gt; : &lt;strong&gt;n&lt;/strong&gt; 为数字，光标 &lt;strong&gt;向右移动&lt;/strong&gt;这一行的n个字符&lt;/li&gt;
&lt;li&gt;&lt;code&gt;n&amp;lt;Enter&amp;gt;&lt;/code&gt; : &lt;strong&gt;n&lt;/strong&gt; 为数字，光标 &lt;strong&gt;向下移动&lt;/strong&gt;n行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0&lt;/code&gt; 或 &lt;code&gt;功能键[Home]&lt;/code&gt;: 光标移动到 &lt;strong&gt;本行开头&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$&lt;/code&gt; 或 &lt;code&gt;功能键[End]&lt;/code&gt;: 光标移动到 &lt;strong&gt;本行末尾&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:n&lt;/code&gt; 或 &lt;code&gt;nG&lt;/code&gt; : &lt;strong&gt;n&lt;/strong&gt; 为数字，光标移动到 &lt;strong&gt;第n行&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;G&lt;/code&gt;: 光标移动到 &lt;strong&gt;最后一行&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gg&lt;/code&gt; : 光标移动到 &lt;strong&gt;第一行&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;查找、替换操作
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;/word&lt;/code&gt; : 向 &lt;strong&gt;光标之下&lt;/strong&gt; 寻找 第一个值为 &lt;strong&gt;word&lt;/strong&gt; 的字符串&lt;/li&gt;
&lt;li&gt;&lt;code&gt;?word&lt;/code&gt; : 向 &lt;strong&gt;光标之上&lt;/strong&gt; 寻找 第一个值为 &lt;strong&gt;word&lt;/strong&gt; 的字符串&lt;/li&gt;
&lt;li&gt;&lt;code&gt;n&lt;/code&gt; : 重复 &lt;strong&gt;前一个&lt;/strong&gt; 查找操作&lt;/li&gt;
&lt;li&gt;&lt;code&gt;N&lt;/code&gt; : 反向 重复 &lt;strong&gt;前一个&lt;/strong&gt; 查找操作&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:n1,n2s/word1/word2/g&lt;/code&gt; : &lt;strong&gt;n1&lt;/strong&gt; 与 &lt;strong&gt;n2&lt;/strong&gt; 为数字，在第 &lt;strong&gt;n1&lt;/strong&gt; 行与 &lt;strong&gt;n2&lt;/strong&gt; 行之间寻找 &lt;strong&gt;word1&lt;/strong&gt; 这个字符串，并将该字符串 替换 为 &lt;strong&gt;word2&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:1,$s/word1/word2/g&lt;/code&gt; : 将全文的 &lt;strong&gt;word1&lt;/strong&gt; 替换为 &lt;strong&gt;word2&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:1,$s/word1/word2/gc&lt;/code&gt; : 将全文的 &lt;strong&gt;word1&lt;/strong&gt; 替换为 &lt;strong&gt;word2&lt;/strong&gt;，且在替换前 &lt;strong&gt;要求用户确认&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;文本操作（可搭配 &lt;code&gt;数字+&amp;lt;Enter&amp;gt;/&amp;lt;Space&amp;gt;、0、G、$&lt;/code&gt; 等使用，达到预期组合效果）
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;v&lt;/code&gt; : 选中文本&lt;/li&gt;
&lt;li&gt;&lt;code&gt;d&lt;/code&gt; : 删除选中的文本&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dd&lt;/code&gt; : 删除当前行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;y&lt;/code&gt; : 复制选中的文本&lt;/li&gt;
&lt;li&gt;&lt;code&gt;yy&lt;/code&gt; : 复制当前行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;p&lt;/code&gt; : 将复制的数据在光标的下一行/下一个位置 粘贴&lt;/li&gt;
&lt;li&gt;&lt;code&gt;u&lt;/code&gt; : 撤销&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl + r&lt;/code&gt; : 取消撤销&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;gt;&lt;/code&gt; : 将选中的文本整体 &lt;strong&gt;向右缩进一次&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;&lt;/code&gt; : 将选中的文本整体 &lt;strong&gt;向左缩进一次&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;命令行操作
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;:w&lt;/code&gt; : 保存&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:w!&lt;/code&gt; : 强制保存&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:q&lt;/code&gt; : 退出&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:q!&lt;/code&gt; : 强制退出&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:wq&lt;/code&gt; : 保存并退出&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:set paste&lt;/code&gt; : 设置成粘贴模式，取消代码自动缩进&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:set nopaste&lt;/code&gt; : 取消粘贴模式，开启代码自动缩进&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:set nu&lt;/code&gt; : 显示行号&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:set nonu&lt;/code&gt; : 隐藏行号&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:noh&lt;/code&gt;：关闭查找关键词高亮&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl + q&lt;/code&gt; : 当&lt;code&gt;vim&lt;/code&gt;卡死时，可以 &lt;strong&gt;取消当前正在执行的命令&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ssh&#34;&gt;SSH&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/2898263/&#34;&gt;SSH | AcWing Linux 基础课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.github.com/cn/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account&#34;&gt;Adding a new SSH key to your GitHub account&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ssh是什么&#34;&gt;SSH是什么？&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;SSH是一种网络协议，用于计算机之间的加密登录&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;ssh-免密登录&#34;&gt;SSH 免密登录&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;ssh-key-gen&lt;/code&gt; ：在本地服务器生成密钥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cd .ssh/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vim config&lt;/code&gt; ：定义服务器别名&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;Host server
	HostName 服务器IP地址  
	User     登录用户名
	port     远程主机端口号，默认为 22
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;code&gt;ssh-copy-id server&lt;/code&gt;：在本地服务器配置免密登录至云服务器&lt;/li&gt;
&lt;li&gt;免密登录至&lt;code&gt;docker 容器&lt;/code&gt;步骤同上&lt;/li&gt;
&lt;li&gt;配置完成后，就可以直接使用 &lt;code&gt;ssh server&lt;/code&gt; 免密登录啦&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;scp&#34;&gt;SCP&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/2898266/&#34;&gt;SCP | AcWing Linux 基础课&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;scp是什么&#34;&gt;SCP是什么？&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;SCP是一个命令行程序，可让您在计算机之间安全地复制文件和目录&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;scp-传文件&#34;&gt;SCP 传文件&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;复制多个文件：&lt;code&gt;scp source1 source2 LOCAL_PATH SERVER:SERVER_PATH&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;复制文件夹 ：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;scp -r ~/tmp SERVER:/home/acs/&lt;/code&gt;：将本地家目录中的&lt;code&gt;tmp&lt;/code&gt;文件夹复制到服务器中的&lt;code&gt;/home/acs/&lt;/code&gt;目录下&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scp -r SERVER:homework .&lt;/code&gt;：将服务器中的&lt;code&gt;~/homework/&lt;/code&gt;文件夹复制到本地的当前路径下&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;git&#34;&gt;Git&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/file_system/file/content/whole/index/content/2932078/&#34;&gt;Git | AcWing Linux 基础课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://juejin.cn/column/6969263852206686221&#34;&gt;Git从放弃到入门&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://juejin.cn/post/6973299611536457742&#34;&gt;Git从放弃到入门：状态与阶段&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://juejin.cn/post/6974039503056928776&#34;&gt;Git从放弃到入门：撤销操作&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ruanyifeng.com/blog/2018/10/git-internals.html&#34;&gt;Git 原理入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://learngitbranching.js.org/?locale=zh_CN&#34;&gt;Learn Git Braching - Game&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://git-scm.com/book/zh/v2&#34;&gt;Pro Git Online&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;git是什么&#34;&gt;Git是什么？&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Git是一个开源的分布式版本控制系统，可以有效、高速地处理从很小到非常大的项目版本管理&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;git常用命令&#34;&gt;Git常用命令&lt;/h3&gt;
&lt;h4 id=&#34;常用命令&#34;&gt;常用命令&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;git add XX&lt;/code&gt;：将&lt;code&gt;XX&lt;/code&gt;文件添加到暂存区&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git commit -m &amp;quot;给自己看的备注信息&amp;quot;&lt;/code&gt;：将暂存区的内容提交到当前分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git push -u (第一次需要 -u 以后不需要)&lt;/code&gt; ：将当前分支推送到远程仓库&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git clone git@git.acwing.com:xxx/XXX.git&lt;/code&gt;：将远程仓库&lt;code&gt;XXX&lt;/code&gt;下载到当前目录下&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git log&lt;/code&gt;：查看当前分支的所有版本&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;git status&lt;/code&gt;：查看仓库状态&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;有时候暂存了更改，尚未提交至仓库，如何取消暂存的更改？&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;git restore --staged XX&lt;/code&gt;或&lt;code&gt;git reset HEAD XX&lt;/code&gt;：将&lt;code&gt;XX&lt;/code&gt;从暂存区里移除&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;有时候修改了本地工作目录（通常也叫工作区）的文件，如何放弃本地更改（尚未暂存）？&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;git checkout XX&lt;/code&gt;或&lt;code&gt;git restore XX&lt;/code&gt;：将&lt;code&gt;XX&lt;/code&gt;文件尚未加入暂存区的修改全部撤销&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;git-全局设置&#34;&gt;Git 全局设置&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;git config --global user.name xxx&lt;/code&gt;：设置全局用户名，信息记录在&lt;code&gt;~/.gitconfig&lt;/code&gt;文件中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git config --global user.email xxx@xxx.com&lt;/code&gt;：设置全局邮箱地址，信息记录在&lt;code&gt;~/.gitconfig&lt;/code&gt;文件中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git init&lt;/code&gt;：将当前目录配置成&lt;code&gt;git&lt;/code&gt;仓库，信息记录在隐藏的&lt;code&gt;.git&lt;/code&gt;文件夹中&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;git-查看命令&#34;&gt;Git 查看命令&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;git diff XX&lt;/code&gt;：查看&lt;code&gt;XX&lt;/code&gt;文件相对于暂存区修改了哪些内容&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git status&lt;/code&gt;：查看仓库状态&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git log&lt;/code&gt;：查看当前分支的所有版本&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git log --pretty=oneline&lt;/code&gt;：用一行来显示&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git reflog&lt;/code&gt;：查看&lt;code&gt;HEAD&lt;/code&gt;指针的移动历史（包括被回滚的版本）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git branch&lt;/code&gt;：查看所有分支和当前所处分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git pull&lt;/code&gt; ：将远程仓库的当前分支与本地仓库的当前分支合并&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;git-删除命令&#34;&gt;Git 删除命令&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;git rm --cached XX&lt;/code&gt;：将文件从仓库索引目录中删掉，不希望管理这个文件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git restore --staged xx&lt;/code&gt;：将&lt;code&gt;xx&lt;/code&gt;从暂存区里移除&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git checkout — XX&lt;/code&gt;或&lt;code&gt;git restore XX&lt;/code&gt;：将&lt;code&gt;XX&lt;/code&gt;文件尚未加入暂存区的修改全部撤销&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;git-代码回滚&#34;&gt;Git 代码回滚&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;git reset --hard HEAD^&lt;/code&gt;或&lt;code&gt;git reset --hard HEAD~ &lt;/code&gt;：将代码库回滚到上一个版本&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git reset --hard HEAD^^&lt;/code&gt;：往上回滚两次，以此类推&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git reset --hard HEAD~100&lt;/code&gt;：往上回滚100个版本&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git reset --hard 版本号&lt;/code&gt;：回滚到某一特定版本&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;git-远程仓库&#34;&gt;Git 远程仓库&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;git remote add origin git@git.acwing.com:xxx/XXX.git&lt;/code&gt;：将本地仓库关联到远程仓库&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git push -u (第一次需要-u以后不需要)&lt;/code&gt; ：将当前分支推送到远程仓库&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git push origin branch_name&lt;/code&gt;：将本地的某个分支推送到远程仓库&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git clone git@git.acwing.com:xxx/XXX.git&lt;/code&gt;：将远程仓库XXX下载到当前目录下&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git push --set-upstream origin branch_name&lt;/code&gt;：设置本地的&lt;code&gt;branch_name&lt;/code&gt;分支对应远程仓库的&lt;code&gt;branch_name&lt;/code&gt;分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git push -d origin branch_name&lt;/code&gt;：删除远程仓库的&lt;code&gt;branch_name&lt;/code&gt;分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git checkout -t origin/branch_name&lt;/code&gt;：将远程的&lt;code&gt;branch_name&lt;/code&gt;分支拉取到本地&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git pull&lt;/code&gt;：将远程仓库的当前分支与本地仓库的当前分支合并&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git pull origin branch_name&lt;/code&gt;：将远程仓库的&lt;code&gt;branch_name&lt;/code&gt;分支与本地仓库的当前分支合并&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git branch --set-upstream-to=origin/branch_name1 branch_name2&lt;/code&gt;：将远程的&lt;/li&gt;
&lt;li&gt;&lt;code&gt;branch_name1&lt;/code&gt;分支与本地的&lt;code&gt;branch_name2&lt;/code&gt;分支对应&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;git-分支命令&#34;&gt;Git 分支命令&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;git branch branch_name&lt;/code&gt;：创建新分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git branch&lt;/code&gt;：查看所有分支和当前所处分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git checkout -b branch_name&lt;/code&gt;：创建并切换到&lt;code&gt;branch_name&lt;/code&gt;这个分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git checkout branch_name&lt;/code&gt;：切换到&lt;code&gt;branch_name&lt;/code&gt;这个分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git merge branch_name&lt;/code&gt;：将分支&lt;code&gt;branch_name&lt;/code&gt;合并到当前分支上&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git branch -d branch_name&lt;/code&gt;：删除本地仓库的&lt;code&gt;branch_name&lt;/code&gt;分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git push --set-upstream origin branch_name&lt;/code&gt;：设置本地的&lt;code&gt;branch_name&lt;/code&gt;分支对应远程仓库的&lt;code&gt;branch_name&lt;/code&gt;分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git push -d origin branch_name&lt;/code&gt;：删除远程仓库的&lt;code&gt;branch_name&lt;/code&gt;分支&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git checkout -t origin/branch_name&lt;/code&gt;：将远程的&lt;code&gt;branch_name&lt;/code&gt;分支拉取到本地&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git pull&lt;/code&gt; ：将远程仓库的当前分支与本地仓库的当前分支合并&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git pull origin branch_name&lt;/code&gt;：将远程仓库的&lt;code&gt;branch_name&lt;/code&gt;分支与本地仓库的当前分支合并&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git branch --set-upstream-to=origin/branch_name1 branch_name2&lt;/code&gt;：将远程的&lt;/li&gt;
&lt;li&gt;&lt;code&gt;branch_name1&lt;/code&gt;分支与本地的&lt;code&gt;branch_name2&lt;/code&gt;分支对应&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;git-stash-暂存&#34;&gt;Git stash 暂存&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;git stash&lt;/code&gt;：将工作区和暂存区中尚未提交的修改存入栈中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git stash apply&lt;/code&gt;：将栈顶存储的修改恢复到当前分支，但不删除栈顶元素&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git stash drop&lt;/code&gt;：删除栈顶存储的修改&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git stash pop&lt;/code&gt;：将栈顶存储的修改恢复到当前分支，同时删除栈顶元素&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git stash list&lt;/code&gt;：查看栈中所有元素&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;git更换远程仓库地址&#34;&gt;Git更换远程仓库地址&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git remote -v  &lt;span style=&#34;color:#f00&#34;&gt;#&lt;/span&gt; &lt;span style=&#34;color:#f00&#34;&gt;查看远端地址&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git remote &lt;span style=&#34;color:#f00&#34;&gt;#&lt;/span&gt; &lt;span style=&#34;color:#f00&#34;&gt;查看远端仓库名&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git remote rm origin &lt;span style=&#34;color:#f00&#34;&gt;#&lt;/span&gt; &lt;span style=&#34;color:#f00&#34;&gt;删除远程的仓库&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git remote &lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;add&lt;/span&gt; origin https:&lt;span style=&#34;color:#007f7f&#34;&gt;//github.com/xx/xx.git （新地址） # 重新添加远程仓库&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git push --&lt;span style=&#34;color:#fff;font-weight:bold&#34;&gt;set&lt;/span&gt;-upstream origin master
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;本地项目上传到github&#34;&gt;本地项目上传到GitHub&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;配置&lt;code&gt;ssh-key&lt;/code&gt;实现本地与&lt;code&gt;Git&lt;/code&gt;服务器免密交互&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ssh-keygen  # 生成密钥
cat .ssh/id_rsa.pub
# 复制密钥，提交到 git 服务器的 ssh 密钥中
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;按照下面的操作在本地文件夹配置一下&lt;code&gt;Git&lt;/code&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git config --global user.name xxx  # 设置用户名
git config --global user.email xxx@xxx.com  # 设置用户邮箱

git init
git add .
git commit -m &amp;#34;xxx&amp;#34;
git remote add origin https://github.com/xxx/XXX.git  # 建立连接
git push -u origin master
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;gitignore的作用&#34;&gt;.gitignore的作用&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;工程常识：缓存文件，可执行文件，编译文件 不要传到自己的 git 项目里&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;.gitignore的作用就是帮助我们在git add时将我们指定的一些文件自动排除在外，不提交到git当中&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在Git工作区的根目录下创建一个特殊的&lt;code&gt;.gitignore&lt;/code&gt;文件，然后把要忽略的文件名填进去，Git就会自动忽略这些文件&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;thrift&#34;&gt;&lt;strong&gt;Thrift&lt;/strong&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/video/3479/&#34;&gt;Thrift | AcWing Linux 基础课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://git.acwing.com/fashen/thrift_learning/-/blob/master/readme.md&#34;&gt;Thrift_learning - AcGit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.colopen-blog.com/Engineer/acw_linux/&#34;&gt;AcWing Linux 基础课 | Colopen&amp;rsquo;s blog | Thrift&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://thrift.apache.org/&#34;&gt;thrift 官网&lt;/a&gt; -&amp;gt; &lt;a href=&#34;https://thrift.apache.org/tutorial/&#34;&gt;Tutorial&lt;/a&gt; -&amp;gt; &lt;a href=&#34;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob_plain;f=tutorial/tutorial.thrift&#34;&gt;tutorial.thrift&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;thrift是什么&#34;&gt;Thrift是什么？&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Thrift是一个轻量级、跨语言的远程过程服务调用（RPC）框架&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RPC（远程过程调用）是一个计算机通信协议，该协议允许运行于一台计算机的程序调用另一台计算机的子程序，而程序员无需额外地为这个交互作用编程&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Thrift用于跨语言服务开发，它将软件栈和代码生成引擎结合在一起，以构建在 C++、Java、Python、PHP、Ruby、Erlang、Perl、Haskell、C#、Cocoa、JavaScript、Node. Js、Smalltalk、OCaml 和 Delphi 等语言之间高效、无缝地工作的服务&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;例实现一个游戏的匹配服务&#34;&gt;例：实现一个游戏的匹配服务&lt;/h3&gt;
&lt;h4 id=&#34;基本框架&#34;&gt;基本框架&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;游戏应用端 &lt;code&gt;game&lt;/code&gt;（Python3）
&lt;ol&gt;
&lt;li&gt;客户端：与 匹配系统服务器 的服务端交互&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;匹配系统服务器 &lt;code&gt;match_system&lt;/code&gt;（C++）
&lt;ol&gt;
&lt;li&gt;服务端：与 游戏应用端 的客户端交互&lt;/li&gt;
&lt;li&gt;客户端：与 数据存储服务器 的服务端交互&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;数据存储服务器（已经实现）
&lt;ol&gt;
&lt;li&gt;服务端：与 匹配系统服务器 的客户端交互&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;文件结构&#34;&gt;文件结构&lt;/h4&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;|-- README.md
|-- game
|   `-- src
|       |-- client.py
|       `-- match_client
|           |-- __init__.py
|           |-- __pycache__
|           |   `-- __init__.cpython-38.pyc
|           `-- match
|               |-- Match.py
|               |-- __init__.py
|               |-- __pycache__
|               |   |-- Match.cpython-38.pyc
|               |   |-- __init__.cpython-38.pyc
|               |   `-- ttypes.cpython-38.pyc
|               |-- constants.py
|               `-- ttypes.py
|-- match_system
|   `-- src
|       |-- Match.o
|       |-- Save.o
|       |-- main
|       |-- main.cpp
|       |-- main.o
|       |-- match_server
|       |   |-- Match.cpp
|       |   |-- Match.h
|       |   |-- match_types.cpp
|       |   `-- match_types.h
|       |-- match_types.o
|       `-- save_client
|           |-- Save.cpp
|           |-- Save.h
|           `-- save_types.h
`-- thrift
    |-- match.thrift
    `-- save.thrift
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;实现过程&#34;&gt;实现过程&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;定义接口 (&lt;code&gt;thrift&lt;/code&gt; 文件夹用于存放接口 )&lt;/li&gt;
&lt;li&gt;完成 &lt;code&gt;Server&lt;/code&gt; 端
&lt;ol&gt;
&lt;li&gt;通过&lt;code&gt;match.thrift&lt;/code&gt;接口在&lt;code&gt;match_system&lt;/code&gt;文件夹下生成 C++版本的服务端&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;thrift -r --gen cpp tutorial.thrift
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;将&lt;code&gt;gen cpp&lt;/code&gt; 文件夹重命名，如：&lt;code&gt;match_server&lt;/code&gt;（区别于之后要在此处生成的&lt;code&gt;client_server&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;把 &lt;code&gt;Match_server.skeleton.cpp&lt;/code&gt; 移动到当前 &lt;code&gt;src&lt;/code&gt; 目录下并重命名为 &lt;code&gt;main.cpp&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;由于移动了 &lt;code&gt;main.cpp&lt;/code&gt; 故需要修改一下&lt;code&gt; main.cpp&lt;/code&gt; 中头文件里关于 &lt;code&gt;Match.h&lt;/code&gt; 的引用路径：&lt;code&gt;#include &amp;quot;Match.h&amp;quot;&lt;/code&gt; -&amp;gt; &lt;code&gt;#include &amp;quot;match_server/Match.h&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;在&lt;code&gt;main.cpp&lt;/code&gt;中实现具体业务逻辑&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;完成 &lt;code&gt;Client&lt;/code&gt; 端
&lt;ol&gt;
&lt;li&gt;通过&lt;code&gt;match.thrift&lt;/code&gt;接口在&lt;code&gt;game&lt;/code&gt;文件夹下生成 &lt;code&gt;python3&lt;/code&gt; 版本的服务端，然后通过修改得到客户端&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;thrift -r --gen py tutorial.thrift
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;删掉 &lt;code&gt;Match_remote &lt;/code&gt;，该文件是用 py 实现 服务端 时用的文件，此处我们只需要实现 &lt;strong&gt;客户端&lt;/strong&gt; 功能，因此他没有作用，不妨删掉，让文档简洁一点&lt;/li&gt;
&lt;li&gt;利用官网提供的模板，在&lt;code&gt;src&lt;/code&gt;文件夹下编写 &lt;strong&gt;客户端&lt;/strong&gt; 文件 &lt;code&gt;client.py&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;持久化到云端
&lt;ul&gt;
&lt;li&gt;将 &lt;strong&gt;非编译文件&lt;/strong&gt; 和 &lt;strong&gt;非可执行文件&lt;/strong&gt; 提交到 &lt;code&gt;git&lt;/code&gt; 中去（好的工程习惯）
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Cpp&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;git restore --stage *.o&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git restore --stage main&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Python&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;git restore --stage *.pyc   # .pyc文件是编译文件，不加入暂存区里&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git restore --stage *.swp   # .swp文件是缓存文件，不加入暂存区里&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;注意：先运行服务器后，客户端才能正常运行&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;thrift-接口&#34;&gt;Thrift 接口&lt;/h4&gt;
&lt;h5 id=&#34;matchthrift&#34;&gt;Match.thrift&lt;/h5&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;namespace cpp match_service
struct User {
    1: i32 id,
    2: string name,
    3: i32 scores
}
service Match {
    i32 add_user(1: User user, 2: string info),
    i32 remove_user(1: User user, 2: string info),
}
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id=&#34;savethrift&#34;&gt;Save.thrift&lt;/h5&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;namespace cpp save_service
service Save {
    /**
     * username: myserver的名称
     * password: myserver的密码的md5值的前8位，用命令md5sum
     * 用户名密码验证成功会返回0，验证失败会返回1
     * 验证成功后，结果会被保存到myserver:homework/lesson_6/result.txt中
     */
    i32 save_data(1: string username, 2: string password, 3: i32 player1_id, 4: i32 player2_id)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;各版本预览&#34;&gt;各版本预览&lt;/h4&gt;
&lt;h5 id=&#34;match_server10&#34;&gt;Match_server:1.0&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;match_client&lt;/code&gt;：创建固定的&lt;code&gt;User&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from match_client.match import Match
from match_client.match.ttypes import User

from thrift import Thrift
from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol


def main():
    # Make socket
    transport = TSocket.TSocket(&amp;#39;localhost&amp;#39;, 9090)

    # Buffering is critical. Raw sockets are very slow
    transport = TTransport.TBufferedTransport(transport)

    # Wrap in a protocol
    protocol = TBinaryProtocol.TBinaryProtocol(transport)

    # Create a client to use the protocol encoder
    client = Match.Client(protocol)

    # Connect!
    transport.open()

    user = User(1, &amp;#39;yxc&amp;#39;, 1500)
    client.add_user(user, &amp;#34;&amp;#34;)

    # Close!
    transport.close()


# 调用 main 函数
if __name__ == &amp;#34;__main__&amp;#34;:
    main()
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;match_server&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// This autogenerated skeleton file illustrates how to build a server.
// You should copy it to another filename to avoid overwriting it.
#include &amp;#34;match_server/Match.h&amp;#34;
#include &amp;lt;thrift/protocol/TBinaryProtocol.h&amp;gt;
#include &amp;lt;thrift/server/TSimpleServer.h&amp;gt;
#include &amp;lt;thrift/transport/TServerSocket.h&amp;gt;
#include &amp;lt;thrift/transport/TBufferTransports.h&amp;gt;
#include&amp;lt;iostream&amp;gt;
using namespace ::apache::thrift;
using namespace ::apache::thrift::protocol;
using namespace ::apache::thrift::transport;
using namespace ::apache::thrift::server;
using namespace  ::match_service;
using namespace std;
class MatchHandler : virtual public MatchIf {
 public:
  MatchHandler() {
    // Your initialization goes here
  }
  int32_t add_user(const User&amp;amp; user, const std::string&amp;amp; info) {
    // Your implementation goes here
    printf(&amp;#34;add_user\n&amp;#34;);
    return 0;
  }
  int32_t remove_user(const User&amp;amp; user, const std::string&amp;amp; info) {
    // Your implementation goes here
    printf(&amp;#34;remove_user\n&amp;#34;);
    return 0;
  }
};
int main(int argc, char **argv) {
  int port = 9090;
  ::std::shared_ptr&amp;lt;MatchHandler&amp;gt; handler(new MatchHandler());
  ::std::shared_ptr&amp;lt;TProcessor&amp;gt; processor(new MatchProcessor(handler));
  ::std::shared_ptr&amp;lt;TServerTransport&amp;gt; serverTransport(new TServerSocket(port));
  ::std::shared_ptr&amp;lt;TTransportFactory&amp;gt; transportFactory(new TBufferedTransportFactory());
  ::std::shared_ptr&amp;lt;TProtocolFactory&amp;gt; protocolFactory(new TBinaryProtocolFactory());
  TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory);
  
  cout &amp;lt;&amp;lt; &amp;#34;Start Match Server&amp;#34; &amp;lt;&amp;lt; endl;
    
  server.serve();
  return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id=&#34;match_server20&#34;&gt;Match_server:2.0&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;match_client&lt;/code&gt;：根据标准输入来创建&lt;code&gt;User&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from match_client.match import Match
from match_client.match.ttypes import User

from thrift import Thrift
from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol

# 利用 python 在终端读入信息需要引入 stdin
from sys import stdin

# 将原来的通信 main 函数改写成operate函数，每次需要的时候调用一次建立通信传递信息
# 目的是可以一直不断处理信息
# 然后重写 main 函数，使之能不断从终端读入信息
def operate(op, user_id, user_name, score):
    # Make socket 
	transport = TSocket.TSocket(&amp;#39;localhost&amp;#39;, 9090)
	
	# Buffering is critical. Raw sockets are very slow
	transport = TTransport.TBufferedTransport(transport)
	
	# Wrap in a protocol
	protocol = TBinaryProtocol.TBinaryProtocol(transport)
	
	# Create a client to use the protocol encoder
	client = Match.Client(protocol)
	
	# Connect!
	transport.open()

    # 针对 op 参数，分别进行 &amp;#34;增加&amp;#34; 与 &amp;#34;删出&amp;#34; 操作
    user = User(user_id, user_name, score)

    if op == &amp;#34;add&amp;#34;:
        client.add_user(user, &amp;#34;&amp;#34;)
    else:
        client.remove_user(user, &amp;#34;&amp;#34;)
    
    # Close!
	transport.close()

def main():
    for line in stdin:
        op, user_id, user_name, score = line.split(&amp;#39; &amp;#39;)
        operate(op, int(user_id), user_name, int(score))

# 调用 main 函数
if __name__ == &amp;#34;__main__&amp;#34;:
    main()
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;match_server&lt;/code&gt;：自动将用户池中前两个用户匹配到一起&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// This autogenerated skeleton file illustrates how to build a server.
// You should copy it to another filename to avoid overwriting it.
#include &amp;#34;match_server/Match.h&amp;#34;
#include &amp;lt;thrift/protocol/TBinaryProtocol.h&amp;gt;
#include &amp;lt;thrift/server/TSimpleServer.h&amp;gt;
#include &amp;lt;thrift/transport/TServerSocket.h&amp;gt;
#include &amp;lt;thrift/transport/TBufferTransports.h&amp;gt;
#include&amp;lt;iostream&amp;gt;
#include &amp;lt;thread&amp;gt;               // 需要线程，引入头文件
#include &amp;lt;mutex&amp;gt;                // 互斥信号量
#include &amp;lt;condition_variable&amp;gt;   // 条件变量，用于 阻塞和唤醒 线程
#include &amp;lt;queue&amp;gt;                // 用于模拟消息队列
#include &amp;lt;vector&amp;gt;
using namespace ::apache::thrift;
using namespace ::apache::thrift::protocol;
using namespace ::apache::thrift::transport;
using namespace ::apache::thrift::server;
using namespace  ::match_service;
using namespace std;
struct Task {   // 消息队列中的元素
    User user;
    string type;
};
struct MessageQueue {   // 消息队列
    queue&amp;lt;Task&amp;gt; q;          // 消息队列本体
    mutex m;                // 互斥信号量
    condition_variable cv;  // 条件变量，用于阻塞唤醒线程
}message_queue;
class Pool {    // 模拟匹配池
public:
    void save_result(int a, int b) {  // 记录成功匹配的信息
        printf(&amp;#34;Match Result: %d %d \n&amp;#34;, a, b);
    }
    void match() {  // 将匹配池中的第一、第二个用户匹配
        while (users.size() &amp;gt; 1) {
            auto a = users[0], b = users[1];
            users.erase(users.begin());
            users.erase(users.begin());
            save_result(a.id, b.id);
        }
    }
    
    void add(User user) {   // 向匹配池中加入用户
        users.push_back(user);
    }
    void remove(User user) {    // 向匹配池中删除用户
        for (uint32_t i = 0; i &amp;lt; users.size(); ++ i) {
            if (users[i].id == user.id) {
                users.erase(users.begin() + i);
                break;
           }
        }
    }
private:
    vector&amp;lt;User&amp;gt; users; // 匹配池中的用户，用 vector 记录
}pool;
class MatchHandler : virtual public MatchIf {
 public:
  MatchHandler() {
    // Your initialization goes here
  }
  int32_t add_user(const User&amp;amp; user, const std::string&amp;amp; info) {
    // Your implementation goes here
    printf(&amp;#34;add_user\n&amp;#34;);
    
    unique_lock&amp;lt;mutex&amp;gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &amp;#34;add&amp;#34;});        // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
    return 0;
  }
  int32_t remove_user(const User&amp;amp; user, const std::string&amp;amp; info) {
    // Your implementation goes here
    printf(&amp;#34;remove_user\n&amp;#34;);
    unique_lock&amp;lt;mutex&amp;gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &amp;#34;remove&amp;#34;});     // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
   
    return 0;
  }
};
// 基于“生产者-消费者模型”的线程
void consume_task() {
    while(true) {
        unique_lock&amp;lt;mutex&amp;gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
        if (message_queue.q.empty()) {
            message_queue.cv.wait(lck); // 这里要阻塞进程
            // 避免队列为空时，一直反复运行该进程，导致一直占用临界区，而不能加入新消息
        } else {
            auto task = message_queue.q.front();    // 取出消息队列队头元素
            message_queue.q.pop();
            lck.unlock();   // 临界区访问结束，直接解锁
            // 避免后续没用到临界区信息，而长时间占用临界区的情况发生
            
            if (task.type == &amp;#34;add&amp;#34;) pool.add(task.user);
            else if (task.type == &amp;#34;remove&amp;#34;) pool.remove(task.user);
            pool.match();
        } 
    }
}
int main(int argc, char **argv) {
  int port = 9090;
  ::std::shared_ptr&amp;lt;MatchHandler&amp;gt; handler(new MatchHandler());
  ::std::shared_ptr&amp;lt;TProcessor&amp;gt; processor(new MatchProcessor(handler));
  ::std::shared_ptr&amp;lt;TServerTransport&amp;gt; serverTransport(new TServerSocket(port));
  ::std::shared_ptr&amp;lt;TTransportFactory&amp;gt; transportFactory(new TBufferedTransportFactory());
  ::std::shared_ptr&amp;lt;TProtocolFactory&amp;gt; protocolFactory(new TBinaryProtocolFactory());
  TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory);
  
  cout &amp;lt;&amp;lt; &amp;#34;Start Match Server&amp;#34; &amp;lt;&amp;lt; endl;
  
  thread matching_thread(consume_task); // 调用一个线程运行 consume_task
  server.serve();
  
  return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id=&#34;match_server30&#34;&gt;Match_server:3.0&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;save_client&lt;/code&gt;：因为一个节点只能由一个&lt;code&gt;main&lt;/code&gt;方法作为程序的入口，所以匹配系统中的客户端和服务端写在同一个&lt;code&gt;main&lt;/code&gt;方法中&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// 需要额外引入的头文件
#include &amp;#34;save_client/Save.h&amp;#34;
#include &amp;lt;thrift/transport/TSocket.h&amp;gt;
#include &amp;lt;thrift/transport/TTransportUtils.h&amp;gt;

// 需要额外声明的命名空间
using namespace  ::save_service;

//重写 save_result 内的内容，使其能够与 &amp;#34;数据存储服务器&amp;#34; 交互
void save_result(int a, int b) { // 记录成功匹配的信息
    printf(&amp;#34;Match Result: %d %d\n&amp;#34;, a, b);

    // Client端的板子
    std::shared_ptr&amp;lt;TTransport&amp;gt; socket(new TSocket(&amp;#34;123.57.47.211&amp;#34;, 9090));
    std::shared_ptr&amp;lt;TTransport&amp;gt; transport(new TBufferedTransport(socket));
    std::shared_ptr&amp;lt;TProtocol&amp;gt; protocol(new TBinaryProtocol(transport));
    SaveClient client(protocol);

    try {
        transport-&amp;gt;open();

        //调用接口，把信息存储 &amp;#34;数据存储服务器&amp;#34; 中
        int res = client.save_data(&amp;#34;acs_4888&amp;#34;, &amp;#34;07637c4c&amp;#34;, a, b);
        //输出匹配结果
        if (!res) puts(&amp;#34;success&amp;#34;);
        else puts(&amp;#34;fail&amp;#34;);

        transport-&amp;gt;close();
    } catch (TException&amp;amp; tx) {
        cout &amp;lt;&amp;lt; &amp;#34;ERROR: &amp;#34; &amp;lt;&amp;lt; tx.what() &amp;lt;&amp;lt; endl;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;match_server&lt;/code&gt;：每次只匹配分差小于 50 的用户&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// This autogenerated skeleton file illustrates how to build a server.
// You should copy it to another filename to avoid overwriting it.
#include &amp;lt;thrift/transport/TSocket.h&amp;gt;
#include &amp;lt;thrift/transport/TTransportUtils.h&amp;gt;
#include &amp;#34;match_server/Match.h&amp;#34;
#include &amp;#34;save_client/Save.h&amp;#34;
#include &amp;lt;thrift/protocol/TBinaryProtocol.h&amp;gt;
#include &amp;lt;thrift/server/TSimpleServer.h&amp;gt;
#include &amp;lt;thrift/transport/TServerSocket.h&amp;gt;
#include &amp;lt;thrift/transport/TBufferTransports.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt; // 用于调用 sleep 函数
#include&amp;lt;iostream&amp;gt;
#include &amp;lt;thread&amp;gt;               // 需要线程，引入头文件
#include &amp;lt;mutex&amp;gt;                // 互斥信号量
#include &amp;lt;condition_variable&amp;gt;   // 条件变量，用于 阻塞和唤醒 线程
#include &amp;lt;queue&amp;gt;                // 用于模拟消息队列
#include &amp;lt;vector&amp;gt;
using namespace ::apache::thrift;
using namespace ::apache::thrift::protocol;
using namespace ::apache::thrift::transport;
using namespace ::apache::thrift::server;
using namespace ::save_service;
using namespace  ::match_service;
using namespace std;
struct Task {   // 消息队列中的元素
    User user;
    string type;
};
struct MessageQueue {   // 消息队列
    queue&amp;lt;Task&amp;gt; q;          // 消息队列本体
    mutex m;                // 互斥信号量
    condition_variable cv;  // 条件变量，用于阻塞唤醒线程
}message_queue;
class Pool {    // 模拟匹配池
public:
	//重写 save_result 内的内容，使其能够与 &amp;#34;数据存储服务器&amp;#34; 交互
    void save_result(int a, int b) {  // 记录成功匹配的信息
        printf(&amp;#34;Match Result: %d %d \n&amp;#34;, a, b);
        // Client端的板子
        std::shared_ptr&amp;lt;TTransport&amp;gt; socket(new TSocket(&amp;#34;123.57.47.211&amp;#34;, 9090));
        std::shared_ptr&amp;lt;TTransport&amp;gt; transport(new TBufferedTransport(socket));
        std::shared_ptr&amp;lt;TProtocol&amp;gt; protocol(new TBinaryProtocol(transport));
        SaveClient client(protocol);
        try {
            transport-&amp;gt;open();
            //调用接口，把信息存储 &amp;#34;数据存储服务器&amp;#34; 中
            int res = client.save_data(&amp;#34;acs_4888&amp;#34;, &amp;#34;07637c4c&amp;#34;, a, b);
            //输出匹配结果
            if (!res) puts(&amp;#34;success&amp;#34;);
            else puts(&amp;#34;fail&amp;#34;);
            transport-&amp;gt;close();
        } catch (TException&amp;amp; tx) {
            cout &amp;lt;&amp;lt; &amp;#34;ERROR: &amp;#34; &amp;lt;&amp;lt; tx.what() &amp;lt;&amp;lt; endl;
        }
    }
    void match() {  // 将匹配池中的第一、第二个用户匹配
        while (users.size() &amp;gt; 1) {
            // 按照 rank分 排序
            sort(users.begin(), users.end(), [&amp;amp;](User&amp;amp; a, User&amp;amp; b) {
                return a.scores &amp;lt; b.scores;
            });
            bool flag = true;
            for (uint32_t i = 1; i &amp;lt; users.size(); ++ i) {
                auto a = users[i - 1], b = users[i];
                // 两名玩家分数差小于50时进行匹配
                if (b.scores - a.scores &amp;lt;= 50) {
                    users.erase(users.begin() + i - 1, users.begin() + i + 1);
                    save_result(a.id, b.id);
                    flag = false;
                    break;
                }
            }
            if (flag) break;    // 一轮扫描后，发现没有能够匹配的用户，就停止扫描，等待下次调用
        }
    } 
    
    void add(User user) {   // 向匹配池中加入用户
        users.push_back(user);
    }
    void remove(User user) {    // 向匹配池中删除用户
        for (uint32_t i = 0; i &amp;lt; users.size(); ++ i) {
            if (users[i].id == user.id) {
                users.erase(users.begin() + i);
                break;
           }
        }
    }
private:
    vector&amp;lt;User&amp;gt; users; // 匹配池中的用户，用 vector 记录
}pool;
class MatchHandler : virtual public MatchIf {
 public:
  MatchHandler() {
    // Your initialization goes here
  }
  int32_t add_user(const User&amp;amp; user, const std::string&amp;amp; info) {
    // Your implementation goes here
    printf(&amp;#34;add_user\n&amp;#34;);
    
    unique_lock&amp;lt;mutex&amp;gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &amp;#34;add&amp;#34;});        // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
    return 0;
  }
  int32_t remove_user(const User&amp;amp; user, const std::string&amp;amp; info) {
    // Your implementation goes here
    printf(&amp;#34;remove_user\n&amp;#34;);
    unique_lock&amp;lt;mutex&amp;gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &amp;#34;remove&amp;#34;});     // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
   
    return 0;
  }
};
// 基于“生产者-消费者模型”的线程
void consume_task() {
    while(true) {
        unique_lock&amp;lt;mutex&amp;gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
        if (message_queue.q.empty()) {
            // message_queue.cv.wait(lck); // 这里要阻塞进程
            // 避免队列为空时，一直反复运行该进程，导致一直占用临界区，而不能加入新消息
            // 修改为每 1 秒进行一次匹配
            lck.unlock();   // 直接解锁临界区资源
            pool.match();   //调用 match()
            sleep(1);
        } else {
            auto task = message_queue.q.front();    // 取出消息队列队头元素
            message_queue.q.pop();
            lck.unlock();   // 临界区访问结束，直接解锁
            // 避免后续没用到临界区信息，而长时间占用临界区的情况发生
            
            if (task.type == &amp;#34;add&amp;#34;) pool.add(task.user);
            else if (task.type == &amp;#34;remove&amp;#34;) pool.remove(task.user);
            pool.match();
        } 
    }
}
int main(int argc, char **argv) {
  int port = 9090;
  ::std::shared_ptr&amp;lt;MatchHandler&amp;gt; handler(new MatchHandler());
  ::std::shared_ptr&amp;lt;TProcessor&amp;gt; processor(new MatchProcessor(handler));
  ::std::shared_ptr&amp;lt;TServerTransport&amp;gt; serverTransport(new TServerSocket(port));
  ::std::shared_ptr&amp;lt;TTransportFactory&amp;gt; transportFactory(new TBufferedTransportFactory());
  ::std::shared_ptr&amp;lt;TProtocolFactory&amp;gt; protocolFactory(new TBinaryProtocolFactory());
  TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory);
  
  cout &amp;lt;&amp;lt; &amp;#34;Start Match Server&amp;#34; &amp;lt;&amp;lt; endl;
  
  thread matching_thread(consume_task); // 调用一个线程运行 consume_task
  server.serve();
  
  return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id=&#34;match_server40&#34;&gt;Match_server:4.0&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;match_server&lt;/code&gt;：随时间扩大匹配域，每一单位的 &lt;code&gt;wt&lt;/code&gt; 会扩大 $50$ 分 的匹配域&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// This autogenerated skeleton file illustrates how to build a server.
// You should copy it to another filename to avoid overwriting it.
#include &amp;lt;thrift/transport/TSocket.h&amp;gt;
#include &amp;lt;thrift/transport/TTransportUtils.h&amp;gt;
#include &amp;#34;match_server/Match.h&amp;#34;
#include &amp;#34;save_client/Save.h&amp;#34;
#include &amp;lt;thrift/protocol/TBinaryProtocol.h&amp;gt;
#include &amp;lt;thrift/server/TSimpleServer.h&amp;gt;
#include &amp;lt;thrift/transport/TServerSocket.h&amp;gt;
#include &amp;lt;thrift/transport/TBufferTransports.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt; // 用于调用 sleep 函数
#include&amp;lt;iostream&amp;gt;
#include &amp;lt;thread&amp;gt;               // 需要线程，引入头文件
#include &amp;lt;mutex&amp;gt;                // 互斥信号量
#include &amp;lt;condition_variable&amp;gt;   // 条件变量，用于 阻塞和唤醒 线程
#include &amp;lt;queue&amp;gt;                // 用于模拟消息队列
#include &amp;lt;vector&amp;gt;
using namespace ::apache::thrift;
using namespace ::apache::thrift::protocol;
using namespace ::apache::thrift::transport;
using namespace ::apache::thrift::server;
using namespace ::save_service;
using namespace  ::match_service;
using namespace std;
struct Task {   // 消息队列中的元素
    User user;
    string type;
};
struct MessageQueue {   // 消息队列
    queue&amp;lt;Task&amp;gt; q;          // 消息队列本体
    mutex m;                // 互斥信号量
    condition_variable cv;  // 条件变量，用于阻塞唤醒线程
}message_queue;
class Pool {    // 模拟匹配池
public:
    void save_result(int a, int b) {  // 记录成功匹配的信息
        printf(&amp;#34;Match Result: %d %d \n&amp;#34;, a, b);
        // Client端的板子
        std::shared_ptr&amp;lt;TTransport&amp;gt; socket(new TSocket(&amp;#34;123.57.47.211&amp;#34;, 9090));
        std::shared_ptr&amp;lt;TTransport&amp;gt; transport(new TBufferedTransport(socket));
        std::shared_ptr&amp;lt;TProtocol&amp;gt; protocol(new TBinaryProtocol(transport));
        SaveClient client(protocol);
        try {
            transport-&amp;gt;open();
            //调用接口，把信息存储 &amp;#34;数据存储服务器&amp;#34; 中
            int res = client.save_data(&amp;#34;acs_4888&amp;#34;, &amp;#34;07637c4c&amp;#34;, a, b);
            //输出匹配结果
            if (!res) puts(&amp;#34;success&amp;#34;);
            else puts(&amp;#34;fail&amp;#34;);
            transport-&amp;gt;close();
        } catch (TException&amp;amp; tx) {
            cout &amp;lt;&amp;lt; &amp;#34;ERROR: &amp;#34; &amp;lt;&amp;lt; tx.what() &amp;lt;&amp;lt; endl;
        }
    }
    bool check_match(uint32_t i, uint32_t j) {
        auto a = users[i], b = users[j];
        
        int dt = abs(a.scores - b.scores);
        int a_max_dif = wt[i] * 50;
        int b_max_dif = wt[j] * 50;
        return dt &amp;lt;= a_max_dif &amp;amp;&amp;amp; dt &amp;lt;= b_max_dif;
    }
    void match() {
       for (uint32_t i = 0; i &amp;lt; wt.size(); ++ i)
           wt[i] ++;
        while (users.size() &amp;gt; 1) {
            bool flag = true;
            for (uint32_t i = 0; i &amp;lt; users.size(); ++ i) {
                for (uint32_t j = i + 1; j &amp;lt; users.size(); ++ j) {
                    if (check_match(i, j)) {
                        auto a = users[i], b = users[j];
                        users.erase(users.begin() + j);
                        users.erase(users.begin() + i);
                        wt.erase(wt.begin() + j);
                        wt.erase(wt.begin() + i);
                        save_result(a.id, b.id);
                        flag = false;
                        break;
                    }
                    if (!flag) break;       
                }
            }
            if (flag) break;    // 一轮扫描后，发现没有能够匹配的用户，就停止扫描，等待下次调用
        }
    } 
    
    void add(User user) {   // 向匹配池中加入用户
        users.push_back(user);
        wt.push_back(0);
    }
    void remove(User user) {    // 向匹配池中删除用户
        for (uint32_t i = 0; i &amp;lt; users.size(); ++ i) {
            if (users[i].id == user.id) {
                users.erase(users.begin() + i);
                wt.erase(wt.begin() + i);
                break;
           }
        }
    }
private:
    vector&amp;lt;User&amp;gt; users; // 匹配池中的用户，用 vector 记录
    vector&amp;lt;int&amp;gt; wt; // 等待时间，单位：s
}pool;
class MatchHandler : virtual public MatchIf {
 public:
  MatchHandler() {
    // Your initialization goes here
  }
  int32_t add_user(const User&amp;amp; user, const std::string&amp;amp; info) {
    // Your implementation goes here
    printf(&amp;#34;add_user\n&amp;#34;);
    
    unique_lock&amp;lt;mutex&amp;gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &amp;#34;add&amp;#34;});        // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
    return 0;
  }
  int32_t remove_user(const User&amp;amp; user, const std::string&amp;amp; info) {
    // Your implementation goes here
    printf(&amp;#34;remove_user\n&amp;#34;);
    unique_lock&amp;lt;mutex&amp;gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &amp;#34;remove&amp;#34;});     // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
   
    return 0;
  }
};
// 基于“生产者-消费者模型”的线程
void consume_task() {
    while(true) {
        unique_lock&amp;lt;mutex&amp;gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
        if (message_queue.q.empty()) {
            // message_queue.cv.wait(lck); // 这里要阻塞进程
            // 避免队列为空时，一直反复运行该进程，导致一直占用临界区，而不能加入新消息
            // 修改为每 1 秒进行一次匹配
            lck.unlock();   // 直接解锁临界区资源
            pool.match();   //调用 match()
            sleep(1);
        } else {
            auto task = message_queue.q.front();    // 取出消息队列队头元素
            message_queue.q.pop();
            lck.unlock();   // 临界区访问结束，直接解锁
            // 避免后续没用到临界区信息，而长时间占用临界区的情况发生
            
            if (task.type == &amp;#34;add&amp;#34;) pool.add(task.user);
            else if (task.type == &amp;#34;remove&amp;#34;) pool.remove(task.user);
        } 
    }
}
int main(int argc, char **argv) {
  int port = 9090;
  ::std::shared_ptr&amp;lt;MatchHandler&amp;gt; handler(new MatchHandler());
  ::std::shared_ptr&amp;lt;TProcessor&amp;gt; processor(new MatchProcessor(handler));
  ::std::shared_ptr&amp;lt;TServerTransport&amp;gt; serverTransport(new TServerSocket(port));
  ::std::shared_ptr&amp;lt;TTransportFactory&amp;gt; transportFactory(new TBufferedTransportFactory());
  ::std::shared_ptr&amp;lt;TProtocolFactory&amp;gt; protocolFactory(new TBinaryProtocolFactory());
  TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory);
  
  cout &amp;lt;&amp;lt; &amp;#34;Start Match Server&amp;#34; &amp;lt;&amp;lt; endl;
  
  thread matching_thread(consume_task); // 调用一个线程运行 consume_task
  server.serve();
  
  return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;usage&#34;&gt;Usage&lt;/h4&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 启动服务端
./match_system/src/main

# 启动客户端
python3 game/src/client.py

# 游戏应用端 （op id name scores）
add 1 yxc 2000
add 2 xan 1500
add 3 zagy 2500
remove 3 zagy 2500

# 匹配系统服务器
add_user
add_user
remove_user 
# 等待了 10 s
Match Result: 1 2
success
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;项目地址&#34;&gt;项目地址&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Xancoding/Learning-Thrift&#34;&gt;Learning-Thrift&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;docker&#34;&gt;Docker&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.acwing.com/blog/content/10878/&#34;&gt;Docker | AcWing Linux 基础课&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html&#34;&gt;Docker 入门教程 | 阮一峰的网络日志&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;docker是什么&#34;&gt;Docker是什么？&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中,然后发布到任何流行的Linux或Windows操作系统的机器上&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;docker常用命令&#34;&gt;Docker常用命令&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;镜像（images）&lt;/code&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;docker images&lt;/code&gt;：列出本地所有镜像&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker image rm ubuntu:20.04&lt;/code&gt;：删除镜像&lt;code&gt;ubuntu:20.04&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker commit CONTAINER_NAME IMAGE_NAME:TAG&lt;/code&gt;：创建某个&lt;code&gt;container&lt;/code&gt;的镜像，&lt;code&gt;TAG&lt;/code&gt; 为镜像标签，用以记录当前版本。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker save -o ubuntu_20_04.tar ubuntu:20.04&lt;/code&gt;：将镜像&lt;code&gt;ubuntu:20.04&lt;/code&gt;导出到本地文件&lt;code&gt;ubuntu_20_04.tar&lt;/code&gt;中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker load -i ubuntu_20_04.tar&lt;/code&gt;：将镜像&lt;code&gt;ubuntu:20.04&lt;/code&gt;从本地文件&lt;code&gt;ubuntu_20_04.tar&lt;/code&gt;中加载出来&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;容器(container)&lt;/code&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;docker ps -a&lt;/code&gt;：查看本地的所有容器&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker start CONTAINER&lt;/code&gt;：启动容器&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker stop CONTAINER&lt;/code&gt;：停止容器&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker restart CONTAINER&lt;/code&gt;：重启容器&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker rm CONTAINER&lt;/code&gt;：删除容器&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker run -p HOST_PORT:CONTAINER_PORT --name CONTAINER_NAME -itd IMAGE_NAME:TAG&lt;/code&gt;：将创建并启动一个容器
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-p&lt;/code&gt;：端口映射，将宿主机的端口和容器的端口进行映射
&lt;ul&gt;
&lt;li&gt;例：&lt;code&gt;-p 20000:22 -p 8000:8000 -p 80:80 -p 443:443&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;22&lt;/code&gt;：&lt;code&gt;ssh&lt;/code&gt;登录服务端口&lt;/li&gt;
&lt;li&gt;&lt;code&gt;8000&lt;/code&gt;：&lt;code&gt;Django&lt;/code&gt;调试端口&lt;/li&gt;
&lt;li&gt;&lt;code&gt;80&lt;/code&gt;：用于&lt;code&gt;HTTP&lt;/code&gt;服务&lt;/li&gt;
&lt;li&gt;&lt;code&gt;443&lt;/code&gt;：用于&lt;code&gt;HTTPS&lt;/code&gt;服务&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker attach CONTAINER&lt;/code&gt;：进入容器
&lt;ul&gt;
&lt;li&gt;先按&lt;code&gt;Ctrl-p&lt;/code&gt;，再按&lt;code&gt;Ctrl-q&lt;/code&gt;可以挂起容器&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;docker环境配置&#34;&gt;Docker环境配置&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;scp django_lesson_1_0.tar server&lt;/code&gt;：将&lt;code&gt;docker压缩包&lt;/code&gt;传至云服务器&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ssh server&lt;/code&gt;：免密登录至云服务器&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker load -i django_lesson_1_0.tar&lt;/code&gt;：将&lt;code&gt;docker压缩包&lt;/code&gt;解压缩成&lt;code&gt;docker镜像&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker run -p 20000:22 8000:8000 --name django -itd django_lesson:1.0&lt;/code&gt; ：利用 &lt;code&gt;镜像django_lesson:1.0&lt;/code&gt; 创建一个命名为 &lt;code&gt;django&lt;/code&gt; 的 &lt;code&gt;docker容器&lt;/code&gt;并启动&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker attach my_docker_server&lt;/code&gt;：进入创建的&lt;code&gt;docker容器&lt;/code&gt;（服务器）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;adduser acs&lt;/code&gt;：创建&lt;code&gt;acs&lt;/code&gt;用户&lt;/li&gt;
&lt;li&gt;&lt;code&gt;usermod -aG sudo acs&lt;/code&gt;：为&lt;code&gt;acs&lt;/code&gt;用户分配&lt;code&gt;sudo&lt;/code&gt;权限&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scp .bashrc .vimrc .tmux.conf django&lt;/code&gt;：将本地服务器的&lt;code&gt;bash&lt;/code&gt;&amp;amp;&lt;code&gt;vim&lt;/code&gt;&amp;amp;&lt;code&gt;tmux&lt;/code&gt;配置文件传至&lt;code&gt;docker 容器&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;docker项目迁移&#34;&gt;Docker项目迁移&lt;/h3&gt;
&lt;p&gt;第一步，登录容器，关闭所有运行中的任务&lt;/p&gt;
&lt;p&gt;第二步，登录运行容器的服务器，然后执行：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;docker commit CONTAINER_NAME django_lesson:1.1  # 将容器保存成镜像，将CONTAINER_NAME替换成容器名称
docker stop CONTAINER_NAME # 关闭容器
docker rm CONTAINER_NAME # 删除容器
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;增加容器的映射端口--80-与-443&#34;&gt;增加容器的映射端口 : 80 与 443&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;给运行中的容器，开通端口，是一件非常麻烦的事情&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;一个比较好的解决方案 : 先把容器保存成镜像，再删掉容器，然后用镜像生成新的容器，同时打开需要的端口&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;第一步，登录容器，关闭所有运行中的任务&lt;/p&gt;
&lt;p&gt;第二步，登录运行容器的服务器，然后执行 :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker commit CONTAINER_NAME django_lesson:1.1  &lt;span style=&#34;color:#007f7f&#34;&gt;# 将容器保存成镜像，将CONTAINER_NAME替换成容器名称&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker stop CONTAINER_NAME  &lt;span style=&#34;color:#007f7f&#34;&gt;# 关闭容器&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker rm CONTAINER_NAME &lt;span style=&#34;color:#007f7f&#34;&gt;# 删除容器&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007f7f&#34;&gt;# 使用保存的镜像重新创建容器&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -p 20000:22 -p 8000:8000 -p 80:80 -p 443:443 --name CONTAINER_NAME -itd django_lesson:1.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;第三步，去云服务器控制台，在安全组配置中开放80和443端口&lt;/p&gt;
</description>
      <content:encoded><![CDATA[<ul>
<li><a href="https://www.colopen-blog.com/Engineer/acw_linux/">AcWing Linux 基础课 | Colopen&rsquo;s blog</a></li>
<li><a href="https://www.acwing.com/activity/content/57/">AcWing Linux 基础课</a></li>
<li><a href="https://github.com/jlevy/the-art-of-command-line/blob/master/README-zh.md">命令行的艺术 </a></li>
<li><a href="https://missing-semester-cn.github.io/">The Missing Semester of Your CS Education</a></li>
</ul>
<hr>
<h2 id="terminal">Terminal</h2>
<blockquote>
<p><strong>终端，一个程序，是界面上打开的黑框框本身，<code>shell</code> 运行于其中</strong></p>
</blockquote>
<h2 id="shell">Shell</h2>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/2855530/">常用文件管理命令 | AcWing Linux 基础课</a></li>
<li><strong><a href="https://www.acwing.com/file_system/file/content/whole/index/content/2855883/">Shell 语法 | AcWing Linux 基础课</a></strong></li>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/3030391/">管道、环境变量与常用命令  | AcWing Linux 基础课</a>
<ul>
<li><strong><a href="https://www.acwing.com/file_system/file/content/whole/index/content/3030414/">常用命令  | AcWing Linux 基础课</a></strong></li>
</ul>
</li>
<li><a href="https://wangdoc.com/bash/">《Bash 脚本教程》</a></li>
<li><a href="https://missing-semester-cn.github.io/2020/course-shell/">第 1 讲 - 课程概览与 Shell | The missing semester of your CS education</a></li>
<li><a href="https://missing-semester-cn.github.io/2020/shell-tools/">第 2 讲 - Shell 工具和脚本 | The missing semester of your CS education</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/19556676">终极 Shell——ZSH</a></li>
<li><a href="https://github.com/ohmyzsh/ohmyzsh">快速入门 zsh</a></li>
</ul>
<hr>
<h3 id="shell是什么">Shell是什么？</h3>
<ul>
<li><code>Shell</code> 是我们通过命令行与操作系统沟通的 <code>程序</code>，是个 <code>命令行解释器</code></li>
<li><code>Shell</code> 脚本可以直接在命令行中执行，也可以将一套逻辑组织成一个文件，方便复用</li>
<li><code>Shell</code> 负责外界与 <code>Linux 内核</code> 的交互，接收用户或其他应用程序的命令，然后把这些命令转化成内核能理解的语言，传给内核，内核是真正干活的，干完之后再把结果返回用户或应用程序</li>
<li><code>Shell</code>解释器有 <code>sh</code>、<code>bash</code>、<code>zsh...</code></li>
</ul>
<h3 id="shell常用命令">Shell常用命令</h3>
<ol>
<li><code>ag xxx</code>：搜索当前目录下的所有文件，<strong>检索<code>xxx</code>字符串</strong></li>
<li><code>find /path/to/directory/ -name '*.py'</code>：<strong>搜索</strong>某个文件路径下的所有<code>*.py</code><strong>文件</strong></li>
<li><code>history</code>：展示当前用户的历史操作。内容存放在<code>~/.bash_history</code>中</li>
<li><code>grep xxx</code>：从<code>stdin</code>中读入若干行数据，如果某行中包含<code>xxx</code>，则输出该行；否则忽略该行，<strong>用于查找文件里符合条件的字符串</strong></li>
</ol>
<h2 id="tmux--vim">Tmux &amp;&amp; Vim</h2>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/2855620/">Tmux和Vim | AcWing Linux 基础课</a></li>
<li><a href="https://www.ruanyifeng.com/blog/2019/10/tmux.html">Tmux 使用教程 | 阮一峰的网络日志</a></li>
<li><a href="http://kuanghy.github.io/2016/09/29/tmux">Tmux 简介与使用 | Huoty&rsquo;s Blog</a></li>
<li><a href="https://coolshell.cn/articles/5426.html#comments">简明 VIM 练级攻略 | 酷壳</a></li>
<li><a href="https://missing-semester-cn.github.io/2020/editors/">第 3 讲 - 编辑器 (Vim) | The missing semester of your CS education</a></li>
<li><a href="https://vim-adventures.com/">VIM 大冒险 - Game</a></li>
</ul>
<hr>
<h3 id="tmux-是什么">Tmux 是什么？</h3>
<blockquote>
<p><strong><code>Tmux</code> 是一个用于在终端窗口中运行多个终端会话的工具，即终端复用软件（terminal multiplexer）</strong></p>
<p><strong>远程 <code>SSH</code> 访问服务器进行工作时。即使非正常掉线，它能保存当前工作状态，并保证当前任务继续运行。</strong></p>
</blockquote>
<h3 id="tmux--session--window--pane">Tmux &amp;&amp; Session &amp;&amp; Window &amp;&amp; Pane</h3>
<ul>
<li>一个<code>tmux </code>可以有好多个<code>session</code>(会话)</li>
<li>一个<code>session</code>可以有好多个<code>window</code>(窗口)</li>
<li>一个<code>window</code>可以有好多个<code>pane</code>(面板)</li>
<li>一个<code>session</code>里不超过10个<code>window</code>是最方便的：可以用0到9迅速切换</li>
</ul>
<h3 id="tmux常用命令">Tmux常用命令</h3>
<blockquote>
<p><strong>Ac-Terminal 下前缀键被修改成了 Ctrl + a，一般的默认情况下是 Ctrl + b</strong></p>
</blockquote>
<ol>
<li><code>tmux new -s &lt;session-name&gt;</code>：新建会话</li>
<li><code>tmux detach</code> $or$ <code>Ctrl + a d</code>：分离会话，退出当前 Tmux 窗口，但是会话和里面的进程仍然在后台运行</li>
<li><code>tmux attach -t &lt;session-name&gt;</code>：重新接入某个已存在的会话</li>
<li><code>tmux kill-session -t &lt;session-name&gt;</code>：杀死某个会话</li>
<li><code>tmux switch -t &lt;session-name&gt;</code>：切换会话</li>
<li><code>tmux rename-session -t &lt;old-name&gt; &lt;new-name&gt;</code>：重命名会话</li>
<li><code>tmux ls</code> $or$ <code>Ctrl + a s</code>：查看当前所有的 Tmux 会话</li>
<li>在<code>tmux</code>中选中文本时，需要按住 <code>shift</code> 键</li>
<li><code>tmux</code>中复制/粘贴文本：
<ol>
<li>按下 <code>Ctrl + a</code> 后松开手指，然后按 <code>[</code></li>
<li>用鼠标选中文本，被选中的文本会被自动复制到tmux的剪贴板</li>
<li>按下 <code>Ctrl + a</code> 后松开手指，然后按 <code>]</code> ，会将剪贴板中的内容粘贴到光标处</li>
</ol>
</li>
</ol>
<h3 id="vim-是什么">Vim 是什么？</h3>
<blockquote>
<p><strong>VIM 是 Linux 系统上一款文本编辑器，它是操作 Linux 的一款利器。</strong></p>
</blockquote>
<h3 id="vim常用命令">Vim常用命令</h3>
<ol>
<li>一般模式切换到编辑模式（常用）
<ol>
<li><code>i</code> : 在光标所处位置 <strong>直接</strong> 开始</li>
<li><code>a</code> : 在光标所处位置的 <strong>下一个字符</strong> 开始</li>
<li><code>o</code> : 在光标所处位置的 <strong>下一行</strong> 开始</li>
<li><code>r</code> : 取代当前光标处的字符，然后开始</li>
<li><code>[ESC]</code> : 退出编辑模式，回到一般模式</li>
</ol>
</li>
<li>光标移动操作
<ol>
<li><code>n&lt;Space&gt;</code> : <strong>n</strong> 为数字，光标 <strong>向右移动</strong>这一行的n个字符</li>
<li><code>n&lt;Enter&gt;</code> : <strong>n</strong> 为数字，光标 <strong>向下移动</strong>n行</li>
<li><code>0</code> 或 <code>功能键[Home]</code>: 光标移动到 <strong>本行开头</strong></li>
<li><code>$</code> 或 <code>功能键[End]</code>: 光标移动到 <strong>本行末尾</strong></li>
<li><code>:n</code> 或 <code>nG</code> : <strong>n</strong> 为数字，光标移动到 <strong>第n行</strong></li>
<li><code>G</code>: 光标移动到 <strong>最后一行</strong></li>
<li><code>gg</code> : 光标移动到 <strong>第一行</strong></li>
</ol>
</li>
<li>查找、替换操作
<ol>
<li><code>/word</code> : 向 <strong>光标之下</strong> 寻找 第一个值为 <strong>word</strong> 的字符串</li>
<li><code>?word</code> : 向 <strong>光标之上</strong> 寻找 第一个值为 <strong>word</strong> 的字符串</li>
<li><code>n</code> : 重复 <strong>前一个</strong> 查找操作</li>
<li><code>N</code> : 反向 重复 <strong>前一个</strong> 查找操作</li>
<li><code>:n1,n2s/word1/word2/g</code> : <strong>n1</strong> 与 <strong>n2</strong> 为数字，在第 <strong>n1</strong> 行与 <strong>n2</strong> 行之间寻找 <strong>word1</strong> 这个字符串，并将该字符串 替换 为 <strong>word2</strong></li>
<li><code>:1,$s/word1/word2/g</code> : 将全文的 <strong>word1</strong> 替换为 <strong>word2</strong></li>
<li><code>:1,$s/word1/word2/gc</code> : 将全文的 <strong>word1</strong> 替换为 <strong>word2</strong>，且在替换前 <strong>要求用户确认</strong></li>
</ol>
</li>
<li>文本操作（可搭配 <code>数字+&lt;Enter&gt;/&lt;Space&gt;、0、G、$</code> 等使用，达到预期组合效果）
<ol>
<li><code>v</code> : 选中文本</li>
<li><code>d</code> : 删除选中的文本</li>
<li><code>dd</code> : 删除当前行</li>
<li><code>y</code> : 复制选中的文本</li>
<li><code>yy</code> : 复制当前行</li>
<li><code>p</code> : 将复制的数据在光标的下一行/下一个位置 粘贴</li>
<li><code>u</code> : 撤销</li>
<li><code>Ctrl + r</code> : 取消撤销</li>
<li><code>&gt;</code> : 将选中的文本整体 <strong>向右缩进一次</strong></li>
<li><code>&lt;</code> : 将选中的文本整体 <strong>向左缩进一次</strong></li>
</ol>
</li>
<li>命令行操作
<ol>
<li><code>:w</code> : 保存</li>
<li><code>:w!</code> : 强制保存</li>
<li><code>:q</code> : 退出</li>
<li><code>:q!</code> : 强制退出</li>
<li><code>:wq</code> : 保存并退出</li>
<li><code>:set paste</code> : 设置成粘贴模式，取消代码自动缩进</li>
<li><code>:set nopaste</code> : 取消粘贴模式，开启代码自动缩进</li>
<li><code>:set nu</code> : 显示行号</li>
<li><code>:set nonu</code> : 隐藏行号</li>
<li><code>:noh</code>：关闭查找关键词高亮</li>
</ol>
</li>
<li><code>Ctrl + q</code> : 当<code>vim</code>卡死时，可以 <strong>取消当前正在执行的命令</strong></li>
</ol>
<h2 id="ssh">SSH</h2>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/2898263/">SSH | AcWing Linux 基础课</a></li>
<li><a href="https://docs.github.com/cn/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account">Adding a new SSH key to your GitHub account</a></li>
</ul>
<hr>
<h3 id="ssh是什么">SSH是什么？</h3>
<blockquote>
<p><strong>SSH是一种网络协议，用于计算机之间的加密登录</strong></p>
</blockquote>
<h3 id="ssh-免密登录">SSH 免密登录</h3>
<ol>
<li><code>ssh-key-gen</code> ：在本地服务器生成密钥</li>
<li><code>cd .ssh/</code></li>
<li><code>vim config</code> ：定义服务器别名</li>
</ol>
<pre tabindex="0"><code class="language-config" data-lang="config">Host server
	HostName 服务器IP地址  
	User     登录用户名
	port     远程主机端口号，默认为 22
</code></pre><ol start="4">
<li><code>ssh-copy-id server</code>：在本地服务器配置免密登录至云服务器</li>
<li>免密登录至<code>docker 容器</code>步骤同上</li>
<li>配置完成后，就可以直接使用 <code>ssh server</code> 免密登录啦</li>
</ol>
<h2 id="scp">SCP</h2>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/2898266/">SCP | AcWing Linux 基础课</a></li>
</ul>
<hr>
<h3 id="scp是什么">SCP是什么？</h3>
<blockquote>
<p><strong>SCP是一个命令行程序，可让您在计算机之间安全地复制文件和目录</strong></p>
</blockquote>
<h3 id="scp-传文件">SCP 传文件</h3>
<ul>
<li>复制多个文件：<code>scp source1 source2 LOCAL_PATH SERVER:SERVER_PATH</code></li>
<li>复制文件夹 ：
<ul>
<li><code>scp -r ~/tmp SERVER:/home/acs/</code>：将本地家目录中的<code>tmp</code>文件夹复制到服务器中的<code>/home/acs/</code>目录下</li>
<li><code>scp -r SERVER:homework .</code>：将服务器中的<code>~/homework/</code>文件夹复制到本地的当前路径下</li>
</ul>
</li>
</ul>
<h2 id="git">Git</h2>
<ul>
<li><a href="https://www.acwing.com/file_system/file/content/whole/index/content/2932078/">Git | AcWing Linux 基础课</a></li>
<li><a href="https://juejin.cn/column/6969263852206686221">Git从放弃到入门</a>
<ul>
<li><a href="https://juejin.cn/post/6973299611536457742">Git从放弃到入门：状态与阶段</a></li>
<li><strong><a href="https://juejin.cn/post/6974039503056928776">Git从放弃到入门：撤销操作</a></strong></li>
</ul>
</li>
<li><a href="https://www.ruanyifeng.com/blog/2018/10/git-internals.html">Git 原理入门</a></li>
<li><a href="https://learngitbranching.js.org/?locale=zh_CN">Learn Git Braching - Game</a></li>
<li><a href="https://git-scm.com/book/zh/v2">Pro Git Online</a></li>
</ul>
<hr>
<h3 id="git是什么">Git是什么？</h3>
<blockquote>
<p><strong>Git是一个开源的分布式版本控制系统，可以有效、高速地处理从很小到非常大的项目版本管理</strong></p>
</blockquote>
<h3 id="git常用命令">Git常用命令</h3>
<h4 id="常用命令">常用命令</h4>
<ol>
<li><code>git add XX</code>：将<code>XX</code>文件添加到暂存区</li>
<li><code>git commit -m &quot;给自己看的备注信息&quot;</code>：将暂存区的内容提交到当前分支</li>
<li><code>git push -u (第一次需要 -u 以后不需要)</code> ：将当前分支推送到远程仓库</li>
<li><code>git clone git@git.acwing.com:xxx/XXX.git</code>：将远程仓库<code>XXX</code>下载到当前目录下</li>
<li><code>git log</code>：查看当前分支的所有版本</li>
<li><strong><code>git status</code>：查看仓库状态</strong></li>
<li><strong>有时候暂存了更改，尚未提交至仓库，如何取消暂存的更改？</strong>
<ul>
<li><strong><code>git restore --staged XX</code>或<code>git reset HEAD XX</code>：将<code>XX</code>从暂存区里移除</strong></li>
</ul>
</li>
<li><strong>有时候修改了本地工作目录（通常也叫工作区）的文件，如何放弃本地更改（尚未暂存）？</strong>
<ul>
<li><strong><code>git checkout XX</code>或<code>git restore XX</code>：将<code>XX</code>文件尚未加入暂存区的修改全部撤销</strong></li>
</ul>
</li>
</ol>
<h4 id="git-全局设置">Git 全局设置</h4>
<ol>
<li><code>git config --global user.name xxx</code>：设置全局用户名，信息记录在<code>~/.gitconfig</code>文件中</li>
<li><code>git config --global user.email xxx@xxx.com</code>：设置全局邮箱地址，信息记录在<code>~/.gitconfig</code>文件中</li>
<li><code>git init</code>：将当前目录配置成<code>git</code>仓库，信息记录在隐藏的<code>.git</code>文件夹中</li>
</ol>
<h4 id="git-查看命令">Git 查看命令</h4>
<ol>
<li><code>git diff XX</code>：查看<code>XX</code>文件相对于暂存区修改了哪些内容</li>
<li><code>git status</code>：查看仓库状态</li>
<li><code>git log</code>：查看当前分支的所有版本</li>
<li><code>git log --pretty=oneline</code>：用一行来显示</li>
<li><code>git reflog</code>：查看<code>HEAD</code>指针的移动历史（包括被回滚的版本）</li>
<li><code>git branch</code>：查看所有分支和当前所处分支</li>
<li><code>git pull</code> ：将远程仓库的当前分支与本地仓库的当前分支合并</li>
</ol>
<h4 id="git-删除命令">Git 删除命令</h4>
<ol>
<li><code>git rm --cached XX</code>：将文件从仓库索引目录中删掉，不希望管理这个文件</li>
<li><code>git restore --staged xx</code>：将<code>xx</code>从暂存区里移除</li>
<li><code>git checkout — XX</code>或<code>git restore XX</code>：将<code>XX</code>文件尚未加入暂存区的修改全部撤销</li>
</ol>
<h4 id="git-代码回滚">Git 代码回滚</h4>
<ol>
<li><code>git reset --hard HEAD^</code>或<code>git reset --hard HEAD~ </code>：将代码库回滚到上一个版本</li>
<li><code>git reset --hard HEAD^^</code>：往上回滚两次，以此类推</li>
<li><code>git reset --hard HEAD~100</code>：往上回滚100个版本</li>
<li><code>git reset --hard 版本号</code>：回滚到某一特定版本</li>
</ol>
<h4 id="git-远程仓库">Git 远程仓库</h4>
<ol>
<li><code>git remote add origin git@git.acwing.com:xxx/XXX.git</code>：将本地仓库关联到远程仓库</li>
<li><code>git push -u (第一次需要-u以后不需要)</code> ：将当前分支推送到远程仓库</li>
<li><code>git push origin branch_name</code>：将本地的某个分支推送到远程仓库</li>
<li><code>git clone git@git.acwing.com:xxx/XXX.git</code>：将远程仓库XXX下载到当前目录下</li>
<li><code>git push --set-upstream origin branch_name</code>：设置本地的<code>branch_name</code>分支对应远程仓库的<code>branch_name</code>分支</li>
<li><code>git push -d origin branch_name</code>：删除远程仓库的<code>branch_name</code>分支</li>
<li><code>git checkout -t origin/branch_name</code>：将远程的<code>branch_name</code>分支拉取到本地</li>
<li><code>git pull</code>：将远程仓库的当前分支与本地仓库的当前分支合并</li>
<li><code>git pull origin branch_name</code>：将远程仓库的<code>branch_name</code>分支与本地仓库的当前分支合并</li>
<li><code>git branch --set-upstream-to=origin/branch_name1 branch_name2</code>：将远程的</li>
<li><code>branch_name1</code>分支与本地的<code>branch_name2</code>分支对应</li>
</ol>
<h4 id="git-分支命令">Git 分支命令</h4>
<ol>
<li><code>git branch branch_name</code>：创建新分支</li>
<li><code>git branch</code>：查看所有分支和当前所处分支</li>
<li><code>git checkout -b branch_name</code>：创建并切换到<code>branch_name</code>这个分支</li>
<li><code>git checkout branch_name</code>：切换到<code>branch_name</code>这个分支</li>
<li><code>git merge branch_name</code>：将分支<code>branch_name</code>合并到当前分支上</li>
<li><code>git branch -d branch_name</code>：删除本地仓库的<code>branch_name</code>分支</li>
<li><code>git push --set-upstream origin branch_name</code>：设置本地的<code>branch_name</code>分支对应远程仓库的<code>branch_name</code>分支</li>
<li><code>git push -d origin branch_name</code>：删除远程仓库的<code>branch_name</code>分支</li>
<li><code>git checkout -t origin/branch_name</code>：将远程的<code>branch_name</code>分支拉取到本地</li>
<li><code>git pull</code> ：将远程仓库的当前分支与本地仓库的当前分支合并</li>
<li><code>git pull origin branch_name</code>：将远程仓库的<code>branch_name</code>分支与本地仓库的当前分支合并</li>
<li><code>git branch --set-upstream-to=origin/branch_name1 branch_name2</code>：将远程的</li>
<li><code>branch_name1</code>分支与本地的<code>branch_name2</code>分支对应</li>
</ol>
<h4 id="git-stash-暂存">Git stash 暂存</h4>
<ol>
<li><code>git stash</code>：将工作区和暂存区中尚未提交的修改存入栈中</li>
<li><code>git stash apply</code>：将栈顶存储的修改恢复到当前分支，但不删除栈顶元素</li>
<li><code>git stash drop</code>：删除栈顶存储的修改</li>
<li><code>git stash pop</code>：将栈顶存储的修改恢复到当前分支，同时删除栈顶元素</li>
<li><code>git stash list</code>：查看栈中所有元素</li>
</ol>
<h3 id="git更换远程仓库地址">Git更换远程仓库地址</h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>git remote -v  <span style="color:#f00">#</span> <span style="color:#f00">查看远端地址</span>
</span></span><span style="display:flex;"><span>git remote <span style="color:#f00">#</span> <span style="color:#f00">查看远端仓库名</span>
</span></span><span style="display:flex;"><span>git remote rm origin <span style="color:#f00">#</span> <span style="color:#f00">删除远程的仓库</span>
</span></span><span style="display:flex;"><span>git remote <span style="color:#fff;font-weight:bold">add</span> origin https:<span style="color:#007f7f">//github.com/xx/xx.git （新地址） # 重新添加远程仓库</span>
</span></span><span style="display:flex;"><span>git push --<span style="color:#fff;font-weight:bold">set</span>-upstream origin master
</span></span></code></pre></div><h3 id="本地项目上传到github">本地项目上传到GitHub</h3>
<ol>
<li>配置<code>ssh-key</code>实现本地与<code>Git</code>服务器免密交互</li>
</ol>
<pre tabindex="0"><code>ssh-keygen  # 生成密钥
cat .ssh/id_rsa.pub
# 复制密钥，提交到 git 服务器的 ssh 密钥中
</code></pre><ol start="2">
<li>按照下面的操作在本地文件夹配置一下<code>Git</code>：</li>
</ol>
<pre tabindex="0"><code>git config --global user.name xxx  # 设置用户名
git config --global user.email xxx@xxx.com  # 设置用户邮箱

git init
git add .
git commit -m &#34;xxx&#34;
git remote add origin https://github.com/xxx/XXX.git  # 建立连接
git push -u origin master
</code></pre><h3 id="gitignore的作用">.gitignore的作用</h3>
<blockquote>
<p><strong>工程常识：缓存文件，可执行文件，编译文件 不要传到自己的 git 项目里</strong></p>
<p><strong>.gitignore的作用就是帮助我们在git add时将我们指定的一些文件自动排除在外，不提交到git当中</strong></p>
<p><strong>在Git工作区的根目录下创建一个特殊的<code>.gitignore</code>文件，然后把要忽略的文件名填进去，Git就会自动忽略这些文件</strong></p>
</blockquote>
<h2 id="thrift"><strong>Thrift</strong></h2>
<ul>
<li><a href="https://www.acwing.com/video/3479/">Thrift | AcWing Linux 基础课</a></li>
<li><a href="https://git.acwing.com/fashen/thrift_learning/-/blob/master/readme.md">Thrift_learning - AcGit</a></li>
<li><a href="https://www.colopen-blog.com/Engineer/acw_linux/">AcWing Linux 基础课 | Colopen&rsquo;s blog | Thrift</a></li>
<li><a href="https://thrift.apache.org/">thrift 官网</a> -&gt; <a href="https://thrift.apache.org/tutorial/">Tutorial</a> -&gt; <a href="https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob_plain;f=tutorial/tutorial.thrift">tutorial.thrift</a></li>
</ul>
<hr>
<h3 id="thrift是什么">Thrift是什么？</h3>
<blockquote>
<p><strong>Thrift是一个轻量级、跨语言的远程过程服务调用（RPC）框架</strong></p>
<p><strong>RPC（远程过程调用）是一个计算机通信协议，该协议允许运行于一台计算机的程序调用另一台计算机的子程序，而程序员无需额外地为这个交互作用编程</strong></p>
<p><strong>Thrift用于跨语言服务开发，它将软件栈和代码生成引擎结合在一起，以构建在 C++、Java、Python、PHP、Ruby、Erlang、Perl、Haskell、C#、Cocoa、JavaScript、Node. Js、Smalltalk、OCaml 和 Delphi 等语言之间高效、无缝地工作的服务</strong></p>
</blockquote>
<h3 id="例实现一个游戏的匹配服务">例：实现一个游戏的匹配服务</h3>
<h4 id="基本框架">基本框架</h4>
<ol>
<li>游戏应用端 <code>game</code>（Python3）
<ol>
<li>客户端：与 匹配系统服务器 的服务端交互</li>
</ol>
</li>
<li>匹配系统服务器 <code>match_system</code>（C++）
<ol>
<li>服务端：与 游戏应用端 的客户端交互</li>
<li>客户端：与 数据存储服务器 的服务端交互</li>
</ol>
</li>
<li>数据存储服务器（已经实现）
<ol>
<li>服务端：与 匹配系统服务器 的客户端交互</li>
</ol>
</li>
</ol>
<h4 id="文件结构">文件结构</h4>
<pre tabindex="0"><code>|-- README.md
|-- game
|   `-- src
|       |-- client.py
|       `-- match_client
|           |-- __init__.py
|           |-- __pycache__
|           |   `-- __init__.cpython-38.pyc
|           `-- match
|               |-- Match.py
|               |-- __init__.py
|               |-- __pycache__
|               |   |-- Match.cpython-38.pyc
|               |   |-- __init__.cpython-38.pyc
|               |   `-- ttypes.cpython-38.pyc
|               |-- constants.py
|               `-- ttypes.py
|-- match_system
|   `-- src
|       |-- Match.o
|       |-- Save.o
|       |-- main
|       |-- main.cpp
|       |-- main.o
|       |-- match_server
|       |   |-- Match.cpp
|       |   |-- Match.h
|       |   |-- match_types.cpp
|       |   `-- match_types.h
|       |-- match_types.o
|       `-- save_client
|           |-- Save.cpp
|           |-- Save.h
|           `-- save_types.h
`-- thrift
    |-- match.thrift
    `-- save.thrift
</code></pre><h4 id="实现过程">实现过程</h4>
<ol>
<li>定义接口 (<code>thrift</code> 文件夹用于存放接口 )</li>
<li>完成 <code>Server</code> 端
<ol>
<li>通过<code>match.thrift</code>接口在<code>match_system</code>文件夹下生成 C++版本的服务端</li>
</ol>
<pre tabindex="0"><code>thrift -r --gen cpp tutorial.thrift
</code></pre><ol start="2">
<li>将<code>gen cpp</code> 文件夹重命名，如：<code>match_server</code>（区别于之后要在此处生成的<code>client_server</code>）</li>
<li>把 <code>Match_server.skeleton.cpp</code> 移动到当前 <code>src</code> 目录下并重命名为 <code>main.cpp</code>
<ul>
<li>由于移动了 <code>main.cpp</code> 故需要修改一下<code> main.cpp</code> 中头文件里关于 <code>Match.h</code> 的引用路径：<code>#include &quot;Match.h&quot;</code> -&gt; <code>#include &quot;match_server/Match.h&quot;</code></li>
</ul>
</li>
<li>在<code>main.cpp</code>中实现具体业务逻辑</li>
</ol>
</li>
<li>完成 <code>Client</code> 端
<ol>
<li>通过<code>match.thrift</code>接口在<code>game</code>文件夹下生成 <code>python3</code> 版本的服务端，然后通过修改得到客户端</li>
</ol>
<pre tabindex="0"><code>thrift -r --gen py tutorial.thrift
</code></pre><ol start="2">
<li>删掉 <code>Match_remote </code>，该文件是用 py 实现 服务端 时用的文件，此处我们只需要实现 <strong>客户端</strong> 功能，因此他没有作用，不妨删掉，让文档简洁一点</li>
<li>利用官网提供的模板，在<code>src</code>文件夹下编写 <strong>客户端</strong> 文件 <code>client.py</code></li>
</ol>
</li>
<li>持久化到云端
<ul>
<li>将 <strong>非编译文件</strong> 和 <strong>非可执行文件</strong> 提交到 <code>git</code> 中去（好的工程习惯）
<ul>
<li><code>Cpp</code>
<ul>
<li><code>git restore --stage *.o</code></li>
<li><code>git restore --stage main</code></li>
</ul>
</li>
<li><code>Python</code>
<ul>
<li><code>git restore --stage *.pyc   # .pyc文件是编译文件，不加入暂存区里</code></li>
<li><code>git restore --stage *.swp   # .swp文件是缓存文件，不加入暂存区里</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li>注意：先运行服务器后，客户端才能正常运行</li>
</ul>
<h4 id="thrift-接口">Thrift 接口</h4>
<h5 id="matchthrift">Match.thrift</h5>
<pre tabindex="0"><code>namespace cpp match_service
struct User {
    1: i32 id,
    2: string name,
    3: i32 scores
}
service Match {
    i32 add_user(1: User user, 2: string info),
    i32 remove_user(1: User user, 2: string info),
}
</code></pre><h5 id="savethrift">Save.thrift</h5>
<pre tabindex="0"><code>namespace cpp save_service
service Save {
    /**
     * username: myserver的名称
     * password: myserver的密码的md5值的前8位，用命令md5sum
     * 用户名密码验证成功会返回0，验证失败会返回1
     * 验证成功后，结果会被保存到myserver:homework/lesson_6/result.txt中
     */
    i32 save_data(1: string username, 2: string password, 3: i32 player1_id, 4: i32 player2_id)
}
</code></pre><h4 id="各版本预览">各版本预览</h4>
<h5 id="match_server10">Match_server:1.0</h5>
<ul>
<li><code>match_client</code>：创建固定的<code>User</code></li>
</ul>
<pre tabindex="0"><code>from match_client.match import Match
from match_client.match.ttypes import User

from thrift import Thrift
from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol


def main():
    # Make socket
    transport = TSocket.TSocket(&#39;localhost&#39;, 9090)

    # Buffering is critical. Raw sockets are very slow
    transport = TTransport.TBufferedTransport(transport)

    # Wrap in a protocol
    protocol = TBinaryProtocol.TBinaryProtocol(transport)

    # Create a client to use the protocol encoder
    client = Match.Client(protocol)

    # Connect!
    transport.open()

    user = User(1, &#39;yxc&#39;, 1500)
    client.add_user(user, &#34;&#34;)

    # Close!
    transport.close()


# 调用 main 函数
if __name__ == &#34;__main__&#34;:
    main()
</code></pre><ul>
<li><code>match_server</code></li>
</ul>
<pre tabindex="0"><code>// This autogenerated skeleton file illustrates how to build a server.
// You should copy it to another filename to avoid overwriting it.
#include &#34;match_server/Match.h&#34;
#include &lt;thrift/protocol/TBinaryProtocol.h&gt;
#include &lt;thrift/server/TSimpleServer.h&gt;
#include &lt;thrift/transport/TServerSocket.h&gt;
#include &lt;thrift/transport/TBufferTransports.h&gt;
#include&lt;iostream&gt;
using namespace ::apache::thrift;
using namespace ::apache::thrift::protocol;
using namespace ::apache::thrift::transport;
using namespace ::apache::thrift::server;
using namespace  ::match_service;
using namespace std;
class MatchHandler : virtual public MatchIf {
 public:
  MatchHandler() {
    // Your initialization goes here
  }
  int32_t add_user(const User&amp; user, const std::string&amp; info) {
    // Your implementation goes here
    printf(&#34;add_user\n&#34;);
    return 0;
  }
  int32_t remove_user(const User&amp; user, const std::string&amp; info) {
    // Your implementation goes here
    printf(&#34;remove_user\n&#34;);
    return 0;
  }
};
int main(int argc, char **argv) {
  int port = 9090;
  ::std::shared_ptr&lt;MatchHandler&gt; handler(new MatchHandler());
  ::std::shared_ptr&lt;TProcessor&gt; processor(new MatchProcessor(handler));
  ::std::shared_ptr&lt;TServerTransport&gt; serverTransport(new TServerSocket(port));
  ::std::shared_ptr&lt;TTransportFactory&gt; transportFactory(new TBufferedTransportFactory());
  ::std::shared_ptr&lt;TProtocolFactory&gt; protocolFactory(new TBinaryProtocolFactory());
  TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory);
  
  cout &lt;&lt; &#34;Start Match Server&#34; &lt;&lt; endl;
    
  server.serve();
  return 0;
}
</code></pre><h5 id="match_server20">Match_server:2.0</h5>
<ul>
<li><code>match_client</code>：根据标准输入来创建<code>User</code></li>
</ul>
<pre tabindex="0"><code>from match_client.match import Match
from match_client.match.ttypes import User

from thrift import Thrift
from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol

# 利用 python 在终端读入信息需要引入 stdin
from sys import stdin

# 将原来的通信 main 函数改写成operate函数，每次需要的时候调用一次建立通信传递信息
# 目的是可以一直不断处理信息
# 然后重写 main 函数，使之能不断从终端读入信息
def operate(op, user_id, user_name, score):
    # Make socket 
	transport = TSocket.TSocket(&#39;localhost&#39;, 9090)
	
	# Buffering is critical. Raw sockets are very slow
	transport = TTransport.TBufferedTransport(transport)
	
	# Wrap in a protocol
	protocol = TBinaryProtocol.TBinaryProtocol(transport)
	
	# Create a client to use the protocol encoder
	client = Match.Client(protocol)
	
	# Connect!
	transport.open()

    # 针对 op 参数，分别进行 &#34;增加&#34; 与 &#34;删出&#34; 操作
    user = User(user_id, user_name, score)

    if op == &#34;add&#34;:
        client.add_user(user, &#34;&#34;)
    else:
        client.remove_user(user, &#34;&#34;)
    
    # Close!
	transport.close()

def main():
    for line in stdin:
        op, user_id, user_name, score = line.split(&#39; &#39;)
        operate(op, int(user_id), user_name, int(score))

# 调用 main 函数
if __name__ == &#34;__main__&#34;:
    main()
</code></pre><ul>
<li><code>match_server</code>：自动将用户池中前两个用户匹配到一起</li>
</ul>
<pre tabindex="0"><code>// This autogenerated skeleton file illustrates how to build a server.
// You should copy it to another filename to avoid overwriting it.
#include &#34;match_server/Match.h&#34;
#include &lt;thrift/protocol/TBinaryProtocol.h&gt;
#include &lt;thrift/server/TSimpleServer.h&gt;
#include &lt;thrift/transport/TServerSocket.h&gt;
#include &lt;thrift/transport/TBufferTransports.h&gt;
#include&lt;iostream&gt;
#include &lt;thread&gt;               // 需要线程，引入头文件
#include &lt;mutex&gt;                // 互斥信号量
#include &lt;condition_variable&gt;   // 条件变量，用于 阻塞和唤醒 线程
#include &lt;queue&gt;                // 用于模拟消息队列
#include &lt;vector&gt;
using namespace ::apache::thrift;
using namespace ::apache::thrift::protocol;
using namespace ::apache::thrift::transport;
using namespace ::apache::thrift::server;
using namespace  ::match_service;
using namespace std;
struct Task {   // 消息队列中的元素
    User user;
    string type;
};
struct MessageQueue {   // 消息队列
    queue&lt;Task&gt; q;          // 消息队列本体
    mutex m;                // 互斥信号量
    condition_variable cv;  // 条件变量，用于阻塞唤醒线程
}message_queue;
class Pool {    // 模拟匹配池
public:
    void save_result(int a, int b) {  // 记录成功匹配的信息
        printf(&#34;Match Result: %d %d \n&#34;, a, b);
    }
    void match() {  // 将匹配池中的第一、第二个用户匹配
        while (users.size() &gt; 1) {
            auto a = users[0], b = users[1];
            users.erase(users.begin());
            users.erase(users.begin());
            save_result(a.id, b.id);
        }
    }
    
    void add(User user) {   // 向匹配池中加入用户
        users.push_back(user);
    }
    void remove(User user) {    // 向匹配池中删除用户
        for (uint32_t i = 0; i &lt; users.size(); ++ i) {
            if (users[i].id == user.id) {
                users.erase(users.begin() + i);
                break;
           }
        }
    }
private:
    vector&lt;User&gt; users; // 匹配池中的用户，用 vector 记录
}pool;
class MatchHandler : virtual public MatchIf {
 public:
  MatchHandler() {
    // Your initialization goes here
  }
  int32_t add_user(const User&amp; user, const std::string&amp; info) {
    // Your implementation goes here
    printf(&#34;add_user\n&#34;);
    
    unique_lock&lt;mutex&gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &#34;add&#34;});        // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
    return 0;
  }
  int32_t remove_user(const User&amp; user, const std::string&amp; info) {
    // Your implementation goes here
    printf(&#34;remove_user\n&#34;);
    unique_lock&lt;mutex&gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &#34;remove&#34;});     // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
   
    return 0;
  }
};
// 基于“生产者-消费者模型”的线程
void consume_task() {
    while(true) {
        unique_lock&lt;mutex&gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
        if (message_queue.q.empty()) {
            message_queue.cv.wait(lck); // 这里要阻塞进程
            // 避免队列为空时，一直反复运行该进程，导致一直占用临界区，而不能加入新消息
        } else {
            auto task = message_queue.q.front();    // 取出消息队列队头元素
            message_queue.q.pop();
            lck.unlock();   // 临界区访问结束，直接解锁
            // 避免后续没用到临界区信息，而长时间占用临界区的情况发生
            
            if (task.type == &#34;add&#34;) pool.add(task.user);
            else if (task.type == &#34;remove&#34;) pool.remove(task.user);
            pool.match();
        } 
    }
}
int main(int argc, char **argv) {
  int port = 9090;
  ::std::shared_ptr&lt;MatchHandler&gt; handler(new MatchHandler());
  ::std::shared_ptr&lt;TProcessor&gt; processor(new MatchProcessor(handler));
  ::std::shared_ptr&lt;TServerTransport&gt; serverTransport(new TServerSocket(port));
  ::std::shared_ptr&lt;TTransportFactory&gt; transportFactory(new TBufferedTransportFactory());
  ::std::shared_ptr&lt;TProtocolFactory&gt; protocolFactory(new TBinaryProtocolFactory());
  TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory);
  
  cout &lt;&lt; &#34;Start Match Server&#34; &lt;&lt; endl;
  
  thread matching_thread(consume_task); // 调用一个线程运行 consume_task
  server.serve();
  
  return 0;
}
</code></pre><h5 id="match_server30">Match_server:3.0</h5>
<ul>
<li><code>save_client</code>：因为一个节点只能由一个<code>main</code>方法作为程序的入口，所以匹配系统中的客户端和服务端写在同一个<code>main</code>方法中</li>
</ul>
<pre tabindex="0"><code>// 需要额外引入的头文件
#include &#34;save_client/Save.h&#34;
#include &lt;thrift/transport/TSocket.h&gt;
#include &lt;thrift/transport/TTransportUtils.h&gt;

// 需要额外声明的命名空间
using namespace  ::save_service;

//重写 save_result 内的内容，使其能够与 &#34;数据存储服务器&#34; 交互
void save_result(int a, int b) { // 记录成功匹配的信息
    printf(&#34;Match Result: %d %d\n&#34;, a, b);

    // Client端的板子
    std::shared_ptr&lt;TTransport&gt; socket(new TSocket(&#34;123.57.47.211&#34;, 9090));
    std::shared_ptr&lt;TTransport&gt; transport(new TBufferedTransport(socket));
    std::shared_ptr&lt;TProtocol&gt; protocol(new TBinaryProtocol(transport));
    SaveClient client(protocol);

    try {
        transport-&gt;open();

        //调用接口，把信息存储 &#34;数据存储服务器&#34; 中
        int res = client.save_data(&#34;acs_4888&#34;, &#34;07637c4c&#34;, a, b);
        //输出匹配结果
        if (!res) puts(&#34;success&#34;);
        else puts(&#34;fail&#34;);

        transport-&gt;close();
    } catch (TException&amp; tx) {
        cout &lt;&lt; &#34;ERROR: &#34; &lt;&lt; tx.what() &lt;&lt; endl;
    }
}
</code></pre><ul>
<li><code>match_server</code>：每次只匹配分差小于 50 的用户</li>
</ul>
<pre tabindex="0"><code>// This autogenerated skeleton file illustrates how to build a server.
// You should copy it to another filename to avoid overwriting it.
#include &lt;thrift/transport/TSocket.h&gt;
#include &lt;thrift/transport/TTransportUtils.h&gt;
#include &#34;match_server/Match.h&#34;
#include &#34;save_client/Save.h&#34;
#include &lt;thrift/protocol/TBinaryProtocol.h&gt;
#include &lt;thrift/server/TSimpleServer.h&gt;
#include &lt;thrift/transport/TServerSocket.h&gt;
#include &lt;thrift/transport/TBufferTransports.h&gt;
#include &lt;unistd.h&gt; // 用于调用 sleep 函数
#include&lt;iostream&gt;
#include &lt;thread&gt;               // 需要线程，引入头文件
#include &lt;mutex&gt;                // 互斥信号量
#include &lt;condition_variable&gt;   // 条件变量，用于 阻塞和唤醒 线程
#include &lt;queue&gt;                // 用于模拟消息队列
#include &lt;vector&gt;
using namespace ::apache::thrift;
using namespace ::apache::thrift::protocol;
using namespace ::apache::thrift::transport;
using namespace ::apache::thrift::server;
using namespace ::save_service;
using namespace  ::match_service;
using namespace std;
struct Task {   // 消息队列中的元素
    User user;
    string type;
};
struct MessageQueue {   // 消息队列
    queue&lt;Task&gt; q;          // 消息队列本体
    mutex m;                // 互斥信号量
    condition_variable cv;  // 条件变量，用于阻塞唤醒线程
}message_queue;
class Pool {    // 模拟匹配池
public:
	//重写 save_result 内的内容，使其能够与 &#34;数据存储服务器&#34; 交互
    void save_result(int a, int b) {  // 记录成功匹配的信息
        printf(&#34;Match Result: %d %d \n&#34;, a, b);
        // Client端的板子
        std::shared_ptr&lt;TTransport&gt; socket(new TSocket(&#34;123.57.47.211&#34;, 9090));
        std::shared_ptr&lt;TTransport&gt; transport(new TBufferedTransport(socket));
        std::shared_ptr&lt;TProtocol&gt; protocol(new TBinaryProtocol(transport));
        SaveClient client(protocol);
        try {
            transport-&gt;open();
            //调用接口，把信息存储 &#34;数据存储服务器&#34; 中
            int res = client.save_data(&#34;acs_4888&#34;, &#34;07637c4c&#34;, a, b);
            //输出匹配结果
            if (!res) puts(&#34;success&#34;);
            else puts(&#34;fail&#34;);
            transport-&gt;close();
        } catch (TException&amp; tx) {
            cout &lt;&lt; &#34;ERROR: &#34; &lt;&lt; tx.what() &lt;&lt; endl;
        }
    }
    void match() {  // 将匹配池中的第一、第二个用户匹配
        while (users.size() &gt; 1) {
            // 按照 rank分 排序
            sort(users.begin(), users.end(), [&amp;](User&amp; a, User&amp; b) {
                return a.scores &lt; b.scores;
            });
            bool flag = true;
            for (uint32_t i = 1; i &lt; users.size(); ++ i) {
                auto a = users[i - 1], b = users[i];
                // 两名玩家分数差小于50时进行匹配
                if (b.scores - a.scores &lt;= 50) {
                    users.erase(users.begin() + i - 1, users.begin() + i + 1);
                    save_result(a.id, b.id);
                    flag = false;
                    break;
                }
            }
            if (flag) break;    // 一轮扫描后，发现没有能够匹配的用户，就停止扫描，等待下次调用
        }
    } 
    
    void add(User user) {   // 向匹配池中加入用户
        users.push_back(user);
    }
    void remove(User user) {    // 向匹配池中删除用户
        for (uint32_t i = 0; i &lt; users.size(); ++ i) {
            if (users[i].id == user.id) {
                users.erase(users.begin() + i);
                break;
           }
        }
    }
private:
    vector&lt;User&gt; users; // 匹配池中的用户，用 vector 记录
}pool;
class MatchHandler : virtual public MatchIf {
 public:
  MatchHandler() {
    // Your initialization goes here
  }
  int32_t add_user(const User&amp; user, const std::string&amp; info) {
    // Your implementation goes here
    printf(&#34;add_user\n&#34;);
    
    unique_lock&lt;mutex&gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &#34;add&#34;});        // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
    return 0;
  }
  int32_t remove_user(const User&amp; user, const std::string&amp; info) {
    // Your implementation goes here
    printf(&#34;remove_user\n&#34;);
    unique_lock&lt;mutex&gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &#34;remove&#34;});     // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
   
    return 0;
  }
};
// 基于“生产者-消费者模型”的线程
void consume_task() {
    while(true) {
        unique_lock&lt;mutex&gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
        if (message_queue.q.empty()) {
            // message_queue.cv.wait(lck); // 这里要阻塞进程
            // 避免队列为空时，一直反复运行该进程，导致一直占用临界区，而不能加入新消息
            // 修改为每 1 秒进行一次匹配
            lck.unlock();   // 直接解锁临界区资源
            pool.match();   //调用 match()
            sleep(1);
        } else {
            auto task = message_queue.q.front();    // 取出消息队列队头元素
            message_queue.q.pop();
            lck.unlock();   // 临界区访问结束，直接解锁
            // 避免后续没用到临界区信息，而长时间占用临界区的情况发生
            
            if (task.type == &#34;add&#34;) pool.add(task.user);
            else if (task.type == &#34;remove&#34;) pool.remove(task.user);
            pool.match();
        } 
    }
}
int main(int argc, char **argv) {
  int port = 9090;
  ::std::shared_ptr&lt;MatchHandler&gt; handler(new MatchHandler());
  ::std::shared_ptr&lt;TProcessor&gt; processor(new MatchProcessor(handler));
  ::std::shared_ptr&lt;TServerTransport&gt; serverTransport(new TServerSocket(port));
  ::std::shared_ptr&lt;TTransportFactory&gt; transportFactory(new TBufferedTransportFactory());
  ::std::shared_ptr&lt;TProtocolFactory&gt; protocolFactory(new TBinaryProtocolFactory());
  TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory);
  
  cout &lt;&lt; &#34;Start Match Server&#34; &lt;&lt; endl;
  
  thread matching_thread(consume_task); // 调用一个线程运行 consume_task
  server.serve();
  
  return 0;
}
</code></pre><h5 id="match_server40">Match_server:4.0</h5>
<ul>
<li><code>match_server</code>：随时间扩大匹配域，每一单位的 <code>wt</code> 会扩大 $50$ 分 的匹配域</li>
</ul>
<pre tabindex="0"><code>// This autogenerated skeleton file illustrates how to build a server.
// You should copy it to another filename to avoid overwriting it.
#include &lt;thrift/transport/TSocket.h&gt;
#include &lt;thrift/transport/TTransportUtils.h&gt;
#include &#34;match_server/Match.h&#34;
#include &#34;save_client/Save.h&#34;
#include &lt;thrift/protocol/TBinaryProtocol.h&gt;
#include &lt;thrift/server/TSimpleServer.h&gt;
#include &lt;thrift/transport/TServerSocket.h&gt;
#include &lt;thrift/transport/TBufferTransports.h&gt;
#include &lt;unistd.h&gt; // 用于调用 sleep 函数
#include&lt;iostream&gt;
#include &lt;thread&gt;               // 需要线程，引入头文件
#include &lt;mutex&gt;                // 互斥信号量
#include &lt;condition_variable&gt;   // 条件变量，用于 阻塞和唤醒 线程
#include &lt;queue&gt;                // 用于模拟消息队列
#include &lt;vector&gt;
using namespace ::apache::thrift;
using namespace ::apache::thrift::protocol;
using namespace ::apache::thrift::transport;
using namespace ::apache::thrift::server;
using namespace ::save_service;
using namespace  ::match_service;
using namespace std;
struct Task {   // 消息队列中的元素
    User user;
    string type;
};
struct MessageQueue {   // 消息队列
    queue&lt;Task&gt; q;          // 消息队列本体
    mutex m;                // 互斥信号量
    condition_variable cv;  // 条件变量，用于阻塞唤醒线程
}message_queue;
class Pool {    // 模拟匹配池
public:
    void save_result(int a, int b) {  // 记录成功匹配的信息
        printf(&#34;Match Result: %d %d \n&#34;, a, b);
        // Client端的板子
        std::shared_ptr&lt;TTransport&gt; socket(new TSocket(&#34;123.57.47.211&#34;, 9090));
        std::shared_ptr&lt;TTransport&gt; transport(new TBufferedTransport(socket));
        std::shared_ptr&lt;TProtocol&gt; protocol(new TBinaryProtocol(transport));
        SaveClient client(protocol);
        try {
            transport-&gt;open();
            //调用接口，把信息存储 &#34;数据存储服务器&#34; 中
            int res = client.save_data(&#34;acs_4888&#34;, &#34;07637c4c&#34;, a, b);
            //输出匹配结果
            if (!res) puts(&#34;success&#34;);
            else puts(&#34;fail&#34;);
            transport-&gt;close();
        } catch (TException&amp; tx) {
            cout &lt;&lt; &#34;ERROR: &#34; &lt;&lt; tx.what() &lt;&lt; endl;
        }
    }
    bool check_match(uint32_t i, uint32_t j) {
        auto a = users[i], b = users[j];
        
        int dt = abs(a.scores - b.scores);
        int a_max_dif = wt[i] * 50;
        int b_max_dif = wt[j] * 50;
        return dt &lt;= a_max_dif &amp;&amp; dt &lt;= b_max_dif;
    }
    void match() {
       for (uint32_t i = 0; i &lt; wt.size(); ++ i)
           wt[i] ++;
        while (users.size() &gt; 1) {
            bool flag = true;
            for (uint32_t i = 0; i &lt; users.size(); ++ i) {
                for (uint32_t j = i + 1; j &lt; users.size(); ++ j) {
                    if (check_match(i, j)) {
                        auto a = users[i], b = users[j];
                        users.erase(users.begin() + j);
                        users.erase(users.begin() + i);
                        wt.erase(wt.begin() + j);
                        wt.erase(wt.begin() + i);
                        save_result(a.id, b.id);
                        flag = false;
                        break;
                    }
                    if (!flag) break;       
                }
            }
            if (flag) break;    // 一轮扫描后，发现没有能够匹配的用户，就停止扫描，等待下次调用
        }
    } 
    
    void add(User user) {   // 向匹配池中加入用户
        users.push_back(user);
        wt.push_back(0);
    }
    void remove(User user) {    // 向匹配池中删除用户
        for (uint32_t i = 0; i &lt; users.size(); ++ i) {
            if (users[i].id == user.id) {
                users.erase(users.begin() + i);
                wt.erase(wt.begin() + i);
                break;
           }
        }
    }
private:
    vector&lt;User&gt; users; // 匹配池中的用户，用 vector 记录
    vector&lt;int&gt; wt; // 等待时间，单位：s
}pool;
class MatchHandler : virtual public MatchIf {
 public:
  MatchHandler() {
    // Your initialization goes here
  }
  int32_t add_user(const User&amp; user, const std::string&amp; info) {
    // Your implementation goes here
    printf(&#34;add_user\n&#34;);
    
    unique_lock&lt;mutex&gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &#34;add&#34;});        // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
    return 0;
  }
  int32_t remove_user(const User&amp; user, const std::string&amp; info) {
    // Your implementation goes here
    printf(&#34;remove_user\n&#34;);
    unique_lock&lt;mutex&gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
    message_queue.q.push({user, &#34;remove&#34;});     // 把新消息加入消息队列
    message_queue.cv.notify_all();              // 唤醒阻塞的线程
   
    return 0;
  }
};
// 基于“生产者-消费者模型”的线程
void consume_task() {
    while(true) {
        unique_lock&lt;mutex&gt; lck(message_queue.m);    // 访问临界区（消息队列），先上锁
        if (message_queue.q.empty()) {
            // message_queue.cv.wait(lck); // 这里要阻塞进程
            // 避免队列为空时，一直反复运行该进程，导致一直占用临界区，而不能加入新消息
            // 修改为每 1 秒进行一次匹配
            lck.unlock();   // 直接解锁临界区资源
            pool.match();   //调用 match()
            sleep(1);
        } else {
            auto task = message_queue.q.front();    // 取出消息队列队头元素
            message_queue.q.pop();
            lck.unlock();   // 临界区访问结束，直接解锁
            // 避免后续没用到临界区信息，而长时间占用临界区的情况发生
            
            if (task.type == &#34;add&#34;) pool.add(task.user);
            else if (task.type == &#34;remove&#34;) pool.remove(task.user);
        } 
    }
}
int main(int argc, char **argv) {
  int port = 9090;
  ::std::shared_ptr&lt;MatchHandler&gt; handler(new MatchHandler());
  ::std::shared_ptr&lt;TProcessor&gt; processor(new MatchProcessor(handler));
  ::std::shared_ptr&lt;TServerTransport&gt; serverTransport(new TServerSocket(port));
  ::std::shared_ptr&lt;TTransportFactory&gt; transportFactory(new TBufferedTransportFactory());
  ::std::shared_ptr&lt;TProtocolFactory&gt; protocolFactory(new TBinaryProtocolFactory());
  TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory);
  
  cout &lt;&lt; &#34;Start Match Server&#34; &lt;&lt; endl;
  
  thread matching_thread(consume_task); // 调用一个线程运行 consume_task
  server.serve();
  
  return 0;
}
</code></pre><h4 id="usage">Usage</h4>
<pre tabindex="0"><code># 启动服务端
./match_system/src/main

# 启动客户端
python3 game/src/client.py

# 游戏应用端 （op id name scores）
add 1 yxc 2000
add 2 xan 1500
add 3 zagy 2500
remove 3 zagy 2500

# 匹配系统服务器
add_user
add_user
remove_user 
# 等待了 10 s
Match Result: 1 2
success
</code></pre><h4 id="项目地址">项目地址</h4>
<ul>
<li><a href="https://github.com/Xancoding/Learning-Thrift">Learning-Thrift</a></li>
</ul>
<h2 id="docker">Docker</h2>
<ul>
<li><a href="https://www.acwing.com/blog/content/10878/">Docker | AcWing Linux 基础课</a></li>
<li><a href="https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html">Docker 入门教程 | 阮一峰的网络日志</a></li>
</ul>
<hr>
<h3 id="docker是什么">Docker是什么？</h3>
<blockquote>
<p><strong>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中,然后发布到任何流行的Linux或Windows操作系统的机器上</strong></p>
</blockquote>
<h3 id="docker常用命令">Docker常用命令</h3>
<ul>
<li><code>镜像（images）</code>
<ol>
<li><code>docker images</code>：列出本地所有镜像</li>
<li><code>docker image rm ubuntu:20.04</code>：删除镜像<code>ubuntu:20.04</code></li>
<li><code>docker commit CONTAINER_NAME IMAGE_NAME:TAG</code>：创建某个<code>container</code>的镜像，<code>TAG</code> 为镜像标签，用以记录当前版本。</li>
<li><code>docker save -o ubuntu_20_04.tar ubuntu:20.04</code>：将镜像<code>ubuntu:20.04</code>导出到本地文件<code>ubuntu_20_04.tar</code>中</li>
<li><code>docker load -i ubuntu_20_04.tar</code>：将镜像<code>ubuntu:20.04</code>从本地文件<code>ubuntu_20_04.tar</code>中加载出来</li>
</ol>
</li>
<li><code>容器(container)</code>
<ol>
<li><code>docker ps -a</code>：查看本地的所有容器</li>
<li><code>docker start CONTAINER</code>：启动容器</li>
<li><code>docker stop CONTAINER</code>：停止容器</li>
<li><code>docker restart CONTAINER</code>：重启容器</li>
<li><code>docker rm CONTAINER</code>：删除容器</li>
<li><code>docker run -p HOST_PORT:CONTAINER_PORT --name CONTAINER_NAME -itd IMAGE_NAME:TAG</code>：将创建并启动一个容器
<ul>
<li><code>-p</code>：端口映射，将宿主机的端口和容器的端口进行映射
<ul>
<li>例：<code>-p 20000:22 -p 8000:8000 -p 80:80 -p 443:443</code></li>
<li><code>22</code>：<code>ssh</code>登录服务端口</li>
<li><code>8000</code>：<code>Django</code>调试端口</li>
<li><code>80</code>：用于<code>HTTP</code>服务</li>
<li><code>443</code>：用于<code>HTTPS</code>服务</li>
</ul>
</li>
</ul>
</li>
<li><code>docker attach CONTAINER</code>：进入容器
<ul>
<li>先按<code>Ctrl-p</code>，再按<code>Ctrl-q</code>可以挂起容器</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="docker环境配置">Docker环境配置</h3>
<ol>
<li><code>scp django_lesson_1_0.tar server</code>：将<code>docker压缩包</code>传至云服务器</li>
<li><code>ssh server</code>：免密登录至云服务器</li>
<li><code>docker load -i django_lesson_1_0.tar</code>：将<code>docker压缩包</code>解压缩成<code>docker镜像</code></li>
<li><code>docker run -p 20000:22 8000:8000 --name django -itd django_lesson:1.0</code> ：利用 <code>镜像django_lesson:1.0</code> 创建一个命名为 <code>django</code> 的 <code>docker容器</code>并启动</li>
<li><code>docker attach my_docker_server</code>：进入创建的<code>docker容器</code>（服务器）</li>
<li><code>adduser acs</code>：创建<code>acs</code>用户</li>
<li><code>usermod -aG sudo acs</code>：为<code>acs</code>用户分配<code>sudo</code>权限</li>
<li><code>scp .bashrc .vimrc .tmux.conf django</code>：将本地服务器的<code>bash</code>&amp;<code>vim</code>&amp;<code>tmux</code>配置文件传至<code>docker 容器</code></li>
</ol>
<h3 id="docker项目迁移">Docker项目迁移</h3>
<p>第一步，登录容器，关闭所有运行中的任务</p>
<p>第二步，登录运行容器的服务器，然后执行：</p>
<pre tabindex="0"><code>docker commit CONTAINER_NAME django_lesson:1.1  # 将容器保存成镜像，将CONTAINER_NAME替换成容器名称
docker stop CONTAINER_NAME # 关闭容器
docker rm CONTAINER_NAME # 删除容器
</code></pre><h3 id="增加容器的映射端口--80-与-443">增加容器的映射端口 : 80 与 443</h3>
<blockquote>
<p><strong>给运行中的容器，开通端口，是一件非常麻烦的事情</strong></p>
<p><strong>一个比较好的解决方案 : 先把容器保存成镜像，再删掉容器，然后用镜像生成新的容器，同时打开需要的端口</strong></p>
</blockquote>
<p>第一步，登录容器，关闭所有运行中的任务</p>
<p>第二步，登录运行容器的服务器，然后执行 :</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker commit CONTAINER_NAME django_lesson:1.1  <span style="color:#007f7f"># 将容器保存成镜像，将CONTAINER_NAME替换成容器名称</span>
</span></span><span style="display:flex;"><span>docker stop CONTAINER_NAME  <span style="color:#007f7f"># 关闭容器</span>
</span></span><span style="display:flex;"><span>docker rm CONTAINER_NAME <span style="color:#007f7f"># 删除容器</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 使用保存的镜像重新创建容器</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker run -p 20000:22 -p 8000:8000 -p 80:80 -p 443:443 --name CONTAINER_NAME -itd django_lesson:1.1
</span></span></code></pre></div><p>第三步，去云服务器控制台，在安全组配置中开放80和443端口</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>我获取信息的方式</title>
      <link>https://xancoding.cn/posts/get-info/</link>
      <pubDate>Wed, 12 Oct 2022 22:42:04 +0800</pubDate>
      
      <guid>https://xancoding.cn/posts/get-info/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;这个时代不缺信息，因为信息太多了，缺的是时间&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;整个互联网正在充斥着流量内容，而我们得学会如何从垃圾中找到金子&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;获取信息的方式最好是主动的，摆脱算法和机器的喂养，自己去挖掘有价值的信息&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;rss&#34;&gt;RSS&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Inoreader &amp;amp; RSSHub Radar&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;什么是rss&#34;&gt;什么是RSS?&lt;/h2&gt;
&lt;p&gt;RSS 英文全称为 Really Simple Syndication，即简易资讯聚合。其实叫什么并不重要，我们只用知道它是一个&lt;strong&gt;能让你在一个地方订阅&lt;/strong&gt;各种感兴趣网站的工具。&lt;/p&gt;
&lt;p&gt;RSS的核心是&lt;strong&gt;资讯聚合&lt;/strong&gt;，由&lt;strong&gt;用户自己决定信息源&lt;/strong&gt;。我们可以通过订阅网站的RSS源，主动获得想要的资讯，去挖掘一些自己真正感兴趣的东西。&lt;/p&gt;
&lt;h2 id=&#34;如何使用rss&#34;&gt;如何使用RSS?&lt;/h2&gt;
&lt;p&gt;利用RSS获取信息，只需要在目标网站上找到RSS链接，并把它添加到RSS阅读器中。&lt;/p&gt;
&lt;p&gt;我使用的工具是&lt;code&gt;Inoreader RSS 阅读器 （需翻墙） + RSSHub Radar 浏览器插件&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Inoreader&lt;/code&gt; 吸引我的点是它支持PC端和手机端的同步，并且PC端可以直接通过浏览器插件使用，使我在手机和电脑上都可以查看消息。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;RSSHub Radar&lt;/code&gt; 的出现，完美解决了不是所有的网页都提供RSS源这一痛点，它可以自动生成网站的RSS源以供订阅，非常方便。&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/10/30/635e1cf8e7955.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/10/30/635e1cf8e7955.png&#34; alt=&#34;RSSHub Radar&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;p&gt;我使用RSS主要用来订阅我感兴趣的个人博客，我订阅的博客网站在 &lt;code&gt;Links&lt;/code&gt; 页面下的 &lt;a href=&#34;https://xancoding.cn/links/#blogs&#34;&gt;Blog&lt;/a&gt; 那一栏。&lt;/p&gt;
&lt;h1 id=&#34;播客&#34;&gt;播客&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;小宇宙&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;播客也是一个很好的信息源，可以在做一些不用🧠的事时听，适合用来拓宽自己的知识面，对一些自己之前完全没有接触过的领域做一个初步的了解，抑或是单纯用以放松也不错。我的使用场景通常是在吃饭或是上下课的路上。&lt;br&gt;
我目前在使用的播客软件是&lt;a href=&#34;https://www.xiaoyuzhoufm.com/&#34;&gt;小宇宙&lt;/a&gt;，体验不错。&lt;/p&gt;
&lt;h1 id=&#34;书籍&#34;&gt;书籍&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Neat Reader &amp;amp; Sumatra PDF &amp;amp; Z-Library &amp;amp; LoreFree &amp;amp; 学校图书馆&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;Neat Reader&lt;/code&gt; 是一款&lt;code&gt;EPUB&lt;/code&gt;阅读器，用以阅读EPUB格式的电子书，体验感不错。我会在 &lt;a href=&#34;https://zh.z-lib.org/&#34;&gt;Z-Library&lt;/a&gt; or &lt;a href=&#34;https://lorefree.com/&#34;&gt;LoreFree&lt;/a&gt; 上搜索得到我想要看的书的EPUB格式的电子书后，存在本地文件上，通过 &lt;a href=&#34;https://www.neat-reader.com/&#34;&gt;Neat Reader&lt;/a&gt; 阅读。&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/10/30/635e1cf8284ec.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/10/30/635e1cf8284ec.png&#34; alt=&#34;neatReader&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;p&gt;如果找不到EPUB格式的书籍，我会存 PDF 格式的，然后在 &lt;a href=&#34;https://www.sumatrapdfreader.org/free-pdf-reader&#34;&gt;Sumatra PDF&lt;/a&gt; 上阅读&lt;/p&gt;
&lt;p&gt;不过，相比于电子书，我其实还是更喜欢纸质书的阅读体验。所以，我也会隔段时间便去拿着自己的书单，去学校的图书馆找书看（当然，并不是每次图书馆都有我想要的书😭）&lt;/p&gt;
&lt;h1 id=&#34;搜索引擎&#34;&gt;搜索引擎&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Chrome（需翻墙） &amp;amp; AdblockPlus &amp;amp; uBlacklist | Personal Blocklist&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;在搜索引擎体验上， Google （强推，体验极佳） &amp;gt; Bing （偶尔用用） &amp;raquo; Baidu （完全不考虑）&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;chrome-浏览器设置&#34;&gt;Chrome 浏览器设置&lt;/h2&gt;
&lt;h3 id=&#34;快捷字词搜索&#34;&gt;快捷字词搜索&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Chrome&lt;/code&gt; 浏览器可以通过在地址栏中输入快捷字词，实现在特定网站中搜索内容，或使用其他搜索引擎进行搜索&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在 Chrome 浏览器右上角找到 &lt;code&gt;设置&lt;/code&gt;，

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371ac394f6db.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371ac394f6db.png&#34; alt=&#34;search&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;点击 &lt;code&gt;搜索引擎&lt;/code&gt;，并在之后点击 &lt;code&gt;管理搜索引擎和网站搜索&lt;/code&gt;

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371ace7ade0d.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371ace7ade0d.png&#34; alt=&#34;search&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;更改快捷键，或者新增新的快捷键

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371af38b5c49.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371af38b5c49.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;



&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371af5ca10f1.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371af5ca10f1.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;



&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371af6d813e6.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371af6d813e6.png&#34; alt=&#34;3&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;在完成上述操作后，就可以通过在地址栏中输入快捷字词实现愉快的简便搜索啦🥳&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/10/30/635e1cfa54e5d.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/10/30/635e1cfa54e5d.png&#34; alt=&#34;search2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h2 id=&#34;chrome-浏览器插件&#34;&gt;Chrome 浏览器插件&lt;/h2&gt;
&lt;p&gt;Chrome 浏览器简洁的界面深得我心，在安装一部分插件后，搜索体验更是极佳😍&lt;/p&gt;
&lt;h3 id=&#34;广告屏蔽&#34;&gt;广告屏蔽&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;AdblockPlus&lt;/code&gt; 由用户手动设置拦截网页上不想看到的内容，我使用这个插件把一些网站我不想要看到的内容进行屏蔽，以获得更为简洁的体验&lt;br&gt;
屏蔽前：

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371b01858fd4.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371b01858fd4.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


屏蔽后：

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371b05a8a732.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371b05a8a732.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


小声BB：启动这个插件，在使用过程中，可能会碰到部分网页显示异常的情况，这个时候需要把该网页加入白名单来保证网页正常显示

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371b54d0642a.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371b54d0642a.png&#34; alt=&#34;3&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/p&gt;
&lt;h3 id=&#34;搜索内容屏蔽&#34;&gt;搜索内容屏蔽&lt;/h3&gt;
&lt;h4 id=&#34;ublacklist&#34;&gt;uBlacklist&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;uBlacklist&lt;/code&gt; 在搜索时屏蔽特定网站，做到对低质内容的过滤&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;点击 &lt;code&gt;选项&lt;/code&gt;

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371b3521b290.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371b3521b290.png&#34; alt=&#34;1&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;在箭头所示部分增加过滤规则并保存

&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; href=&#34;https://bu.dusays.com/2022/11/14/6371b35c32ad8.png&#34;&gt;
&lt;img src=&#34;https://bu.dusays.com/2022/11/14/6371b35c32ad8.png&#34; alt=&#34;2&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;


以下是我添加的一些过滤规则：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;*://www.csdn.net/*
*://bbs.csdn.net/*
*://blog.csdn.net/*
*://zhidao.baidu.com/*
*://www.cnblogs.com/*

*://z.sogou.com/*
*://wenku.baidu.com/*
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2022-11-14 更新：不知道是为什么，最近一段时间这个插件失效了&lt;/p&gt;
&lt;h4 id=&#34;personal-blocklist&#34;&gt;Personal Blocklist&lt;/h4&gt;
&lt;p&gt;使用方法和 &lt;code&gt;uBlacklist&lt;/code&gt; 差不多，目前使用来看效果不错&lt;/p&gt;
&lt;h1 id=&#34;推荐阅读&#34;&gt;推荐阅读&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/349349861&#34;&gt;知道RSS的人越少，我就越希望它能被人知道！&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/VUhz2Tg08UqYSAZB6nU9MQ&#34;&gt;RSS 二十年&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rss-source.com/&#34;&gt;RSS Source | RSS订阅源推荐&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://haoeric.github.io/Google-search-grammar/&#34;&gt;Practical Google Search Tips&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://catcoding.me/p/get-better-info/&#34;&gt;优化自己的信息源&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zhihu.com/question/49684783/answer/2305132342&#34;&gt;中文互联网的产出在渐渐枯萎&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<blockquote>
<p><strong>这个时代不缺信息，因为信息太多了，缺的是时间</strong></p>
<p><strong>整个互联网正在充斥着流量内容，而我们得学会如何从垃圾中找到金子</strong></p>
<p><strong>获取信息的方式最好是主动的，摆脱算法和机器的喂养，自己去挖掘有价值的信息</strong></p>
</blockquote>
<h1 id="rss">RSS</h1>
<ul>
<li><code>Inoreader &amp; RSSHub Radar</code></li>
</ul>
<h2 id="什么是rss">什么是RSS?</h2>
<p>RSS 英文全称为 Really Simple Syndication，即简易资讯聚合。其实叫什么并不重要，我们只用知道它是一个<strong>能让你在一个地方订阅</strong>各种感兴趣网站的工具。</p>
<p>RSS的核心是<strong>资讯聚合</strong>，由<strong>用户自己决定信息源</strong>。我们可以通过订阅网站的RSS源，主动获得想要的资讯，去挖掘一些自己真正感兴趣的东西。</p>
<h2 id="如何使用rss">如何使用RSS?</h2>
<p>利用RSS获取信息，只需要在目标网站上找到RSS链接，并把它添加到RSS阅读器中。</p>
<p>我使用的工具是<code>Inoreader RSS 阅读器 （需翻墙） + RSSHub Radar 浏览器插件</code>。</p>
<p><code>Inoreader</code> 吸引我的点是它支持PC端和手机端的同步，并且PC端可以直接通过浏览器插件使用，使我在手机和电脑上都可以查看消息。</p>
<p><code>RSSHub Radar</code> 的出现，完美解决了不是所有的网页都提供RSS源这一痛点，它可以自动生成网站的RSS源以供订阅，非常方便。</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/10/30/635e1cf8e7955.png">
<img src="https://bu.dusays.com/2022/10/30/635e1cf8e7955.png" alt="RSSHub Radar"  />
</a>
</div>

</p>
<p>我使用RSS主要用来订阅我感兴趣的个人博客，我订阅的博客网站在 <code>Links</code> 页面下的 <a href="https://xancoding.cn/links/#blogs">Blog</a> 那一栏。</p>
<h1 id="播客">播客</h1>
<ul>
<li><code>小宇宙</code></li>
</ul>
<p>播客也是一个很好的信息源，可以在做一些不用🧠的事时听，适合用来拓宽自己的知识面，对一些自己之前完全没有接触过的领域做一个初步的了解，抑或是单纯用以放松也不错。我的使用场景通常是在吃饭或是上下课的路上。<br>
我目前在使用的播客软件是<a href="https://www.xiaoyuzhoufm.com/">小宇宙</a>，体验不错。</p>
<h1 id="书籍">书籍</h1>
<ul>
<li><code>Neat Reader &amp; Sumatra PDF &amp; Z-Library &amp; LoreFree &amp; 学校图书馆</code></li>
</ul>
<p><code>Neat Reader</code> 是一款<code>EPUB</code>阅读器，用以阅读EPUB格式的电子书，体验感不错。我会在 <a href="https://zh.z-lib.org/">Z-Library</a> or <a href="https://lorefree.com/">LoreFree</a> 上搜索得到我想要看的书的EPUB格式的电子书后，存在本地文件上，通过 <a href="https://www.neat-reader.com/">Neat Reader</a> 阅读。</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/10/30/635e1cf8284ec.png">
<img src="https://bu.dusays.com/2022/10/30/635e1cf8284ec.png" alt="neatReader"  />
</a>
</div>

</p>
<p>如果找不到EPUB格式的书籍，我会存 PDF 格式的，然后在 <a href="https://www.sumatrapdfreader.org/free-pdf-reader">Sumatra PDF</a> 上阅读</p>
<p>不过，相比于电子书，我其实还是更喜欢纸质书的阅读体验。所以，我也会隔段时间便去拿着自己的书单，去学校的图书馆找书看（当然，并不是每次图书馆都有我想要的书😭）</p>
<h1 id="搜索引擎">搜索引擎</h1>
<ul>
<li><code>Chrome（需翻墙） &amp; AdblockPlus &amp; uBlacklist | Personal Blocklist</code></li>
<li><strong>在搜索引擎体验上， Google （强推，体验极佳） &gt; Bing （偶尔用用） &raquo; Baidu （完全不考虑）</strong></li>
</ul>
<h2 id="chrome-浏览器设置">Chrome 浏览器设置</h2>
<h3 id="快捷字词搜索">快捷字词搜索</h3>
<p><code>Chrome</code> 浏览器可以通过在地址栏中输入快捷字词，实现在特定网站中搜索内容，或使用其他搜索引擎进行搜索</p>
<ol>
<li>在 Chrome 浏览器右上角找到 <code>设置</code>，

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371ac394f6db.png">
<img src="https://bu.dusays.com/2022/11/14/6371ac394f6db.png" alt="search"  />
</a>
</div>

</li>
<li>点击 <code>搜索引擎</code>，并在之后点击 <code>管理搜索引擎和网站搜索</code>

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371ace7ade0d.png">
<img src="https://bu.dusays.com/2022/11/14/6371ace7ade0d.png" alt="search"  />
</a>
</div>

</li>
<li>更改快捷键，或者新增新的快捷键

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371af38b5c49.png">
<img src="https://bu.dusays.com/2022/11/14/6371af38b5c49.png" alt="1"  />
</a>
</div>



<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371af5ca10f1.png">
<img src="https://bu.dusays.com/2022/11/14/6371af5ca10f1.png" alt="2"  />
</a>
</div>



<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371af6d813e6.png">
<img src="https://bu.dusays.com/2022/11/14/6371af6d813e6.png" alt="3"  />
</a>
</div>

</li>
<li>在完成上述操作后，就可以通过在地址栏中输入快捷字词实现愉快的简便搜索啦🥳</li>
</ol>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/10/30/635e1cfa54e5d.png">
<img src="https://bu.dusays.com/2022/10/30/635e1cfa54e5d.png" alt="search2"  />
</a>
</div>

</p>
<h2 id="chrome-浏览器插件">Chrome 浏览器插件</h2>
<p>Chrome 浏览器简洁的界面深得我心，在安装一部分插件后，搜索体验更是极佳😍</p>
<h3 id="广告屏蔽">广告屏蔽</h3>
<p><code>AdblockPlus</code> 由用户手动设置拦截网页上不想看到的内容，我使用这个插件把一些网站我不想要看到的内容进行屏蔽，以获得更为简洁的体验<br>
屏蔽前：

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371b01858fd4.png">
<img src="https://bu.dusays.com/2022/11/14/6371b01858fd4.png" alt="1"  />
</a>
</div>


屏蔽后：

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371b05a8a732.png">
<img src="https://bu.dusays.com/2022/11/14/6371b05a8a732.png" alt="2"  />
</a>
</div>


小声BB：启动这个插件，在使用过程中，可能会碰到部分网页显示异常的情况，这个时候需要把该网页加入白名单来保证网页正常显示

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371b54d0642a.png">
<img src="https://bu.dusays.com/2022/11/14/6371b54d0642a.png" alt="3"  />
</a>
</div>

</p>
<h3 id="搜索内容屏蔽">搜索内容屏蔽</h3>
<h4 id="ublacklist">uBlacklist</h4>
<p><code>uBlacklist</code> 在搜索时屏蔽特定网站，做到对低质内容的过滤</p>
<ol>
<li>点击 <code>选项</code>

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371b3521b290.png">
<img src="https://bu.dusays.com/2022/11/14/6371b3521b290.png" alt="1"  />
</a>
</div>

</li>
<li>在箭头所示部分增加过滤规则并保存

<div class="post-img-view">
<a data-fancybox="gallery" href="https://bu.dusays.com/2022/11/14/6371b35c32ad8.png">
<img src="https://bu.dusays.com/2022/11/14/6371b35c32ad8.png" alt="2"  />
</a>
</div>


以下是我添加的一些过滤规则：</li>
</ol>
<pre tabindex="0"><code>*://www.csdn.net/*
*://bbs.csdn.net/*
*://blog.csdn.net/*
*://zhidao.baidu.com/*
*://www.cnblogs.com/*

*://z.sogou.com/*
*://wenku.baidu.com/*
</code></pre><p>2022-11-14 更新：不知道是为什么，最近一段时间这个插件失效了</p>
<h4 id="personal-blocklist">Personal Blocklist</h4>
<p>使用方法和 <code>uBlacklist</code> 差不多，目前使用来看效果不错</p>
<h1 id="推荐阅读">推荐阅读</h1>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/349349861">知道RSS的人越少，我就越希望它能被人知道！</a></li>
<li><a href="https://mp.weixin.qq.com/s/VUhz2Tg08UqYSAZB6nU9MQ">RSS 二十年</a></li>
<li><a href="https://rss-source.com/">RSS Source | RSS订阅源推荐</a></li>
</ul>
<hr>
<ul>
<li><a href="http://haoeric.github.io/Google-search-grammar/">Practical Google Search Tips</a></li>
</ul>
<hr>
<ul>
<li><a href="https://catcoding.me/p/get-better-info/">优化自己的信息源</a></li>
<li><a href="https://www.zhihu.com/question/49684783/answer/2305132342">中文互联网的产出在渐渐枯萎</a></li>
</ul>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
